# GitHub to Vercel Deployment Guide

Complete step-by-step guide for deploying Grounded PWA releases to Vercel via GitHub.

## Prerequisites

- âœ… GitHub repository set up
- âœ… Vercel account (free tier works)
- âœ… Code committed to GitHub
- âœ… `vercel.json` file in project root (already configured)

## Step 1: Connect GitHub Repository to Vercel

### Option A: First-Time Setup (Recommended)

1. **Go to Vercel Dashboard**
   - Visit https://vercel.com
   - Sign in or create a free account

2. **Import Your Project**
   - Click "Add New..." â†’ "Project"
   - Select "Import Git Repository"
   - Choose your GitHub repository
   - Click "Import"

3. **Configure Project Settings**
   - **Project Name**: `grounded` (or your preferred name)
   - **Framework Preset**: Vite (should auto-detect)
   - **Root Directory**: `./` (leave as default)
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`
   - **Install Command**: `npm install`

4. **Environment Variables** (if needed)
   - Add any required environment variables
   - For this project, none are typically needed

5. **Deploy**
   - Click "Deploy"
   - Wait for build to complete (2-5 minutes)

### Option B: Using Vercel CLI

```bash
# Install Vercel CLI globally
npm i -g vercel

# Login to Vercel
vercel login

# Link project to Vercel
vercel link

# Deploy
vercel --prod
```

## Step 2: Verify Vercel Configuration

Ensure `vercel.json` is in your project root:

```json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "Cross-Origin-Opener-Policy",
          "value": "same-origin"
        },
        {
          "key": "Cross-Origin-Embedder-Policy",
          "value": "require-corp"
        },
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    },
    {
      "source": "/index.html",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=0, must-revalidate"
        }
      ]
    },
    {
      "source": "/manifest.webmanifest",
      "headers": [
        {
          "key": "Content-Type",
          "value": "application/manifest+json"
        }
      ]
    }
  ]
}
```

## Step 3: GitHub Workflow for Releases

### Method 1: Manual Release via GitHub UI (Recommended)

1. **Prepare Your Release**
   ```bash
   # Ensure all changes are committed
   git add .
   git commit -m "Release v1.13.4"
   git push origin main
   ```

2. **Create a GitHub Release**
   - Go to your GitHub repository
   - Click "Releases" â†’ "Create a new release"
   - **Tag version**: `v1.13.4` (must match `package.json` version)
   - **Release title**: `Grounded PWA v1.13.4`
   - **Description**: Copy from `RELEASE_NOTES.md` or write release notes
   - **Target**: `main` (or your default branch)
   - Click "Publish release"

3. **Vercel Auto-Deployment**
   - Vercel automatically detects the new release
   - Triggers a new deployment
   - Builds and deploys to production
   - You'll receive an email notification when complete

4. **Verify Deployment**
   - Check Vercel dashboard for deployment status
   - Visit your Vercel URL (e.g., `grounded-nu.vercel.app`)
   - Test the PWA installation

### Method 2: Using Git Tags (Alternative)

```bash
# Create and push a tag
git tag -a v1.13.4 -m "Release v1.13.4"
git push origin v1.13.4

# Vercel will automatically deploy
```

### Method 3: Push to Main Branch (Automatic)

```bash
# Push to main branch
git push origin main

# Vercel automatically deploys on push to main
```

## Step 4: Build and Deploy Process

### What Happens Automatically

1. **GitHub Push/Release** â†’ Triggers Vercel webhook
2. **Vercel Build** â†’ Runs `npm install` and `npm run build`
3. **Vercel Deploy** â†’ Deploys `dist/` folder to CDN
4. **Vercel Config** â†’ Applies headers from `vercel.json`
5. **Live URL** â†’ App available at `your-project.vercel.app`

### Build Command Details

Vercel runs:
```bash
npm install
npm run build
```

Which executes:
```bash
npm run download:models && vite build && node scripts/fix-sw-registration.js
```

This:
- Downloads AI models
- Builds the Vite production bundle
- Fixes Service Worker registration

## Step 5: Custom Domain (Optional)

1. **In Vercel Dashboard**
   - Go to Project Settings â†’ Domains
   - Add your custom domain (e.g., `grounded.acminds.com`)
   - Follow DNS configuration instructions

2. **DNS Configuration**
   - Add CNAME record pointing to Vercel
   - Wait for DNS propagation (5-60 minutes)
   - SSL certificate auto-generated by Vercel

## Step 6: Verification Checklist

After deployment, verify:

- [ ] **Build succeeded** in Vercel dashboard
- [ ] **App loads** at Vercel URL
- [ ] **Headers are correct** (check DevTools â†’ Network)
- [ ] **PWA installable** (install prompt appears)
- [ ] **Service Worker active** (DevTools â†’ Application â†’ Service Workers)
- [ ] **AI models load** (check console for model download)
- [ ] **No console errors** in production build
- [ ] **Deep links work** (if applicable)

### Quick Verification Commands

```bash
# Check headers
curl -I https://your-project.vercel.app

# Should see:
# Cross-Origin-Opener-Policy: same-origin
# Cross-Origin-Embedder-Policy: require-corp
```

## Step 7: Rollback (If Needed)

### Via Vercel Dashboard

1. Go to Vercel Dashboard â†’ Your Project
2. Click "Deployments" tab
3. Find previous working deployment
4. Click "..." â†’ "Promote to Production"

### Via Vercel CLI

```bash
# List deployments
vercel ls

# Promote specific deployment
vercel promote <deployment-url>
```

## Step 8: Environment-Specific Deployments

### Production (Main Branch)

- **Branch**: `main`
- **URL**: `your-project.vercel.app`
- **Auto-deploy**: Yes (on every push)

### Preview Deployments

- **Branch**: Any branch except `main`
- **URL**: `your-project-git-branch-name.vercel.app`
- **Auto-deploy**: Yes (on every push to branch)

### Manual Deployment

```bash
# Deploy specific branch
vercel --prod

# Deploy preview
vercel
```

## Troubleshooting

### Build Fails

**Issue**: Build fails in Vercel
**Solution**:
1. Check build logs in Vercel dashboard
2. Verify `package.json` scripts are correct
3. Ensure all dependencies are in `package.json` (not just `devDependencies`)
4. Check Node.js version (Vercel uses Node 18+ by default)

### Headers Not Applied

**Issue**: Headers not showing in response
**Solution**:
1. Verify `vercel.json` is in project root
2. Check file syntax (valid JSON)
3. Redeploy after fixing `vercel.json`

### Service Worker Not Working

**Issue**: Service Worker registration fails
**Solution**:
1. Verify `fix-sw-registration.js` runs in build
2. Check `manifest.js` exists in `dist/`
3. Verify MIME types in `vercel.json`

### AI Models Not Loading

**Issue**: Models fail to download
**Solution**:
1. Check network tab for failed requests
2. Verify HuggingFace URLs are accessible
3. Check browser console for errors
4. Verify SharedArrayBuffer support (requires headers)

## Quick Reference Commands

```bash
# Build locally (test before deploying)
npm run build

# Preview build locally
npm run preview

# Deploy to Vercel (production)
vercel --prod

# Deploy preview
vercel

# Check deployment status
vercel ls

# View logs
vercel logs
```

## Best Practices

1. **Always test locally before deploying**
   ```bash
   npm run build
   npm run preview
   ```

2. **Use semantic versioning for releases**
   - Format: `v1.13.4`
   - Update `package.json` version before release

3. **Create release notes**
   - Document changes in `RELEASE_NOTES.md`
   - Include in GitHub release description

4. **Monitor deployments**
   - Check Vercel dashboard after each deployment
   - Verify app works in production

5. **Keep `vercel.json` updated**
   - Ensure headers are correct
   - Update if adding new routes or features

## Current Vercel Configuration

Your project is configured with:
- âœ… Build command: `npm run build`
- âœ… Output directory: `dist`
- âœ… Headers configured in `vercel.json`
- âœ… Auto-deploy on push to `main`
- âœ… Preview deployments for branches

## Support

- **Vercel Docs**: https://vercel.com/docs
- **GitHub Actions**: Can be added for custom workflows
- **Vercel CLI Docs**: https://vercel.com/docs/cli

---

**Quick Start**: Push to `main` branch â†’ Vercel auto-deploys â†’ Done! ðŸš€

