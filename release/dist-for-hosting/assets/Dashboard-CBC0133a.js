var et=Object.defineProperty;var m=(i,d)=>et(i,"name",{value:d,configurable:!0});import{R as X,j as e,r as a}from"./react-vendor-ByHOp49b.js";import{EMOTIONAL_STATES as ge,getEmotionalState as K}from"./emotionalStates-CHdd7_6Z.js";import{m as pe}from"./animations-F5nNuMjH.js";import{h as tt}from"./animations-CgpoTaqC.js";import{S as st,a as De,d as q,b as Te,c as Ae,e as Fe}from"./index-WGdxYKHL.js";import{S as ue}from"./StatusIndicator-CNI75ZVz.js";import{e as ie,f as Me,h as rt,j as Oe,k as Ve,l as at}from"./ai-services-4hnf0_d4.js";import{b as nt,s as ot}from"./emailService-BJmZKHwj.js";import"./vendor-CFU3Mex3.js";import"./transformers-CgLRIXTl.js";import"@tauri-apps/api/core";const it=m(({data:i})=>i.length===0?e.jsxs("div",{className:"bg-white dark:bg-dark-bg-secondary rounded-2xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary dark:text-white mb-4",children:"Mood Trends"}),e.jsx("p",{className:"text-text-secondary dark:text-white/70 text-sm",children:"No mood data available yet. Start logging your reflections to see trends."})]}):e.jsxs("div",{className:"bg-white dark:bg-dark-bg-secondary rounded-2xl p-6 space-y-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary dark:text-white",children:"Mood Trends"}),e.jsx("div",{className:"space-y-3",children:i.map((d,c)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xl",children:d.emoji}),e.jsx("span",{className:"text-text-secondary dark:text-white/70",children:d.label})]}),e.jsxs("span",{className:"font-semibold text-text-primary dark:text-white",children:[d.percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-bg-tertiary dark:bg-dark-bg-tertiary rounded-full h-2 overflow-hidden",children:e.jsx(pe.div,{initial:{width:0},animate:{width:`${d.percentage}%`},transition:{duration:.5,delay:c*.1},className:"h-full rounded-full",style:{backgroundColor:d.color}})})]},`${d.state}-${c}`))})]}),"MoodTrendChart"),lt=X.memo(it),ct=m(({onSelect:i,selected:d,disabled:c=!1})=>{const f=a.useCallback(u=>{c||(tt("light"),i(u))},[c,i]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary dark:text-white",children:"How are you feeling?"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-4 lg:grid-cols-8 gap-3",children:ge.map((u,b)=>{const o=d===u.state;return e.jsxs(pe.button,{onClick:m(()=>f(u.state),"onClick"),disabled:c,whileTap:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:b*.05},className:`
                flex flex-col items-center justify-center p-4 sm:p-5 rounded-2xl
                transition-all duration-200
                min-h-[88px] min-w-[88px] sm:min-h-[100px] sm:min-w-[100px]
                ${o?"ring-4 ring-navy-primary dark:ring-yellow-warm shadow-lg scale-105":"shadow-sm hover:shadow-md"}
                ${c?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                bg-white dark:bg-dark-bg-secondary
                border-2 ${o?"border-navy-primary dark:border-yellow-warm":"border-border-soft dark:border-dark-border"}
              `,children:[e.jsx("div",{className:"w-full h-10 sm:h-12 rounded-lg mb-2 transition-all",style:{backgroundColor:u.color,boxShadow:o?`0 0 0 2px ${u.color}, 0 2px 4px rgba(0,0,0,0.1)`:"none"}}),e.jsx("span",{className:"text-2xl sm:text-3xl mb-1",children:u.emoji}),e.jsx("span",{className:`
                text-xs sm:text-sm font-semibold text-center leading-tight
                ${o?"text-navy-primary dark:text-yellow-warm":"text-text-primary dark:text-white/70"}
              `,children:u.shortLabel})]},u.state)})})]})},"EmotionSelector"),dt=X.memo(ct),mt=m(({message:i,emotion:d,feeling:c,feelingEmoji:f,onActionClick:u})=>{const[b,o]=a.useState(!1);a.useEffect(()=>{const $=setTimeout(()=>o(!0),100);return()=>clearTimeout($)},[]);const N=a.useCallback($=>{u?.($)},[u]),I=c||d||"Reflection",r=f||"ðŸ’™";return e.jsxs(pe.div,{initial:{opacity:0,y:20},animate:{opacity:b?1:0,y:b?0:20},transition:{duration:.5,ease:"easeOut"},className:"bg-navy-light/10 dark:bg-dark-bg-secondary rounded-3xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-navy-primary dark:bg-yellow-warm rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white dark:text-navy-dark text-sm",children:r})}),e.jsx("span",{className:"text-sm font-semibold text-navy-primary dark:text-yellow-warm capitalize",children:I})]}),e.jsx("p",{className:"text-text-primary dark:text-white leading-relaxed",children:i}),u&&e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("p",{className:"text-sm text-text-secondary dark:text-white/70",children:"Would you like to:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:m(()=>N("reflection"),"onClick"),className:"w-full bg-white dark:bg-dark-bg-tertiary text-text-primary dark:text-white rounded-xl p-4 text-left font-medium shadow-sm hover:shadow-md transition-all active:scale-98",children:"ðŸ“ Write a reflection"}),e.jsx("button",{onClick:m(()=>N("values"),"onClick"),className:"w-full bg-white dark:bg-dark-bg-tertiary text-text-primary dark:text-white rounded-xl p-4 text-left font-medium shadow-sm hover:shadow-md transition-all active:scale-98",children:"ðŸŽ¯ See your values"}),e.jsx("button",{onClick:m(()=>N("resources"),"onClick"),className:"w-full bg-white dark:bg-dark-bg-tertiary text-text-primary dark:text-white rounded-xl p-4 text-left font-medium shadow-sm hover:shadow-md transition-all active:scale-98",children:"ðŸ“ž View resources"})]})]})]})},"AIResponseBubble"),xt=X.memo(mt),ht=m(({encouragementText:i,encouragementLoading:d,lastEncouragedState:c,selectedFeeling:f,lowStateCount:u,lcswConfig:b,values:o,onSelectEmotion:N,onActionClick:I,onResetEncouragement:r,onOpenFirstValue:$})=>{const D=(c?K(c):null)?.emoji||"ðŸ’™";return e.jsxs("div",{className:"bg-white dark:bg-dark-bg-secondary rounded-xl sm:rounded-2xl border border-border-soft dark:border-dark-border shadow-sm p-4 sm:p-5",children:[!i&&e.jsx(dt,{onSelect:N,selected:c,disabled:d}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs sm:text-sm font-black text-text-primary/50 dark:text-white/50 uppercase tracking-widest",children:"Encouragement"}),e.jsx(ue,{status:d?"processing":i?"complete":"not-done",size:"sm"})]}),e.jsx(xt,{message:i,emotion:c||void 0,feeling:f||void 0,feelingEmoji:D,onActionClick:m(P=>{P==="reflection"?$():I(P)},"onActionClick")}),u>=3&&(c==="drained"||c==="heavy"||c==="overwhelmed")&&e.jsx("div",{className:"mt-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-200 font-medium",children:["ðŸ’™ ",e.jsx("strong",{children:"Consider reaching out:"})," You've been feeling low several times. Your therapist (",b?.emergencyContact?.phone||"contact them","), a trusted friend, or the 988 Crisis & Suicide Lifeline can provide support. You don't have to go through this alone."]})}),e.jsx("button",{onClick:r,className:"w-full py-2 text-sm text-text-secondary dark:text-white/70 hover:text-text-primary dark:hover:text-white transition-colors",children:"Choose a different feeling"})]}),d&&e.jsx("div",{className:"space-y-3",children:e.jsx(st,{lines:2,showHeader:!0})})]})},"EncourageSection"),ut=m(({value:i,emotionalState:d,selectedFeeling:c,showFeelingsList:f,reflectionText:u,goalText:b,goalFreq:o,reflectionAnalysis:N,analyzingReflection:I,coachInsight:r,valueMantra:$,loading:V,aiGoalLoading:D,lcswConfig:P,onEmotionalStateChange:x,onShowFeelingsListToggle:A,onSelectedFeelingChange:w,onReflectionTextChange:z,onGoalTextChange:B,onGoalFreqChange:p,onSuggestGoal:M,onCommit:h,getReflectionPlaceholder:L,onTriggerReflectionAnalysis:g})=>e.jsxs("div",{className:"mt-4 sm:mt-6 space-y-4 sm:space-y-6 animate-pop border-t border-border-soft dark:border-dark-border/30 pt-4 sm:pt-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs sm:text-sm font-black text-text-primary/50 dark:text-white/50 uppercase tracking-widest block px-1",children:"How are you feeling right now?"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-4 lg:grid-cols-8 gap-1.5 sm:gap-2",children:ge.map(l=>{const n=d===l.state;return e.jsxs("button",{onClick:m(()=>{x(l.state),A()},"onClick"),className:`flex flex-col items-center p-2 sm:p-3 rounded-lg sm:rounded-xl border-2 transition-all active:scale-95 ${n?"border-navy-primary dark:border-white shadow-md scale-105 bg-white dark:bg-dark-bg-primary":"border-border-soft dark:border-dark-border/30 hover:border-border-soft dark:hover:border-dark-border/50 bg-white dark:bg-dark-bg-primary"}`,children:[e.jsx("div",{className:"w-full h-8 sm:h-10 rounded-md mb-1.5 sm:mb-2 transition-all",style:{backgroundColor:l.color,boxShadow:n?`0 0 0 2px ${l.color}, 0 2px 4px rgba(0,0,0,0.1)`:"none"}}),e.jsx("span",{className:`text-xs sm:text-sm font-black uppercase tracking-tight text-center leading-tight ${n?"text-text-primary dark:text-white":"text-text-primary/60 dark:text-white/60"}`,children:l.shortLabel})]},l.state)})}),f&&(()=>{const l=K(d);return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",onClick:A,children:e.jsx("div",{className:"bg-white dark:bg-dark-bg-primary rounded-2xl sm:rounded-3xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-hidden",onClick:m(n=>n.stopPropagation(),"onClick"),children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-black text-text-primary dark:text-white",children:l.label}),e.jsx("p",{className:"text-xs text-text-primary/60 dark:text-white/60 mt-1",children:l.reflectionPrompt})]}),e.jsx("button",{onClick:A,className:"w-8 h-8 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-primary/50 text-text-tertiary hover:text-text-primary dark:hover:text-white",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:l.feelings.map(n=>e.jsx("button",{onClick:m(()=>{w(n),A()},"onClick"),className:`p-3 sm:p-4 rounded-xl sm:rounded-2xl border-2 transition-all active:scale-95 ${c===n?"border-navy-primary dark:border-white font-bold text-white dark:text-text-primary":"border-border-soft dark:border-dark-border/30 bg-bg-secondary dark:bg-dark-bg-primary/50 text-text-primary dark:text-white hover:border-yellow-warm/50"}`,style:c===n?{backgroundColor:l.color}:{},children:e.jsx("span",{className:"text-xs sm:text-sm capitalize",children:n})},n))}),c&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-warm/10 dark:bg-yellow-warm/20 rounded-xl border border-yellow-warm/30",children:e.jsxs("p",{className:"text-xs text-text-primary dark:text-white",children:[e.jsx("span",{className:"font-bold",children:"Selected:"})," ",c]})})]})})}):null})(),c&&(()=>{const l=K(d);return l?e.jsx("div",{className:"mt-2 p-2 sm:p-3 bg-yellow-warm/10 dark:bg-yellow-warm/20 rounded-lg border border-yellow-warm/30",children:e.jsxs("p",{className:"text-xs sm:text-sm text-text-primary dark:text-white",children:[e.jsx("span",{className:"font-bold",children:"Feeling:"})," ",c," (",l.shortLabel,")"]})}):null})()]}),e.jsxs("div",{className:"bg-navy-primary dark:bg-navy-primary rounded-xl sm:rounded-2xl p-3 sm:p-4 shadow-md border border-navy-primary/20 dark:border-dark-border/50 relative overflow-hidden group",children:[e.jsx("p",{className:"text-xs sm:text-sm font-black text-yellow-warm/80 uppercase tracking-widest mb-1.5",children:"Focus Lens"}),V?e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(De,{width:"75%",height:"0.625rem",className:"bg-yellow-warm/30"}),e.jsx(De,{width:"50%",height:"0.625rem",className:"bg-yellow-warm/30"})]}):e.jsxs("p",{className:"text-white dark:text-white font-medium italic text-xs sm:text-sm leading-relaxed relative z-10",children:['"',r,'"']}),e.jsx("div",{className:"absolute bottom-2 right-3 sm:right-4 text-xs sm:text-sm font-black text-yellow-warm/60 uppercase opacity-60",children:$})]}),c&&(()=>{const l=K(d);return l?e.jsx("div",{className:"bg-yellow-warm/10 dark:bg-yellow-warm/20 rounded-xl sm:rounded-2xl p-3 sm:p-4 border-2 border-yellow-warm/30",children:e.jsxs("h3",{className:"text-base sm:text-lg font-black text-text-primary dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl",children:l.emoji}),e.jsx("span",{className:"capitalize",children:c}),e.jsx("span",{className:"text-yellow-warm",children:"â€”"}),e.jsx("span",{className:"text-text-primary/70 dark:text-white/70",children:l.shortLabel})]})}):null})(),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("label",{className:"text-xs sm:text-sm font-black text-text-primary/50 dark:text-white/50 uppercase tracking-widest",children:"1. Deep Reflection"}),e.jsx("span",{className:"text-xs sm:text-sm font-bold text-yellow-warm uppercase tracking-widest",children:"Systemic Focus"})]}),e.jsx("textarea",{value:u,onChange:m(l=>z(l.target.value),"onChange"),placeholder:L(o,c),className:"w-full p-3 sm:p-4 rounded-xl sm:rounded-2xl bg-bg-secondary dark:bg-dark-bg-primary/50 border-none focus:ring-2 focus:ring-yellow-warm/30 outline-none text-text-primary dark:text-white min-h-[140px] sm:min-h-[160px] resize-none text-sm sm:text-base leading-relaxed shadow-inner"}),e.jsx("button",{onClick:m(async()=>{u.trim()&&g()},"onClick"),disabled:I||!u.trim(),className:"w-full py-2 sm:py-2.5 bg-yellow-warm text-text-primary rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-xs sm:text-sm shadow-sm hover:opacity-90 transition-all active:scale-[0.98] disabled:opacity-30 disabled:cursor-not-allowed",children:I?"Analyzing...":"ðŸ’¾ Save"}),I&&e.jsx("div",{className:"text-xs sm:text-sm text-yellow-warm font-bold uppercase tracking-widest animate-pulse",children:"Analyzing reflection..."}),N&&!I&&e.jsxs("div",{className:"mt-3 p-3 sm:p-4 bg-yellow-warm/10 dark:bg-yellow-warm/20 rounded-xl border border-yellow-warm/30 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs sm:text-sm font-black text-yellow-warm uppercase tracking-widest",children:"Reflection Analysis"}),e.jsx(ue,{status:I?"processing":N?"complete":"not-done",size:"sm"})]}),e.jsx("button",{onClick:g,disabled:I||!u.trim()||!d||d==="mixed"||!c,className:"text-xs sm:text-sm font-black text-yellow-warm uppercase tracking-widest hover:underline disabled:opacity-30 disabled:cursor-not-allowed",title:"Refresh analysis",children:"ðŸ”„ Refresh"})]}),e.jsx("div",{className:"text-sm sm:text-base text-text-primary dark:text-white whitespace-pre-line leading-relaxed space-y-2",children:(()=>{let l;if(typeof N=="string")l=N;else if(N&&typeof N=="object"){const n=N;l=`## Core Themes
${(n.coreThemes||[]).map(F=>`- ${F}`).join(`
`)}

## The 'LCSW Lens'
${n.lcswLens||""}

## Reflective Inquiry
${(n.reflectiveInquiry||[]).map(F=>`- ${F}`).join(`
`)}

## Session Prep
${n.sessionPrep||""}`}else l="";return l.split(`
`).map((n,F)=>n.startsWith("##")?e.jsx("div",{className:"font-black text-yellow-warm mt-3 first:mt-0",children:n.replace("##","").trim()},F):n.startsWith("-")||/^\d+\./.test(n.trim())?e.jsx("div",{className:"ml-2",children:n},F):n.trim()?e.jsx("div",{children:n},F):e.jsx("br",{},F))})()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("label",{className:"text-xs sm:text-sm font-black text-text-primary/50 dark:text-white/50 uppercase tracking-widest",children:"2. Self-Advocacy Aim"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:M,disabled:D,className:"text-xs sm:text-sm font-black text-yellow-warm uppercase tracking-widest hover:underline disabled:opacity-50",children:D?"Suggesting...":"âœ¨ Suggest"}),e.jsx(ue,{status:D?"processing":b?"complete":"not-done",size:"sm"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{className:"flex gap-1",children:["daily","weekly","monthly"].map(l=>e.jsx("button",{onClick:m(()=>p(l),"onClick"),className:`flex-1 py-1 rounded-lg text-xs sm:text-sm font-black uppercase tracking-widest transition-all ${o===l?"bg-yellow-warm text-text-primary shadow-sm":"bg-bg-secondary dark:bg-dark-bg-primary/50 text-text-primary/40 dark:text-white/40"}`,children:l},l))}),e.jsx("textarea",{value:b,onChange:m(l=>B(l.target.value),"onChange"),placeholder:"Define one tool or boundary to implement next.",className:"w-full p-3 sm:p-4 rounded-xl sm:rounded-2xl bg-bg-secondary dark:bg-dark-bg-primary/50 border-none focus:ring-2 focus:ring-yellow-warm/30 outline-none text-text-primary dark:text-white min-h-[160px] sm:min-h-[180px] resize-y text-sm sm:text-base leading-relaxed shadow-inner",style:{minHeight:"160px"}})]})]})]}),e.jsx("button",{onClick:h,disabled:!u.trim()&&!b.trim(),className:"w-full py-3 sm:py-4 bg-yellow-warm text-text-primary rounded-xl sm:rounded-2xl font-black uppercase tracking-[0.2em] shadow-lg hover:opacity-90 transition-all active:scale-[0.98] disabled:opacity-20 text-xs sm:text-sm",children:"Archive & Commit"})]}),"ReflectionForm"),gt=m(({value:i,index:d,isActive:c,isSuccess:f,valueGoals:u,emotionalState:b,selectedFeeling:o,showFeelingsList:N,reflectionText:I,goalText:r,goalFreq:$,reflectionAnalysis:V,analyzingReflection:D,coachInsight:P,valueMantra:x,loading:A,aiGoalLoading:w,cardRef:z,onToggleActive:B,onEmotionalStateChange:p,onShowFeelingsListToggle:M,onSelectedFeelingChange:h,onReflectionTextChange:L,onGoalTextChange:g,onGoalFreqChange:l,onSuggestGoal:n,onCompleteGoal:F,onCommit:le,getReflectionPlaceholder:Z,onTriggerReflectionAnalysis:Y,lcswConfig:Q,onNavigateToHome:te})=>e.jsx("div",{ref:z,className:`bg-white dark:bg-dark-bg-primary rounded-xl sm:rounded-2xl border transition-all duration-300 ${c?"border-yellow-warm shadow-lg dark:shadow-xl":"border-border-soft dark:border-dark-border/30 shadow-sm hover:border-yellow-warm/50 dark:hover:border-yellow-warm/50"} ${f?"border-calm-sage dark:border-calm-sage ring-2 ring-calm-sage/20 dark:ring-calm-sage/30":""}`,children:e.jsxs("div",{className:"p-3 sm:p-4 md:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-grow min-w-0",children:[e.jsx("div",{className:`w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center text-xs sm:text-sm font-black shadow-sm flex-shrink-0 ${d===0?"bg-yellow-warm text-text-primary":"bg-bg-secondary dark:bg-dark-bg-primary/50 text-text-primary/40 dark:text-white/40"}`,children:d+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"text-sm sm:text-base font-black text-text-primary dark:text-white tracking-tight truncate",children:[i.name,o&&b&&(()=>{const C=K(b)?.emoji||"";return e.jsxs("span",{className:"ml-2 text-yellow-warm font-bold",children:["â€” ",C," ",o]})})()]}),e.jsx("p",{className:"text-xs font-bold text-text-primary/50 dark:text-white/50 uppercase tracking-widest",children:i.category})]})]}),e.jsx("button",{onClick:B,className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-black text-xs sm:text-sm uppercase tracking-widest transition-all shadow-sm active:scale-95 flex-shrink-0 ${c?"bg-navy-primary dark:bg-navy-primary text-white":"bg-yellow-warm text-text-primary hover:opacity-90"}`,children:c?"Close":"Check-in"})]}),!c&&u.length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border-soft dark:border-dark-border/30 flex gap-2 overflow-x-auto no-scrollbar pb-1",children:u.map(J=>e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 bg-bg-secondary dark:bg-dark-bg-primary/50 px-2 sm:px-3 py-1.5 rounded-lg sm:rounded-xl border border-border-soft dark:border-dark-border/30",children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-text-primary dark:text-white max-w-[100px] sm:max-w-[120px] truncate",children:J.text}),e.jsx("button",{onClick:m(()=>F(J),"onClick"),className:"w-5 h-5 bg-calm-sage dark:bg-calm-sage text-white rounded-md flex items-center justify-center shadow-sm active:scale-90 flex-shrink-0",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M5 13l4 4L19 7"})})})]},J.id))}),!c&&u.length===0&&te&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border-soft dark:border-dark-border/30",children:e.jsxs("p",{className:"text-xs sm:text-sm text-text-primary/60 dark:text-white/60 text-center",children:["No goals yet. Start with ",e.jsx("button",{onClick:te,className:"text-yellow-warm underline font-bold hover:opacity-90",children:"reflections"})," to create your first goal."]})}),c&&e.jsx(ut,{value:i,emotionalState:b,selectedFeeling:o,showFeelingsList:N,reflectionText:I,goalText:r,goalFreq:$,reflectionAnalysis:V,analyzingReflection:D,coachInsight:P,valueMantra:x,loading:A,aiGoalLoading:w,lcswConfig:Q,onEmotionalStateChange:p,onShowFeelingsListToggle:M,onSelectedFeelingChange:h,onReflectionTextChange:L,onGoalTextChange:g,onGoalFreqChange:l,onSuggestGoal:n,onCommit:le,getReflectionPlaceholder:Z,onTriggerReflectionAnalysis:Y})]})}),"ValueCard"),pt=X.memo(gt),ft=m(({goals:i,values:d,onCompleteGoal:c,onDeleteGoal:f})=>{const u=i.filter(b=>!b.completed);return u.length===0?null:e.jsxs("div",{className:"space-y-3 pt-4 sm:pt-6 border-t border-border-soft dark:border-dark-border/30",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-sm sm:text-base font-black text-text-primary dark:text-white tracking-tight",children:"Active Commitments"}),e.jsx("p",{className:"text-xs sm:text-sm font-black text-text-primary/50 dark:text-white/50 uppercase tracking-widest",children:'The "Work"'})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:u.map(b=>{const o=d.find(N=>N.id===b.valueId);return e.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-border-soft dark:border-dark-border/30 shadow-sm relative",children:[e.jsx("span",{className:"absolute top-2 sm:top-3 right-3 sm:right-4 px-1.5 py-0.5 bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm rounded-md text-xs font-black uppercase tracking-widest",children:b.frequency}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-yellow-warm"}),e.jsx("span",{className:"text-xs sm:text-sm font-black text-text-primary/50 dark:text-white/50 uppercase tracking-widest",children:o?.name})]}),e.jsx("div",{className:"text-sm sm:text-base font-bold text-text-primary dark:text-white mb-3 sm:mb-4 leading-snug pr-12",children:b.text}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m(()=>c(b),"onClick"),className:"flex-1 py-2 bg-calm-sage dark:bg-calm-sage text-white rounded-lg text-xs sm:text-sm font-black uppercase tracking-widest shadow-sm hover:opacity-90",children:"Done"}),e.jsx("button",{onClick:m(()=>f(b.id),"onClick"),className:"w-8 h-8 bg-bg-secondary dark:bg-dark-bg-primary/50 text-text-primary/30 dark:text-white/30 rounded-lg hover:text-red-500 dark:hover:text-red-400 flex items-center justify-center transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]})]},b.id)})})]})},"GoalsSection"),bt=X.memo(ft),yt=m(({onClose:i,lcswConfig:d})=>e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-navy-dark/60 backdrop-blur-sm animate-fade-in",onClick:i,children:e.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-lg rounded-[40px] shadow-2xl overflow-hidden animate-pop relative border border-border-soft dark:border-dark-border",onClick:m(c=>c.stopPropagation(),"onClick"),children:[e.jsx("button",{onClick:i,className:"absolute top-6 right-6 w-10 h-10 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white transition-colors z-10",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-8 sm:p-10 space-y-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“ž"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-text-primary dark:text-white tracking-tight",children:"Crisis Resources"}),e.jsx("p",{className:"text-sm sm:text-base text-text-primary/60 dark:text-white/60",children:"You're not alone. Help is available 24/7."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 p-4 sm:p-5 rounded-xl",children:[e.jsx("h3",{className:"text-lg font-black text-red-800 dark:text-red-300 mb-2",children:"ðŸš¨ Emergency Services"}),e.jsxs("div",{className:"space-y-2 text-sm text-red-700 dark:text-red-200",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"911"})," - For immediate emergencies"]}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-300",children:"Call 911 if you or someone else is in immediate danger."})]})]}),e.jsxs("div",{className:"bg-yellow-warm/10 dark:bg-yellow-warm/20 border-l-4 border-yellow-warm p-4 sm:p-5 rounded-xl",children:[e.jsx("h3",{className:"text-lg font-black text-text-primary dark:text-white mb-3",children:"ðŸ“ž Crisis Hotlines (24/7, Free, Confidential)"}),e.jsxs("div",{className:"space-y-3 text-sm text-text-primary dark:text-white",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-base",children:"988 Suicide & Crisis Lifeline"}),e.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary mt-1",children:["Dial ",e.jsx("strong",{children:"988"})," or text 988. Available 24/7 for anyone in suicidal crisis or emotional distress."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-base",children:"Crisis Text Line"}),e.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary mt-1",children:["Text ",e.jsx("strong",{children:"HOME"})," to ",e.jsx("strong",{children:"741741"}),". Free, 24/7 crisis support via text message."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-base",children:"National Domestic Violence Hotline"}),e.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary mt-1",children:["Call ",e.jsx("strong",{children:"1-800-799-SAFE (7233)"})," or text START to 88788. 24/7 support for domestic violence."]})]})]})]}),d?.emergencyContact?.phone&&e.jsxs("div",{className:"bg-navy-primary/10 dark:bg-navy-primary/20 border-l-4 border-navy-primary p-4 sm:p-5 rounded-xl",children:[e.jsx("h3",{className:"text-lg font-black text-text-primary dark:text-white mb-2",children:"ðŸ‘¤ Your Therapist"}),e.jsxs("div",{className:"space-y-2 text-sm text-text-primary dark:text-white",children:[d.emergencyContact.phone&&e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",d.emergencyContact.phone]}),d.emergencyContact.email&&e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",d.emergencyContact.email]}),d.emergencyContact.name&&e.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary mt-1",children:["Contact: ",d.emergencyContact.name]})]})]}),e.jsx("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary p-4 sm:p-5 rounded-xl border border-border-soft dark:border-dark-border",children:e.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary leading-relaxed",children:[e.jsx("strong",{children:"Remember:"})," These resources are available 24/7. If you're in crisis, don't wait - reach out immediately. Your safety and wellbeing are important."]})})]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{onClick:i,className:"w-full py-4 bg-navy-primary dark:bg-navy-primary text-white dark:text-white rounded-[24px] font-black uppercase tracking-[0.2em] shadow-xl hover:opacity-90 transition-all active:scale-[0.98]",children:"Got it"})})]})]})}),"CrisisResourcesModal");function Ge(i,d){const[c,f]=a.useState(i);return a.useEffect(()=>{const u=setTimeout(()=>{f(i)},d);return()=>{clearTimeout(u)}},[i,d]),c}m(Ge,"useDebounce");function wt(i,d,c,f,u,b){const[o,N]=a.useState(null),[I,r]=a.useState(!1),[$,V]=a.useState(null),[D,P]=a.useState("âœ¨"),[x,A]=a.useState("mixed"),[w,z]=a.useState(null),[B,p]=a.useState(!1),M=Ge(D,500),[h,L]=a.useState(""),[g,l]=a.useState(""),[n,F]=a.useState("daily"),[le,Z]=a.useState(!1),[Y,Q]=a.useState(null),[te,J]=a.useState(null),[C,fe]=a.useState(null),[_e,be]=a.useState(!1),[ce,se]=a.useState(null),[He,ye]=a.useState(!1),[We,we]=a.useState(null),[G,ke]=a.useState(0);Ge(h,2e3);const de=a.useRef({}),[U,je]=a.useState(null),[me,ve]=a.useState(null),[jt,Ne]=a.useState(null),[qe,Se]=a.useState(null),re=a.useRef(!1),ae=a.useCallback(()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const s=Math.random()*16|0;return(t==="x"?s:s&3|8).toString(16)}),[]),Pe=a.useCallback(async(t,s,y)=>{try{const k=sessionStorage.getItem("userId")||"anonymous",j=new Date().toISOString(),v=`feeling-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,_=JSON.stringify({emotion:t,subEmotion:s,valueId:y,timestamp:j,userId:k});let S="",O="",H=!1;try{const W=await ie(t,s,G,f,{recentJournalText:"",timeOfDay:(()=>{const T=new Date().getHours();return T<12?"morning":T<18?"afternoon":T<22?"evening":"night"})(),userPatterns:{frequentStates:[],progress:0}});S=JSON.stringify(W),H=!0}catch(W){console.warn("AI encouragement failed, using rule-based fallback:",W);const T=await ie(t,s,G,f,{recentJournalText:"",timeOfDay:(()=>{const R=new Date().getHours();return R<12?"morning":R<18?"afternoon":R<22?"evening":"night"})(),userPatterns:{frequentStates:[],progress:0}});S=JSON.stringify({message:T,acknowledgeFeeling:s,timestamp:j}),H=!1}let ee=O;if(!ee&&o){const W=i.find(T=>T.id===o);W&&(ee=await Me(t,W,f,{recentReflections:"",timeOfDay:(()=>{const T=new Date().getHours();return T<12?"morning":T<18?"afternoon":T<22?"evening":"night"})()}))}const he={id:v,timestamp:j,emotion:t,subEmotion:s,jsonIn:_,jsonOut:S,focusLens:ee||"",reflection:"",selfAdvocacy:"",frequency:"daily",jsonAssessment:"",isAIResponse:H,lowStateCount:G};await q.saveFeelingLog(he),console.log("âœ… Emotion interaction saved to database")}catch(k){console.error("Error saving emotion interaction:",k)}},[f,ie]),E=a.useCallback(async(t,s)=>{try{const y=sessionStorage.getItem("userId")||"anonymous",k={id:ae(),timestamp:new Date().toISOString(),type:t,sessionId:U||"no-session",valueId:o||void 0,emotionalState:x||void 0,selectedFeeling:w||void 0,metadata:s};await q.saveUserInteraction(k)}catch(y){console.error("Failed to save interaction:",y)}},[U,o,x,w,ae]),ze=a.useCallback(t=>{A(t),o&&t!=="mixed"&&E("feeling_selected",{emotionalState:t})},[o,E]),Je=a.useCallback(async t=>{z(t),o&&t&&(E("sub_feeling_selected",{selectedFeeling:t}),x&&x!=="mixed"&&t&&o&&await Pe(x,t,o))},[o,E,x]),Ce=a.useCallback(async t=>{try{const s=sessionStorage.getItem("userId")||"anonymous",y=ae(),k=Date.now();je(y),ve(k),Se(t),Ne(x),re.current=!1;const j={id:y,userId:s,startTimestamp:new Date().toISOString(),valueId:t,initialEmotionalState:x||void 0,goalCreated:!1};await q.saveSession(j),await E("card_opened")}catch(s){console.error("Failed to start session:",s)}},[x,ae,E]),ne=a.useCallback(async(t,s=!1)=>{if(!(!U||!me))try{const y=sessionStorage.getItem("userId")||"anonymous",k=Date.now(),j=Math.floor((k-me)/1e3);await q.updateSession(U,{endTimestamp:new Date().toISOString(),finalEmotionalState:x||void 0,reflectionLength:h.trim().length||void 0,goalCreated:s,duration:j}),await E("card_closed",{duration:j,goalCreated:s}),je(null),ve(null),Se(null),Ne(null),re.current=!1}catch(y){console.error("Failed to end session:",y)}},[U,me,x,h,E]),Ie=a.useRef(Ce),Re=a.useRef(ne),Ee=a.useRef(null);Ie.current=Ce,Re.current=ne,a.useEffect(()=>{const t=o!==Ee.current;if(Ee.current=o,!!t){if(o)U||Ie.current(o);else if(U){const s=qe||"";s&&Re.current(s,!1)}}},[o]),a.useEffect(()=>{o&&Promise.all([Te(`draft_reflection_${o}`),Te(`draft_goal_${o}`)]).then(([t,s])=>{t&&L(t),s&&l(s)}).catch(console.error)},[o]),a.useEffect(()=>{o&&(Ae(`draft_reflection_${o}`,h).catch(console.error),Ae(`draft_goal_${o}`,g).catch(console.error),h.trim().length>0&&!re.current&&(re.current=!0,E("reflection_started")))},[h,g,o,E]);const Be=a.useCallback(async()=>{if(!(h.trim().length>0)){console.warn("Reflection text is required");return}if(o&&h.trim())try{const S=new Date().toISOString(),O={id:`feeling-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:S,emotion:x||"mixed",subEmotion:w||null,jsonIn:JSON.stringify({emotion:x||"mixed",subEmotion:w,valueId:o,reflection:h.trim(),timestamp:S}),jsonOut:"",focusLens:Y||"",reflection:h.trim(),selfAdvocacy:"",frequency:n,jsonAssessment:"",emotionalState:x||"mixed",selectedFeeling:w||null,aiResponse:"",isAIResponse:!1,lowStateCount:G};await q.saveFeelingLog(O),console.log("âœ… Reflection saved to database")}catch(S){console.error("Error saving reflection:",S)}const s=h.trim().length>20,y=x&&x!=="mixed",k=w!==null;if(!s){console.warn("Reflection text is too short for analysis (minimum 20 characters)");return}if(!y||!k){console.warn("Please select both feeling and sub-feeling before analyzing");return}const j=K(x),v=j&&w?`Emotional State: ${j.label} (${w})

`:"",_=v?`${v}Deep Reflection:
${h}`:h;be(!0);try{const S=await rt(_,n,f,x,w,C?typeof C=="string"?JSON.parse(C):C:null),O=`## Core Themes
${S.coreThemes.map(H=>`- ${H}`).join(`
`)}

## The 'LCSW Lens'
${S.lcswLens}

## Reflective Inquiry
${S.reflectiveInquiry.map(H=>`- ${H}`).join(`
`)}

## Session Prep
${S.sessionPrep}`;fe(O)}catch(S){console.error("Reflection analysis error:",S),fe(null)}finally{be(!1)}},[h,x,w,n,f,C,o,Y,G]),Le=a.useRef(c);Le.current=c,a.useEffect(()=>{if(o){const t=i.find(s=>s.id===o);t&&(r(!0),Le.current.slice(0,3).map(s=>s.note||s.deepReflection||"").filter(Boolean).join(" ").substring(0,500),Promise.all([Me(x,t,{timeOfDay:(()=>{const s=new Date().getHours();return s<12?"morning":s<18?"afternoon":s<22?"evening":"night"})()}),Oe(t)]).then(([s,y])=>{Q(s),J(y),r(!1)}).catch(s=>{console.error("AI Motivation Error:",s),Q("There was an issue connecting to the AI coach. Focusing on the present moment is a powerful step."),J("Be Here Now"),r(!1)}))}else Q(null)},[M,o,i,f,x,w,G]);const[xe,$e]=a.useState(null);a.useEffect(()=>{if(i.length>0&&!xe){const t=i[0];Oe(t).then(s=>$e(s)).catch(()=>$e("Be Here Now"))}},[i,xe]),a.useEffect(()=>{o&&de.current[o]&&setTimeout(()=>{de.current[o]?.scrollIntoView({behavior:"smooth",block:"center"})},100)},[o]);const Ye=a.useCallback((t,s)=>{const y=s?`I feel ${s} because...

What specific situation, thought, or experience is connected to feeling ${s}?

How does feeling ${s} show up in my body, thoughts, or behaviors?

What would help me navigate feeling ${s} in a way that aligns with my values?`:null;if(y)return y;const k=["The Hour: Dominant mood 'flavor'? Thought, person, or sensation triggered it?","The Day: When did I feel 'connected' vs 'checked out'?","Daily Win: One small boundary set or self-care moment followed through?","Energy Audit: What interaction drained the battery? How to recharge?"].join(`

`),j=["The Narrative: If this week was a book chapter, what would the title be?","Coping Check: Which therapy tools felt like life jackets? Which felt like anchors?","Social Environment: How did my body feel after leaving specific social spaces?","Unfinished Business: What am I still 'chewing on' or feeling heavy about?"].join(`

`),v=["Growth Marker: What feels slightly less daunting than it did 30 days ago?","Recurring Theme: What 'broken record' thought kept appearing? What is it saying?","External Impact: How have systemic factors (finances, work) influenced me?","Goal Alignment: Am I moving toward my treatment plan version of self?"].join(`

`);return t==="weekly"?j:t==="monthly"||t==="quarterly"?v:k},[]),Ue=a.useCallback(async t=>{Z(!0),await E("suggest_clicked",{hasReflection:h.trim().length>0});try{const s=Ve(h,f);if(s.isCrisis&&s.recommendedAction!=="continue"){l(`### Safety First

âš ï¸ Your reflection contains concerning content. Please contact your therapist or emergency services if needed.

Emergency: ${f?.emergencyContact?.phone||"911"}
Crisis Line: 988`),Z(!1);return}const y=x&&w?`Emotional State: ${x}
Selected Feeling: ${w}

`:x?`Emotional State: ${x}

`:"",k=h.trim()?`${y}Deep Reflection:
${h}

${C?`Reflection Analysis:
${JSON.stringify(C,null,2)}`:""}`:y+(C?JSON.stringify(C,null,2):""),j=await generateCounselingGuidance(t,x||"mixed",h,f),v=await at(t,n,k,j,f,x,w,C);l(v)}catch(s){console.error("AI Goal Error:",s),l("Error suggesting a goal. Try writing a small, simple one yourself!")}finally{Z(!1)}},[h,C,n,x,w,f,E]),Ke=a.useCallback(async t=>{const s={...t,completed:!0};if(u({id:Date.now().toString()+"-done",date:new Date().toISOString(),valueId:t.valueId,livedIt:!0,note:`Achieved Commitment: ${t.text.substring(0,40)}...`,type:"goal-completion",goalText:t.text}),b(d.map(y=>y.id===t.id?s:y)),f?.emergencyContact?.email){const y=[f.emergencyContact.email],k=nt(d.map(j=>j.id===t.id?s:j),i,[s],!0);await ot(k,y)}},[d,i,f,u,b]),Qe=a.useCallback(t=>{b(d.filter(s=>s.id!==t))},[d,b]),Xe=a.useCallback(async t=>{ye(!0),we(t),se(null);let s;t==="drained"||t==="heavy"||t==="overwhelmed"?(s=G+1,ke(s)):(s=0,ke(0));const y=new Date().getHours(),k=y<12?"morning":y<18?"afternoon":y<22?"evening":"night",j=c.slice(0,3).map(v=>v.note||v.deepReflection||"").filter(Boolean).join(" ").substring(0,500);try{const v=await q.getFeelingLogs(30),_=v.map(R=>R.emotionalState).reduce((R,oe)=>(R[oe]=(R[oe]||0)+1,R),{}),S=Object.entries(_).sort((R,oe)=>oe[1]-R[1]).slice(0,3).map(([R])=>R),O=v.slice(0,10),H=["calm","hopeful","positive","energized"],ee=O.filter(R=>H.includes(R.emotionalState)).length,he=O.length>0?ee/O.length*100:0,W=await ie(t,w,s,f,{recentJournalText:j||void 0,timeOfDay:k,userPatterns:{frequentStates:S,progress:Math.round(he)}});se(W);const T={id:Date.now().toString()+"-feeling",timestamp:new Date().toISOString(),emotionalState:t,selectedFeeling:w,aiResponse:W,isAIResponse:!0,lowStateCount:s};try{await q.saveFeelingLog(T)}catch(R){console.error("Failed to save feeling log:",R)}}catch(v){console.error("Encouragement generation error:",v);const _="You're doing important work. Keep going, one step at a time.";se(_);const S={id:Date.now().toString()+"-feeling",timestamp:new Date().toISOString(),emotionalState:t,selectedFeeling:w,aiResponse:_,isAIResponse:!1,lowStateCount:s};try{await q.saveFeelingLog(S)}catch(O){console.error("Failed to save feeling log:",O)}}finally{ye(!1)}},[c,w,G,f]),Ze=a.useCallback(async t=>{if(!h.trim()&&!g.trim())return;const s=`${h} ${g}`.trim(),y=Ve(s);if(y.isCrisis&&y.severity==="critical"){const v=`ðŸš¨ CRISIS DETECTED

Your entry contains crisis indicators. Please:

1. Contact emergency services: 911
2. Contact your therapist: ${f?.emergencyContact?.phone||"Your therapist's emergency line"}
3. Crisis hotline: 988

This app cannot provide crisis support. Please connect with a professional immediately.`;alert(v)}const k=new Date().toISOString(),j=g.trim().length>0;if(j){const v={id:Date.now().toString()+"-goal",valueId:t,text:g,frequency:n,completed:!1,createdAt:k,updates:[]};b([v,...d]),await E("goal_created",{goalText:g.substring(0,50)})}if(await E("reflection_committed",{reflectionLength:h.trim().length,goalCreated:j}),u({id:Date.now().toString()+"-log",date:k,valueId:t,livedIt:!0,note:h.trim()||"Observed without judgment.",mood:D,type:g.trim()?"goal-update":"standard",deepReflection:h.trim()||void 0,reflectionAnalysis:C?JSON.stringify(C):void 0,emotionalState:x,selectedFeeling:w||void 0,selfAdvocacy:g.trim()||void 0,frequency:n}),x&&x!=="mixed")try{const v=JSON.stringify({emotion:x,subEmotion:w,valueId:t,reflection:h.trim(),goalText:g.trim(),frequency:n,timestamp:k}),_=JSON.stringify({encouragement:ce||"",focusLens:Y||"",reflectionAnalysis:C||null,goalSuggestion:g.trim()||null}),S={id:`feeling-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:k,emotion:x,subEmotion:w||null,jsonIn:v,jsonOut:_,focusLens:Y||"",reflection:h.trim(),selfAdvocacy:g.trim(),frequency:n,jsonAssessment:C?JSON.stringify(C):"",emotionalState:x,selectedFeeling:w||null,aiResponse:ce||"",isAIResponse:!0,lowStateCount:G};await q.saveFeelingLog(S),console.log("âœ… Complete AI interaction saved to feelingLogs")}catch(v){console.error("Error saving complete feeling log:",v)}await ne(t,j),A("mixed"),z(null),Fe(`draft_reflection_${t}`).catch(console.error),Fe(`draft_goal_${t}`).catch(console.error),V(t),setTimeout(()=>V(null),2e3),L(""),l(""),Q(null),J(null),N(null)},[h,g,n,x,w,D,C,f,d,u,b,E,ne]);return{activeValueId:o,loading:I,lastLoggedId:$,emotionalState:x,selectedFeeling:w,showFeelingsList:B,reflectionText:h,goalText:g,goalFreq:n,aiGoalLoading:le,coachInsight:Y,valueMantra:te,reflectionAnalysis:C,analyzingReflection:_e,encouragementText:ce,encouragementLoading:He,lastEncouragedState:We,lowStateCount:G,topValueMantra:xe,valueCardRefs:de,setActiveValueId:N,setEmotionalState:ze,setSelectedFeeling:Je,setShowFeelingsList:p,setReflectionText:L,setGoalText:l,setGoalFreq:F,handleSuggestGoal:Ue,handleCompleteGoal:Ke,handleDeleteGoal:Qe,handleEmotionalEncourage:Xe,handleCommit:Ze,getReflectionPlaceholder:Ye,triggerReflectionAnalysis:Be,resetEncouragement:a.useCallback(()=>{se(null),we(null)},[])}}m(wt,"useDashboard");const kt=m(({values:i,onLog:d,goals:c,onUpdateGoals:f,logs:u,lcswConfig:b,onNavigate:o,onReset:N,initialValueId:I})=>{const r=wt(i,c,u,b,d,f),[$,V]=a.useState(!1);a.useEffect(()=>{if(I)r.setActiveValueId(I);else{const p=m(()=>{r.setActiveValueId(null)},"handleReset");return window.__dashboardReset=p,()=>{delete window.__dashboardReset}}},[I,r]);const D=m(()=>{const p=new Date().getHours();return p<12?"Good morning":p<18?"Good afternoon":"Good evening"},"getGreeting"),P=m(()=>{const p=new Date().getHours();return p<12?"ðŸŒ…":p<18?"â˜€ï¸":"ðŸŒ™"},"getTimeEmoji"),x=a.useMemo(()=>{if(u.length===0)return[];const p=new Date;p.setDate(p.getDate()-7);const M=u.filter(g=>new Date(g.date)>=p),h={};M.forEach(g=>{g.emotionalState&&(h[g.emotionalState]=(h[g.emotionalState]||0)+1)});const L=M.length||1;return ge.map(g=>{const l=h[g.state]||0;return{state:g.state,emoji:g.emoji,label:g.shortLabel,percentage:Math.round(l/L*100),color:g.color}}).filter(g=>g.percentage>0).sort((g,l)=>l.percentage-g.percentage).slice(0,4)},[u]),A=i.length>0?i[0]:null,w=r.valueMantra||r.topValueMantra||"Be Here Now",z=m(p=>{p==="reflection"?i.length>0&&r.setActiveValueId(i[0].id):p==="values"?o&&o("values"):p==="resources"&&V(!0)},"handleActionClick"),B=m(()=>{i.length>0&&(r.lastEncouragedState&&r.setEmotionalState(r.lastEncouragedState),r.setActiveValueId(i[0].id))},"handleOpenFirstValue");return e.jsxs("div",{className:"space-y-4 sm:space-y-6 animate-fade-in pb-20 lg:pb-12",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary dark:text-white",children:[D()," ",P()]}),e.jsx("p",{className:"text-text-secondary dark:text-white/70",children:"How are you feeling today?"})]}),A&&e.jsx("div",{className:"bg-gradient-to-br from-yellow-warm/20 to-yellow-light/20 dark:from-yellow-warm/10 dark:to-yellow-light/10 rounded-xl sm:rounded-2xl p-3 sm:p-4",children:e.jsx("div",{className:"flex items-center justify-between gap-2 sm:gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"text-xl sm:text-2xl flex-shrink-0",children:"ðŸŽ¯"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-text-primary dark:text-white truncate",children:"Today's Focus"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-text-primary dark:text-white truncate",children:A.name})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-text-secondary dark:text-white/70 italic truncate",children:['"',w,'"']})]})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0",children:[e.jsx("div",{}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("p",{className:"text-xs sm:text-sm font-black text-yellow-warm uppercase tracking-widest",children:"Active Focus"}),e.jsxs("p",{className:"text-sm sm:text-base font-black text-text-primary dark:text-white leading-tight",children:[i.length," Core Values"]})]})]}),e.jsx(ht,{encouragementText:r.encouragementText,encouragementLoading:r.encouragementLoading,lastEncouragedState:r.lastEncouragedState,selectedFeeling:r.selectedFeeling,lowStateCount:r.lowStateCount,lcswConfig:b,values:i,onSelectEmotion:r.handleEmotionalEncourage,onActionClick:z,onResetEncouragement:r.resetEncouragement,onOpenFirstValue:B}),x.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary dark:text-white",children:"ðŸ“Š Your Week at a Glance"}),e.jsx(lt,{data:x})]}),u.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary dark:text-white",children:"âœ¨ Recent Reflections"}),e.jsx("div",{className:"space-y-2",children:u.slice(0,3).map(p=>{const h=new Date(p.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),L=i.find(n=>n.id===p.valueId),g=p.emotionalState?K(p.emotionalState):null,l=g?g.emoji:"ðŸ“";return e.jsxs("div",{className:"bg-white dark:bg-dark-bg-secondary rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary dark:text-white/70",children:h}),e.jsx("span",{className:"text-xl",children:l})]}),e.jsx("p",{className:"text-text-primary dark:text-white line-clamp-2 text-sm",children:p.note||p.deepReflection||"Reflection entry"}),L&&e.jsx("p",{className:"text-xs text-text-tertiary dark:text-white/50 mt-1",children:L.name})]},p.id)})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:i.map((p,M)=>{const h=r.activeValueId===p.id,L=r.lastLoggedId===p.id,g=c.filter(n=>n.valueId===p.id&&!n.completed),l=i.find(n=>n.id===r.activeValueId);return e.jsx(pt,{value:p,index:M,isActive:h,isSuccess:L,valueGoals:g,emotionalState:r.emotionalState,selectedFeeling:r.selectedFeeling,showFeelingsList:r.showFeelingsList,reflectionText:r.reflectionText,goalText:r.goalText,goalFreq:r.goalFreq,reflectionAnalysis:r.reflectionAnalysis,analyzingReflection:r.analyzingReflection,coachInsight:r.coachInsight,valueMantra:r.valueMantra,loading:r.loading,aiGoalLoading:r.aiGoalLoading,cardRef:m(n=>{r.valueCardRefs.current[p.id]=n},"cardRef"),onToggleActive:m(()=>{h&&(r.setEmotionalState("mixed"),r.setSelectedFeeling(null),r.setShowFeelingsList(!1)),r.setActiveValueId(h?null:p.id)},"onToggleActive"),onEmotionalStateChange:m(n=>r.setEmotionalState(n),"onEmotionalStateChange"),onShowFeelingsListToggle:m(()=>r.setShowFeelingsList(!r.showFeelingsList),"onShowFeelingsListToggle"),onSelectedFeelingChange:m(n=>r.setSelectedFeeling(n),"onSelectedFeelingChange"),onReflectionTextChange:m(n=>r.setReflectionText(n),"onReflectionTextChange"),onGoalTextChange:m(n=>r.setGoalText(n),"onGoalTextChange"),onGoalFreqChange:m(n=>r.setGoalFreq(n),"onGoalFreqChange"),onSuggestGoal:m(()=>l&&r.handleSuggestGoal(l),"onSuggestGoal"),onCompleteGoal:r.handleCompleteGoal,onCommit:m(()=>r.handleCommit(p.id),"onCommit"),getReflectionPlaceholder:r.getReflectionPlaceholder,onTriggerReflectionAnalysis:r.triggerReflectionAnalysis,lcswConfig:b,onNavigateToHome:m(()=>{o?.("home"),r.setActiveValueId(p.id)},"onNavigateToHome")},p.id)})}),e.jsx(bt,{goals:c,values:i,onCompleteGoal:r.handleCompleteGoal,onDeleteGoal:r.handleDeleteGoal}),$&&e.jsx(yt,{onClose:m(()=>V(!1),"onClose"),lcswConfig:b})]})},"Dashboard"),Ft=X.memo(kt);export{Ft as default};
