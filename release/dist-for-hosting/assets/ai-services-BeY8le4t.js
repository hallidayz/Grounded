const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/transformers-cJLoZuBt.js","assets/vendor-Dfov_G5I.js","assets/react-vendor-C3J-WWQD.js"])))=>i.map(i=>d[i]);
var ue=Object.defineProperty;var d=(e,o)=>ue(e,"name",{value:o,configurable:!0});const he="modulepreload",ge=d(function(e){return"/"+e},"assetsURL"),ne={},le=d(function(o,r,i){let n=Promise.resolve();if(r&&r.length>0){let s=d(function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))},"allSettled2");document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");n=s(r.map(c=>{if(c=ge(c),c in ne)return;ne[c]=!0;const h=c.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${l}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":he,h||(m.as="script"),m.crossOrigin="",m.href=c,u&&m.setAttribute("nonce",u),document.head.appendChild(m),h)return new Promise((p,w)=>{m.addEventListener("load",p),m.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function t(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return d(t,"handlePreloadError"),n.then(s=>{for(const a of s||[])a.status==="rejected"&&t(a.reason);return o().catch(t)})},"preload");function me(){try{return typeof SharedArrayBuffer<"u"}catch{return!1}}d(me,"checkSharedArrayBuffer");function ye(){try{return self.crossOriginIsolated===!0}catch{return!1}}d(ye,"checkCrossOriginIsolated");function fe(){try{return"gpu"in navigator&&navigator.gpu!==void 0}catch{return!1}}d(fe,"checkWebGPU");function pe(){try{return typeof WebAssembly<"u"&&typeof WebAssembly.instantiate=="function"}catch{return!1}}d(pe,"checkWASM");function Ie(){try{if("deviceMemory"in navigator&&navigator.deviceMemory)return navigator.deviceMemory*1024;const e=navigator.userAgent.toLowerCase();return/mobile|android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e)?2048:4096}catch{return null}}d(Ie,"estimateMemory");function Se(){try{const e=navigator.userAgent.toLowerCase();return/tablet|ipad|playbook|silk/i.test(e)?"tablet":/mobile|android|iphone|ipod|blackberry|iemobile|opera mini/i.test(e)?"mobile":/windows|macintosh|linux/i.test(e)?"desktop":"unknown"}catch{return"unknown"}}d(Se,"detectDeviceType");function we(){try{const e=navigator.userAgent;return e.includes("Chrome")&&!e.includes("Edg")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")&&!e.includes("Chrome")?"Safari":e.includes("Edg")?"Edge":e.includes("Opera")||e.includes("OPR")?"Opera":"Unknown"}catch{return"Unknown"}}d(we,"detectBrowser");function Ee(){try{const e=navigator.userAgent;return e.includes("Windows")?"Windows":e.includes("Mac OS")?"macOS":e.includes("Linux")?"Linux":e.includes("Android")?"Android":e.includes("iOS")||e.includes("iPhone")||e.includes("iPad")?"iOS":"Unknown"}catch{return"Unknown"}}d(Ee,"detectOS");function _e(e,o,r,i,n,t,s,a){const u=[],c=[];let h=!0,l="standard";return e||(u.push("SharedArrayBuffer is not available"),c.push("Enable COOP/COEP headers on your server (see SERVER_CONFIG.md)"),h=!1,l="single-threaded"),o||(u.push("Cross-origin isolation is not enabled"),e||c.push("Set Cross-Origin-Opener-Policy: same-origin and Cross-Origin-Embedder-Policy: require-corp headers")),i||(u.push("WebAssembly is not supported"),c.push("Use a modern browser that supports WebAssembly"),h=!1,l="unavailable"),n!==null&&(n<1024?(u.push(`Low device memory detected (${Math.round(n)}MB)`),c.push("Use smaller models or close other applications"),l="low-memory"):n<2048&&(u.push(`Limited device memory (${Math.round(n)}MB)`),c.push("Consider using smaller models for better performance"),l==="standard"&&(l="low-memory"))),r||(u.push("WebGPU is not available"),c.push("GPU acceleration unavailable - will use CPU only"),l==="standard"&&(l="cpu-only")),t==="mobile"&&n!==null&&n<3072&&(u.push("Mobile device with limited memory"),c.push("AI models may be slow or unavailable on this device"),l==="standard"&&(l="low-memory")),i?!e&&!o&&(h=!0,l="single-threaded"):(h=!1,l="unavailable"),{sharedArrayBuffer:e,crossOriginIsolated:o,webGPU:r,wasm:i,estimatedMemory:n,deviceType:t,browser:s,os:a,isCompatible:i&&(e||o),issues:u,recommendations:c,canUseAI:h,suggestedStrategy:l}}d(_e,"generateReport");function Re(){const e=me(),o=ye(),r=fe(),i=pe(),n=Ie(),t=Se(),s=we(),a=Ee();return _e(e,o,r,i,n,t,s,a)}d(Re,"checkBrowserCompatibility");function ve(e){return e.canUseAI?e.suggestedStrategy==="unavailable"?"AI models unavailable - WebAssembly not supported":e.suggestedStrategy==="single-threaded"?"AI models available (single-threaded mode) - enable COOP/COEP headers for better performance":e.suggestedStrategy==="low-memory"?"AI models available (low-memory mode) - may be slower":e.suggestedStrategy==="cpu-only"?"AI models available (CPU-only mode) - GPU acceleration unavailable":"AI models available - all features supported":"AI models unavailable - browser compatibility issue"}d(ve,"getCompatibilitySummary");let J={progress:0,status:"idle",label:""};const X=new Set;function Be(e){return X.add(e),e(J),()=>{X.delete(e)}}d(Be,"subscribeToProgress");function Z(e){J=e,X.forEach(o=>{try{o(e)}catch(r){console.error("Progress callback error:",r)}})}d(Z,"notifyProgress");function ie(e,o,r){Z({progress:Math.max(0,Math.min(100,e)),status:"loading",label:o,details:r})}d(ie,"setModelLoadingProgress");function Ce(e="Complete",o){Z({progress:100,status:"success",label:e,details:o})}d(Ce,"setProgressSuccess");function z(e="Error",o){Z({progress:J.progress,status:"error",label:e,details:o})}d(z,"setProgressError");function We(){return{...J}}d(We,"getCurrentProgress");if(typeof globalThis<"u"){const e=globalThis.ort=globalThis.ort||{};e.env=e.env||{},e.env.wasm=e.env.wasm||{},e.env.wasm.numThreads||(e.env.wasm.numThreads=typeof SharedArrayBuffer<"u"?4:1),e.registerBackend||(e.registerBackend=function(){})}typeof window<"u"&&(window.__TRANSFORMERS_ENV__=window.__TRANSFORMERS_ENV__||{},window.__TRANSFORMERS_ENV__.USE_WEBGPU=!1,window.__TRANSFORMERS_ENV__.USE_WASM=!0);const K={distilbert:{name:"DistilBERT",path:"/models/distilbert-base-uncased-finetuned-sst-2-english",task:"text-classification",description:"Fast sentiment analysis and mood classification",size:"~67MB"},tinyllama:{name:"TinyLlama",path:"/models/TinyLlama-1.1B-Chat-v1.0",task:"text-generation",description:"Best for healthcare/psychology - balanced quality and performance",size:"~637MB"}},Ae="tinyllama";let A=null,D=null,V=new Map,M=Ae,N=!1,O=null,C=null,v=null;function Q(){return A}d(Q,"getMoodTrackerModel");function R(){return D}d(R,"getCounselingCoachModel");function G(){return N}d(G,"getIsModelLoading");function Ve(e){M=e}d(Ve,"setSelectedModel");function Ye(){return K}d(Ye,"getAllModelConfigs");async function Y(){if(A=null,D=null,V.clear(),N=!1,O=null,"caches"in window){const e=await caches.keys();for(const o of e)(o.includes("transformers")||o.includes("model")||o.includes("onnx"))&&await caches.delete(o)}}d(Y,"clearModels");async function P(e=!1,o){o&&o!==M&&(M=o,(A||D)&&(e=!0));const r=o||M;if(e&&await Y(),A&&D&&M===r&&!e)try{if(await F())return!0}catch{}if(N&&O&&!e)try{const n=await O;if(A&&D&&M===r)return n}catch{}o&&o!==M&&(M=o),N=!0;let i=null;return i=setTimeout(()=>{N&&(console.warn("‚ö†Ô∏è Model loading timeout - stopping after 10 seconds"),N=!1,z("AI models unavailable","App uses rule-based responses (fully functional)"))},1e4),O=(async()=>{try{console.log("[MODEL_DEBUG] Running browser compatibility check..."),C=Re(),v=null;const n=ve(C);if(console.log(`üîç Browser compatibility: ${n}`),console.log("[MODEL_DEBUG] Compatibility details:",{canUseAI:C?.canUseAI,wasm:C?.wasm,sharedArrayBuffer:C?.sharedArrayBuffer,webGPU:C?.webGPU,estimatedMemory:C?.estimatedMemory,suggestedStrategy:C?.suggestedStrategy}),!C.wasm)return console.warn("‚ö†Ô∏è WebAssembly not supported. AI models cannot be used on this browser."),v="wasm",N=!1,z("AI models unavailable","WebAssembly not supported. Use a modern browser."),!1;C.sharedArrayBuffer?console.log("‚úì SharedArrayBuffer available - multi-threaded mode enabled"):(console.warn("‚ö†Ô∏è SharedArrayBuffer not available. Will attempt single-threaded mode."),console.warn("‚ö†Ô∏è For better performance, enable COOP/COEP headers (see SERVER_CONFIG.md)."),v="coop-coep"),console.log("[MODEL_DEBUG] Browser compatibility check passed, proceeding with model loading..."),console.log("[MODEL_DEBUG] canUseAI:",C.canUseAI,"suggestedStrategy:",C.suggestedStrategy);let t;try{if(console.log("[MODEL_DEBUG] Importing @xenova/transformers (using WASM backend)..."),typeof globalThis<"u"){const I=globalThis.ort=globalThis.ort||{};I.env||(I.env={wasm:{numThreads:typeof SharedArrayBuffer<"u"?4:1}}),I.registerBackend||(I.registerBackend=function(){})}const g=le(()=>import("./transformers-cJLoZuBt.js").then(I=>I.t),__vite__mapDeps([0,1,2])),S=new Promise((I,y)=>{setTimeout(()=>y(new Error("Import timeout after 10 seconds")),1e4)});if(t=await Promise.race([g,S]),console.log("[MODEL_DEBUG] Transformers module imported successfully"),!t||!t.pipeline)return console.error("[MODEL_DEBUG] Transformers module structure invalid:",{hasModule:!!t,hasPipeline:!!t?.pipeline,moduleKeys:t?Object.keys(t):[]}),console.info("‚ÑπÔ∏è Transformers module structure invalid. Using rule-based responses."),i&&(clearTimeout(i),i=null),N=!1,!1;console.log("[MODEL_DEBUG] Transformers module verified - pipeline function available")}catch(g){const S=g?.message||String(g),I=g?.stack||"";return console.error("[MODEL_DEBUG] Failed to import @xenova/transformers:",S),I&&console.error("[MODEL_DEBUG] Import error stack:",I),S.includes("memory")||S.includes("OOM")||S.includes("out of memory")?(v="memory",console.info("‚ÑπÔ∏è AI models unavailable: Insufficient device memory."),console.info("‚ÑπÔ∏è App uses rule-based responses (fully functional).")):S.includes("network")||S.includes("fetch")||S.includes("Failed to fetch")?(v="network",console.info("‚ÑπÔ∏è AI models unavailable: Network error during download."),console.info("‚ÑπÔ∏è App uses rule-based responses (fully functional).")):(v="unknown",console.info("‚ÑπÔ∏è AI models unavailable. App uses rule-based responses (fully functional).")),N=!1,i&&(clearTimeout(i),i=null),O=null,!1}const{pipeline:s,env:a}=t;if(!s||!a)throw new Error("Transformers module did not load correctly");if(typeof s!="function")throw new Error("Pipeline function not available in transformers module");try{a.allowLocalModels=!0,a.useBrowserCache=!0,a.useCustomCache=!1,a.cacheDir="./models-cache",a.useBrowserCache=!0,a.allowRemoteModels=!0,console.log("üì¶ Using local bundled models from /models/ directory"),console.log("üì¶ Will fallback to HuggingFace if local model not available")}catch(g){console.warn("Could not configure transformers environment, using defaults:",g)}let u="cpu",c="";C?.wasm?(u="cpu",c="ONNX Runtime WASM backend (CPU with optimizations)",C?.sharedArrayBuffer?console.log("[MODEL_DEBUG] ‚úÖ ONNX Runtime WASM backend with multi-threading available"):console.log("[MODEL_DEBUG] ‚úÖ ONNX Runtime WASM backend available (single-threaded mode)")):(u="cpu",c="CPU (fallback)",console.log("[MODEL_DEBUG] ‚ö†Ô∏è Using CPU fallback - WASM optimizations unavailable")),console.log("Loading psychology-centric AI model...");let h=0,l=0;const m=2;let p=0;const w=100,_=d(g=>{const S=Date.now(),I=S-p>=w;if(g.status==="progress"){const y=g.progress?Math.round(g.progress*100):0,E=Math.round(l/m*100+y/m);h=Math.min(100,E);const k=g.name||"model";console.log(`Model loading: ${k} - ${y}%`),I&&(ie(h,"Loading AI models...",`${k}: ${y}%`),p=S)}else if(g.status==="done"){l++;const y=Math.round(l/m*100);h=Math.min(100,y);const E=g.name||"model";console.log(`Model loaded: ${E}`),ie(h,"Loading AI models...",`${E} loaded`),p=S}},"progressCallback"),f=K[r];console.log(`Loading ${f.name} (${f.description})...`);const $=(C?.suggestedStrategy||"standard")==="low-memory"||C?.estimatedMemory!==null&&C.estimatedMemory<2048;try{console.log(`Attempting to load ${f.name} for mood tracking...`),console.log(`[MODEL_DEBUG] Pipeline call: task=${f.task}, path=${f.path}`);const g={quantized:!0,progress_callback:_,device:u};console.log(`[MODEL_DEBUG] Loading model with ${c}`);const S=new Promise((I,y)=>{setTimeout(()=>y(new Error("Model loading timeout after 30 seconds")),3e4)});A=await Promise.race([s(f.task,f.path,g),S]),console.log("[MODEL_DEBUG] Pipeline call completed successfully"),console.log(`‚úì ${f.name} model loaded successfully for mood tracking`),V.set(r,A)}catch(g){const S=g?.message||String(g),I=g?.stack||"";console.error(`[MODEL_DEBUG] Pipeline call failed for ${f.name}:`,S),console.error("[MODEL_DEBUG] Error stack:",I);const y=g?.message||String(g),E=g?.stack||"";console.error("[MODEL_DEBUG] Model loading error:",y),E&&console.error("[MODEL_DEBUG] Error stack:",E),y.includes("memory")||y.includes("OOM")||y.includes("out of memory")?(v="memory",console.warn("‚ö†Ô∏è Insufficient memory for model loading.")):y.includes("network")||y.includes("fetch")||y.includes("Failed to fetch")||y.includes("Unexpected token")||y.includes("<!DOCTYPE")||y.includes("not valid JSON")?(v="network",console.warn("‚ö†Ô∏è Network/CORS error during model loading. The model may not be accessible from HuggingFace."),console.warn("‚ö†Ô∏è This could be due to CORS restrictions or network connectivity issues."),console.warn("‚ö†Ô∏è Try checking your network connection or using a different model.")):(v="unknown",console.warn("‚ö†Ô∏è Model loading failed for unknown reason.")),console.warn("The app will continue using rule-based responses. AI features will not be available."),A=null}console.log("Loading counseling coach model...");let L=!1;if(A)try{A.task==="text-generation"&&(L=!0,console.log(`‚úì Reusing ${f.name} for counseling (text-generation model)`))}catch{L=!1}if(L)D=A,console.log(`‚úì Using ${f.name} for both mood tracking and counseling`);else{const g=r==="distilbert"?"tinyllama":r,S=K[g];if(V.has(g))D=V.get(g),console.log(`‚úì Using cached ${S.name} for counseling`);else try{console.log(`Attempting to load ${S.name} for counseling...`);const I={quantized:!0,progress_callback:_,device:u};console.log(`[MODEL_DEBUG] Loading counseling model with ${c}`);const y=new Promise((E,k)=>{setTimeout(()=>k(new Error("Counseling model loading timeout after 30 seconds")),3e4)});D=await Promise.race([s("text-generation",S.path,I),y]),console.log(`‚úì ${S.name} loaded successfully for counseling`),V.set(g,D)}catch(I){const y=I?.message||String(I),E=I?.stack||"";console.error("[MODEL_DEBUG] Counseling model loading error:",y),E&&console.error("[MODEL_DEBUG] Error stack:",E),y.includes("memory")||y.includes("OOM")||y.includes("out of memory")?(v="memory",console.warn("‚ö†Ô∏è Insufficient memory for counseling model loading.")):y.includes("network")||y.includes("fetch")||y.includes("Failed to fetch")?(v="network",console.warn("‚ö†Ô∏è Network error during counseling model loading.")):(v="unknown",console.warn("‚ö†Ô∏è Counseling model loading failed for unknown reason.")),console.warn("The app will continue using rule-based responses. AI features will not be available."),D=null}}console.log(D?"‚úì Counseling coach model ready for guidance and encouragement":"‚ö†Ô∏è Using rule-based counseling guidance (models unavailable)");const b=A!==null&&D!==null;if(i&&clearTimeout(i),N=!1,b)if(console.log("[MODEL_VERIFY] Verifying loaded models work..."),await F())ce(),Ce("AI models loaded successfully!","All models are ready to use"),console.log("‚úÖ All AI models loaded, verified, and ready!"),console.log(`  - Mood tracker: ${A?"‚úì":"‚úó"}`),console.log(`  - Counseling coach: ${D?"‚úì":"‚úó"}`);else return console.warn("‚ö†Ô∏è Models loaded but verification failed - will retry..."),await Y(),!1;else z("AI models unavailable","App will use rule-based responses"),console.warn("‚ö†Ô∏è AI models not available. App will use rule-based responses."),console.warn(`  - Mood tracker: ${A?"‚úì Loaded":"‚úó Failed"}`),console.warn(`  - Counseling coach: ${D?"‚úì Loaded":"‚úó Failed"}`),console.info(A||D?"‚ÑπÔ∏è Partial model loading: Some AI features may be available.":"‚ÑπÔ∏è All models failed to load. The app will use rule-based responses which are fully functional.");return b}catch(n){i&&clearTimeout(i),console.error("Model initialization error:",n),N=!1,O=null,A=null,D=null;const t=n instanceof Error?n.message:String(n);switch(v||(t.includes("memory")||t.includes("OOM")||t.includes("out of memory")?v="memory":t.includes("network")||t.includes("fetch")||t.includes("Failed to fetch")?v="network":t.includes("WebAssembly")||t.includes("WASM")?v="wasm":v="unknown"),v){case"memory":console.warn("‚ö†Ô∏è Insufficient memory for AI models. App will use rule-based responses.");break;case"network":console.warn("‚ö†Ô∏è Failed to download AI models. Check your internet connection."),console.warn("App will use rule-based responses.");break;case"wasm":console.warn("‚ö†Ô∏è WebAssembly not supported. AI models cannot run on this browser."),console.warn("App will continue with rule-based responses.");break;default:console.warn("‚ö†Ô∏è Failed to load on-device models. App will use rule-based responses instead.")}return!1}})(),O}d(P,"initializeModels");async function De(){if(N&&O){console.log("üöÄ Model loading already in progress, waiting for existing load...");try{return await O,x()}catch{return!1}}if(x()&&await F())return console.log("‚úÖ Models already loaded and working - skipping preload."),!0;console.log("üöÄ Starting background model preload...");try{if(x())if(console.log("‚úÖ Models already loaded, checking if current..."),await Te()){if(console.log("‚úÖ Models are current, verifying they work..."),await F())return console.log("‚úÖ Models are loaded, current, and verified working - skipping preload."),!0;console.warn("‚ö†Ô∏è Models are loaded but verification failed - will reload..."),await Y()}else console.log("‚ö†Ô∏è Models are loaded but outdated - will update..."),await Y();let e=0,o=null,r=!1;for(;!r;){e++,(e===1||e%5===0)&&console.log(`üöÄ AI model preload attempt ${e}...`);try{if(N&&O)try{if(await O,x())return!0}catch{}const t=await P(),s=Q(),a=R();if(t&&s&&a){if(console.log(`[MODEL_VERIFY] Verifying models work after ${e} attempt${e!==1?"s":""}...`),await F())return ce(),console.log(`‚úÖ AI models loaded, verified, and ready after ${e} attempt${e!==1?"s":""}!`),!0;console.warn(`‚ö†Ô∏è Models loaded but verification failed after ${e} attempt${e!==1?"s":""} - will retry...`),await Y()}(s||a)&&console.log(`‚ÑπÔ∏è Partial model loading: ${s?"Mood tracker ‚úì":"Mood tracker ‚úó"}, ${a?"Counseling coach ‚úì":"Counseling coach ‚úó"}`)}catch(t){o=t;const s=t instanceof Error?t.message:String(t),a=t instanceof Error?t.stack:"";if(s.includes("network")||s.includes("fetch")||s.includes("Failed to fetch")||s.includes("No internet")||s.includes("NetworkError")||s.includes("ERR_INTERNET_DISCONNECTED")){r=!0,console.warn(`[MODEL_DEBUG] Network error detected on attempt ${e} - stopping retries (no internet).`),console.warn("‚ö†Ô∏è AI models cannot be downloaded without internet connection.");break}e%10===0&&console.log(`[MODEL_DEBUG] Attempt ${e} failed (will retry):`,s.substring(0,100))}if(!r){const t=Math.min(1e3*Math.pow(1.5,e-1),3e4);e%5===0&&console.log(`[MODEL_DEBUG] Waiting ${Math.round(t/1e3)}s before retry ${e+1}...`),await new Promise(s=>setTimeout(s,t))}}const i=Q(),n=R();return i||n?(console.log(`‚ö†Ô∏è Model preload completed with partial loading after ${e} attempts:`),console.log(`  - Mood tracker: ${i?"‚úì":"‚úó"}`),console.log(`  - Counseling coach: ${n?"‚úì":"‚úó"}`),console.log("  - Some AI features may be available."),!0):(r?(console.warn(`‚ö†Ô∏è AI models unavailable after ${e} attempts: No internet connection.`),console.warn("‚ö†Ô∏è Connect to internet to enable AI features. App uses rule-based responses.")):console.warn(`‚ö†Ô∏è AI models unavailable after ${e} attempts. Will continue retrying in background.`),!1)}catch(e){return console.error("[MODEL_DEBUG] preloadModels() caught unexpected error:",e),!1}}d(De,"preloadModels");let H=!1;async function Ke(){if(H){console.log("üöÄ Continuous model loading already active, skipping duplicate call.");return}return H=!0,console.log("üöÄ Starting continuous AI model loading (will retry until loaded or no internet)..."),(async()=>{let e=0;const o=3;try{for(;;){if(x()&&await F()){console.log("‚úÖ AI models loaded and verified! Continuous loading complete."),H=!1;return}try{if(N){if(O)try{if(await O,x()){console.log("‚úÖ Models loaded by another process. Continuous loading complete."),H=!1;return}}catch{}}else if(await De()){console.log("‚úÖ AI models loaded successfully! Continuous loading complete."),H=!1;return}e=0,await new Promise(r=>setTimeout(r,3e4))}catch(r){const i=r instanceof Error?r.message:String(r);if(i.includes("network")||i.includes("fetch")||i.includes("Failed to fetch")||i.includes("No internet")||i.includes("NetworkError")){if(e++,console.warn(`[MODEL_DEBUG] Network error ${e}/${o} - checking internet connection...`),e>=o){console.warn("‚ö†Ô∏è Multiple network errors detected - stopping continuous model loading (no internet)."),console.warn("‚ö†Ô∏è AI models will be loaded when internet connection is restored."),H=!1;return}}else e=0;await new Promise(t=>setTimeout(t,1e4))}}}finally{H=!1}})(),Promise.resolve()}d(Ke,"preloadModelsContinuously");async function Te(){try{const e=`ai-models-version-${M}`,o=localStorage.getItem(e);if(!o)return!1;const r=JSON.parse(o),{timestamp:i,modelPath:n}=r,t=(Date.now()-i)/(1e3*60*60*24);if(t>7)return console.log(`[MODEL_VERSION] Models are ${Math.round(t)} days old - checking for updates...`),!1;const s=K[M].path;return n!==s?(console.log(`[MODEL_VERSION] Model path changed from ${n} to ${s} - update needed`),!1):!0}catch(e){return console.warn("[MODEL_VERSION] Error checking model version:",e),!0}}d(Te,"areModelsCurrent");function ce(){try{const e=`ai-models-version-${M}`,o={timestamp:Date.now(),modelPath:K[M].path,modelType:M};localStorage.setItem(e,JSON.stringify(o)),console.log(`[MODEL_VERSION] Updated version info for ${M}`)}catch(e){console.warn("[MODEL_VERSION] Error updating model version:",e)}}d(ce,"updateModelVersion");async function F(){try{const e=Q(),o=R();if(!e&&!o)return console.log("[MODEL_VERIFY] No models loaded to verify"),!1;let r=!1,i=!1;if(e)try{console.log("[MODEL_VERIFY] Testing mood tracker model...");const s=await Promise.race([e("I feel happy and grateful today"),new Promise((a,u)=>setTimeout(()=>u(new Error("Test timeout")),5e3))]);s!=null?(r=!0,console.log("[MODEL_VERIFY] ‚úì Mood tracker model works")):console.warn("[MODEL_VERIFY] ‚úó Mood tracker returned invalid result")}catch(t){console.warn("[MODEL_VERIFY] ‚úó Mood tracker test failed:",t instanceof Error?t.message:String(t))}else console.log("[MODEL_VERIFY] Mood tracker model not loaded");if(o)try{console.log("[MODEL_VERIFY] Testing counseling coach model...");const s=await Promise.race([o("Test prompt for counseling model",{max_new_tokens:10,temperature:.7}),new Promise((a,u)=>setTimeout(()=>u(new Error("Test timeout")),1e4))]);s&&(Array.isArray(s)&&s.length>0&&s[0]?.generated_text||typeof s=="object"&&s.generated_text)?(i=!0,console.log("[MODEL_VERIFY] ‚úì Counseling coach model works")):console.warn("[MODEL_VERIFY] ‚úó Counseling coach returned invalid result")}catch(t){console.warn("[MODEL_VERIFY] ‚úó Counseling coach test failed:",t instanceof Error?t.message:String(t))}else console.log("[MODEL_VERIFY] Counseling coach model not loaded");const n=(e?r:!0)&&(o?i:!0);return n?console.log("[MODEL_VERIFY] ‚úì All loaded models verified and working"):console.warn("[MODEL_VERIFY] ‚úó Some models failed verification"),n}catch(e){return console.error("[MODEL_VERIFY] Error during model verification:",e),!1}}d(F,"verifyModelsWork");function x(e=!0){return e?A!==null&&D!==null:A!==null||D!==null}d(x,"areModelsLoaded");function Je(){return{loaded:x(),loading:N,moodTracker:A!==null,counselingCoach:D!==null,compatibility:C||void 0,errorCategory:v}}d(Je,"getModelStatus");function je(){return C}d(je,"getCompatibilityReport");const be=[{phrase:"i want to die",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i want to kill myself",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i am going to kill myself",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm suicidal",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i have suicidal thoughts",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i've been thinking about suicide",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i am planning to end my life",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm going to end it all",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm going to end my life",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i want to end it",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm done with life",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i don't want to live anymore",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"life is not worth living",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm better off dead",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"everyone would be better off without me",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i wish i hadn't been born",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i wish i were dead",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i wish i didn't exist",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm thinking about ending everything",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i just want it all to stop permanently",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i can't go on living like this",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i have no reason to live",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"}],Ne=[{phrase:"i can't go on",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i can't do this anymore",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm at the end of my rope",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i feel trapped",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"there's no way out",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm done",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm finished",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm so tired of this life",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i just want to disappear",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i just want to go to sleep and not wake up",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i don't want to be here anymore",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i don't see a future for myself",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"nothing will ever get better",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"there's no point in trying anymore",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i have nothing to live for",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm such a burden",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"people would be better off without me",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"the world would be better if i were gone",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"soon this will all be over",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"if i see you again",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i won't be around much longer",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"you won't have to worry about me soon",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"}],Me=[{phrase:"i'm going to jump",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"jump off a bridge",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"jump in front of a train",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i'm going to take all my pills",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i'm going to overdose",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"use gun on myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"use knife on myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"use razor on myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i'm going to hang myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i'm going to drown myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"researching painless ways to die",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"looking up how to kill myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"how many pills it takes to overdose",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"most effective suicide methods",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"bought a gun for myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"bought a rope",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"saving my meds for when i'm ready",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"wrote my suicide note",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"picked the day i'm going to do it",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i know exactly how i'm going to end my life",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i have everything ready to end it",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"tried to overdose before",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"tried to cut before",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"tried to jump before",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"tried to hang myself before",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"last time i tried to kill myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"}],Oe=[{phrase:"i've been cutting myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i cut myself to cope",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i hurt myself on purpose",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"scratching myself until i bleed",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i've been burning myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i punch myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i hit my head",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i pull out my hair when i'm upset",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i starve myself on purpose",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i binge and then make myself throw up",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i want to hurt myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i'm scared i might hurt myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i can't stop hurting myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i like seeing myself bleed",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i deserve to be hurt",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i'm thinking about cutting again",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i have the blade ready",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i have the knife ready",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i have the razor ready",category:"CRISIS_SELF_HARM",severity:"high"}],Le=[{phrase:"i feel hopeless",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"nothing will ever change",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i feel completely alone",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i feel empty all the time",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm useless",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm worthless",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm a failure at everything",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i hate myself",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm disgusting",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm a burden to everyone",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"everyone hates me",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"nobody cares if i live or die",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"no one would miss me",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i don't matter",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i have no purpose",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm broken beyond repair",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"}],ke=[{phrase:"i've been giving away my stuff",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i'm saying goodbye to people",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i've been writing letters to everyone",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"making sure everything is in order for when i'm gone",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i quit my job and don't care what happens",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i've been isolating from everyone",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i don't talk to my friends or family anymore",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i stay in my room all day",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i started drinking a lot more",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i'm using drugs to escape",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i've been driving recklessly on purpose",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i don't care if i get hurt anymore",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"}],Pe=[{phrase:"my friend wants to kill themselves",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my friend is talking about suicide",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my friend said they want to die",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"someone i know is going to end their life",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my child keeps saying they wish they were dead",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my partner said the world would be better without them",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"a friend told me they are going to overdose",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"someone i know is cutting themself",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my friend is talking about how they would do it",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my friend wrote a suicide note",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"i'm scared my friend will hurt themselves",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"}],$e=[{phrase:"i'm going to do it now",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm going to do it tonight",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i can't stop myself",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i don't think i can stay safe",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm alone and i'm scared of what i might do",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i already took the pills",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i already cut myself and it won't stop bleeding",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm bleeding a lot",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i swallowed a lot of pills",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i just tried to hang myself",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i just tried to kill myself",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm sitting here with a gun",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm sitting here with a knife",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm sitting here with pills",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm sitting here with a rope",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm in the car ready to drive off the bridge",category:"CRISIS_IMMINENT_DANGER",severity:"critical"}],Ue=[...be,...Ne,...Me,...Oe,...Le,...ke,...Pe,...$e];function ze(e){return{CRISIS_SUICIDAL_IDEATION_DIRECT:"Direct Suicide Statements",CRISIS_SUICIDAL_IDEATION_INDIRECT:"Indirect Suicide Statements",CRISIS_PLANNING_OR_METHOD:"Suicide Planning or Methods",CRISIS_SELF_HARM:"Self-Harm",RISK_SEVERE_HOPELESSNESS:"Severe Hopelessness",RISK_BEHAVIORAL_RED_FLAGS:"Behavioral Warning Signs",CRISIS_THIRD_PARTY_SUICIDE_RISK:"Concern for Others",CRISIS_IMMINENT_DANGER:"Immediate Danger"}[e]||e}d(ze,"getCategoryDisplayName");function j(e,o){const r=e.toLowerCase(),i=[],n=[];let t="low";for(const h of Ue)r.includes(h.phrase)&&(i.push(h.phrase),n.includes(h.category)||n.push(h.category),h.severity==="critical"?t="critical":h.severity==="high"&&t!=="critical"?t="high":h.severity==="moderate"&&t==="low"&&(t="moderate"));const s=n.some(h=>h==="RISK_SEVERE_HOPELESSNESS"||h==="RISK_BEHAVIORAL_RED_FLAGS"),a=n.some(h=>h.startsWith("CRISIS_"));s&&a&&t==="moderate"&&(t="high");const u=i.length>0;let c="continue";return t==="critical"?c="emergency":t==="high"||n.includes("CRISIS_SELF_HARM")||n.includes("CRISIS_THIRD_PARTY_SUICIDE_RISK")?c="contact_lcsw":u&&(c="show_crisis_info"),{isCrisis:u,severity:t,detectedPhrases:i,recommendedAction:c,categories:n}}d(j,"detectCrisis");function de(e,o){const r=o?.emergencyContact,i=r?`${r.name||"Your therapist"}: ${r.phone}`:"Your therapist or healthcare provider";if(e.severity==="critical"||e.recommendedAction==="emergency")return e.categories?.includes("CRISIS_IMMINENT_DANGER")||e.categories?.includes("CRISIS_PLANNING_OR_METHOD")?`üö® **IMMEDIATE SAFETY CONCERN**

**Your safety is the most important thing right now.**

**If you are in immediate danger or feel you might act on thoughts of ending your life, please contact emergency services (911 in the U.S.) or the 988 Suicide & Crisis Lifeline right now.**

**This app cannot help in an emergency. If you are about to harm yourself or someone else, please call 911 or 988, or your local emergency number, immediately.**

**Please also reach out to someone you trust right now**‚Äîa close friend, family member, or someone who can be with you or check in on you. You don't have to go through this alone.

**Resources available right now:**
‚Ä¢ **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
‚Ä¢ **Crisis Text Line** - Text HOME to 741741
‚Ä¢ **Emergency Services** - 911 (U.S.) or your local emergency number
‚Ä¢ **Your Therapist**: ${i}

**If you have started to carry out a plan to end your life, stop using this app and contact 911, 988, or your local crisis service for urgent help.**

*Feeling suicidal is a medical and emotional emergency, not a personal failure. You deserve support, and help is available.*`:`üö® **SAFETY CHECK**

**It sounds like you may be thinking about ending your life or hurting yourself.**

**Are you having thoughts of suicide right now?**

**If you are thinking about suicide or have a plan, your safety is the priority. Please contact emergency services (911 in the U.S.) or the 988 Suicide & Crisis Lifeline right now.**

**This app cannot help in an emergency. If you are about to harm yourself, please call 911 or 988, or your local emergency number, immediately.**

**Please also reach out to someone you trust right now**‚Äîa close friend, family member, or someone who can be with you. You don't have to go through this alone.

**Resources available right now:**
‚Ä¢ **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
‚Ä¢ **Crisis Text Line** - Text HOME to 741741
‚Ä¢ **Emergency Services** - 911 (U.S.) or your local emergency number
‚Ä¢ **Your Therapist**: ${i}

*You are not alone in feeling this way, and it is OK to talk about suicide. Reaching out for help can make a difference. Many people have thoughts of suicide when pain feels overwhelming. Talking with a trained crisis counselor or mental health professional can help you stay safe.*`;if(e.severity==="high"||e.recommendedAction==="contact_lcsw"){const n=e.categories?.includes("CRISIS_SELF_HARM"),t=e.categories?.includes("CRISIS_THIRD_PARTY_SUICIDE_RISK");return n?`‚ö†Ô∏è **SUPPORT NEEDED**

**Thank you for sharing this. It sounds like you may be hurting yourself or thinking about self-harm.**

**What has helped you stay safe so far when you've had thoughts of suicide or self-harm?**

**Your safety matters. Please reach out for help:**

1. **Contact your therapist as soon as possible**: ${i}
2. **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
3. **Crisis Text Line** - Text HOME to 741741
4. **Reach out to someone you trust**‚Äîa close friend, family member, or someone who can support you right now

**This app is not a crisis or emergency service and cannot keep you safe in an emergency. For urgent help, contact 988, 911, or your local crisis line.**

**If you feel you might act on thoughts of self-harm, please contact a crisis line, emergency services, or your local equivalent immediately.**

*Feeling suicidal is a medical and emotional emergency, not a personal failure. You deserve support, and help is available.*`:t?`‚ö†Ô∏è **CONCERN FOR SOMEONE ELSE**

**It sounds like you're concerned about someone else who may be thinking about suicide or self-harm.**

**If someone you know is in immediate danger, please contact emergency services (911) or a crisis line right away.**

**Resources to help:**
‚Ä¢ **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
‚Ä¢ **Crisis Text Line** - Text HOME to 741741
‚Ä¢ **Emergency Services** - 911 (U.S.) or your local emergency number
‚Ä¢ **Your Therapist**: ${i}

**You can also encourage the person to reach out to a trusted friend, family member, or mental health professional.**

*This app is not a crisis or emergency service. For urgent situations, contact local emergency services or crisis lines.*`:`‚ö†Ô∏è **SUPPORT AVAILABLE**

**It sounds like you're going through a very difficult time right now.**

**Who in your life (family, friends, professionals) could you contact today to talk about how you're feeling?**

**Please reach out for help:**

1. **Contact your therapist as soon as possible**: ${i}
2. **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
3. **Crisis Text Line** - Text HOME to 741741
4. **Reach out to a trusted person**‚Äîa close friend, family member, or someone you trust‚Äîand let them know you need support right now

**This app is not a crisis or emergency service and cannot keep you safe in an emergency. For urgent help, contact 988, 911, or your local crisis line.**

**If you are thinking about suicide or self-harm, this app cannot keep you safe. Please call a crisis hotline or emergency services immediately.**

*You are not alone in feeling this way. Reaching out for help can make a difference. Would you consider creating or updating a safety plan with a mental health professional or crisis counselor?*`}return`**SUPPORT AVAILABLE**

**It sounds like you're going through a difficult time. Thank you for sharing this.**

**Please know that support is available:**

1. **Discuss this with your therapist** in your next session: ${i}
2. **988 Suicide & Crisis Lifeline** - Dial 988 if you need to talk to someone (24/7, free, confidential)
3. **Crisis Text Line** - Text HOME to 741741
4. **Consider reaching out to a trusted person**‚Äîa friend, family member, or someone you trust‚Äîand sharing what you're experiencing

**If you are thinking about suicide or self-harm, or feel you might act on harmful thoughts, please stop using the app and reach out to a trusted person or crisis service now.**

**This app cannot help in emergencies. If you are in crisis or considering self-harm, call your local emergency number or a crisis hotline now.**

*This app is not a substitute for professional therapy or crisis support. I can offer general information, but only trained people and local services can provide the immediate help you deserve when you feel suicidal.*`}d(de,"getCrisisResponse");function q(e,o){const r={},i={};e.forEach(a=>{const u=o.find(c=>c.id===a.valueId)?.name||"Unknown";r[u]=(r[u]||0)+1,a.mood&&(i[a.mood]=(i[a.mood]||0)+1)});const n=Object.entries(r).sort((a,u)=>u[1]-a[1])[0]?.[0]||"N/A",t=Object.entries(i).sort((a,u)=>u[1]-a[1])[0]?.[0]||"N/A";let s="";return e.slice(0,10).forEach(a=>{const u=o.find(c=>c.id===a.valueId);s+=`

**${new Date(a.date).toLocaleDateString()} - ${u?.name||"General"}**
`,a.deepReflection&&(s+=`
Deep Reflection:
${a.deepReflection}
`),a.goalText&&(s+=`
Committed Action/Goal:
${a.goalText}
`),a.reflectionAnalysis&&(s+=`
Suggested Next Steps:
${a.reflectionAnalysis}
`),a.emotionalState&&(s+=`
Emotional State: ${a.emotionalState}`,a.selectedFeeling&&(s+=` (${a.selectedFeeling})`),s+=`
`)}),`# Clinical Summary

## SOAP Format

**Subjective**: Client has logged ${e.length} reflection entries, with primary focus on ${n}. Most common mood indicator: ${t}.${s}

**Objective**: Patterns show engagement with value-based reflection practice. Entries span ${new Date(e[e.length-1]?.date||Date.now()).toLocaleDateString()} to ${new Date(e[0]?.date||Date.now()).toLocaleDateString()}.

**Assessment**: Client is actively engaging in self-reflection and value alignment work.

**Plan**: Continue value-based reflection. Review patterns with LCSW in next session.

---

## DAP Format

**Data**: ${e.length} entries, ${Object.keys(r).length} values engaged, mood tracking active.${s}

**Assessment**: Consistent engagement with reflection practice. Primary value focus: ${n}.

**Plan**: Maintain current practice. Discuss themes and patterns with LCSW.

---

## BIRP Format

**Behavior**: Client consistently logs reflections and tracks mood states.${s}

**Intervention**: Value-based reflection practice, self-monitoring.

**Response**: Active engagement, ${e.length} entries completed.

**Plan**: Continue practice, review with LCSW.

---

*This is a basic summary. For detailed analysis, please review entries manually or discuss with your LCSW.*`}d(q,"generateFallbackReport");async function qe(e,o,r){try{if(e.length===0)return"No logs available for synthesis.";const i=e.map(l=>l.note).filter(Boolean).join(" "),n=j(i,r);if(n.isCrisis&&n.severity==="critical"){const l=r?.emergencyContact;return`# üö® SAFETY CONCERN DETECTED IN LOGS

**Your safety is the priority.** These logs contain language that suggests you may be thinking about ending your life or hurting yourself.

**If you are in immediate danger or feel you might act on thoughts of suicide, please contact emergency services (911 in the U.S.) or the 988 Suicide & Crisis Lifeline right now.**

**This app cannot help in an emergency. If you are about to harm yourself, please call 911 or 988, or your local emergency number, immediately.**

**Please also reach out to someone you trust right now**‚Äîa close friend, family member, or someone who can be with you. You don't have to go through this alone.

**Resources available right now:**
‚Ä¢ **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
‚Ä¢ **Crisis Text Line** - Text HOME to 741741
‚Ä¢ **Emergency Services** - 911 (U.S.) or your local emergency number
‚Ä¢ **Your Therapist**: ${l?`${l.name||"Your therapist"}: ${l.phone}`:"Your therapist or healthcare provider"}

---

# Clinical Summary

Due to safety concerns detected in these logs, a full clinical summary should be reviewed with your LCSW or mental health professional in person.

*Feeling suicidal is a medical and emotional emergency, not a personal failure. You deserve support, and help is available.*`}if(!R()&&!await P())return`${q(e,o)}

---

*This report was generated using rule-based analysis. All processing happens on your device for privacy.*`;const a=`You are a therapy integration assistant helping synthesize a client's reflection logs for review with their LCSW.

Generate a comprehensive report in SOAP, DAP, and BIRP formats.
      
Logs:
      ${e.map(l=>{const m=o.find(w=>w.id===l.valueId)?.name||"General";let p=`[${l.date.split("T")[0]}] Value: ${m}, Mood: ${l.mood||"N/A"}`;return l.deepReflection&&(p+=`
  Deep Reflection: ${l.deepReflection}`),l.goalText&&(p+=`
  Committed Action/Goal: ${l.goalText}`),l.reflectionAnalysis&&(p+=`
  Suggested Next Steps: ${l.reflectionAnalysis}`),l.emotionalState&&(p+=`
  Emotional State: ${l.emotionalState}`),l.selectedFeeling&&(p+=`
  Selected Feeling: ${l.selectedFeeling}`),l.note&&!l.deepReflection&&(p+=`
  Note: ${l.note}`),p}).join(`

`)}
      
IMPORTANT: For each log entry, include:
1. Deep Reflection: The user's written reflection content
2. Committed Action: Any goals or actions the user committed to
3. Suggested Next Steps: AI-generated recommendations or analysis

Format your response with clear sections for each format. Keep the tone supportive, clinical yet human, and focused on patterns and themes that would be useful for therapy integration.`;let u=q(e,o),c=R();if(!c)if(G()){const p=Date.now();for(;!c&&Date.now()-p<3e4;)await new Promise(w=>setTimeout(w,500)),c=R()}else await P(),c=R();if(c)try{console.log("ü§ñ Using on-device AI model for report generation...");const l=performance.now(),m=await c(a,{max_new_tokens:1e3,temperature:.7,do_sample:!0}),p=performance.now(),_=(m[0]?.generated_text||"").replace(a,"").trim();_&&_.length>50?(u=_,console.log(`‚úÖ On-device AI generated report (${Math.round(p-l)}ms)`)):console.warn("‚ö†Ô∏è AI model returned empty or too short report, using fallback")}catch(l){if(console.error("‚ùå On-device AI report generation failed:",l),l instanceof Error&&(l.message.includes("not a function")||l.message.includes("Cannot read"))){await P(!0);const m=R();if(m)try{const _=((await m(a,{max_new_tokens:1e3,temperature:.7,do_sample:!0}))[0]?.generated_text||"").replace(a,"").trim();_&&(u=_)}catch(p){console.warn("Retry report generation failed:",p)}}}return u+`

---

*This report is generated on-device for your personal review and discussion with your LCSW. It is not a substitute for professional clinical assessment.*`}catch(i){return console.error("Report generation error:",i),`${q(e,o)}

---

*This report was generated using rule-based analysis. All processing happens on your device for privacy.*`}}d(qe,"generateHumanReports");function ee(e,o,r,i,n=[]){const t=`${e}|${o}|${r}|${i}|${JSON.stringify(n)}`;let s=0;for(let a=0;a<t.length;a++){const u=t.charCodeAt(a);s=(s<<5)-s+u,s=s&s}return`ai_cache_${Math.abs(s).toString(36)}`}d(ee,"generateCacheKey");async function oe(e){try{const o=`ai_cache_${e}`,r=localStorage.getItem(o);if(!r)return null;const i=JSON.parse(r);return Date.now()>i.expiresAt?(localStorage.removeItem(o),null):i}catch(o){return console.warn("Cache read error:",o),null}}d(oe,"getCachedResponse");async function B(e,o){try{const r=Date.now(),i=1440*60*1e3,n={key:e,...o,timestamp:r,expiresAt:r+i},t=`ai_cache_${e}`;localStorage.setItem(t,JSON.stringify(n))}catch(r){console.warn("Cache write error:",r)}}d(B,"setCachedResponse");function He(e,o,r){const i={"üå±":"growth and adaptation","üî•":"momentum and action","‚ú®":"alignment and flow","üßó":"challenge and resilience"}[o]||"your journey";return`Your focus on ${e.name} during this time of ${i} shows self-awareness. Consider how this reflection connects to what you've discussed with your LCSW. What small step can you take today that aligns with your treatment plan?`}d(He,"generateFallbackGuidance");function xe(e){return`## Core Themes
${e.coreThemes.map(o=>`- ${o}`).join(`
`)}

## The 'LCSW Lens'
${e.lcswLens}

## Reflective Inquiry
${e.reflectiveInquiry.map((o,r)=>`${r+1}. ${o}`).join(`
`)}

## Session Prep
${e.sessionPrep}`}d(xe,"formatReflectionAnalysisJSON");function se(e){return`### Structured Aim
- **Description**: ${e.description}
- **What this helps with**: ${e.whatThisHelpsWith}
- **How do I measure progress**:
${e.howToMeasureProgress.map((o,r)=>`  ${r+1}. ${o}`).join(`
`)}`}d(se,"formatGoalSuggestionJSON");function ae(e,o,r){const i=e.toLowerCase(),n=[];(i.includes("anxious")||i.includes("worried")||i.includes("stress"))&&n.push("Anxiety/Stress"),(i.includes("sad")||i.includes("down")||i.includes("depressed"))&&n.push("Mood/Low Energy"),(i.includes("work")||i.includes("job")||i.includes("colleague"))&&n.push("Work Environment"),(i.includes("family")||i.includes("relationship")||i.includes("friend"))&&n.push("Interpersonal Relationships"),(i.includes("sleep")||i.includes("tired")||i.includes("exhausted"))&&n.push("Physical Well-being"),n.length===0&&n.push("Self-Reflection","Personal Growth");let t="";i.includes("work")||i.includes("office")?t="Your work environment appears to be influencing your mental state. Notice how your physical space and work relationships impact your internal experience.":i.includes("home")||i.includes("house")?t="Your home environment seems significant in this reflection. Consider how your physical space and home relationships affect your well-being.":t="Consider how your environment‚Äîwhether work, home, or social spaces‚Äîconnects to what you're experiencing internally.";const s=["What specific coping mechanism did you use (or could you use) in response to what you observed?","How might advocating for yourself in this situation look different than what you've done before?"],a=o==="quarterly"?"monthly":o,u=n.length>0?`Bring the theme of "${n[0]}" to your next session. Consider discussing how your environment and coping strategies are working (or not working) for you right now.`:`Focus on discussing your reflection about ${a} patterns with your therapist. Consider what you want to explore more deeply.`;return`## Core Themes
${n.slice(0,3).map(c=>`- ${c}`).join(`
`)}

## The 'LCSW Lens'
${t}

## Reflective Inquiry
${s.map((c,h)=>`${h+1}. ${c}`).join(`
`)}

## Session Prep
${u}`}d(ae,"generateFallbackReflectionAnalysis");async function Xe(e,o,r,i,n){try{const t=j(e,r);if(t.isCrisis)return de(t,r);if(!e.trim())return"Please enter your reflection to receive analysis.";const s=r?.protocols||[],a=ee(e,i||null,n||null,o,s),u=await oe(a);if(u?.reflectionAnalysis)return console.log("‚úÖ Using cached reflection analysis"),u.reflectionAnalysis;const c=s.length>0?`The user is working with an LCSW using ${s.join(", ")} protocols.`:"The user is working with a licensed clinical social worker.",l=`Analyze this ${o==="quarterly"?"monthly":o} reflection and return ONLY valid JSON (no markdown, no extra text):

{
  "coreThemes": ["theme1", "theme2", "theme3"],
  "lcswLens": "environment/internal state connections text",
  "reflectiveInquiry": ["question1", "question2"],
  "sessionPrep": "key takeaway text"
}

Context: ${c}

Reflection:
${e}

Return valid JSON only.`;let m=R();if(!m)if(G()){const _=Date.now();for(;!m&&Date.now()-_<1e4;)await new Promise(f=>setTimeout(f,500)),m=R()}else try{await P(),m=R()}catch{console.warn("Model initialization failed for reflection analysis")}if(m)try{console.log("ü§ñ Calling AI model for reflection analysis (JSON)...");const f=((await m(l,{max_new_tokens:300,temperature:.7,do_sample:!0}))[0]?.generated_text||"").replace(l,"").trim().match(/\{[\s\S]*\}/);if(f)try{const T=JSON.parse(f[0]);return console.log("‚úÖ AI-generated JSON reflection analysis received"),xe(T)}catch{console.warn("Failed to parse JSON response, using fallback")}}catch(p){console.warn("AI reflection analysis failed:",p)}return ae(e,o,r)}catch(t){return console.error("Reflection analysis error:",t),ae(e,o)}}d(Xe,"analyzeReflection");async function Ge(e,o,r,i){try{const n=j(r,i);if(n.isCrisis)return de(n,i);let t=R();const s=G();if(!t)if(s){const p=Date.now();for(;!t&&Date.now()-p<3e4;)await new Promise(w=>setTimeout(w,500)),t=R()}else await P(),t=R();const a=i?.protocols||[],c=`You are a supportive therapy integration assistant helping a client between sessions with their LCSW.

${a.length>0?`The user is working with an LCSW using ${a.join(", ")} protocols.`:"The user is working with a licensed clinical social worker."}

Your role is to:
- Help the client remember and practice what was discussed in therapy
- Provide structured reflection prompts aligned with their treatment plan
- Offer psychoeducation and coping skills (NOT diagnoses or crisis handling)
- Support value-based living and goal achievement

The client is focusing on the value: "${e.name}" (${e.description}).
Their current mood indicator: ${o}
Their reflection: "${r}"

Provide a brief, warm, and structured response (2-3 sentences) that:
1. Validates their experience
2. Connects to their value
3. Suggests a small, actionable step they can take before their next session

Remember: You are supporting therapy integration, not providing therapy. Keep responses educational and supportive.`;let h="Your commitment to reflecting on your values is a meaningful step in your journey.",l=!1;if(t)try{console.log("ü§ñ Using on-device AI model for counseling guidance...");const m=performance.now(),p=await t(c,{max_new_tokens:150,temperature:.7,do_sample:!0,top_p:.9}),w=performance.now(),f=(p[0]?.generated_text||"").replace(c,"").trim();f&&f.length>20?(h=f,l=!0,console.log(`‚úÖ On-device AI generated response (${Math.round(w-m)}ms)`)):console.warn("‚ö†Ô∏è AI model returned empty or too short response, using fallback")}catch(m){if(console.error("‚ùå On-device AI inference failed:",m),m instanceof Error&&(m.message.includes("not a function")||m.message.includes("Cannot read")||m.message.includes("is not a function"))){console.warn("Possible model type mismatch, attempting reload..."),await P(!0);const p=R();if(p)try{const f=((await p(c,{max_new_tokens:150,temperature:.7,do_sample:!0,top_p:.9}))[0]?.generated_text||"").replace(c,"").trim();f&&(h=f)}catch(w){console.warn("Retry inference failed:",w)}}}return h==="Your commitment to reflecting on your values is a meaningful step in your journey."?(console.log("‚ÑπÔ∏è Using rule-based fallback (AI model not available or failed)"),h=He(e,o,r)):l&&console.log("‚úÖ Successfully used on-device AI for counseling guidance"),h}catch(n){return console.error("Counseling guidance error:",n),`Your focus on ${e.name} shows self-awareness. Consider discussing this reflection with your therapist in your next session.`}}d(Ge,"generateCounselingGuidance");async function Qe(e,o="‚ú®",r){return Ge(e,o,"",r)}d(Qe,"generateEncouragement");async function Ze(e,o,r,i,n){const{getEmotionalState:t}=await le(async()=>{const{getEmotionalState:I}=await import("./emotionalStates-CHdd7_6Z.js");return{getEmotionalState:I}},[]),s=t(e);if(!s)return"You're doing important work. Keep going, one step at a time.";const a=i?.protocols||[],u=ee(`${e}|${o}|${r}|${n?.timeOfDay||""}|${n?.recentJournalText?.substring(0,50)||""}`,e,o,"daily",a),c=await oe(u);if(c?.encouragement)return console.log("‚úÖ Using cached encouragement"),c.encouragement;const h=a.length>0?`The user is working with an LCSW using ${a.join(", ")} protocols.`:"The user is working with a licensed clinical social worker.",l=o?` The user has specifically selected the feeling: "${o}". This is the primary feeling they want support with.`:"",m=n?.timeOfDay?n.timeOfDay==="morning"?" It is morning‚Äîa time for fresh starts and forward momentum.":n.timeOfDay==="evening"||n.timeOfDay==="night"?" It is evening/night‚Äîa time for reflection and rest.":" It is afternoon‚Äîa time for continued engagement.":"",p=n?.recentJournalText?` Recent reflection: "${n.recentJournalText.substring(0,200)}"`:"",w=n?.userPatterns&&n.userPatterns.frequentStates.length>0?` The user has been feeling ${n.userPatterns.frequentStates.join(", ")} frequently.`:"",_=e==="drained"||e==="heavy"||e==="overwhelmed",f=_&&r>=3;let T="";if(f&&n?.userPatterns){const{frequentStates:I,progress:y}=n.userPatterns;I.length>0&&(T=` Based on recent patterns, the user has been feeling ${I.join(", ")} frequently (${r} consecutive times).`),y!==void 0&&y<30&&(T+=` Recent progress shows ${y}% positive states, indicating ongoing challenges.`)}const $=f?` Strongly encourage them to reach out to a trusted person, their therapist, or a support line (988). Emphasize that they don't have to go through this alone.${T}`:_?" Gently suggest that connecting with someone they trust might be helpful.":"",L=s.encouragementPrompt.instruction,b=`Provide encouragement and return ONLY valid JSON (no markdown, no extra text):

{
  "message": "30-60 words, 2-3 sentences of support",
  "acknowledgeFeeling": "specific feeling acknowledgment",
  "actionableStep": "optional small step"
}

Context: User is feeling ${s.label.toLowerCase()}.${l}${m}${p}${w}
${h}

Role: ${L}${$}

Requirements:
- Acknowledge: "${o||s.shortLabel}"
- Honest, realistic support (30-60 words)
- See possibilities without toxic positivity
- Genuine, warm, supportive${f?`
- Strongly encourage reaching out for support`:""}

Return valid JSON only.`;let g="";e==="drained"?g=`Feeling drained is real and valid. Right now might feel heavy, but there are opportunities ahead. Consider reaching out to someone you trust‚Äîyou don't have to carry this alone. Small steps forward are still progress.${f?" Please consider reaching out to your therapist, a trusted friend, or the 988 Crisis & Suicide Lifeline. You deserve support.":""}`:e==="heavy"?g=`Feeling heavy is understandable. These moments can feel overwhelming, but they also show your capacity to feel deeply. There are possibilities and opportunities waiting for you.${f?" Please consider reaching out to your therapist, a trusted friend, or a support line (988). You deserve support.":" Consider connecting with someone who cares about you."}`:e==="overwhelmed"?g=`Feeling overwhelmed is completely understandable when there's so much happening. Take a moment to breathe. You can break things down into smaller, manageable steps. There are opportunities ahead, and you have the capacity to navigate them.${f?" Consider reaching out to someone you trust for support.":""}`:e==="mixed"?g="Mixed feelings are completely normal and valid. This in-between space can actually be a place of growth and possibility. There are opportunities ahead, and you have the capacity to navigate them. Consider what feels most authentic to you right now.":e==="calm"?g="It's wonderful that you're feeling calm and centered. This peaceful state is a gift‚Äîtake time to appreciate it and notice what brought you here. There are opportunities to build on this sense of stability.":e==="hopeful"?g="Feeling hopeful is a sign of resilience and possibility. This forward-looking energy is valuable‚Äîthere are opportunities ahead that align with your values and goals. How can you channel this hope into meaningful action?":e==="positive"?g="It's wonderful that you're feeling positive and grounded. This is a great time to explore opportunities and possibilities. Consider what you'd like to build on or move toward. You have momentum‚Äîhow can you channel this energy in meaningful ways?":g="You're feeling energized and motivated‚Äîthat's powerful! This is a great time to explore opportunities and take meaningful action. What possibilities are calling to you? How can you channel this energy toward what matters most to you?";let S=R();if(!S)if(G()){const E=Date.now();for(;!S&&Date.now()-E<5e3&&(await new Promise(k=>setTimeout(k,500)),S=R(),!(!G()&&!S)););}else try{const y=P(),E=new Promise((k,U)=>setTimeout(()=>U(new Error("Model initialization timeout")),1e4));await Promise.race([y,E]),S=R()}catch{console.warn("Model initialization failed or timed out, using rule-based encouragement")}if(S)try{const E=((await S(b,{max_new_tokens:200,temperature:.8,do_sample:!0,top_p:.9}))[0]?.generated_text||"").replace(b,"").trim(),k=E.match(/\{[\s\S]*\}/);if(k)try{const U=JSON.parse(k[0]);console.log("‚úÖ AI-generated JSON encouragement received");const W=U.message||g;return await B(u,{encouragement:W}),W}catch{console.warn("Failed to parse JSON encouragement, using raw response")}if(E&&E.length>20)return await B(u,{encouragement:E}),E}catch(I){if(console.warn("Emotional encouragement inference failed:",I),I instanceof Error&&(I.message.includes("not a function")||I.message.includes("Cannot read")||I.message.includes("is not a function"))){console.warn("Model type mismatch detected, attempting to reload..."),await P(!0);const y=R();if(y)try{const U=((await y(b,{max_new_tokens:200,temperature:.8,do_sample:!0,top_p:.9}))[0]?.generated_text||"").replace(b,"").trim(),W=U.match(/\{[\s\S]*\}/);if(W)try{const te=JSON.parse(W[0]);console.log("‚úÖ AI-generated JSON encouragement received after reload");const re=te.message||g;return await B(u,{encouragement:re}),re}catch{console.warn("Failed to parse retry JSON encouragement")}if(U&&U.length>20)return U}catch(E){console.warn("Retry inference also failed:",E)}}}return g}d(Ze,"generateEmotionalEncouragement");async function eo(e){return{Integrity:"Truth guides me",Family:"Love connects us",Creativity:"Ideas flow freely",Health:"Body and mind unite",Freedom:"I choose my path",Justice:"Fairness for all",Kindness:"Compassion in action",Learning:"Growth through curiosity",Nature:"Earth sustains me",Peace:"Calm within",Respect:"Dignity for all",Service:"Help others rise",Spirituality:"Connection beyond self",Success:"Progress over perfection",Wealth:"Abundance flows",Wisdom:"Insight guides",Authenticity:"Be true to self",Compassion:"Kindness in action",Humor:"Joy lightens the load",Leadership:"Guide with heart",Resilience:"Bounce back stronger",Responsibility:"Own my choices",Courage:"Face fears bravely",Humility:"Learn from all",Loyalty:"Stand by others",Community:"Together we thrive",Artistry:"Create with soul",Curiosity:"Wonder opens doors",Balance:"Harmony in motion",Sustainability:"Care for tomorrow","Open-Mindedness":"Embrace new views",Impact:"Make a difference",Adventure:"Explore boldly"}[e.name]||`Honor ${e.name} today`}d(eo,"generateValueMantra");async function oo(e,o,r="",i,n,t){try{if(j(r,i).isCrisis)return`### Safety First
- **Description**: Contact your therapist or emergency services if you're in crisis
- **What this helps with**: Immediate support and safety
- **How do I measure progress**:
  1. Reached out to a professional
  2. Followed your safety plan
  3. Engaged with your support network`;const a=i?.protocols||[],u=ee(`${e.id}|${r}`,n||null,t||null,o,a),c=await oe(u);if(c?.goalSuggestion)return console.log("‚úÖ Using cached goal suggestion"),c.goalSuggestion;let h=R();if(h)console.log("‚úÖ AI model already loaded and ready");else if(console.log("üîÑ AI model not loaded, initializing..."),G()){console.log("‚è≥ Waiting for model to finish loading...");const T=3e4,$=Date.now();for(;!h&&Date.now()-$<T;)await new Promise(L=>setTimeout(L,500)),h=R();h?console.log("‚úÖ Model loaded successfully after wait"):console.warn("‚ö†Ô∏è Model loading timeout - will use fallback response")}else{console.log("üöÄ Starting model initialization...");try{const T=await P();h=R(),h?console.log("‚úÖ Model initialized successfully"):console.warn("‚ö†Ô∏è Model initialization completed but model is not available")}catch(T){console.error("‚ùå Model initialization failed:",T),h=null}}const l=r.includes("Deep Reflection:")||r.trim().length>50,m=r.includes("## Core Themes")||r.includes("## The 'LCSW Lens'")||r.includes("Reflection Analysis:"),p=n&&t?`The user's current emotional state is: ${n}
Their specific feeling is: ${t}

`:n?`The user's current emotional state is: ${n}

`:t?`The user's specific feeling is: ${t}

`:"",w=`Suggest a goal and return ONLY valid JSON (no markdown, no extra text):

{
  "description": "what they'll do",
  "whatThisHelpsWith": "why it matters",
  "howToMeasureProgress": ["step1", "step2", "step3"]
}

Value: "${e.name}" (${e.description})
Frequency: ${o}
${p}${l||m?`Reflection:
${r}`:`Recent reflection: "${r}"`}

Requirements:
- Specific and achievable for ${o}
- Aligned with value "${e.name}"
${l||m?"- Directly addresses the reflection content":""}
- Supports growth and success

Return valid JSON only.`,_=`### Structured Aim
- **Description**: Take one small action today that aligns with ${e.name}
- **What this helps with**: Building consistency and self-efficacy
- **How do I measure progress**:
  1. Identified the action
  2. Completed the action
  3. Reflected on the experience`;if(!h)return console.warn("‚ö†Ô∏è AI model not available for goal suggestion - using fallback response"),console.warn("Model status:",{modelAvailable:!!h,isModelLoading:G(),hasReflection:r.trim().length>0,hasAnalysis:r.includes("Reflection Analysis:")}),await B(u,{goalSuggestion:_}),_;try{console.log("ü§ñ Calling AI model for goal suggestion (JSON)...");const $=((await h(w,{max_new_tokens:200,temperature:.8,do_sample:!0}))[0]?.generated_text||"").replace(w,"").trim(),L=$.match(/\{[\s\S]*\}/);if(L)try{const b=JSON.parse(L[0]);return console.log("‚úÖ AI-generated JSON goal suggestion received"),se(b)}catch{console.warn("Failed to parse JSON response, using fallback")}return $&&$.length>20?(console.warn("‚ö†Ô∏è AI returned non-JSON response, using as-is"),$):(console.warn("‚ö†Ô∏è AI model returned empty or invalid response, using fallback"),_)}catch(f){if(console.error("‚ùå Goal suggestion inference failed:",f),f instanceof Error&&(f.message.includes("not a function")||f.message.includes("Cannot read"))){console.log("üîÑ Attempting to reload AI model...");try{await P(!0);const T=R();if(T){console.log("‚úÖ Model reloaded, retrying goal suggestion...");const b=((await T(w,{max_new_tokens:200,temperature:.8,do_sample:!0}))[0]?.generated_text||"").replace(w,"").trim(),g=b.match(/\{[\s\S]*\}/);if(g)try{const S=JSON.parse(g[0]);return console.log("‚úÖ AI-generated JSON goal suggestion received after reload"),se(S)}catch{console.warn("Failed to parse retry JSON response")}if(b&&b.length>20)return console.log("‚úÖ AI-generated goal suggestion received after reload (non-JSON)"),b}}catch(T){console.error("‚ùå Retry goal suggestion failed:",T)}}return console.warn("‚ö†Ô∏è Using fallback goal suggestion due to AI model errors"),await B(u,{goalSuggestion:_}),_}}catch(s){console.error("Goal suggestion error:",s);const a=`### Structured Aim
- **Description**: Practice ${e.name} in one specific way today
- **What this helps with**: Building value-aligned habits
- **How do I measure progress**:
  1. Planned the action
  2. Took the action
  3. Noted the outcome`;return await B(cacheKey,{goalSuggestion:a}).catch(console.warn),a}}d(oo,"suggestGoal");export{Ue as A,Re as B,de as C,q as D,Ge as E,le as _,Je as a,je as b,ve as c,Ye as d,Xe as e,Ze as f,qe as g,Qe as h,P as i,eo as j,j as k,oo as l,We as m,Be as n,ze as o,x as p,G as q,De as r,Ve as s,ie as t,Ke as u,Ce as v,z as w,Y as x,Q as y,R as z};
