const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/emailService-6vz86vpM.js","assets/ai-services-Dyqhbvbu.js"])))=>i.map(i=>d[i]);
import{a as e,b as r,c as t,s as a,d as s,i as n,_ as d}from"./ai-services-Dyqhbvbu.js";import{r as i,j as o}from"./react-vendor-CQK77wC2.js";import{g as l,b as c,s as x,c as m}from"./emailService-6vz86vpM.js";import{h as b}from"./animations-CweKPWyX.js";import{generateRandomTopic as p,sendNtfyNotification as h,isValidTopic as u}from"./ntfyService-DcHFu_a1.js";import{h as y,r as g,s as k}from"./index-C1iKWUY7.js";import"./vendor-JrpKAf2Q.js";const f=({userId:e="",logs:r=[],goals:t=[],values:a=[],schedule:s,onUpdate:n,onClose:d})=>{const[b,p]=i.useState(s?.enabled||!1),[h,u]=i.useState(s?.frequency||"weekly"),[y,g]=i.useState(s?.time||"09:00"),[k,f]=i.useState(s?.recipientEmails?.join("\n")||""),[w,v]=i.useState(s?.sendGoalCompletions??!0),[j,N]=i.useState(s?.sendReports??!0);return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",children:o.jsx("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-2xl rounded-xl sm:rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:o.jsxs("div",{className:"p-6 sm:p-8 space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl sm:text-2xl font-black text-text-primary dark:text-white tracking-tight",children:"Email Schedule"}),o.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary mt-1",children:"Automatically send summaries to your therapist"})]}),o.jsx("button",{onClick:d,className:"w-10 h-10 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("label",{className:"text-sm font-black text-text-primary dark:text-white block mb-1",children:"Enable Email Schedule"}),o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Automatically send summaries at scheduled times"})]}),o.jsx("button",{onClick:()=>p(!b),className:"w-16 h-8 rounded-full transition-all relative flex-shrink-0 "+(b?"bg-navy-primary":"bg-border-soft dark:bg-dark-border"),"aria-label":b?"Disable email schedule":"Enable email schedule",children:o.jsx("div",{className:"absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all "+(b?"left-9":"left-1")})})]}),b&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3",children:"Frequency"}),o.jsx("div",{className:"flex gap-2",children:["daily","weekly","monthly"].map(e=>o.jsx("button",{onClick:()=>u(e),className:"flex-1 py-3 rounded-xl text-sm font-black uppercase tracking-widest transition-all border "+(h===e?"bg-yellow-warm text-navy-primary shadow-sm border-yellow-warm":"bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white border-border-soft dark:border-dark-border hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary"),children:e},e))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3",children:"Send Time"}),o.jsx("input",{type:"time",value:y,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 rounded-xl bg-bg-secondary dark:bg-dark-bg-secondary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white font-bold"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3",children:"Therapist Email(s)"}),o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary mb-2",children:"One email address per line. You can add multiple recipients."}),o.jsx("textarea",{value:k,onChange:e=>f(e.target.value),placeholder:"therapist@example.com\nlcsw@example.com\nsupervisor@example.com",className:"w-full px-4 py-3 rounded-xl bg-bg-secondary dark:bg-dark-bg-secondary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[100px] resize-none text-sm"}),k&&o.jsx("div",{className:"mt-2 p-2 bg-bg-tertiary dark:bg-dark-bg-tertiary rounded-lg",children:o.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:[k.split("\n").filter(e=>e.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())).length," valid email(s) entered"]})})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest",children:"What to Include"}),o.jsxs("label",{className:"flex items-start gap-3 cursor-pointer p-3 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary transition-colors",children:[o.jsx("input",{type:"checkbox",checked:j,onChange:e=>N(e.target.checked),className:"mt-1 w-5 h-5 rounded border-2 border-text-primary/30 dark:border-white/30 text-yellow-warm focus:ring-2 focus:ring-yellow-warm/50 cursor-pointer"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("span",{className:"text-sm font-bold text-text-primary dark:text-white block",children:"Clinical Reports"}),o.jsx("span",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Include SOAP/DAP/BIRP formatted summaries"})]})]}),o.jsxs("label",{className:"flex items-start gap-3 cursor-pointer p-3 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary transition-colors",children:[o.jsx("input",{type:"checkbox",checked:w,onChange:e=>v(e.target.checked),className:"mt-1 w-5 h-5 rounded border-2 border-text-primary/30 dark:border-white/30 text-yellow-warm focus:ring-2 focus:ring-yellow-warm/50 cursor-pointer"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("span",{className:"text-sm font-bold text-text-primary dark:text-white block",children:"Goal Completions"}),o.jsx("span",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Send email when goals are completed"})]})]})]}),o.jsx("button",{onClick:async()=>{const e=k.split("\n").map(e=>e.trim()).filter(e=>e.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e));if(0===e.length)return void alert("Please add at least one valid email address");let s;if(j&&r.length>0)s=l(r.slice(0,10),a);else{const e=t.filter(e=>e.completed);s=c(t,a,e)}s.subject=`[TEST] ${s.subject}`,s.body=`This is a test email from Grounded by AC MiNDS.\n\n${s.body}`,await x(s,e)&&alert("Test email opened! Check your email client.")},className:"w-full py-3 bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm dark:text-yellow-warm rounded-xl text-sm font-black uppercase tracking-widest hover:bg-yellow-warm/30 dark:hover:bg-yellow-warm/40 border border-yellow-warm/30 dark:border-yellow-warm/50",children:"Send Test Email"})]}),s?.lastSent&&o.jsx("div",{className:"p-3 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border",children:o.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:["Last sent: ",new Date(s.lastSent).toLocaleString()]})})]}),o.jsxs("div",{className:"flex gap-3 pt-4",children:[o.jsx("button",{onClick:d,className:"flex-1 px-6 py-3 bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-xl text-sm font-black uppercase tracking-widest hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary border border-border-soft dark:border-dark-border",children:"Cancel"}),o.jsx("button",{onClick:()=>{const r=k.split("\n").map(e=>e.trim()).filter(e=>e.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)),t={enabled:b,frequency:h,time:y,recipientEmails:r,sendGoalCompletions:w,sendReports:j,lastSent:s?.lastSent};e&&m(e,t),n(t),d()},className:"flex-1 px-6 py-3 bg-navy-primary text-white rounded-xl text-sm font-black uppercase tracking-widest hover:opacity-90 shadow-lg border border-navy-primary",children:"Save Schedule"})]})]})})})},w=({className:a=""})=>{const s=e(),n=s.compatibility||r();return n?o.jsxs("div",{className:`space-y-4 ${a}`,children:[o.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl p-4 border border-border-soft dark:border-dark-border",children:[o.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[o.jsx("span",{className:"text-2xl",children:s.loaded?"âœ…":s.loading?"â³":n.canUseAI?"âš ï¸":"âŒ"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-sm font-black text-text-primary dark:text-white mb-1",children:"AI Engine Status"}),o.jsx("p",{className:"text-xs font-bold "+(s.loaded?"text-green-600 dark:text-green-400":s.loading?"text-yellow-600 dark:text-yellow-400":n.canUseAI?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400"),children:t(n)})]})]}),s.errorCategory&&o.jsx("div",{className:"mt-3 pt-3 border-t border-border-soft dark:border-dark-border",children:o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:(()=>{switch(s.errorCategory){case"coop-coep":return"Server configuration required: Enable COOP/COEP headers (see SERVER_CONFIG.md)";case"memory":return"Insufficient device memory: Close other applications or use a device with more RAM";case"webgpu":return"GPU acceleration unavailable: Using CPU-only mode (slower but functional)";case"network":return"Network error: Check your internet connection and try again";case"wasm":return"WebAssembly not supported: Use a modern browser";case"unknown":return"Unknown error: Browser compatibility issue detected";default:return null}})()})})]}),o.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl p-4 border border-border-soft dark:border-dark-border space-y-3",children:[o.jsx("h4",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Browser Capabilities"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:n.sharedArrayBuffer?"text-green-600":"text-red-600",children:n.sharedArrayBuffer?"âœ“":"âœ—"}),o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"SharedArrayBuffer"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:n.crossOriginIsolated?"text-green-600":"text-red-600",children:n.crossOriginIsolated?"âœ“":"âœ—"}),o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Cross-Origin Isolation"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:n.webGPU?"text-green-600":"text-yellow-600",children:n.webGPU?"âœ“":"âš "}),o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"WebGPU"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:n.wasm?"text-green-600":"text-red-600",children:n.wasm?"âœ“":"âœ—"}),o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"WebAssembly"})]})]}),n.estimatedMemory&&o.jsx("div",{className:"pt-2 border-t border-border-soft dark:border-dark-border",children:o.jsxs("div",{className:"flex justify-between items-center text-xs",children:[o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Estimated Memory"}),o.jsxs("span",{className:"font-bold text-text-primary dark:text-white",children:[Math.round(n.estimatedMemory)," MB"]})]})}),o.jsxs("div",{className:"pt-2 border-t border-border-soft dark:border-dark-border",children:[o.jsxs("div",{className:"flex justify-between items-center text-xs",children:[o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Device"}),o.jsx("span",{className:"font-bold text-text-primary dark:text-white capitalize",children:n.deviceType})]}),o.jsxs("div",{className:"flex justify-between items-center text-xs mt-1",children:[o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Browser"}),o.jsxs("span",{className:"font-bold text-text-primary dark:text-white",children:[n.browser," on ",n.os]})]})]})]}),n.issues.length>0&&o.jsxs("div",{className:"bg-yellow-warm/10 dark:bg-yellow-warm/20 rounded-xl p-4 border border-yellow-warm/30 dark:border-yellow-warm/50",children:[o.jsx("h4",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Issues Detected"}),o.jsx("ul",{className:"space-y-1",children:n.issues.map((e,r)=>o.jsxs("li",{className:"text-xs text-text-secondary dark:text-text-secondary flex items-start gap-2",children:[o.jsx("span",{className:"text-yellow-warm mt-0.5",children:"â€¢"}),o.jsx("span",{children:e})]},r))})]}),n.recommendations.length>0&&o.jsxs("div",{className:"bg-navy-primary/10 dark:bg-navy-primary/20 rounded-xl p-4 border border-navy-primary/30 dark:border-navy-primary/50",children:[o.jsx("h4",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Recommendations"}),o.jsx("ul",{className:"space-y-1",children:n.recommendations.map((e,r)=>o.jsxs("li",{className:"text-xs text-text-secondary dark:text-text-secondary flex items-start gap-2",children:[o.jsx("span",{className:"text-navy-primary dark:text-yellow-warm mt-0.5",children:"â†’"}),o.jsx("span",{children:e})]},r))})]}),s.loaded&&o.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-xl p-4 border border-green-200 dark:border-green-800",children:[o.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[o.jsx("span",{className:"text-green-600 dark:text-green-400",children:"âœ“"}),o.jsx("span",{className:"font-bold text-green-700 dark:text-green-300",children:"AI models loaded successfully"})]}),o.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:s.moodTracker?"text-green-600":"text-red-600",children:s.moodTracker?"âœ“":"âœ—"}),o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Mood Tracker"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:s.counselingCoach?"text-green-600":"text-red-600",children:s.counselingCoach?"âœ“":"âœ—"}),o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Counseling Coach"})]})]})]})]}):null},v=({config:r,onUpdate:t,onClose:l,settings:c,onUpdateSettings:x})=>{const[m,v]=i.useState(r?.protocols||[]),[j,N]=i.useState(r?.crisisPhrases?.join("\n")||""),[C,S]=i.useState(r?.emergencyContact?.name||""),[T,M]=i.useState(r?.emergencyContact?.phone||""),[L,A]=i.useState(r?.emergencyContact?.notes||""),[E,P]=i.useState(r?.customPrompts?.join("\n")||""),[I,B]=i.useState(r?.allowStructuredRecommendations??!0),[D,O]=i.useState(!1),[R,W]=i.useState(!1),[q,U]=i.useState(!1),[z,$]=i.useState(!1),[G,_]=i.useState(null),[F,H]=i.useState(null),Y=i.useRef(null),[X,K]=i.useState("default"),[V,Z]=i.useState(""),[J,Q]=i.useState("idle"),[ee,re]=i.useState(null),[te,ae]=i.useState(!1),[se,ne]=i.useState(c?.aiModel||"tinyllama");i.useEffect(()=>{c?.aiModel&&(ne(c.aiModel),a(c.aiModel))},[c?.aiModel]),i.useEffect(()=>{y()?K("granted"):K("default")},[]),i.useEffect(()=>{const r=()=>{try{const r=e();re(r)}catch(r){}};r();const t=setInterval(r,2e3);return()=>clearInterval(t)},[]),i.useEffect(()=>{const e=e=>{F&&Y.current&&!Y.current.contains(e.target)&&H(null)};return F&&(document.addEventListener("mousedown",e),document.addEventListener("touchstart",e)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[F]);const de={CBT:"Cognitive Behavioral Therapy: Focuses on identifying and changing negative thought patterns and behaviors.",DBT:"Dialectical Behavior Therapy: Combines cognitive-behavioral techniques with mindfulness and acceptance strategies.",ACT:"Acceptance and Commitment Therapy: Emphasizes accepting difficult thoughts and feelings while committing to values-based actions.",EMDR:"Eye Movement Desensitization and Reprocessing: Uses bilateral stimulation to process traumatic memories and reduce distress.",Other:"Other therapeutic approaches or custom protocols specific to your treatment plan."};i.useEffect(()=>{if(!c?.reminders)return;const e=()=>{if(!c.reminders.enabled)return void Z("Disabled");const e=(new Date).getHours();switch(c.reminders.frequency||"daily"){case"hourly":Z(e>=8&&e<20?`Hourly: ${e+1}:00`:"Hourly: 8:00 AM");break;case"daily":default:Z(`Daily: ${c.reminders.time}`);break;case"weekly":const r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][c.reminders.dayOfWeek??0];Z(`Weekly: ${r} at ${c.reminders.time}`);break;case"monthly":const t=c.reminders.dayOfMonth??1;Z(`Monthly: Day ${t} at ${c.reminders.time}`)}};e();const r=setInterval(e,6e4);return()=>clearInterval(r)},[c?.reminders]);const ie=async()=>{if(c&&x){if(!c.reminders.ntfyTopic){const e=p();return x({...c,reminders:{...c.reminders,ntfyTopic:e}}),void setTimeout(()=>ie(),100)}Q("sending");try{const e="ðŸ’› Test notification from Grounded! If you received this, push notifications are working perfectly!";y()&&await k("Grounded Test",{body:e,icon:"/favicon.ico"}),await h(e,"Grounded Test",{topic:c.reminders.ntfyTopic,server:c.reminders.ntfyServer})?(Q("success"),setTimeout(()=>Q("idle"),3e3)):(Q("error"),setTimeout(()=>Q("idle"),3e3))}catch(e){Q("error"),setTimeout(()=>Q("idle"),3e3)}}};return o.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",children:[o.jsx("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-2xl rounded-[40px] shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:o.jsxs("div",{className:"p-8 space-y-8",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-black text-text-primary dark:text-white",children:"Configuration"}),o.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary mt-1",children:"Configure therapy integration settings"})]}),o.jsx("button",{onClick:l,className:"w-10 h-10 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 block",children:"Treatment Protocols"}),o.jsx("div",{ref:Y,className:"flex flex-wrap gap-2 relative",children:["CBT","DBT","ACT","EMDR","Other"].map(e=>{const r=F===e,t=G===e||r;return o.jsxs("div",{className:"relative",onMouseEnter:()=>_(e),onMouseLeave:()=>{_(null)},onTouchStart:r=>{r.stopPropagation(),b("light"),H(F===e?null:e)},children:[o.jsx("button",{onClick:r=>{r.stopPropagation(),(e=>{v(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])})(e),"ontouchstart"in window&&H(F===e?null:e)},className:"px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all relative z-10 "+(m.includes(e)?"bg-navy-primary text-white shadow-sm":"bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary border border-border-soft dark:border-dark-border"),children:e}),t&&o.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-50 w-64 sm:w-72",children:o.jsxs("div",{className:"bg-navy-dark dark:bg-dark-bg-tertiary text-white dark:text-white rounded-xl p-3 shadow-2xl border border-navy-light/30 dark:border-dark-border animate-fade-in",children:[o.jsx("p",{className:"text-[10px] sm:text-xs leading-relaxed font-medium",children:de[e]}),o.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1",children:o.jsx("div",{className:"w-2 h-2 bg-navy-dark dark:bg-dark-bg-tertiary rotate-45 border-r border-b border-navy-light/30 dark:border-dark-border"})}),r&&o.jsx("button",{onClick:e=>{e.stopPropagation(),H(null)},className:"absolute top-1 right-1 w-6 h-6 flex items-center justify-center rounded-full bg-white/20 dark:bg-white/20 active:bg-white/30 dark:active:bg-white/30 text-white dark:text-white transition-colors touch-target","aria-label":"Close tooltip",children:o.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]})})]},e)})})]}),o.jsxs("div",{children:[o.jsxs("button",{onClick:()=>W(!R),className:"w-full flex items-center justify-between text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 p-2 hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary rounded-lg transition-colors",children:[o.jsx("span",{children:"Crisis Detection"}),o.jsx("svg",{className:"w-4 h-4 transition-transform "+(R?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),R&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsxs("button",{onClick:()=>U(!q),className:"w-full flex items-center justify-between p-4 bg-navy-light/10 dark:bg-navy-light/20 rounded-2xl border border-navy-light/30 dark:border-navy-light/50 hover:bg-navy-light/15 dark:hover:bg-navy-light/25 transition-colors",children:[o.jsx("p",{className:"text-xs font-bold text-navy-primary dark:text-navy-light",children:"ðŸ”’ Automatic Crisis Detection (Non-Editable)"}),o.jsx("svg",{className:"w-4 h-4 text-navy-primary dark:text-navy-light transition-transform "+(q?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),q&&o.jsxs("div",{className:"p-4 bg-navy-light/5 dark:bg-navy-light/10 rounded-xl mt-2 border border-navy-light/20 dark:border-navy-light/30",children:[o.jsxs("p",{className:"text-xs text-navy-dark dark:text-navy-light leading-relaxed mb-2",children:["The app uses ",o.jsx("strong",{children:"comprehensive, hardcoded crisis detection"})," that monitors for over 100+ phrases across 8 categories including direct suicide statements, self-harm language, planning indicators, and immediate danger signals. These detection phrases ",o.jsx("strong",{children:"cannot be modified or disabled"})," to ensure consistent safety monitoring."]}),o.jsx("p",{className:"text-xs text-navy-primary dark:text-navy-light italic",children:"When crisis language is detected, the app immediately stops normal responses and displays emergency resources, crisis hotlines (988), and encourages contacting professional help or emergency services."})]})]}),o.jsxs("div",{children:[o.jsxs("button",{onClick:()=>$(!z),className:"w-full flex items-center justify-between p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-2xl border border-border-soft dark:border-dark-border hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary transition-colors",children:[o.jsx("p",{className:"text-xs font-bold text-text-primary dark:text-white",children:"Additional Custom Phrases (Optional)"}),o.jsx("svg",{className:"w-4 h-4 text-text-primary dark:text-white transition-transform "+(z?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),z&&o.jsxs("div",{className:"p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl mt-2 border border-border-soft dark:border-dark-border",children:[o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary mb-2",children:"You can add custom phrases here, but note that the comprehensive hardcoded detection will still be active. Custom phrases are in addition to, not replacements for, the built-in safety monitoring."}),o.jsx("textarea",{value:j,onChange:e=>N(e.target.value),placeholder:"Add any additional phrases specific to your practice (optional)\nNote: Built-in crisis detection remains active",className:"w-full p-4 rounded-xl bg-white dark:bg-dark-bg-tertiary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[100px] resize-none text-sm"})]})]})]})]}),o.jsxs("details",{className:"group",children:[o.jsxs("summary",{className:"cursor-pointer text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 p-2 hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary rounded-lg transition-colors list-none flex items-center justify-between",children:[o.jsx("span",{children:"Emergency Contact"}),o.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o.jsxs("div",{className:"space-y-3 mt-3",children:[o.jsx("input",{type:"text",value:C,onChange:e=>S(e.target.value),placeholder:"Therapist Name",className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border-none focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white"}),o.jsx("input",{type:"tel",value:T,onChange:e=>M(e.target.value),placeholder:"Phone Number",className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border-none focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white"}),o.jsx("textarea",{value:L,onChange:e=>A(e.target.value),placeholder:"Additional notes (e.g., 'Available 24/7', 'Text preferred')",className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border-none focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[80px] resize-none text-sm"})]})]}),o.jsxs("details",{className:"group",children:[o.jsxs("summary",{className:"cursor-pointer text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 p-2 hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary rounded-lg transition-colors list-none flex items-center justify-between",children:[o.jsx("span",{children:"Custom Homework/Worksheets"}),o.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o.jsxs("div",{className:"mt-3 space-y-3",children:[o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Custom prompts, worksheets, or links your therapist wants you to focus on. One per line. Links will be clickable."}),o.jsx("textarea",{value:E,onChange:e=>P(e.target.value),placeholder:"Practice mindfulness for 5 minutes daily\nComplete thought record worksheet\nhttps://example.com/worksheet.pdf\nJournal about triggers",className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[100px] resize-none text-sm"}),E&&o.jsxs("div",{className:"p-3 bg-bg-tertiary dark:bg-dark-bg-tertiary rounded-xl",children:[o.jsx("p",{className:"text-xs font-bold text-text-primary dark:text-white mb-2",children:"Preview:"}),o.jsx("div",{className:"space-y-1 text-xs text-text-primary dark:text-white",children:E.split("\n").filter(e=>e.trim()).map((e,r)=>{const t=/^https?:\/\//.test(e.trim());return o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-text-tertiary",children:"â€¢"}),t?o.jsx("a",{href:e.trim(),target:"_blank",rel:"noopener noreferrer",className:"text-navy-primary dark:text-navy-light hover:underline break-all",children:e.trim()}):o.jsx("span",{children:e.trim()})]},r)})})]})]})]}),o.jsxs("div",{className:"flex items-center justify-between p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-2xl border border-border-soft dark:border-dark-border",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white block mb-1",children:"Allow Structured Recommendations"}),o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"AI can suggest structured actions aligned with your treatment plan"})]}),o.jsx("button",{onClick:()=>B(!I),className:"w-14 h-8 rounded-full transition-all relative flex-shrink-0 "+(I?"bg-navy-primary":"bg-border-soft dark:bg-dark-bg-primary"),"aria-label":I?"Disable recommendations":"Enable recommendations",children:o.jsx("div",{className:"absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all "+(I?"right-1":"left-1")})})]}),c&&x&&o.jsxs("details",{className:"group border-t border-border-soft dark:border-dark-border pt-6",children:[o.jsx("summary",{className:"cursor-pointer list-none",children:o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-1 block",children:"Email Summaries"}),o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Schedule automatic reports to your therapist"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[c.emailSchedule?.enabled&&o.jsx("span",{className:"px-2 py-1 bg-calm-sage/20 dark:bg-calm-sage/20 text-calm-sage dark:text-calm-sage rounded-lg text-[9px] font-black uppercase tracking-widest",children:"Active"}),o.jsx("svg",{className:"w-4 h-4 text-text-primary dark:text-white transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("button",{onClick:()=>O(!0),className:"w-full px-4 py-3 bg-navy-primary text-white dark:text-white rounded-xl text-xs font-black uppercase tracking-widest hover:opacity-90 border border-navy-primary",children:"Configure Email Summaries"}),c.emailSchedule?.enabled&&o.jsxs("div",{className:"p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border",children:[o.jsxs("p",{className:"text-xs text-text-primary dark:text-white mb-1",children:[o.jsx("strong",{children:"Active:"})," ",c.emailSchedule.frequency," at ",c.emailSchedule.time]}),o.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:["Recipients: ",c.emailSchedule.recipientEmails.length," email(s)"]})]})]})]}),c&&x&&o.jsxs("details",{className:"group border-t border-border-soft dark:border-dark-border pt-6",open:!1,children:[o.jsx("summary",{className:"cursor-pointer list-none",children:o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-1 block",children:"Growth and Progress"}),o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Keep your North Star in sight throughout the day"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:e=>{e.preventDefault(),c&&x&&("granted"!==X&&(async()=>{const e=await g();K(e)})(),x({...c,reminders:{...c.reminders,enabled:!c.reminders.enabled}}))},className:"w-14 h-8 rounded-full transition-all relative "+(c.reminders.enabled?"bg-yellow-warm":"bg-border-soft dark:bg-dark-bg-primary"),children:o.jsx("div",{className:"absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all "+(c.reminders.enabled?"right-1":"left-1")})}),o.jsx("svg",{className:"w-4 h-4 text-text-primary dark:text-white transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),o.jsxs("div",{className:"space-y-6 transition-all duration-500 "+(c.reminders.enabled?"opacity-100 scale-100":"opacity-30 scale-95 pointer-events-none"),children:[o.jsxs("div",{className:"space-y-3",children:[o.jsxs("label",{className:"text-[10px] font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:[(c.reminders.frequency||"daily").charAt(0).toUpperCase()+(c.reminders.frequency||"daily").slice(1)," Reflection Reminder"]}),o.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:["hourly","daily","weekly","monthly"].map(e=>o.jsx("button",{onClick:()=>{return r=e,void(c&&x&&x({...c,reminders:{...c.reminders,frequency:r}}));var r},className:"px-4 py-3 rounded-xl font-black text-xs uppercase tracking-widest transition-all "+((c.reminders.frequency||"daily")===e?"bg-yellow-warm text-text-primary shadow-lg scale-105":"bg-bg-secondary dark:bg-dark-bg-primary/50 text-text-primary/60 dark:text-white/60 hover:bg-yellow-warm/20 dark:hover:bg-yellow-warm/20"),children:e},e))})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[("daily"===(c.reminders.frequency||"daily")||"weekly"===(c.reminders.frequency||"daily")||"monthly"===(c.reminders.frequency||"daily"))&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-[10px] font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Time"}),o.jsx("input",{type:"time",value:c.reminders.time,onChange:e=>{c&&x&&x({...c,reminders:{...c.reminders,time:e.target.value}})},className:"w-full bg-bg-secondary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 rounded-xl p-3 font-black text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none"})]}),"weekly"===(c.reminders.frequency||"daily")&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-[10px] font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Day of Week"}),o.jsxs("select",{value:c.reminders.dayOfWeek??0,onChange:e=>{c&&x&&x({...c,reminders:{...c.reminders,dayOfWeek:parseInt(e.target.value)}})},className:"w-full bg-bg-secondary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 rounded-xl p-3 font-black text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none",children:[o.jsx("option",{value:0,children:"Sunday"}),o.jsx("option",{value:1,children:"Monday"}),o.jsx("option",{value:2,children:"Tuesday"}),o.jsx("option",{value:3,children:"Wednesday"}),o.jsx("option",{value:4,children:"Thursday"}),o.jsx("option",{value:5,children:"Friday"}),o.jsx("option",{value:6,children:"Saturday"})]})]}),"monthly"===(c.reminders.frequency||"daily")&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-[10px] font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Day of Month (1-31)"}),o.jsx("input",{type:"number",min:"1",max:"31",value:c.reminders.dayOfMonth??1,onChange:e=>{if(!c||!x)return;const r=parseInt(e.target.value);r>=1&&r<=31&&x({...c,reminders:{...c.reminders,dayOfMonth:r}})},className:"w-full bg-bg-secondary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 rounded-xl p-3 font-black text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none"})]})]}),o.jsx("div",{className:"bg-bg-secondary dark:bg-dark-bg-primary/50 rounded-xl p-4 border border-border-soft dark:border-dark-border/30",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("p",{className:"text-[10px] font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Device Calendar"}),o.jsx("p",{className:"text-xs text-text-primary/60 dark:text-white/60",children:"Add reminders to your device's calendar app"})]}),o.jsx("button",{onClick:async()=>{if(c&&x)if(c.reminders.useDeviceCalendar)x({...c,reminders:{...c.reminders,useDeviceCalendar:!1}});else try{if("calendar"in navigator&&"requestPermission"in navigator.calendar)"granted"===await navigator.calendar.requestPermission()&&x({...c,reminders:{...c.reminders,useDeviceCalendar:!0}});else{const[e,r]=c.reminders.time.split(":").map(Number),t=new Date;t.setHours(e,r,0,0);const a=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=Grounded Reflection Reminder&dates=${t.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${t.toISOString().replace(/[-:]/g,"").split(".")[0]}Z&details=Time to reflect on your values`;window.open(a,"_blank"),x({...c,reminders:{...c.reminders,useDeviceCalendar:!0}})}}catch(e){alert("Could not access calendar. You can manually add reminders to your calendar.")}},className:"w-14 h-8 rounded-full transition-all relative "+(c.reminders.useDeviceCalendar?"bg-yellow-warm":"bg-border-soft dark:bg-dark-bg-primary"),children:o.jsx("div",{className:"absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all "+(c.reminders.useDeviceCalendar?"right-1":"left-1")})})]})}),o.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-primary/50 rounded-xl p-4 border border-border-soft dark:border-dark-border/30 space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("p",{className:"text-[10px] font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Push Notifications (ntfy.sh)"}),o.jsx("p",{className:"text-xs text-text-primary/60 dark:text-white/60",children:"Secure push notifications to your device"})]}),o.jsx("button",{onClick:()=>{if(c&&x)if(c.reminders.useNtfyPush)x({...c,reminders:{...c.reminders,useNtfyPush:!1}});else{const e=c.reminders.ntfyTopic||p();x({...c,reminders:{...c.reminders,useNtfyPush:!0,ntfyTopic:e}})}},className:"w-14 h-8 rounded-full transition-all relative "+(c.reminders.useNtfyPush?"bg-yellow-warm":"bg-border-soft dark:bg-dark-bg-primary"),children:o.jsx("div",{className:"absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all "+(c.reminders.useNtfyPush?"right-1":"left-1")})})]}),c.reminders.useNtfyPush&&o.jsxs("div",{className:"space-y-4 pt-3 border-t border-border-soft dark:border-dark-border/30",children:[o.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary rounded-xl p-4 border-2 border-yellow-warm/30 space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("p",{className:"text-[9px] font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Your Subscription Topic"}),o.jsx("button",{onClick:()=>{if(!c||!x)return;const e=p();x({...c,reminders:{...c.reminders,ntfyTopic:e}}),Q("idle")},className:"px-2 py-1 bg-border-soft dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-lg text-[8px] font-black uppercase tracking-widest hover:bg-yellow-warm/20 dark:hover:bg-yellow-warm/20 transition-all",title:"Generate new topic",children:"ðŸ”„ Reset"})]}),o.jsx("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary rounded-lg p-3 border border-border-soft dark:border-dark-border/30",children:o.jsx("code",{className:"text-sm font-black text-navy-primary dark:text-yellow-warm break-all",children:c.reminders.ntfyTopic||"Loading..."})}),o.jsxs("p",{className:"text-[9px] text-text-secondary dark:text-white/70 leading-relaxed",children:["ðŸ“± ",o.jsx("strong",{children:"Quick Setup:"})," Open the ntfy app on your device and subscribe to this topic. That's it!"]})]}),o.jsxs("button",{onClick:ie,disabled:"sending"===J,className:"w-full px-4 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all shadow-md "+("success"===J?"bg-calm-sage text-white":"error"===J?"bg-warm-coral text-white":"sending"===J?"bg-border-soft dark:bg-dark-bg-tertiary text-text-primary dark:text-white opacity-50 cursor-not-allowed":"bg-yellow-warm text-text-primary hover:opacity-90"),children:["sending"===J&&"â³ Sending...","success"===J&&"âœ… Sent! Check your device","error"===J&&"âŒ Failed. Check your topic","idle"===J&&"ðŸ”” Test Notification"]}),o.jsxs("details",{className:"group",children:[o.jsx("summary",{className:"cursor-pointer text-[9px] font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest hover:text-text-primary dark:hover:text-white transition-colors",children:"âš™ï¸ Advanced Options"}),o.jsxs("div",{className:"mt-3 space-y-3 pt-3 border-t border-border-soft dark:border-dark-border/30",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-[9px] font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Custom Topic (Optional)"}),o.jsx("input",{type:"text",value:c.reminders.ntfyTopic||"",onChange:e=>{if(!c||!x)return;const r=e.target.value.trim();(u(r)||""===r)&&x({...c,reminders:{...c.reminders,ntfyTopic:r}})},placeholder:"grounded-abc123xyz",className:"w-full p-2 rounded-lg bg-white dark:bg-dark-bg-primary border border-border-soft dark:border-dark-border/30 text-xs font-medium text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none"}),o.jsx("p",{className:"text-[8px] text-text-primary/50 dark:text-white/50",children:"Use only letters, numbers, dashes, and underscores"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-[9px] font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Custom Server (Optional)"}),o.jsx("input",{type:"text",value:c.reminders.ntfyServer||"",onChange:e=>x({...c,reminders:{...c.reminders,ntfyServer:e.target.value.trim()||void 0}}),placeholder:"https://ntfy.sh (default)",className:"w-full p-2 rounded-lg bg-white dark:bg-dark-bg-primary border border-border-soft dark:border-dark-border/30 text-xs font-medium text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none"}),o.jsx("p",{className:"text-[8px] text-text-primary/50 dark:text-white/50",children:"Leave empty to use the free public server"})]})]})]})]})]}),o.jsx("div",{className:"bg-yellow-warm/10 dark:bg-yellow-warm/20 rounded-xl p-4 border border-yellow-warm/30",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-[10px] font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Next Reminder"}),o.jsx("span",{className:"text-sm font-black text-yellow-warm animate-pulse",children:V})]})}),o.jsx("div",{className:"w-full space-y-3",children:"granted"!==X?o.jsxs("button",{onClick:g,className:"w-full px-6 py-4 bg-yellow-warm/20 dark:bg-yellow-warm/20 text-yellow-warm dark:text-yellow-warm rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-yellow-warm/30 dark:hover:bg-yellow-warm/30 transition-colors flex items-center justify-center gap-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Enable Browser Permissions"]}):o.jsxs("div",{className:"px-6 py-4 bg-calm-sage/20 dark:bg-calm-sage/20 text-calm-sage dark:text-calm-sage rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Nudge Engine Active"]})}),o.jsx("p",{className:"text-[10px] text-text-tertiary dark:text-text-tertiary font-medium italic text-center",children:"Reminders trigger via system notifications while this tab is open. Keep the app open for notifications to work."})]})]}),o.jsxs("details",{className:"group border-t border-border-soft dark:border-dark-border pt-6",children:[o.jsxs("summary",{className:"cursor-pointer text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 p-2 hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary rounded-lg transition-colors list-none flex items-center justify-between",children:[o.jsx("span",{children:"AI Model"}),o.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o.jsxs("div",{className:"mt-3 space-y-4",children:[o.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Update the on-device AI model for better guidance and encouragement. Models are downloaded and cached on your device for privacy."}),o.jsx(w,{}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-xs font-bold text-text-primary dark:text-white",children:"Select AI Model:"}),o.jsx("select",{value:se,onChange:async r=>{const t=r.target.value;ne(t),x&&c&&x({...c,aiModel:t}),ae(!0);try{a(t),await n(!0,t),setTimeout(()=>{const r=e();re(r)},1e3)}catch(s){}finally{ae(!1)}},disabled:te||ee?.loading,className:"w-full px-4 py-3 rounded-xl text-xs font-medium bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white border border-border-soft dark:border-dark-border focus:outline-none focus:ring-2 focus:ring-navy-primary disabled:opacity-50 disabled:cursor-not-allowed",children:Object.entries(s()).map(([e,r])=>o.jsxs("option",{value:e,children:[r.name," - ",r.description," (",r.size,")"]},e))}),o.jsxs("p",{className:"text-[10px] text-text-tertiary dark:text-text-tertiary",children:[s()[se].description,". Models are cached in your browser for instant loading."]})]}),ee&&o.jsxs("div",{className:"p-3 bg-bg-secondary dark:bg-dark-bg-secondary rounded-lg border border-border-soft dark:border-dark-border space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between text-xs",children:[o.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Model Status:"}),o.jsx("span",{className:"font-semibold "+(ee.loaded?"text-green-600 dark:text-green-400":ee.loading?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"),children:ee.loaded?"âœ“ Loaded":ee.loading?"â³ Loading...":"âœ— Not Available"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[10px]",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-text-tertiary dark:text-text-tertiary",children:"Mood Tracker:"}),o.jsx("span",{className:ee.moodTracker?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:ee.moodTracker?"âœ“":"âœ—"})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-text-tertiary dark:text-text-tertiary",children:"Counseling Coach:"}),o.jsx("span",{className:ee.counselingCoach?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:ee.counselingCoach?"âœ“":"âœ—"})]})]}),!ee.loaded&&!ee.loading&&o.jsx("p",{className:"text-[10px] text-text-tertiary dark:text-text-tertiary mt-2",children:"The app is using rule-based responses. This is normal if your browser doesn't support ONNX Runtime. All features remain fully functional."})]}),o.jsx("button",{onClick:async()=>{if(confirm("This will clear and re-download the AI model. This may take a few minutes and requires internet connection. Continue?")){ae(!0);try{const{initializeModels:r}=await d(async()=>{const{initializeModels:e}=await import("./emailService-6vz86vpM.js").then(e=>e.d);return{initializeModels:e}},__vite__mapDeps([0,1])),t=await r(!0);if(setTimeout(()=>{const r=e();re(r)},1e3),t)alert("âœ… Model update complete! The new model has been downloaded and cached on your device. AI features are now available.");else{const r=e();let t="Model update failed. The app will continue using rule-based responses.";r.moodTracker||r.counselingCoach?r.moodTracker&&r.counselingCoach||(t+=`\n\nPartial loading: ${r.moodTracker?"Mood tracker âœ“":"Mood tracker âœ—"}, ${r.counselingCoach?"Counseling coach âœ“":"Counseling coach âœ—"}`):t+="\n\nThis is likely a browser compatibility issue with ONNX Runtime. The app is fully functional with rule-based responses.",alert(t)}}catch(r){const e=r?.message||String(r);let t="Error updating model. ";e.includes("registerBackend")||e.includes("ort-web")?t+="This appears to be a browser compatibility issue with ONNX Runtime. The app will continue using rule-based responses, which are fully functional.":t+="Please check your internet connection and try again.",alert(t)}finally{ae(!1)}}},disabled:te||ee?.loading,className:"w-full px-4 py-3 rounded-xl text-xs font-black uppercase tracking-widest shadow-sm border "+(te||ee?.loading?"bg-gray-400 dark:bg-gray-600 text-white cursor-not-allowed":"bg-navy-primary text-white dark:text-white hover:opacity-90 border-navy-primary"),children:te?"â³ Updating...":ee?.loading?"â³ Loading...":"Update AI Model"}),o.jsx("p",{className:"text-[9px] text-text-tertiary dark:text-text-tertiary text-center",children:"Recommended: MiniCPM-0.5B or TinyLlama-1.1B (quantized for mobile)"}),!ee?.loaded&&!ee?.loading&&o.jsx("p",{className:"text-[9px] text-text-tertiary dark:text-text-tertiary text-center italic",children:"Note: If models fail to load, this is typically a browser compatibility issue. The app remains fully functional with rule-based responses."})]})]})]}),o.jsxs("div",{className:"flex gap-3 pt-4",children:[o.jsx("button",{onClick:l,className:"flex-1 px-6 py-4 bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary",children:"Cancel"}),o.jsx("button",{onClick:()=>{const e={protocols:m,crisisPhrases:j.split("\n").filter(e=>e.trim().length>0),emergencyContact:C||T?{name:C,phone:T,notes:L||void 0}:void 0,customPrompts:E.split("\n").filter(e=>e.trim().length>0),allowStructuredRecommendations:I};t(e),l()},className:"flex-1 px-6 py-4 bg-navy-primary text-white rounded-2xl text-xs font-black uppercase tracking-widest hover:opacity-90 shadow-sm",children:"Save Configuration"})]}),o.jsx("div",{className:"pt-4 border-t border-border-soft dark:border-dark-border",children:o.jsx("p",{className:"text-xs text-text-tertiary dark:text-text-tertiary text-center",children:"This configuration helps the app support your therapy integration. All AI processing happens on your device for privacy."})})]})}),D&&c&&x&&o.jsx(f,{schedule:c.emailSchedule,onUpdate:e=>x({...c,emailSchedule:e}),onClose:()=>O(!1)})]})};export{v as default};
//# sourceMappingURL=LCSWConfig-CDUAZG3u.js.map
