const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/emailService-CUnzClK5.js","assets/ai-services-BeY8le4t.js"])))=>i.map(i=>d[i]);
var je=Object.defineProperty;var a=(u,x)=>je(u,"name",{value:x,configurable:!0});import{a as L,b as Ne,c as Ce,s as U,d as V,i as Te,_ as Me}from"./ai-services-BeY8le4t.js";import{r as o,j as e}from"./react-vendor-C3J-WWQD.js";import{g as Se,b as Ee,s as Pe,c as Ae}from"./emailService-CUnzClK5.js";import{h as Le}from"./animations-CgpoTaqC.js";import{generateRandomTopic as Y,sendNtfyNotification as De,isValidTopic as Ie}from"./ntfyService-CH0GdzTc.js";import{h as ee,r as re,s as Re}from"./index-rY5DbNcP.js";import"./vendor-Dfov_G5I.js";import"./transformers-cJLoZuBt.js";const $e=a(({userId:u="",logs:x=[],goals:i=[],values:r=[],schedule:n,onUpdate:T,onClose:p})=>{const[b,$]=o.useState(n?.enabled||!1),[M,O]=o.useState(n?.frequency||"weekly"),[S,B]=o.useState(n?.time||"09:00"),[g,W]=o.useState(n?.recipientEmails?.join(`
`)||""),[N,z]=o.useState(n?.sendGoalCompletions??!0),[y,q]=o.useState(n?.sendReports??!0),G=a(()=>{const l=g.split(`
`).map(k=>k.trim()).filter(k=>k.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k)),h={enabled:b,frequency:M,time:S,recipientEmails:l,sendGoalCompletions:N,sendReports:y,lastSent:n?.lastSent};u&&Ae(u,h),T(h),p()},"handleSave"),D=a(async()=>{const l=g.split(`
`).map(f=>f.trim()).filter(f=>f.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f));if(l.length===0){alert("Please add at least one valid email address");return}let h;if(y&&x.length>0)h=Se(x.slice(0,10),r);else{const f=i.filter(A=>A.completed);h=Ee(i,r,f)}h.subject=`[TEST] ${h.subject}`,h.body=`This is a test email from Grounded by AC MiNDS.

${h.body}`,await Pe(h,l)&&alert("Test email opened! Check your email client.")},"handleTestEmail");return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-2xl rounded-xl sm:rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6 sm:p-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black text-text-primary dark:text-white tracking-tight",children:"Email Schedule"}),e.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary mt-1",children:"Automatically send summaries to your therapist"})]}),e.jsx("button",{onClick:p,className:"w-10 h-10 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-black text-text-primary dark:text-white block mb-1",children:"Enable Email Schedule"}),e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Automatically send summaries at scheduled times"})]}),e.jsx("button",{onClick:a(()=>$(!b),"onClick"),className:`w-16 h-8 rounded-full transition-all relative flex-shrink-0 ${b?"bg-navy-primary":"bg-border-soft dark:bg-dark-border"}`,"aria-label":b?"Disable email schedule":"Enable email schedule",children:e.jsx("div",{className:`absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all ${b?"left-9":"left-1"}`})})]}),b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3",children:"Frequency"}),e.jsx("div",{className:"flex gap-2",children:["daily","weekly","monthly"].map(l=>e.jsx("button",{onClick:a(()=>O(l),"onClick"),className:`flex-1 py-3 rounded-xl text-sm font-black uppercase tracking-widest transition-all border ${M===l?"bg-yellow-warm text-navy-primary shadow-sm border-yellow-warm":"bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white border-border-soft dark:border-dark-border hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary"}`,children:l},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3",children:"Send Time"}),e.jsx("input",{type:"time",value:S,onChange:a(l=>B(l.target.value),"onChange"),className:"w-full px-4 py-3 rounded-xl bg-bg-secondary dark:bg-dark-bg-secondary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3",children:"Therapist Email(s)"}),e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary mb-2",children:"One email address per line. You can add multiple recipients."}),e.jsx("textarea",{value:g,onChange:a(l=>W(l.target.value),"onChange"),placeholder:`therapist@example.com
lcsw@example.com
supervisor@example.com`,className:"w-full px-4 py-3 rounded-xl bg-bg-secondary dark:bg-dark-bg-secondary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[100px] resize-none text-sm"}),g&&e.jsx("div",{className:"mt-2 p-2 bg-bg-tertiary dark:bg-dark-bg-tertiary rounded-lg",children:e.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:[g.split(`
`).filter(l=>l.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.trim())).length," valid email(s) entered"]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest",children:"What to Include"}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer p-3 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary transition-colors",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:a(l=>q(l.target.checked),"onChange"),className:"mt-1 w-5 h-5 rounded border-2 border-text-primary/30 dark:border-white/30 text-yellow-warm focus:ring-2 focus:ring-yellow-warm/50 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-bold text-text-primary dark:text-white block",children:"Clinical Reports"}),e.jsx("span",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Include SOAP/DAP/BIRP formatted summaries"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer p-3 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary transition-colors",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:a(l=>z(l.target.checked),"onChange"),className:"mt-1 w-5 h-5 rounded border-2 border-text-primary/30 dark:border-white/30 text-yellow-warm focus:ring-2 focus:ring-yellow-warm/50 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-bold text-text-primary dark:text-white block",children:"Goal Completions"}),e.jsx("span",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Send email when goals are completed"})]})]})]}),e.jsx("button",{onClick:D,className:"w-full py-3 bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm dark:text-yellow-warm rounded-xl text-sm font-black uppercase tracking-widest hover:bg-yellow-warm/30 dark:hover:bg-yellow-warm/40 border border-yellow-warm/30 dark:border-yellow-warm/50",children:"Send Test Email"})]}),n?.lastSent&&e.jsx("div",{className:"p-3 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border",children:e.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:["Last sent: ",new Date(n.lastSent).toLocaleString()]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:p,className:"flex-1 px-6 py-3 bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-xl text-sm font-black uppercase tracking-widest hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary border border-border-soft dark:border-dark-border",children:"Cancel"}),e.jsx("button",{onClick:G,className:"flex-1 px-6 py-3 bg-navy-primary text-white rounded-xl text-sm font-black uppercase tracking-widest hover:opacity-90 shadow-lg border border-navy-primary",children:"Save Schedule"})]})]})})})},"EmailScheduleComponent"),Oe=a(({className:u=""})=>{const x=L(),i=x.compatibility||Ne();if(!i)return null;const r=a(()=>x.loaded?"text-green-600 dark:text-green-400":x.loading?"text-yellow-600 dark:text-yellow-400":i.canUseAI?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400","getStatusColor"),n=a(()=>x.loaded?"‚úÖ":x.loading?"‚è≥":i.canUseAI?"‚ö†Ô∏è":"‚ùå","getStatusIcon"),T=a(()=>{switch(x.errorCategory){case"coop-coep":return"Server configuration required: Enable COOP/COEP headers (see SERVER_CONFIG.md)";case"memory":return"Insufficient device memory: Close other applications or use a device with more RAM";case"webgpu":return"GPU acceleration unavailable: Using CPU-only mode (slower but functional)";case"network":return"Network error: Check your internet connection and try again";case"wasm":return"WebAssembly not supported: Use a modern browser";case"unknown":return"Unknown error: Browser compatibility issue detected";default:return null}},"getErrorCategoryMessage");return e.jsxs("div",{className:`space-y-4 ${u}`,children:[e.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl p-4 border border-border-soft dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("span",{className:"text-2xl",children:n()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-black text-text-primary dark:text-white mb-1",children:"AI Engine Status"}),e.jsx("p",{className:`text-xs font-bold ${r()}`,children:Ce(i)})]})]}),x.errorCategory&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border-soft dark:border-dark-border",children:e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:T()})})]}),e.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl p-4 border border-border-soft dark:border-dark-border space-y-3",children:[e.jsx("h4",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Browser Capabilities"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:i.sharedArrayBuffer?"text-green-600":"text-red-600",children:i.sharedArrayBuffer?"‚úì":"‚úó"}),e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"SharedArrayBuffer"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:i.crossOriginIsolated?"text-green-600":"text-red-600",children:i.crossOriginIsolated?"‚úì":"‚úó"}),e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Cross-Origin Isolation"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:i.webGPU?"text-green-600":"text-yellow-600",children:i.webGPU?"‚úì":"‚ö†"}),e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"WebGPU"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:i.wasm?"text-green-600":"text-red-600",children:i.wasm?"‚úì":"‚úó"}),e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"WebAssembly"})]})]}),i.estimatedMemory&&e.jsx("div",{className:"pt-2 border-t border-border-soft dark:border-dark-border",children:e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Estimated Memory"}),e.jsxs("span",{className:"font-bold text-text-primary dark:text-white",children:[Math.round(i.estimatedMemory)," MB"]})]})}),e.jsxs("div",{className:"pt-2 border-t border-border-soft dark:border-dark-border",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Device"}),e.jsx("span",{className:"font-bold text-text-primary dark:text-white capitalize",children:i.deviceType})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mt-1",children:[e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Browser"}),e.jsxs("span",{className:"font-bold text-text-primary dark:text-white",children:[i.browser," on ",i.os]})]})]})]}),i.issues.length>0&&e.jsxs("div",{className:"bg-yellow-warm/10 dark:bg-yellow-warm/20 rounded-xl p-4 border border-yellow-warm/30 dark:border-yellow-warm/50",children:[e.jsx("h4",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Issues Detected"}),e.jsx("ul",{className:"space-y-1",children:i.issues.map((p,b)=>e.jsxs("li",{className:"text-xs text-text-secondary dark:text-text-secondary flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-warm mt-0.5",children:"‚Ä¢"}),e.jsx("span",{children:p})]},b))})]}),i.recommendations.length>0&&e.jsxs("div",{className:"bg-navy-primary/10 dark:bg-navy-primary/20 rounded-xl p-4 border border-navy-primary/30 dark:border-navy-primary/50",children:[e.jsx("h4",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Recommendations"}),e.jsx("ul",{className:"space-y-1",children:i.recommendations.map((p,b)=>e.jsxs("li",{className:"text-xs text-text-secondary dark:text-text-secondary flex items-start gap-2",children:[e.jsx("span",{className:"text-navy-primary dark:text-yellow-warm mt-0.5",children:"‚Üí"}),e.jsx("span",{children:p})]},b))})]}),x.loaded&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-xl p-4 border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"‚úì"}),e.jsx("span",{className:"font-bold text-green-700 dark:text-green-300",children:"AI models loaded successfully"})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:x.moodTracker?"text-green-600":"text-red-600",children:x.moodTracker?"‚úì":"‚úó"}),e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Mood Tracker"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:x.counselingCoach?"text-green-600":"text-red-600",children:x.counselingCoach?"‚úì":"‚úó"}),e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Counseling Coach"})]})]})]})]})},"AIDiagnostics"),Ye=a(({config:u,onUpdate:x,onClose:i,settings:r,onUpdateSettings:n})=>{const[T,p]=o.useState(u?.protocols||[]),[b,$]=o.useState(u?.crisisPhrases?.join(`
`)||""),[M,O]=o.useState(u?.emergencyContact?.name||""),[S,B]=o.useState(u?.emergencyContact?.phone||""),[g,W]=o.useState(u?.emergencyContact?.notes||""),[N,z]=o.useState(u?.customPrompts?.join(`
`)||""),[y,q]=o.useState(u?.allowStructuredRecommendations??!0),[G,D]=o.useState(!1),[l,h]=o.useState(!1),[k,f]=o.useState(!1),[A,te]=o.useState(!1),[ae,K]=o.useState(null),[E,P]=o.useState(null),_=o.useRef(null),[X,F]=o.useState("default"),[se,C]=o.useState(""),[w,v]=o.useState("idle"),[c,H]=o.useState(null),[I,R]=o.useState(!1),[Z,J]=o.useState(r?.aiModel||"tinyllama");o.useEffect(()=>{r?.aiModel&&(J(r.aiModel),U(r.aiModel))},[r?.aiModel]),o.useEffect(()=>{ee()?F("granted"):F("default")},[]),o.useEffect(()=>{const t=a(()=>{try{const d=L();H(d)}catch(d){console.warn("Could not get model status:",d)}},"updateModelStatus");t();const s=setInterval(t,2e3);return()=>clearInterval(s)},[]),o.useEffect(()=>{const t=a(s=>{E&&_.current&&!_.current.contains(s.target)&&P(null)},"handleClickOutside");return E&&(document.addEventListener("mousedown",t),document.addEventListener("touchstart",t)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)}},[E]);const ne=["CBT","DBT","ACT","EMDR","Other"],de={CBT:"Cognitive Behavioral Therapy: Focuses on identifying and changing negative thought patterns and behaviors.",DBT:"Dialectical Behavior Therapy: Combines cognitive-behavioral techniques with mindfulness and acceptance strategies.",ACT:"Acceptance and Commitment Therapy: Emphasizes accepting difficult thoughts and feelings while committing to values-based actions.",EMDR:"Eye Movement Desensitization and Reprocessing: Uses bilateral stimulation to process traumatic memories and reduce distress.",Other:"Other therapeutic approaches or custom protocols specific to your treatment plan."},oe=a(()=>{const t={protocols:T,crisisPhrases:b.split(`
`).filter(s=>s.trim().length>0),emergencyContact:M||S?{name:M,phone:S,notes:g||void 0}:void 0,customPrompts:N.split(`
`).filter(s=>s.trim().length>0),allowStructuredRecommendations:y};x(t),i()},"handleSave"),ie=a(t=>{p(s=>s.includes(t)?s.filter(d=>d!==t):[...s,t])},"toggleProtocol");o.useEffect(()=>{if(!r?.reminders)return;const t=a(()=>{if(!r.reminders.enabled){C("Disabled");return}const m=new Date().getHours();switch(r.reminders.frequency||"daily"){case"hourly":m>=8&&m<20?C(`Hourly: ${m+1}:00`):C("Hourly: 8:00 AM");break;case"daily":C(`Daily: ${r.reminders.time}`);break;case"weekly":const ge=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],fe=r.reminders.dayOfWeek??0,we=ge[fe];C(`Weekly: ${we} at ${r.reminders.time}`);break;case"monthly":const ve=r.reminders.dayOfMonth??1;C(`Monthly: Day ${ve} at ${r.reminders.time}`);break;default:C(`Daily: ${r.reminders.time}`);break}},"updatePulsePreview");t();const s=setInterval(t,6e4);return()=>clearInterval(s)},[r?.reminders]);const le=a(async()=>{const t=await re();F(t)},"handleRequestPermission"),ce=a(()=>{!r||!n||(X!=="granted"&&le(),n({...r,reminders:{...r.reminders,enabled:!r.reminders.enabled}}))},"toggleReminders"),xe=a(t=>{!r||!n||n({...r,reminders:{...r.reminders,frequency:t}})},"handleFrequencyChange"),me=a(t=>{!r||!n||n({...r,reminders:{...r.reminders,time:t.target.value}})},"handleTimeChange"),ue=a(t=>{!r||!n||n({...r,reminders:{...r.reminders,dayOfWeek:parseInt(t.target.value)}})},"handleDayOfWeekChange"),be=a(t=>{if(!r||!n)return;const s=parseInt(t.target.value);s>=1&&s<=31&&n({...r,reminders:{...r.reminders,dayOfMonth:s}})},"handleDayOfMonthChange"),he=a(async()=>{if(!(!r||!n))if(r.reminders.useDeviceCalendar)n({...r,reminders:{...r.reminders,useDeviceCalendar:!1}});else try{if("calendar"in navigator&&"requestPermission"in navigator.calendar)await navigator.calendar.requestPermission()==="granted"&&n({...r,reminders:{...r.reminders,useDeviceCalendar:!0}});else{const t=new Date,[s,d]=r.reminders.time.split(":").map(Number),m=new Date;m.setHours(s,d,0,0);const j=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=Grounded Reflection Reminder&dates=${m.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${m.toISOString().replace(/[-:]/g,"").split(".")[0]}Z&details=Time to reflect on your values`;window.open(j,"_blank"),n({...r,reminders:{...r.reminders,useDeviceCalendar:!0}})}}catch(t){console.error("Calendar access error:",t),alert("Could not access calendar. You can manually add reminders to your calendar.")}},"handleCalendarToggle"),pe=a(()=>{if(!(!r||!n))if(r.reminders.useNtfyPush)n({...r,reminders:{...r.reminders,useNtfyPush:!1}});else{const t=r.reminders.ntfyTopic||Y();n({...r,reminders:{...r.reminders,useNtfyPush:!0,ntfyTopic:t}})}},"handleNtfyToggle"),ye=a(()=>{if(!r||!n)return;const t=Y();n({...r,reminders:{...r.reminders,ntfyTopic:t}}),v("idle")},"handleResetTopic"),ke=a(t=>{if(!r||!n)return;const s=t.target.value.trim();(Ie(s)||s==="")&&n({...r,reminders:{...r.reminders,ntfyTopic:s}})},"handleNtfyTopicChange"),Q=a(async()=>{if(!(!r||!n)){if(!r.reminders.ntfyTopic){const t=Y();n({...r,reminders:{...r.reminders,ntfyTopic:t}}),setTimeout(()=>Q(),100);return}v("sending");try{const t="üíõ Test notification from Grounded! If you received this, push notifications are working perfectly!";ee()&&await Re("Grounded Test",{body:t,icon:"/favicon.ico"}),await De(t,"Grounded Test",{topic:r.reminders.ntfyTopic,server:r.reminders.ntfyServer})?(v("success"),setTimeout(()=>v("idle"),3e3)):(v("error"),setTimeout(()=>v("idle"),3e3))}catch(t){console.error("Test notification error:",t),v("error"),setTimeout(()=>v("idle"),3e3)}}},"handleTestNtfy");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",children:[e.jsx("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-2xl rounded-[40px] shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-text-primary dark:text-white",children:"Configuration"}),e.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary mt-1",children:"Configure therapy integration settings"})]}),e.jsx("button",{onClick:i,className:"w-10 h-10 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 block",children:"Treatment Protocols"}),e.jsx("div",{ref:_,className:"flex flex-wrap gap-2 relative",children:ne.map(t=>{const s=ae===t,d=E===t,m=s||d;return e.jsxs("div",{className:"relative",onMouseEnter:a(()=>K(t),"onMouseEnter"),onMouseLeave:a(()=>{K(null)},"onMouseLeave"),onTouchStart:a(j=>{j.stopPropagation(),Le("light"),P(E===t?null:t)},"onTouchStart"),children:[e.jsx("button",{onClick:a(j=>{j.stopPropagation(),ie(t),"ontouchstart"in window&&P(E===t?null:t)},"onClick"),className:`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all relative z-10 ${T.includes(t)?"bg-navy-primary text-white shadow-sm":"bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary border border-border-soft dark:border-dark-border"}`,children:t}),m&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-50 w-64 sm:w-72",children:e.jsxs("div",{className:"bg-navy-dark dark:bg-dark-bg-tertiary text-white dark:text-white rounded-xl p-3 shadow-2xl border border-navy-light/30 dark:border-dark-border animate-fade-in",children:[e.jsx("p",{className:"text-xs sm:text-sm sm:text-xs leading-relaxed font-medium",children:de[t]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1",children:e.jsx("div",{className:"w-2 h-2 bg-navy-dark dark:bg-dark-bg-tertiary rotate-45 border-r border-b border-navy-light/30 dark:border-dark-border"})}),d&&e.jsx("button",{onClick:a(j=>{j.stopPropagation(),P(null)},"onClick"),className:"absolute top-1 right-1 w-6 h-6 flex items-center justify-center rounded-full bg-white/20 dark:bg-white/20 active:bg-white/30 dark:active:bg-white/30 text-white dark:text-white transition-colors touch-target","aria-label":"Close tooltip",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]})})]},t)})})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:a(()=>h(!l),"onClick"),className:"w-full flex items-center justify-between text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 p-2 hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary rounded-lg transition-colors",children:[e.jsx("span",{children:"Crisis Detection"}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${l?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:a(()=>f(!k),"onClick"),className:"w-full flex items-center justify-between p-4 bg-navy-light/10 dark:bg-navy-light/20 rounded-2xl border border-navy-light/30 dark:border-navy-light/50 hover:bg-navy-light/15 dark:hover:bg-navy-light/25 transition-colors",children:[e.jsx("p",{className:"text-xs font-bold text-navy-primary dark:text-navy-light",children:"üîí Automatic Crisis Detection (Non-Editable)"}),e.jsx("svg",{className:`w-4 h-4 text-navy-primary dark:text-navy-light transition-transform ${k?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),k&&e.jsxs("div",{className:"p-4 bg-navy-light/5 dark:bg-navy-light/10 rounded-xl mt-2 border border-navy-light/20 dark:border-navy-light/30",children:[e.jsxs("p",{className:"text-xs text-navy-dark dark:text-navy-light leading-relaxed mb-2",children:["The app uses ",e.jsx("strong",{children:"comprehensive, hardcoded crisis detection"})," that monitors for over 100+ phrases across 8 categories including direct suicide statements, self-harm language, planning indicators, and immediate danger signals. These detection phrases ",e.jsx("strong",{children:"cannot be modified or disabled"})," to ensure consistent safety monitoring."]}),e.jsx("p",{className:"text-xs text-navy-primary dark:text-navy-light italic",children:"When crisis language is detected, the app immediately stops normal responses and displays emergency resources, crisis hotlines (988), and encourages contacting professional help or emergency services."})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:a(()=>te(!A),"onClick"),className:"w-full flex items-center justify-between p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-2xl border border-border-soft dark:border-dark-border hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary transition-colors",children:[e.jsx("p",{className:"text-xs font-bold text-text-primary dark:text-white",children:"Additional Custom Phrases (Optional)"}),e.jsx("svg",{className:`w-4 h-4 text-text-primary dark:text-white transition-transform ${A?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),A&&e.jsxs("div",{className:"p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl mt-2 border border-border-soft dark:border-dark-border",children:[e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary mb-2",children:"You can add custom phrases here, but note that the comprehensive hardcoded detection will still be active. Custom phrases are in addition to, not replacements for, the built-in safety monitoring."}),e.jsx("textarea",{value:b,onChange:a(t=>$(t.target.value),"onChange"),placeholder:`Add any additional phrases specific to your practice (optional)
Note: Built-in crisis detection remains active`,className:"w-full p-4 rounded-xl bg-white dark:bg-dark-bg-tertiary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[100px] resize-none text-sm"})]})]})]})]}),e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 p-2 hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary rounded-lg transition-colors list-none flex items-center justify-between",children:[e.jsx("span",{children:"Emergency Contact"}),e.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsx("input",{type:"text",value:M,onChange:a(t=>O(t.target.value),"onChange"),placeholder:"Therapist Name",className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border-none focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white"}),e.jsx("input",{type:"tel",value:S,onChange:a(t=>B(t.target.value),"onChange"),placeholder:"Phone Number",className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border-none focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white"}),e.jsx("textarea",{value:g,onChange:a(t=>W(t.target.value),"onChange"),placeholder:"Additional notes (e.g., 'Available 24/7', 'Text preferred')",className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border-none focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[80px] resize-none text-sm"})]})]}),e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 p-2 hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary rounded-lg transition-colors list-none flex items-center justify-between",children:[e.jsx("span",{children:"Custom Homework/Worksheets"}),e.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Custom prompts, worksheets, or links your therapist wants you to focus on. One per line. Links will be clickable."}),e.jsx("textarea",{value:N,onChange:a(t=>z(t.target.value),"onChange"),placeholder:`Practice mindfulness for 5 minutes daily
Complete thought record worksheet
https://example.com/worksheet.pdf
Journal about triggers`,className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[100px] resize-none text-sm"}),N&&e.jsxs("div",{className:"p-3 bg-bg-tertiary dark:bg-dark-bg-tertiary rounded-xl",children:[e.jsx("p",{className:"text-xs font-bold text-text-primary dark:text-white mb-2",children:"Preview:"}),e.jsx("div",{className:"space-y-1 text-xs text-text-primary dark:text-white",children:N.split(`
`).filter(t=>t.trim()).map((t,s)=>{const d=/^https?:\/\//.test(t.trim());return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-text-tertiary",children:"‚Ä¢"}),d?e.jsx("a",{href:t.trim(),target:"_blank",rel:"noopener noreferrer",className:"text-navy-primary dark:text-navy-light hover:underline break-all",children:t.trim()}):e.jsx("span",{children:t.trim()})]},s)})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-2xl border border-border-soft dark:border-dark-border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white block mb-1",children:"Allow Structured Recommendations"}),e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"AI can suggest structured actions aligned with your treatment plan"})]}),e.jsx("button",{onClick:a(()=>q(!y),"onClick"),className:`w-14 h-8 rounded-full transition-all relative flex-shrink-0 ${y?"bg-navy-primary":"bg-border-soft dark:bg-dark-bg-primary"}`,"aria-label":y?"Disable recommendations":"Enable recommendations",children:e.jsx("div",{className:`absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all ${y?"right-1":"left-1"}`})})]}),r&&n&&e.jsxs("details",{className:"group border-t border-border-soft dark:border-dark-border pt-6",children:[e.jsx("summary",{className:"cursor-pointer list-none",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-1 block",children:"Email Summaries"}),e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Schedule automatic reports to your therapist"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.emailSchedule?.enabled&&e.jsx("span",{className:"px-2 py-1 bg-calm-sage/20 dark:bg-calm-sage/20 text-calm-sage dark:text-calm-sage rounded-lg text-xs sm:text-sm font-black uppercase tracking-widest",children:"Active"}),e.jsx("svg",{className:"w-4 h-4 text-text-primary dark:text-white transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:a(()=>D(!0),"onClick"),className:"w-full px-4 py-3 bg-navy-primary text-white dark:text-white rounded-xl text-xs font-black uppercase tracking-widest hover:opacity-90 border border-navy-primary",children:"Configure Email Summaries"}),r.emailSchedule?.enabled&&e.jsxs("div",{className:"p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border",children:[e.jsxs("p",{className:"text-xs text-text-primary dark:text-white mb-1",children:[e.jsx("strong",{children:"Active:"})," ",r.emailSchedule.frequency," at ",r.emailSchedule.time]}),e.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:["Recipients: ",r.emailSchedule.recipientEmails.length," email(s)"]})]})]})]}),r&&n&&e.jsxs("details",{className:"group border-t border-border-soft dark:border-dark-border pt-6",open:!1,children:[e.jsx("summary",{className:"cursor-pointer list-none",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-1 block",children:"Growth and Progress"}),e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Keep your North Star in sight throughout the day"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:a(t=>{t.preventDefault(),ce()},"onClick"),className:`w-14 h-8 rounded-full transition-all relative ${r.reminders.enabled?"bg-yellow-warm":"bg-border-soft dark:bg-dark-bg-primary"}`,children:e.jsx("div",{className:`absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all ${r.reminders.enabled?"right-1":"left-1"}`})}),e.jsx("svg",{className:"w-4 h-4 text-text-primary dark:text-white transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),e.jsxs("div",{className:`space-y-6 transition-all duration-500 ${r.reminders.enabled?"opacity-100 scale-100":"opacity-30 scale-95 pointer-events-none"}`,children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-xs sm:text-sm font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:[(r.reminders.frequency||"daily").charAt(0).toUpperCase()+(r.reminders.frequency||"daily").slice(1)," Reflection Reminder"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:["hourly","daily","weekly","monthly"].map(t=>e.jsx("button",{onClick:a(()=>xe(t),"onClick"),className:`px-4 py-3 rounded-xl font-black text-xs uppercase tracking-widest transition-all ${(r.reminders.frequency||"daily")===t?"bg-yellow-warm text-text-primary shadow-lg scale-105":"bg-bg-secondary dark:bg-dark-bg-primary/50 text-text-primary/60 dark:text-white/60 hover:bg-yellow-warm/20 dark:hover:bg-yellow-warm/20"}`,children:t},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[((r.reminders.frequency||"daily")==="daily"||(r.reminders.frequency||"daily")==="weekly"||(r.reminders.frequency||"daily")==="monthly")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Time"}),e.jsx("input",{type:"time",value:r.reminders.time,onChange:me,className:"w-full bg-bg-secondary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 rounded-xl p-3 font-black text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none"})]}),(r.reminders.frequency||"daily")==="weekly"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Day of Week"}),e.jsxs("select",{value:r.reminders.dayOfWeek??0,onChange:ue,className:"w-full bg-bg-secondary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 rounded-xl p-3 font-black text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none",children:[e.jsx("option",{value:0,children:"Sunday"}),e.jsx("option",{value:1,children:"Monday"}),e.jsx("option",{value:2,children:"Tuesday"}),e.jsx("option",{value:3,children:"Wednesday"}),e.jsx("option",{value:4,children:"Thursday"}),e.jsx("option",{value:5,children:"Friday"}),e.jsx("option",{value:6,children:"Saturday"})]})]}),(r.reminders.frequency||"daily")==="monthly"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Day of Month (1-31)"}),e.jsx("input",{type:"number",min:"1",max:"31",value:r.reminders.dayOfMonth??1,onChange:be,className:"w-full bg-bg-secondary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 rounded-xl p-3 font-black text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none"})]})]}),e.jsx("div",{className:"bg-bg-secondary dark:bg-dark-bg-primary/50 rounded-xl p-4 border border-border-soft dark:border-dark-border/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Device Calendar"}),e.jsx("p",{className:"text-xs text-text-primary/60 dark:text-white/60",children:"Add reminders to your device's calendar app"})]}),e.jsx("button",{onClick:he,className:`w-14 h-8 rounded-full transition-all relative ${r.reminders.useDeviceCalendar?"bg-yellow-warm":"bg-border-soft dark:bg-dark-bg-primary"}`,children:e.jsx("div",{className:`absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all ${r.reminders.useDeviceCalendar?"right-1":"left-1"}`})})]})}),e.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-primary/50 rounded-xl p-4 border border-border-soft dark:border-dark-border/30 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Push Notifications (ntfy.sh)"}),e.jsx("p",{className:"text-xs text-text-primary/60 dark:text-white/60",children:"Secure push notifications to your device"})]}),e.jsx("button",{onClick:pe,className:`w-14 h-8 rounded-full transition-all relative ${r.reminders.useNtfyPush?"bg-yellow-warm":"bg-border-soft dark:bg-dark-bg-primary"}`,children:e.jsx("div",{className:`absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all ${r.reminders.useNtfyPush?"right-1":"left-1"}`})})]}),r.reminders.useNtfyPush&&e.jsxs("div",{className:"space-y-4 pt-3 border-t border-border-soft dark:border-dark-border/30",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary rounded-xl p-4 border-2 border-yellow-warm/30 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs sm:text-sm font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Your Subscription Topic"}),e.jsx("button",{onClick:ye,className:"px-2 py-1 bg-border-soft dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-lg text-xs font-black uppercase tracking-widest hover:bg-yellow-warm/20 dark:hover:bg-yellow-warm/20 transition-all",title:"Generate new topic",children:"üîÑ Reset"})]}),e.jsx("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary rounded-lg p-3 border border-border-soft dark:border-dark-border/30",children:e.jsx("code",{className:"text-sm font-black text-navy-primary dark:text-yellow-warm break-all",children:r.reminders.ntfyTopic||"Loading..."})}),e.jsxs("p",{className:"text-xs sm:text-sm text-text-secondary dark:text-white/70 leading-relaxed",children:["üì± ",e.jsx("strong",{children:"Quick Setup:"})," Open the ntfy app on your device and subscribe to this topic. That's it!"]})]}),e.jsxs("button",{onClick:Q,disabled:w==="sending",className:`w-full px-4 py-3 rounded-xl text-xs sm:text-sm font-black uppercase tracking-widest transition-all shadow-md ${w==="success"?"bg-calm-sage text-white":w==="error"?"bg-warm-coral text-white":w==="sending"?"bg-border-soft dark:bg-dark-bg-tertiary text-text-primary dark:text-white opacity-50 cursor-not-allowed":"bg-yellow-warm text-text-primary hover:opacity-90"}`,children:[w==="sending"&&"‚è≥ Sending...",w==="success"&&"‚úÖ Sent! Check your device",w==="error"&&"‚ùå Failed. Check your topic",w==="idle"&&"üîî Test Notification"]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer text-xs sm:text-sm font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest hover:text-text-primary dark:hover:text-white transition-colors",children:"‚öôÔ∏è Advanced Options"}),e.jsxs("div",{className:"mt-3 space-y-3 pt-3 border-t border-border-soft dark:border-dark-border/30",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Custom Topic (Optional)"}),e.jsx("input",{type:"text",value:r.reminders.ntfyTopic||"",onChange:ke,placeholder:"grounded-abc123xyz",className:"w-full p-2 rounded-lg bg-white dark:bg-dark-bg-primary border border-border-soft dark:border-dark-border/30 text-xs font-medium text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none"}),e.jsx("p",{className:"text-xs text-text-primary/50 dark:text-white/50",children:"Use only letters, numbers, dashes, and underscores"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest block",children:"Custom Server (Optional)"}),e.jsx("input",{type:"text",value:r.reminders.ntfyServer||"",onChange:a(t=>n({...r,reminders:{...r.reminders,ntfyServer:t.target.value.trim()||void 0}}),"onChange"),placeholder:"https://ntfy.sh (default)",className:"w-full p-2 rounded-lg bg-white dark:bg-dark-bg-primary border border-border-soft dark:border-dark-border/30 text-xs font-medium text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm transition-all outline-none"}),e.jsx("p",{className:"text-xs text-text-primary/50 dark:text-white/50",children:"Leave empty to use the free public server"})]})]})]})]})]}),e.jsx("div",{className:"bg-yellow-warm/10 dark:bg-yellow-warm/20 rounded-xl p-4 border border-yellow-warm/30",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Next Reminder"}),e.jsx("span",{className:"text-sm font-black text-yellow-warm animate-pulse",children:se})]})}),e.jsx("div",{className:"w-full space-y-3",children:X!=="granted"?e.jsxs("button",{onClick:re,className:"w-full px-6 py-4 bg-yellow-warm/20 dark:bg-yellow-warm/20 text-yellow-warm dark:text-yellow-warm rounded-2xl text-xs sm:text-sm font-black uppercase tracking-widest hover:bg-yellow-warm/30 dark:hover:bg-yellow-warm/30 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Enable Browser Permissions"]}):e.jsxs("div",{className:"px-6 py-4 bg-calm-sage/20 dark:bg-calm-sage/20 text-calm-sage dark:text-calm-sage rounded-2xl text-xs sm:text-sm font-black uppercase tracking-widest flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Nudge Engine Active"]})}),e.jsx("p",{className:"text-xs sm:text-sm text-text-tertiary dark:text-text-tertiary font-medium italic text-center",children:"Reminders trigger via system notifications while this tab is open. Keep the app open for notifications to work."})]})]}),e.jsxs("details",{className:"group border-t border-border-soft dark:border-dark-border pt-6",children:[e.jsxs("summary",{className:"cursor-pointer text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 p-2 hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary rounded-lg transition-colors list-none flex items-center justify-between",children:[e.jsx("span",{children:"AI Model"}),e.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsxs("div",{className:"mt-3 space-y-4",children:[e.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary",children:"Update the on-device AI model for better guidance and encouragement. Models are downloaded and cached on your device for privacy."}),e.jsx(Oe,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-text-primary dark:text-white",children:"Select AI Model:"}),e.jsx("select",{value:Z,onChange:a(async t=>{const s=t.target.value;J(s),n&&r&&n({...r,aiModel:s}),R(!0);try{U(s);const d=await Te(!0,s);setTimeout(()=>{const m=L();H(m)},1e3),d&&console.log(`‚úÖ Switched to ${V()[s].name}`)}catch(d){console.error("Model switch error:",d)}finally{R(!1)}},"onChange"),disabled:I||c?.loading,className:"w-full px-4 py-3 rounded-xl text-xs font-medium bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white border border-border-soft dark:border-dark-border focus:outline-none focus:ring-2 focus:ring-navy-primary disabled:opacity-50 disabled:cursor-not-allowed",children:Object.entries(V()).map(([t,s])=>e.jsxs("option",{value:t,children:[s.name," - ",s.description," (",s.size,")"]},t))}),e.jsxs("p",{className:"text-xs sm:text-sm text-text-tertiary dark:text-text-tertiary",children:[V()[Z].description,". Models are cached in your browser for instant loading."]})]}),c&&e.jsxs("div",{className:"p-3 bg-bg-secondary dark:bg-dark-bg-secondary rounded-lg border border-border-soft dark:border-dark-border space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary dark:text-text-secondary",children:"Model Status:"}),e.jsx("span",{className:`font-semibold ${c.loaded?"text-green-600 dark:text-green-400":c.loading?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:c.loaded?"‚úì Loaded":c.loading?"‚è≥ Loading...":"‚úó Not Available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-text-tertiary dark:text-text-tertiary",children:"Mood Tracker:"}),e.jsx("span",{className:c.moodTracker?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:c.moodTracker?"‚úì":"‚úó"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-text-tertiary dark:text-text-tertiary",children:"Counseling Coach:"}),e.jsx("span",{className:c.counselingCoach?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:c.counselingCoach?"‚úì":"‚úó"})]})]}),!c.loaded&&!c.loading&&e.jsx("p",{className:"text-xs sm:text-sm text-text-tertiary dark:text-text-tertiary mt-2",children:c.errorCategory==="network"?"AI models unavailable: Check your internet connection. The app will use rule-based responses until models can be downloaded.":c.errorCategory==="memory"?"AI models unavailable: Insufficient device memory. The app will use rule-based responses. All features remain fully functional.":c.errorCategory==="wasm"?"AI models unavailable: WebAssembly not supported. Please use a modern browser. The app will use rule-based responses.":"AI models are loading or unavailable. The app will use rule-based responses. All features remain fully functional."})]}),e.jsx("button",{onClick:a(async()=>{if(confirm("This will clear and re-download the AI model. This may take a few minutes and requires internet connection. Continue?")){R(!0);try{const{initializeModels:t}=await Me(async()=>{const{initializeModels:d}=await import("./emailService-CUnzClK5.js").then(m=>m.d);return{initializeModels:d}},__vite__mapDeps([0,1])),s=await t(!0);if(setTimeout(()=>{const d=L();H(d)},1e3),s)alert("‚úÖ Model update complete! The new model has been downloaded and cached on your device. AI features are now available.");else{const d=L();let m="Model update failed. The app will continue using rule-based responses.";!d.moodTracker&&!d.counselingCoach?m+=`

This is likely a browser compatibility issue with ONNX Runtime. The app is fully functional with rule-based responses.`:(!d.moodTracker||!d.counselingCoach)&&(m+=`

Partial loading: ${d.moodTracker?"Mood tracker ‚úì":"Mood tracker ‚úó"}, ${d.counselingCoach?"Counseling coach ‚úì":"Counseling coach ‚úó"}`),alert(m)}}catch(t){console.error("Model update error:",t);const s=t?.message||String(t);let d="Error updating model. ";s.includes("registerBackend")||s.includes("ort-web")?d+="This appears to be a browser compatibility issue with ONNX Runtime. The app will continue using rule-based responses, which are fully functional.":d+="Please check your internet connection and try again.",alert(d)}finally{R(!1)}}},"onClick"),disabled:I||c?.loading,className:`w-full px-4 py-3 rounded-xl text-xs font-black uppercase tracking-widest shadow-sm border ${I||c?.loading?"bg-gray-400 dark:bg-gray-600 text-white cursor-not-allowed":"bg-navy-primary text-white dark:text-white hover:opacity-90 border-navy-primary"}`,children:I?"‚è≥ Updating...":c?.loading?"‚è≥ Loading...":"Update AI Model"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-tertiary dark:text-text-tertiary text-center",children:"Recommended: TinyLlama-1.1B (quantized for mobile, publicly available)"}),!c?.loaded&&!c?.loading&&e.jsx("p",{className:"text-xs sm:text-sm text-text-tertiary dark:text-text-tertiary text-center italic",children:"Note: If models fail to load, this is typically a browser compatibility issue. The app remains fully functional with rule-based responses."})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:i,className:"flex-1 px-6 py-4 bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary",children:"Cancel"}),e.jsx("button",{onClick:oe,className:"flex-1 px-6 py-4 bg-navy-primary text-white rounded-2xl text-xs font-black uppercase tracking-widest hover:opacity-90 shadow-sm",children:"Save Configuration"})]}),e.jsx("div",{className:"pt-4 border-t border-border-soft dark:border-dark-border",children:e.jsx("p",{className:"text-xs text-text-tertiary dark:text-text-tertiary text-center",children:"This configuration helps the app support your therapy integration. All AI processing happens on your device for privacy."})})]})}),G&&r&&n&&e.jsx($e,{schedule:r.emailSchedule,onUpdate:a(t=>n({...r,emailSchedule:t}),"onUpdate"),onClose:a(()=>D(!1),"onClose")})]})},"LCSWConfigComponent");export{Ye as default};
