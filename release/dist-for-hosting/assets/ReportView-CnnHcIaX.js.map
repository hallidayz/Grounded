{"version":3,"mappings":"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","names":["ReportView_default","React","memo","logs","values","lcswConfig","selectedLogIds","setSelectedLogIds","useState","Set","map","l","id","generatedReport","setGeneratedReport","loading","setLoading","mode","setMode","filteredLogs","useMemo","filter","has","sortedLogs","sort","a","b","Date","date","getTime","handleGenerate","useCallback","async","length","report","generateHumanReports","error","generateFallbackReport","__vitePreload","import","then","n","d","__VITE_PRELOAD__","fallbackReport","alert","toggleLog","prev","next","delete","add","jsxs","className","children","jsx","onClick","size","VirtualList","items","itemHeight","containerHeight","window","Math","min","innerHeight","overscan","threshold","renderItem","log","index","val","find","v","valueId","isSelected","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","toLocaleDateString","mood","name","deepReflection","substring","note","disabled","navigator","clipboard","writeText","emailData","generateEmailReport","shareViaEmail","isWebShareAvailable"],"ignoreList":[],"sources":["../../components/ReportView.tsx"],"sourcesContent":["\nimport React, { useState, useMemo, useCallback } from 'react';\nimport { LogEntry, ValueItem, LCSWConfig } from '../types';\nimport { generateHumanReports } from '../services/aiService';\nimport { shareViaEmail, generateEmailReport, isWebShareAvailable } from '../services/emailService';\nimport SkeletonCard from './SkeletonCard';\nimport VirtualList from './VirtualList';\n\ninterface ReportViewProps {\n  logs: LogEntry[];\n  values: ValueItem[];\n  lcswConfig?: LCSWConfig;\n}\n\nconst ReportView: React.FC<ReportViewProps> = ({ logs, values, lcswConfig }) => {\n  const [selectedLogIds, setSelectedLogIds] = useState<Set<string>>(new Set(logs.map(l => l.id)));\n  const [generatedReport, setGeneratedReport] = useState<string>('');\n  const [loading, setLoading] = useState(false);\n  const [mode, setMode] = useState<'review' | 'generate'>('review');\n\n  const filteredLogs = useMemo(() => {\n    return logs.filter(l => selectedLogIds.has(l.id));\n  }, [logs, selectedLogIds]);\n\n  const sortedLogs = useMemo(() => {\n    return [...logs].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n  }, [logs]);\n\n  const handleGenerate = useCallback(async () => {\n    if (filteredLogs.length === 0) {\n      alert(\"Please select at least one log to synthesize.\");\n      return;\n    }\n    setLoading(true);\n    try {\n      // Generate report using on-device AI with configuration\n      // This will use rule-based fallback if AI models aren't available\n      const report = await generateHumanReports(filteredLogs, values, lcswConfig);\n      setGeneratedReport(report);\n      setMode('generate');\n    } catch (error) {\n      console.error(\"Report synthesis failed:\", error);\n      // Generate fallback report gracefully\n      const { generateFallbackReport } = await import('../services/aiService');\n      const fallbackReport = generateFallbackReport(filteredLogs, values);\n      const disclaimer = `\\n\\n---\\n\\n*This report was generated using rule-based analysis. All processing happens on your device for privacy.*`;\n      setGeneratedReport(fallbackReport + disclaimer);\n      setMode('generate');\n    } finally {\n      setLoading(false);\n    }\n  }, [filteredLogs, values, lcswConfig]);\n\n  const toggleLog = useCallback((id: string) => {\n    setSelectedLogIds(prev => {\n      const next = new Set(prev);\n      if (next.has(id)) next.delete(id);\n      else next.add(id);\n      return next;\n    });\n  }, []);\n\n  return (\n    <div className=\"space-y-4 sm:space-y-6 lg:space-y-8 animate-fade-in pb-12 sm:pb-20\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-end gap-3 sm:gap-0\">\n        <div>\n          <h2 className=\"text-2xl sm:text-3xl font-black text-navy-primary dark:text-white tracking-tight\">Clinical Synthesis</h2>\n          <p className=\"text-text-secondary dark:text-text-secondary text-sm sm:text-lg mt-1\">Human-first insights for professional sharing.</p>\n        </div>\n        {mode === 'generate' && (\n          <button onClick={() => setMode('review')} className=\"text-yellow-warm dark:text-yellow-warm font-black uppercase text-[10px] tracking-widest hover:underline\">\n            ‚Üê Edit Selection\n          </button>\n        )}\n      </div>\n\n      {mode === 'review' ? (\n        <div className=\"grid lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8\">\n          <div className=\"lg:col-span-2 space-y-3 sm:space-y-4\">\n            <div className=\"flex items-center justify-between px-2 mb-2\">\n              <h3 className=\"text-[10px] font-black text-text-secondary dark:text-text-secondary uppercase tracking-widest\">Select your records</h3>\n              <span className=\"text-[10px] font-bold text-yellow-warm bg-yellow-warm/20 dark:bg-yellow-warm/30 px-2 sm:px-3 py-1 rounded-full uppercase\">{selectedLogIds.size} Ready</span>\n            </div>\n            {sortedLogs.length === 0 ? (\n              <div className=\"text-center py-16 sm:py-24 bg-white dark:bg-dark-bg-primary rounded-2xl sm:rounded-[40px] border border-dashed border-border-soft dark:border-dark-border text-text-tertiary dark:text-text-tertiary\">\n                No data in the vault yet.\n              </div>\n            ) : (\n              <VirtualList\n                items={sortedLogs}\n                itemHeight={140}\n                containerHeight={typeof window !== 'undefined' ? Math.min(600, window.innerHeight * 0.6) : 600}\n                overscan={2}\n                className=\"space-y-3 sm:space-y-4 pr-2 custom-scrollbar\"\n                threshold={5}\n                renderItem={(log, index) => {\n                  const val = values.find(v => v.id === log.valueId);\n                  const isSelected = selectedLogIds.has(log.id);\n                  return (\n                    <button \n                      key={log.id} \n                      onClick={() => toggleLog(log.id)}\n                      className={`w-full text-left bg-white dark:bg-dark-bg-primary p-4 sm:p-6 lg:p-8 rounded-2xl sm:rounded-[32px] border-2 transition-all flex gap-3 sm:gap-6 ${isSelected ? 'border-yellow-warm shadow-xl' : 'border-border-soft dark:border-dark-border opacity-50'}`}\n                    >\n                      <div className={`w-6 h-6 sm:w-8 sm:h-8 rounded-full border-2 flex items-center justify-center transition-colors flex-shrink-0 mt-1 ${isSelected ? 'bg-yellow-warm border-yellow-warm' : 'border-border-soft dark:border-dark-border'}`}>\n                        {isSelected && <svg className=\"w-3 h-3 sm:w-4 sm:h-4 text-navy-primary\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={4} d=\"M5 13l4 4L19 7\" /></svg>}\n                      </div>\n                      <div className=\"flex-grow min-w-0\">\n                        <div className=\"flex justify-between mb-2\">\n                          <span className=\"text-[9px] sm:text-[10px] font-black text-text-secondary dark:text-text-secondary uppercase tracking-widest\">{new Date(log.date).toLocaleDateString()}</span>\n                          <span className=\"text-xl sm:text-2xl\">{log.mood}</span>\n                        </div>\n                        <p className=\"text-base sm:text-lg font-black text-text-primary dark:text-white truncate\">{val?.name}</p>\n                        {log.deepReflection && (\n                          <p className=\"text-text-primary dark:text-white/80 mt-2 sm:mt-3 leading-relaxed text-xs sm:text-sm line-clamp-2 font-medium\">\n                            Deep Reflection: {log.deepReflection.substring(0, 100)}{log.deepReflection.length > 100 ? '...' : ''}\n                          </p>\n                        )}\n                        <p className=\"text-text-primary/70 dark:text-white/70 mt-2 sm:mt-3 italic leading-relaxed text-sm sm:text-base line-clamp-2\">\"{log.note}\"</p>\n                      </div>\n                    </button>\n                  );\n                }}\n              />\n            )}\n          </div>\n\n          <div className=\"lg:col-span-1\">\n            <div className=\"bg-white dark:bg-dark-bg-primary p-6 sm:p-8 lg:p-10 rounded-2xl sm:rounded-[48px] border border-border-soft dark:border-dark-border shadow-2xl sticky top-20 sm:top-24 space-y-6 sm:space-y-8\">\n               <div className=\"space-y-3 sm:space-y-4\">\n                 <p className=\"text-sm font-bold text-text-primary dark:text-white\">Synthesis Engine</p>\n                 <p className=\"text-xs text-text-secondary dark:text-text-secondary leading-relaxed\">This will generate a natural-language report in SOAP, DAP, and BIRP formats simultaneously. Perfect for review with your therapist.</p>\n               </div>\n              <button\n                onClick={handleGenerate}\n                disabled={loading || selectedLogIds.size === 0}\n                className=\"w-full py-4 sm:py-5 bg-navy-primary dark:bg-navy-primary text-white dark:text-white rounded-2xl sm:rounded-3xl font-black uppercase tracking-[0.2em] shadow-xl hover:opacity-90 transition-all active:scale-95 disabled:opacity-20 text-[9px] sm:text-[10px]\"\n              >\n                {loading ? 'Synthesizing...' : 'Generate All'}\n              </button>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"space-y-6 sm:space-y-8 animate-pop\">\n           <div className=\"bg-white dark:bg-dark-bg-primary p-6 sm:p-8 lg:p-12 rounded-2xl sm:rounded-[56px] shadow-2xl border border-yellow-warm/20 dark:border-yellow-warm/30 max-w-4xl mx-auto prose prose-slate dark:prose-invert\">\n              <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0 mb-6 sm:mb-10 pb-4 sm:pb-6 border-b border-border-soft dark:border-dark-border\">\n                <p className=\"text-[10px] font-black text-yellow-warm uppercase tracking-[0.3em]\">Confidential Clinical Summary</p>\n                <div className=\"flex flex-wrap gap-2\">\n                <button \n                  onClick={() => {\n                    navigator.clipboard.writeText(generatedReport);\n                    alert(\"All formats copied to clipboard!\");\n                  }}\n                    className=\"px-4 sm:px-6 py-2 bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm rounded-full text-[9px] sm:text-[10px] font-black uppercase tracking-widest hover:bg-yellow-warm/30 dark:hover:bg-yellow-warm/40\"\n                >\n                    Copy\n                  </button>\n                  <button \n                    onClick={async () => {\n                      const emailData = generateEmailReport(filteredLogs, values, generatedReport);\n                      const therapistEmails = lcswConfig?.emergencyContact?.phone \n                        ? [] // We'll use the emergency contact if available\n                        : [];\n                      const success = await shareViaEmail(emailData, therapistEmails);\n                      if (!success) {\n                        alert(\"Could not open email. Please copy the report and send manually.\");\n                      }\n                    }}\n                    className=\"px-4 sm:px-6 py-2 bg-yellow-warm text-navy-primary rounded-full text-[9px] sm:text-[10px] font-black uppercase tracking-widest hover:opacity-90\"\n                  >\n                    {isWebShareAvailable() ? 'üìß Share' : 'üìß Email'}\n                </button>\n                </div>\n              </div>\n              <div className=\"whitespace-pre-wrap font-sans text-text-primary dark:text-white leading-relaxed text-sm sm:text-base lg:text-lg prose prose-slate dark:prose-invert max-w-none clinical-report\">\n                {generatedReport}\n              </div>\n           </div>\n           <p className=\"text-center text-text-tertiary dark:text-text-tertiary text-xs font-medium\">These reports are generated on-device using local AI for your personal review. All processing happens on your device for privacy.</p>\n        </div>\n      )}\n\n      <style>{`\n        .custom-scrollbar::-webkit-scrollbar { width: 4px; }\n        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }\n        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #4a5568; }\n      `}</style>\n    </div>\n  );\n};\n\nexport default React.memo(ReportView);\n"],"file":"assets/ReportView-CnnHcIaX.js"}