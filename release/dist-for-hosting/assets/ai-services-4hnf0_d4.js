const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/transformers-CgLRIXTl.js","assets/vendor-CFU3Mex3.js","assets/react-vendor-ByHOp49b.js","assets/index-WGdxYKHL.js","assets/index-CXd8JJcB.css"])))=>i.map(i=>d[i]);
var Me=Object.defineProperty;var d=(e,o)=>Me(e,"name",{value:o,configurable:!0});const Oe="modulepreload",Le=d(function(e){return"/"+e},"assetsURL"),_e={},de=d(function(o,n,i){let a=Promise.resolve();if(n&&n.length>0){let t=d(function(u){return Promise.all(u.map(y=>Promise.resolve(y).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))},"allSettled2");document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),c=s?.nonce||s?.getAttribute("nonce");a=t(n.map(u=>{if(u=Le(u),u in _e)return;_e[u]=!0;const y=u.endsWith(".css"),l=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${l}`))return;const h=document.createElement("link");if(h.rel=y?"stylesheet":Oe,y||(h.as="script"),h.crossOrigin="",h.href=u,c&&h.setAttribute("nonce",c),document.head.appendChild(h),y)return new Promise((w,E)=>{h.addEventListener("load",w),h.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(t){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=t,window.dispatchEvent(s),!s.defaultPrevented)throw t}return d(r,"handlePreloadError"),a.then(t=>{for(const s of t||[])s.status==="rejected"&&r(s.reason);return o().catch(r)})},"preload");function Ne(){try{return typeof SharedArrayBuffer<"u"}catch{return!1}}d(Ne,"checkSharedArrayBuffer");function Pe(){try{return self.crossOriginIsolated===!0}catch{return!1}}d(Pe,"checkCrossOriginIsolated");function $e(){try{return"gpu"in navigator&&navigator.gpu!==void 0}catch{return!1}}d($e,"checkWebGPU");function Ue(){try{return typeof WebAssembly<"u"&&typeof WebAssembly.instantiate=="function"}catch{return!1}}d(Ue,"checkWASM");function Fe(){try{if("deviceMemory"in navigator&&navigator.deviceMemory)return navigator.deviceMemory*1024;const e=navigator.userAgent.toLowerCase();return/mobile|android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e)?2048:4096}catch{return null}}d(Fe,"estimateMemory");function We(){try{const e=navigator.userAgent.toLowerCase();return/tablet|ipad|playbook|silk/i.test(e)?"tablet":/mobile|android|iphone|ipod|blackberry|iemobile|opera mini/i.test(e)?"mobile":/windows|macintosh|linux/i.test(e)?"desktop":"unknown"}catch{return"unknown"}}d(We,"detectDeviceType");function He(){try{const e=navigator.userAgent;return e.includes("Chrome")&&!e.includes("Edg")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")&&!e.includes("Chrome")?"Safari":e.includes("Edg")?"Edge":e.includes("Opera")||e.includes("OPR")?"Opera":"Unknown"}catch{return"Unknown"}}d(He,"detectBrowser");function Ge(){try{const e=navigator.userAgent;return e.includes("Windows")?"Windows":e.includes("Mac OS")?"macOS":e.includes("Linux")?"Linux":e.includes("Android")?"Android":e.includes("iOS")||e.includes("iPhone")||e.includes("iPad")?"iOS":"Unknown"}catch{return"Unknown"}}d(Ge,"detectOS");function xe(e,o,n,i,a,r,t,s){const c=[],u=[];let y=!0,l="standard";return e||(c.push("SharedArrayBuffer is not available"),u.push("Enable COOP/COEP headers on your server (see SERVER_CONFIG.md)"),y=!1,l="single-threaded"),o||(c.push("Cross-origin isolation is not enabled"),e||u.push("Set Cross-Origin-Opener-Policy: same-origin and Cross-Origin-Embedder-Policy: require-corp headers")),i||(c.push("WebAssembly is not supported"),u.push("Use a modern browser that supports WebAssembly"),y=!1,l="unavailable"),a!==null&&(a<1024?(c.push(`Low device memory detected (${Math.round(a)}MB)`),u.push("Use smaller models or close other applications"),l="low-memory"):a<2048&&(c.push(`Limited device memory (${Math.round(a)}MB)`),u.push("Consider using smaller models for better performance"),l==="standard"&&(l="low-memory"))),n||(c.push("WebGPU is not available"),u.push("GPU acceleration unavailable - will use CPU only"),l==="standard"&&(l="cpu-only")),r==="mobile"&&a!==null&&a<3072&&(c.push("Mobile device with limited memory"),u.push("AI models may be slow or unavailable on this device"),l==="standard"&&(l="low-memory")),i?!e&&!o&&(y=!0,l="single-threaded"):(y=!1,l="unavailable"),{sharedArrayBuffer:e,crossOriginIsolated:o,webGPU:n,wasm:i,estimatedMemory:a,deviceType:r,browser:t,os:s,isCompatible:i&&(e||o),issues:c,recommendations:u,canUseAI:y,suggestedStrategy:l}}d(xe,"generateReport");function Be(){const e=Ne(),o=Pe(),n=$e(),i=Ue(),a=Fe(),r=We(),t=He(),s=Ge();return xe(e,o,n,i,a,r,t,s)}d(Be,"checkBrowserCompatibility");function Ye(e){return e.canUseAI?e.suggestedStrategy==="unavailable"?"AI models unavailable - WebAssembly not supported":e.suggestedStrategy==="single-threaded"?"AI models available (single-threaded mode) - enable COOP/COEP headers for better performance":e.suggestedStrategy==="low-memory"?"AI models available (low-memory mode) - may be slower":e.suggestedStrategy==="cpu-only"?"AI models available (CPU-only mode) - GPU acceleration unavailable":"AI models available - all features supported":"AI models unavailable - browser compatibility issue"}d(Ye,"getCompatibilitySummary");let he={progress:0,status:"idle",label:""};const Se=new Set;function go(e){return Se.add(e),e(he),()=>{Se.delete(e)}}d(go,"subscribeToProgress");function Ee(e){he=e,Se.forEach(o=>{try{o(e)}catch(n){console.error("Progress callback error:",n)}})}d(Ee,"notifyProgress");function te(e,o,n){Ee({progress:Math.max(0,Math.min(100,e)),status:"loading",label:o,details:n})}d(te,"setModelLoadingProgress");function fe(e="Complete",o){Ee({progress:100,status:"success",label:e,details:o})}d(fe,"setProgressSuccess");function Re(e="Error",o){Ee({progress:he.progress,status:"error",label:e,details:o})}d(Re,"setProgressError");function mo(){return{...he}}d(mo,"getCurrentProgress");if(typeof globalThis<"u"){const e=globalThis.ort=globalThis.ort||{};e.env=e.env||{},e.env.wasm=e.env.wasm||{},e.env.wasm.numThreads||(e.env.wasm.numThreads=typeof SharedArrayBuffer<"u"?4:1),e.registerBackend||(e.registerBackend=function(){})}typeof window<"u"&&(window.__TRANSFORMERS_ENV__=window.__TRANSFORMERS_ENV__||{},window.__TRANSFORMERS_ENV__.USE_WEBGPU=!1,window.__TRANSFORMERS_ENV__.USE_WASM=!0);const se={distilbert:{name:"DistilBERT",path:"/models/distilbert-base-uncased-finetuned-sst-2-english",task:"text-classification",description:"Fast sentiment analysis and mood classification",size:"~67MB"},tinyllama:{name:"TinyLlama",path:"/models/TinyLlama-1.1B-Chat-v1.0",task:"text-generation",description:"Best for healthcare/psychology - balanced quality and performance",size:"~637MB"}},Ve="tinyllama";let S=null,C=null,ie=new Map,U=Ve,M=!1,F=null,D=null,A=null,le=0,Z=0;const ce=3e4,Ke=3;let Y=0,P="idle",$="",G="";function ue(){return S}d(ue,"getMoodTrackerModel");function b(){return C}d(b,"getCounselingCoachModel");function oe(){return M}d(oe,"getIsModelLoading");function je(){return{progress:Y,status:P,label:$,details:G}}d(je,"getModelDownloadProgress");function Je(e){U=e}d(Je,"setSelectedModel");function ze(){return se}d(ze,"getAllModelConfigs");async function ae(){if(S=null,C=null,ie.clear(),M=!1,F=null,"caches"in window){const e=await caches.keys();for(const o of e)(o.includes("transformers")||o.includes("model")||o.includes("onnx"))&&await caches.delete(o)}}d(ae,"clearModels");async function J(e=!1,o){o&&o!==U&&(U=o,(S||C)&&(e=!0));const n=o||U;if(e&&(await ae(),Z=0),S&&C&&U===n&&!e)try{if(await re())return Z=0,!0}catch{}if(M&&F&&!e)try{const r=await F;if(S&&C&&U===n)return r}catch{}const i=Date.now();if(!e&&Z>=Ke){const r=i-le;if(r<ce)return console.log(`‚è∏Ô∏è Model initialization skipped - too many recent failures. Waiting ${Math.ceil((ce-r)/1e3)}s before retry.`),!1;Z=0}if(!e&&K())return console.log("‚úÖ Models already loaded - skipping initialization"),P="complete",Y=100,$="AI models ready",G="All models loaded",fe("AI models ready","All models are loaded and ready"),!0;if(!e&&le>0){const r=i-le;if(r<ce&&!M)return console.log(`‚è∏Ô∏è Model initialization skipped - too soon after last attempt. Waiting ${Math.ceil((ce-r)/1e3)}s.`),!1}le=i,o&&o!==U&&(U=o),M=!0,Y=0,P="downloading",$="Starting download...",G="Preparing AI models";let a=null;return F=(async()=>{try{console.log("[MODEL_DEBUG] Running browser compatibility check..."),D=Be(),A=null;const r=Ye(D);if(console.log(`üîç Browser compatibility: ${r}`),console.log("[MODEL_DEBUG] Compatibility details:",{canUseAI:D?.canUseAI,wasm:D?.wasm,sharedArrayBuffer:D?.sharedArrayBuffer,webGPU:D?.webGPU,estimatedMemory:D?.estimatedMemory,suggestedStrategy:D?.suggestedStrategy}),!D.wasm)return console.warn("‚ö†Ô∏è WebAssembly not supported. AI models cannot be used on this browser."),A="wasm",M=!1,Re("AI models unavailable","WebAssembly not supported. Use a modern browser."),!1;D.sharedArrayBuffer?console.log("‚úì SharedArrayBuffer available - multi-threaded mode enabled"):(console.warn("‚ö†Ô∏è SharedArrayBuffer not available. Will attempt single-threaded mode."),console.warn("‚ö†Ô∏è For better performance, enable COOP/COEP headers (see SERVER_CONFIG.md)."),A="coop-coep"),console.log("[MODEL_DEBUG] Browser compatibility check passed, proceeding with model loading..."),console.log("[MODEL_DEBUG] canUseAI:",D.canUseAI,"suggestedStrategy:",D.suggestedStrategy);let t;try{if(console.log("[MODEL_DEBUG] Importing @xenova/transformers (using WASM backend)..."),typeof globalThis<"u"){const p=globalThis.ort=globalThis.ort||{};p.env||(p.env={wasm:{numThreads:typeof SharedArrayBuffer<"u"?4:1}}),p.registerBackend||(p.registerBackend=function(){})}const f=de(()=>import("./transformers-CgLRIXTl.js").then(p=>p.t),__vite__mapDeps([0,1,2])),g=new Promise((p,m)=>{setTimeout(()=>m(new Error("Import timeout after 10 seconds")),1e4)});if(t=await Promise.race([f,g]),console.log("[MODEL_DEBUG] Transformers module imported successfully"),!t||!t.pipeline)return console.error("[MODEL_DEBUG] Transformers module structure invalid:",{hasModule:!!t,hasPipeline:!!t?.pipeline,moduleKeys:t?Object.keys(t):[]}),console.info("‚ÑπÔ∏è Transformers module structure invalid. Using rule-based responses."),a&&(clearTimeout(a),a=null),M=!1,!1;console.log("[MODEL_DEBUG] Transformers module verified - pipeline function available")}catch(f){const g=f?.message||String(f),p=f?.stack||"";return console.error("[MODEL_DEBUG] Failed to import @xenova/transformers:",g),p&&console.error("[MODEL_DEBUG] Import error stack:",p),g.includes("memory")||g.includes("OOM")||g.includes("out of memory")?(A="memory",console.info("‚ÑπÔ∏è AI models unavailable: Insufficient device memory."),console.info("‚ÑπÔ∏è App uses rule-based responses (fully functional).")):g.includes("network")||g.includes("fetch")||g.includes("Failed to fetch")?(A="network",console.info("‚ÑπÔ∏è AI models unavailable: Network error during download."),console.info("‚ÑπÔ∏è App uses rule-based responses (fully functional).")):(A="unknown",console.info("‚ÑπÔ∏è AI models unavailable. App uses rule-based responses (fully functional).")),M=!1,a&&(clearTimeout(a),a=null),F=null,!1}const{pipeline:s,env:c}=t;if(!s||!c)throw new Error("Transformers module did not load correctly");if(typeof s!="function")throw new Error("Pipeline function not available in transformers module");try{c.allowLocalModels=!0,c.useBrowserCache=!0,c.useCustomCache=!1;const f=!1;c.cacheDir="./models-cache",c.useBrowserCache=!0,c.allowRemoteModels=!0,f||(console.log("üì¶ Using local bundled models from /models/ directory"),console.log("üì¶ Will fallback to HuggingFace if local model not available"))}catch(f){console.warn("Could not configure transformers environment, using defaults:",f)}let u="cpu",y="";D?.wasm?(u="cpu",y="ONNX Runtime WASM backend (CPU with optimizations)",D?.sharedArrayBuffer?console.log("[MODEL_DEBUG] ‚úÖ ONNX Runtime WASM backend with multi-threading available"):console.log("[MODEL_DEBUG] ‚úÖ ONNX Runtime WASM backend available (single-threaded mode)")):(u="cpu",y="CPU (fallback)",console.log("[MODEL_DEBUG] ‚ö†Ô∏è Using CPU fallback - WASM optimizations unavailable")),console.log("Loading psychology-centric AI model...");let l=0,h=0;const w=2;let E=0;const _=100,W=d(f=>{const g=Date.now(),p=g-E>=_;if(f.status==="progress"){const m=f.progress?Math.round(f.progress*100):0,v=Math.round(h/w*100+m/w);l=Math.min(100,v);const B=f.name||"model";console.log(`Model loading: ${B} - ${m}%`),Y=l,P="downloading",$="Loading AI models...",G=`${B}: ${m}%`,p&&(te(l,"Loading AI models...",`${B}: ${m}%`),E=g)}else if(f.status==="done"){const m=f.name||"model";console.log(`Model progress callback: ${m} reported done (files downloaded, initializing...)`),p&&(te(Math.min(l,85),"Loading AI models...",`${m} files downloaded, initializing...`),E=g)}},"progressCallback"),I=se[n];console.log(`Loading ${I.name} (${I.description})...`);const x={distilbert:"Xenova/distilbert-base-uncased-finetuned-sst-2-english",tinyllama:"Xenova/TinyLlama-1.1B-Chat-v1.0"};let k=I.path;const R=x[n],O=!1;O||console.log(`[MODEL_DEBUG] Production mode - trying local path: ${k}`);const L=(D?.suggestedStrategy||"standard")==="low-memory"||D?.estimatedMemory!==null&&D.estimatedMemory<2048;try{console.log(`Attempting to load ${I.name} for mood tracking...`),console.log(`[MODEL_DEBUG] Pipeline call: task=${I.task}, path=${k}`);const f={quantized:!0,progress_callback:W,device:u};console.log(`[MODEL_DEBUG] Loading model with ${y}`);const g=new Promise((m,v)=>{setTimeout(()=>v(new Error("Model loading timeout after 30 seconds")),3e4)});try{S=await Promise.race([s(I.task,k,f),g])}catch(m){if(k!==R&&R){const v=m?.message||String(m),B=m?.stack||"";if(v.includes("<!DOCTYPE")||v.includes("404")||v.includes("Not Found")||v.includes("not valid JSON")||v.includes("Unexpected token")){console.warn(`[MODEL_DEBUG] Local model path failed (${v.substring(0,50)}), falling back to HuggingFace: ${R}`),k=R;try{S=await Promise.race([s(I.task,k,f),g])}catch(X){const V=X?.message||String(X);throw(V.includes("<!DOCTYPE")||V.includes("not valid JSON")||V.includes("CORS"))&&(!1||(console.error(`[MODEL_DEBUG] HuggingFace model also failed - possible CORS issue: ${V.substring(0,100)}`),console.error("[MODEL_DEBUG] This might be a CORS configuration issue. Models will be unavailable."))),X}}else throw m}else{const v=m?.message||String(m);throw(v.includes("<!DOCTYPE")||v.includes("not valid JSON"))&&(!1||(console.error(`[MODEL_DEBUG] HuggingFace model failed with HTML response - possible CORS or network issue: ${v.substring(0,100)}`),console.error("[MODEL_DEBUG] Check browser console for CORS errors. Models may be unavailable."))),m}}if(console.log("[MODEL_DEBUG] Pipeline call completed successfully"),console.log(`‚úì ${I.name} model loaded successfully for mood tracking`),console.log(`[MODEL_DEBUG] Model task: ${I.task}, can be reused: ${I.task==="text-generation"}`),console.log(`[MODEL_DEBUG] moodTrackerModel is set: ${!!S}, type: ${typeof S}`),!S)throw new Error("Model loaded but moodTrackerModel is null");ie.set(n,S),console.log(`[MODEL_DEBUG] Model cached: ${n}`),h++;const p=Math.round(h/w*95);l=Math.min(95,p),Y=l,P="downloading",$="Loading AI models...",G=`${I.name} initialized`,te(l,"Loading AI models...",`${I.name} initialized`)}catch(f){const g=f?.message||String(f),p=f?.stack||"",m=!1;m&&(g.includes("<!DOCTYPE")||g.includes("not valid JSON")||g.includes("CORS"))||(console.error(`[MODEL_DEBUG] Pipeline call failed for ${I.name}:`,g),p&&console.error("[MODEL_DEBUG] Error stack:",p)),g.includes("memory")||g.includes("OOM")||g.includes("out of memory")?(A="memory",console.warn("‚ö†Ô∏è Insufficient memory for model loading.")):g.includes("network")||g.includes("fetch")||g.includes("Failed to fetch")||g.includes("Unexpected token")||g.includes("<!DOCTYPE")||g.includes("not valid JSON")||g.includes("CORS")||g.includes("Cross-Origin")?(A="network",m||(console.warn("‚ö†Ô∏è Network/CORS error during model loading."),console.warn("‚ö†Ô∏è The model may not be accessible due to CORS restrictions or network issues."),console.warn("‚ö†Ô∏è Models will retry in the background."),console.warn("‚ö†Ô∏è The app will continue using rule-based responses (fully functional)."))):(A="unknown",console.warn("‚ö†Ô∏è Model loading failed for unknown reason.")),console.warn("‚ÑπÔ∏è The app will continue using rule-based responses. AI features will not be available until models load."),console.warn("‚ÑπÔ∏è Models will continue retrying in the background."),S=null}console.log("Loading counseling coach model...");const N=ie.get(n);N&&!S&&(console.log("[MODEL_DEBUG] Found cached model, assigning to moodTrackerModel"),S=N);let q=!1;console.log(`[MODEL_DEBUG] Checking model reuse: moodTrackerModel=${!!S}, modelConfig.task=${I.task}, targetModel=${n}`);const z=S||N;if(z&&I.task==="text-generation"?(q=!0,!S&&N&&(S=N,console.log("[MODEL_DEBUG] Using cached model for mood tracking")),C=S,console.log(`‚úì Reusing ${I.name} for counseling (text-generation model)`),console.log("[MODEL_DEBUG] Model reuse check passed - will reuse moodTrackerModel for counseling")):(console.log(`[MODEL_DEBUG] Model reuse check failed: moodTrackerModel=${!!S}, cachedModel=${!!N}, task=${I.task}`),z&&I.task!=="text-generation"?console.log(`[MODEL_DEBUG] Cannot reuse: model is ${I.task}, need text-generation for counseling`):z||(console.log("[MODEL_DEBUG] Cannot reuse: moodTrackerModel is null and no cached model"),n==="tinyllama"&&I.task==="text-generation"&&(console.log("[MODEL_DEBUG] Skipping counseling model load - TinyLlama already failed, would fail again"),q=!1))),!q&&!(n==="tinyllama"&&!S&&!N)){const f=n==="distilbert"?"tinyllama":n,g=se[f];if(ie.has(f))C=ie.get(f),console.log(`‚úì Using cached ${g.name} for counseling`);else try{console.log(`Attempting to load ${g.name} for counseling...`);let p=g.path;const m=x[f];O||console.log(`[MODEL_DEBUG] Production mode - trying local path for counseling: ${p}`);const v={quantized:!0,progress_callback:W,device:u};console.log(`[MODEL_DEBUG] Loading counseling model with ${y}`);const B=new Promise((V,Q)=>{setTimeout(()=>Q(new Error("Counseling model loading timeout after 30 seconds")),3e4)});try{C=await Promise.race([s("text-generation",p,v),B])}catch(V){if(p!==m&&m){const Q=V?.message||String(V);if(Q.includes("<!DOCTYPE")||Q.includes("404")||Q.includes("Not Found")||Q.includes("not valid JSON"))console.warn(`[MODEL_DEBUG] Local counseling model path failed (${Q.substring(0,50)}), falling back to HuggingFace: ${m}`),p=m,C=await Promise.race([s("text-generation",p,v),B]);else throw V}else throw V}console.log(`‚úì ${g.name} loaded successfully for counseling`),ie.set(f,C),h++;const X=Math.round(h/w*100);l=Math.min(100,X),Y=l,P="downloading",$="Loading AI models...",G=`${g.name} initialized`,te(l,"Loading AI models...",`${g.name} initialized`)}catch(p){const m=p?.message||String(p),v=p?.stack||"";console.error("[MODEL_DEBUG] Counseling model loading error:",m),v&&console.error("[MODEL_DEBUG] Error stack:",v),m.includes("memory")||m.includes("OOM")||m.includes("out of memory")?(A="memory",console.warn("‚ö†Ô∏è Insufficient memory for counseling model loading.")):m.includes("network")||m.includes("fetch")||m.includes("Failed to fetch")||m.includes("Unexpected token")||m.includes("<!DOCTYPE")||m.includes("not valid JSON")||m.includes("CORS")||m.includes("Cross-Origin")?(A="network",console.warn("‚ö†Ô∏è Network/CORS error during counseling model loading."),console.warn("‚ö†Ô∏è This is common in development mode. Models will retry in the background."),console.warn("‚ö†Ô∏è The app will continue using rule-based responses (fully functional).")):(A="unknown",console.warn("‚ö†Ô∏è Counseling model loading failed for unknown reason.")),console.warn("‚ÑπÔ∏è The app will continue using rule-based responses. AI features will not be available until models load."),console.warn("‚ÑπÔ∏è Models will continue retrying in the background."),C=null}}else q?(C=S,console.log(`‚úì Using ${I.name} for both mood tracking and counseling`),h=w,l=100,Y=l,P="downloading",$="Loading AI models...",G=`${I.name} ready for both tasks`,te(l,"Loading AI models...",`${I.name} ready for both tasks`)):(C=null,console.log("[MODEL_DEBUG] TinyLlama failed - skipping separate counseling model load (would fail again)"));console.log(C?"‚úì Counseling coach model ready for guidance and encouragement":"‚ö†Ô∏è Using rule-based counseling guidance (models unavailable)");const T=S!==null&&C!==null;if(a&&clearTimeout(a),M=!1,T)if(Y=100,P="complete",$="AI models ready",G="All models loaded and verified",fe("AI models loaded successfully!","All models are ready to use"),console.log("‚úÖ All AI models loaded!"),console.log(`  - Mood tracker: ${S?"‚úì":"‚úó"}`),console.log(`  - Counseling coach: ${C?"‚úì":"‚úó"}`),console.log("[MODEL_VERIFY] Verifying loaded models work..."),await re())Te(),console.log("‚úÖ Model verification passed - all systems ready!");else return console.warn("‚ö†Ô∏è Models loaded but verification failed - will retry..."),await ae(),P="error",$="Model verification failed",G="Will retry loading",!1;else M||(Re("AI models unavailable","App will use rule-based responses"),console.warn("‚ö†Ô∏è AI models not available. App will use rule-based responses."),console.warn(`  - Mood tracker: ${S?"‚úì Loaded":"‚úó Failed"}`),console.warn(`  - Counseling coach: ${C?"‚úì Loaded":"‚úó Failed"}`),S||C?(console.info("‚ÑπÔ∏è Partial model loading: Some AI features may be available."),S&&C?(P="complete",$="AI models ready",fe("AI models loaded successfully!","All models are ready to use")):(P="error",$="Partial model loading",te(50,"Partial model loading","Some AI features available"))):(console.info("‚ÑπÔ∏è All models failed to load. The app will use rule-based responses which are fully functional."),P="error",$="AI models unavailable",Y=0,te(0,"AI models unavailable","Using rule-based responses")));return T}catch(r){a&&clearTimeout(a),console.error("Model initialization error:",r),M=!1,F=null,S=null,C=null;const t=r instanceof Error?r.message:String(r);switch(A||(t.includes("memory")||t.includes("OOM")||t.includes("out of memory")?A="memory":t.includes("network")||t.includes("fetch")||t.includes("Failed to fetch")?A="network":t.includes("WebAssembly")||t.includes("WASM")?A="wasm":A="unknown"),A){case"memory":console.warn("‚ö†Ô∏è Insufficient memory for AI models. App will use rule-based responses.");break;case"network":console.warn("‚ö†Ô∏è Failed to download AI models. Check your internet connection."),console.warn("App will use rule-based responses.");break;case"wasm":console.warn("‚ö†Ô∏è WebAssembly not supported. AI models cannot run on this browser."),console.warn("App will continue with rule-based responses.");break;default:console.warn("‚ö†Ô∏è Failed to load on-device models. App will use rule-based responses instead.")}return P="error",$="AI models unavailable",G="Will retry in background",Z++,!1}})(),F.then(r=>(r?Z=0:Z++,r)).catch(r=>{throw Z++,r})}d(J,"initializeModels");async function De(){if(M&&F){console.log("üöÄ Model loading already in progress, waiting for existing load...");try{return await F,K()}catch{return!1}}if(K()&&await re())return console.log("‚úÖ Models already loaded and working - skipping preload."),!0;console.log("üöÄ Starting background model preload...");try{if(K())if(console.log("‚úÖ Models already loaded, checking if current..."),await Xe()){if(console.log("‚úÖ Models are current, verifying they work..."),await re())return console.log("‚úÖ Models are loaded, current, and verified working - skipping preload."),!0;console.warn("‚ö†Ô∏è Models are loaded but verification failed - will reload..."),await ae()}else console.log("‚ö†Ô∏è Models are loaded but outdated - will update..."),await ae();let e=0,o=null,n=!1;for(;!n;){e++,(e===1||e%5===0)&&console.log(`üöÄ AI model preload attempt ${e}...`);try{if(M&&F)try{if(await F,K())return!0}catch{}const r=await J(),t=ue(),s=b();if(r&&t&&s){if(console.log(`[MODEL_VERIFY] Verifying models work after ${e} attempt${e!==1?"s":""}...`),await re())return Te(),console.log(`‚úÖ AI models loaded, verified, and ready after ${e} attempt${e!==1?"s":""}!`),!0;console.warn(`‚ö†Ô∏è Models loaded but verification failed after ${e} attempt${e!==1?"s":""} - will retry...`),await ae()}(t||s)&&console.log(`‚ÑπÔ∏è Partial model loading: ${t?"Mood tracker ‚úì":"Mood tracker ‚úó"}, ${s?"Counseling coach ‚úì":"Counseling coach ‚úó"}`)}catch(r){o=r;const t=r instanceof Error?r.message:String(r),s=r instanceof Error?r.stack:"";if(t.includes("network")||t.includes("fetch")||t.includes("Failed to fetch")||t.includes("No internet")||t.includes("NetworkError")||t.includes("ERR_INTERNET_DISCONNECTED")){n=!0,console.warn(`[MODEL_DEBUG] Network error detected on attempt ${e} - stopping retries (no internet).`),console.warn("‚ö†Ô∏è AI models cannot be downloaded without internet connection.");break}e%10===0&&console.log(`[MODEL_DEBUG] Attempt ${e} failed (will retry):`,t.substring(0,100))}if(!n){const r=Math.min(1e3*Math.pow(1.5,e-1),3e4);e%5===0&&console.log(`[MODEL_DEBUG] Waiting ${Math.round(r/1e3)}s before retry ${e+1}...`),await new Promise(t=>setTimeout(t,r))}}const i=ue(),a=b();return i||a?(console.log(`‚ö†Ô∏è Model preload completed with partial loading after ${e} attempts:`),console.log(`  - Mood tracker: ${i?"‚úì":"‚úó"}`),console.log(`  - Counseling coach: ${a?"‚úì":"‚úó"}`),console.log("  - Some AI features may be available."),!0):(n?(console.warn(`‚ö†Ô∏è AI models unavailable after ${e} attempts: No internet connection.`),console.warn("‚ö†Ô∏è Connect to internet to enable AI features. App uses rule-based responses.")):console.warn(`‚ö†Ô∏è AI models unavailable after ${e} attempts. Will continue retrying in background.`),!1)}catch(e){return console.error("[MODEL_DEBUG] preloadModels() caught unexpected error:",e),!1}}d(De,"preloadModels");let ne=!1;async function qe(){if(ne){console.log("üöÄ Continuous model loading already active, skipping duplicate call.");return}if(K()&&await re().catch(()=>!1)){console.log("‚úÖ Models already loaded and working - skipping continuous loading."),Y=100,P="complete",$="Complete",G="All models loaded";return}if(M&&F){console.log("üöÄ Model loading already in progress, skipping duplicate call.");return}return ne=!0,console.log("üöÄ Starting continuous AI model loading (will retry until loaded or no internet)..."),Y=0,P="downloading",$="Starting download...",G="Preparing AI models",(async()=>{let e=0;const o=3;try{for(;;){if(K()&&await re()){console.log("‚úÖ AI models loaded and verified! Continuous loading complete."),ne=!1;return}try{if(M){if(F)try{if(await F,K()){console.log("‚úÖ Models loaded by another process. Continuous loading complete."),ne=!1;return}}catch{}}else if(await De()){console.log("‚úÖ AI models loaded successfully! Continuous loading complete."),ne=!1;return}e=0,await new Promise(n=>setTimeout(n,3e4))}catch(n){const i=n instanceof Error?n.message:String(n);if(i.includes("network")||i.includes("fetch")||i.includes("Failed to fetch")||i.includes("No internet")||i.includes("NetworkError")){if(e++,console.warn(`[MODEL_DEBUG] Network error ${e}/${o} - checking internet connection...`),e>=o){console.warn("‚ö†Ô∏è Multiple network errors detected - stopping continuous model loading (no internet)."),console.warn("‚ö†Ô∏è AI models will be loaded when internet connection is restored."),ne=!1;return}}else e=0;await new Promise(r=>setTimeout(r,1e4))}}}finally{ne=!1}})(),Promise.resolve()}d(qe,"preloadModelsContinuously");async function Xe(){try{const e=`ai-models-version-${U}`,o=localStorage.getItem(e);if(!o)return!1;const n=JSON.parse(o),{timestamp:i,modelPath:a}=n,r=(Date.now()-i)/(1e3*60*60*24);if(r>7)return console.log(`[MODEL_VERSION] Models are ${Math.round(r)} days old - checking for updates...`),!1;const t=se[U].path;return a!==t?(console.log(`[MODEL_VERSION] Model path changed from ${a} to ${t} - update needed`),!1):!0}catch(e){return console.warn("[MODEL_VERSION] Error checking model version:",e),!0}}d(Xe,"areModelsCurrent");function Te(){try{const e=`ai-models-version-${U}`,o={timestamp:Date.now(),modelPath:se[U].path,modelType:U};localStorage.setItem(e,JSON.stringify(o)),console.log(`[MODEL_VERSION] Updated version info for ${U}`)}catch(e){console.warn("[MODEL_VERSION] Error updating model version:",e)}}d(Te,"updateModelVersion");async function re(){try{const e=ue(),o=b();if(!e&&!o)return console.log("[MODEL_VERIFY] No models loaded to verify"),!1;let n=!1,i=!1;if(e)try{console.log("[MODEL_VERIFY] Testing mood tracker model...");const t=await Promise.race([e("I feel happy and grateful today"),new Promise((s,c)=>setTimeout(()=>c(new Error("Test timeout")),5e3))]);t!=null?(n=!0,console.log("[MODEL_VERIFY] ‚úì Mood tracker model works")):console.warn("[MODEL_VERIFY] ‚úó Mood tracker returned invalid result")}catch(r){console.warn("[MODEL_VERIFY] ‚úó Mood tracker test failed:",r instanceof Error?r.message:String(r))}else console.log("[MODEL_VERIFY] Mood tracker model not loaded");if(o)try{console.log("[MODEL_VERIFY] Testing counseling coach model...");const t=await Promise.race([o("Test prompt for counseling model",{max_new_tokens:10,temperature:.7}),new Promise((s,c)=>setTimeout(()=>c(new Error("Test timeout")),1e4))]);t&&(Array.isArray(t)&&t.length>0&&t[0]?.generated_text||typeof t=="object"&&t.generated_text)?(i=!0,console.log("[MODEL_VERIFY] ‚úì Counseling coach model works")):console.warn("[MODEL_VERIFY] ‚úó Counseling coach returned invalid result")}catch(r){console.warn("[MODEL_VERIFY] ‚úó Counseling coach test failed:",r instanceof Error?r.message:String(r))}else console.log("[MODEL_VERIFY] Counseling coach model not loaded");const a=(e?n:!0)&&(o?i:!0);return a?console.log("[MODEL_VERIFY] ‚úì All loaded models verified and working"):console.warn("[MODEL_VERIFY] ‚úó Some models failed verification"),a}catch(e){return console.error("[MODEL_VERIFY] Error during model verification:",e),!1}}d(re,"verifyModelsWork");function K(e=!0){return e?S!==null&&C!==null:S!==null||C!==null}d(K,"areModelsLoaded");function Qe(){return{loaded:K(),loading:M,moodTracker:S!==null,counselingCoach:C!==null,compatibility:D||void 0,errorCategory:A}}d(Qe,"getModelStatus");function Ze(){return D}d(Ze,"getCompatibilityReport");const eo=Object.freeze(Object.defineProperty({__proto__:null,MODEL_CONFIGS:se,areModelsLoaded:K,clearModels:ae,getAllModelConfigs:ze,getCompatibilityReport:Ze,getCounselingCoachModel:b,getIsModelLoading:oe,getModelDownloadProgress:je,getModelStatus:Qe,getMoodTrackerModel:ue,initializeModels:J,preloadModels:De,preloadModelsContinuously:qe,setSelectedModel:Je},Symbol.toStringTag,{value:"Module"})),oo=[{phrase:"i want to die",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i want to kill myself",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i am going to kill myself",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm suicidal",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i have suicidal thoughts",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i've been thinking about suicide",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i am planning to end my life",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm going to end it all",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm going to end my life",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i want to end it",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm done with life",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i don't want to live anymore",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"life is not worth living",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm better off dead",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"everyone would be better off without me",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i wish i hadn't been born",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i wish i were dead",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i wish i didn't exist",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i'm thinking about ending everything",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i just want it all to stop permanently",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i can't go on living like this",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"},{phrase:"i have no reason to live",category:"CRISIS_SUICIDAL_IDEATION_DIRECT",severity:"critical"}],to=[{phrase:"i can't go on",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i can't do this anymore",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm at the end of my rope",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i feel trapped",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"there's no way out",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm done",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm finished",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm so tired of this life",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i just want to disappear",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i just want to go to sleep and not wake up",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i don't want to be here anymore",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i don't see a future for myself",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"nothing will ever get better",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"there's no point in trying anymore",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i have nothing to live for",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i'm such a burden",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"people would be better off without me",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"the world would be better if i were gone",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"soon this will all be over",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"if i see you again",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"i won't be around much longer",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"},{phrase:"you won't have to worry about me soon",category:"CRISIS_SUICIDAL_IDEATION_INDIRECT",severity:"high"}],no=[{phrase:"i'm going to jump",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"jump off a bridge",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"jump in front of a train",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i'm going to take all my pills",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i'm going to overdose",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"use gun on myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"use knife on myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"use razor on myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i'm going to hang myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i'm going to drown myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"researching painless ways to die",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"looking up how to kill myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"how many pills it takes to overdose",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"most effective suicide methods",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"bought a gun for myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"bought a rope",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"saving my meds for when i'm ready",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"wrote my suicide note",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"picked the day i'm going to do it",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i know exactly how i'm going to end my life",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"i have everything ready to end it",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"tried to overdose before",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"tried to cut before",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"tried to jump before",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"tried to hang myself before",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"},{phrase:"last time i tried to kill myself",category:"CRISIS_PLANNING_OR_METHOD",severity:"critical"}],ro=[{phrase:"i've been cutting myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i cut myself to cope",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i hurt myself on purpose",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"scratching myself until i bleed",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i've been burning myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i punch myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i hit my head",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i pull out my hair when i'm upset",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i starve myself on purpose",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i binge and then make myself throw up",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i want to hurt myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i'm scared i might hurt myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i can't stop hurting myself",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i like seeing myself bleed",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i deserve to be hurt",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i'm thinking about cutting again",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i have the blade ready",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i have the knife ready",category:"CRISIS_SELF_HARM",severity:"high"},{phrase:"i have the razor ready",category:"CRISIS_SELF_HARM",severity:"high"}],io=[{phrase:"i feel hopeless",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"nothing will ever change",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i feel completely alone",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i feel empty all the time",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm useless",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm worthless",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm a failure at everything",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i hate myself",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm disgusting",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm a burden to everyone",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"everyone hates me",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"nobody cares if i live or die",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"no one would miss me",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i don't matter",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i have no purpose",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"},{phrase:"i'm broken beyond repair",category:"RISK_SEVERE_HOPELESSNESS",severity:"moderate"}],ao=[{phrase:"i've been giving away my stuff",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i'm saying goodbye to people",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i've been writing letters to everyone",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"making sure everything is in order for when i'm gone",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i quit my job and don't care what happens",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i've been isolating from everyone",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i don't talk to my friends or family anymore",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i stay in my room all day",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i started drinking a lot more",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i'm using drugs to escape",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i've been driving recklessly on purpose",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"},{phrase:"i don't care if i get hurt anymore",category:"RISK_BEHAVIORAL_RED_FLAGS",severity:"moderate"}],so=[{phrase:"my friend wants to kill themselves",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my friend is talking about suicide",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my friend said they want to die",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"someone i know is going to end their life",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my child keeps saying they wish they were dead",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my partner said the world would be better without them",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"a friend told me they are going to overdose",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"someone i know is cutting themself",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my friend is talking about how they would do it",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"my friend wrote a suicide note",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"},{phrase:"i'm scared my friend will hurt themselves",category:"CRISIS_THIRD_PARTY_SUICIDE_RISK",severity:"high"}],lo=[{phrase:"i'm going to do it now",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm going to do it tonight",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i can't stop myself",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i don't think i can stay safe",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm alone and i'm scared of what i might do",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i already took the pills",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i already cut myself and it won't stop bleeding",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm bleeding a lot",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i swallowed a lot of pills",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i just tried to hang myself",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i just tried to kill myself",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm sitting here with a gun",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm sitting here with a knife",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm sitting here with pills",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm sitting here with a rope",category:"CRISIS_IMMINENT_DANGER",severity:"critical"},{phrase:"i'm in the car ready to drive off the bridge",category:"CRISIS_IMMINENT_DANGER",severity:"critical"}],co=[...oo,...to,...no,...ro,...io,...ao,...so,...lo];function yo(e){return{CRISIS_SUICIDAL_IDEATION_DIRECT:"Direct Suicide Statements",CRISIS_SUICIDAL_IDEATION_INDIRECT:"Indirect Suicide Statements",CRISIS_PLANNING_OR_METHOD:"Suicide Planning or Methods",CRISIS_SELF_HARM:"Self-Harm",RISK_SEVERE_HOPELESSNESS:"Severe Hopelessness",RISK_BEHAVIORAL_RED_FLAGS:"Behavioral Warning Signs",CRISIS_THIRD_PARTY_SUICIDE_RISK:"Concern for Others",CRISIS_IMMINENT_DANGER:"Immediate Danger"}[e]||e}d(yo,"getCategoryDisplayName");function ve(e,o){const n=e.toLowerCase(),i=[],a=[];let r="low";for(const y of co)n.includes(y.phrase)&&(i.push(y.phrase),a.includes(y.category)||a.push(y.category),y.severity==="critical"?r="critical":y.severity==="high"&&r!=="critical"?r="high":y.severity==="moderate"&&r==="low"&&(r="moderate"));const t=a.some(y=>y==="RISK_SEVERE_HOPELESSNESS"||y==="RISK_BEHAVIORAL_RED_FLAGS"),s=a.some(y=>y.startsWith("CRISIS_"));t&&s&&r==="moderate"&&(r="high");const c=i.length>0;let u="continue";return r==="critical"?u="emergency":r==="high"||a.includes("CRISIS_SELF_HARM")||a.includes("CRISIS_THIRD_PARTY_SUICIDE_RISK")?u="contact_lcsw":c&&(u="show_crisis_info"),{isCrisis:c,severity:r,detectedPhrases:i,recommendedAction:u,categories:a}}d(ve,"detectCrisis");function uo(e,o){const n=o?.emergencyContact,i=n?`${n.name||"Your therapist"}: ${n.phone}`:"Your therapist or healthcare provider";if(e.severity==="critical"||e.recommendedAction==="emergency")return e.categories?.includes("CRISIS_IMMINENT_DANGER")||e.categories?.includes("CRISIS_PLANNING_OR_METHOD")?`üö® **IMMEDIATE SAFETY CONCERN**

**Your safety is the most important thing right now.**

**If you are in immediate danger or feel you might act on thoughts of ending your life, please contact emergency services (911 in the U.S.) or the 988 Suicide & Crisis Lifeline right now.**

**This app cannot help in an emergency. If you are about to harm yourself or someone else, please call 911 or 988, or your local emergency number, immediately.**

**Please also reach out to someone you trust right now**‚Äîa close friend, family member, or someone who can be with you or check in on you. You don't have to go through this alone.

**Resources available right now:**
‚Ä¢ **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
‚Ä¢ **Crisis Text Line** - Text HOME to 741741
‚Ä¢ **Emergency Services** - 911 (U.S.) or your local emergency number
‚Ä¢ **Your Therapist**: ${i}

**If you have started to carry out a plan to end your life, stop using this app and contact 911, 988, or your local crisis service for urgent help.**

*Feeling suicidal is a medical and emotional emergency, not a personal failure. You deserve support, and help is available.*`:`üö® **SAFETY CHECK**

**It sounds like you may be thinking about ending your life or hurting yourself.**

**Are you having thoughts of suicide right now?**

**If you are thinking about suicide or have a plan, your safety is the priority. Please contact emergency services (911 in the U.S.) or the 988 Suicide & Crisis Lifeline right now.**

**This app cannot help in an emergency. If you are about to harm yourself, please call 911 or 988, or your local emergency number, immediately.**

**Please also reach out to someone you trust right now**‚Äîa close friend, family member, or someone who can be with you. You don't have to go through this alone.

**Resources available right now:**
‚Ä¢ **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
‚Ä¢ **Crisis Text Line** - Text HOME to 741741
‚Ä¢ **Emergency Services** - 911 (U.S.) or your local emergency number
‚Ä¢ **Your Therapist**: ${i}

*You are not alone in feeling this way, and it is OK to talk about suicide. Reaching out for help can make a difference. Many people have thoughts of suicide when pain feels overwhelming. Talking with a trained crisis counselor or mental health professional can help you stay safe.*`;if(e.severity==="high"||e.recommendedAction==="contact_lcsw"){const a=e.categories?.includes("CRISIS_SELF_HARM"),r=e.categories?.includes("CRISIS_THIRD_PARTY_SUICIDE_RISK");return a?`‚ö†Ô∏è **SUPPORT NEEDED**

**Thank you for sharing this. It sounds like you may be hurting yourself or thinking about self-harm.**

**What has helped you stay safe so far when you've had thoughts of suicide or self-harm?**

**Your safety matters. Please reach out for help:**

1. **Contact your therapist as soon as possible**: ${i}
2. **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
3. **Crisis Text Line** - Text HOME to 741741
4. **Reach out to someone you trust**‚Äîa close friend, family member, or someone who can support you right now

**This app is not a crisis or emergency service and cannot keep you safe in an emergency. For urgent help, contact 988, 911, or your local crisis line.**

**If you feel you might act on thoughts of self-harm, please contact a crisis line, emergency services, or your local equivalent immediately.**

*Feeling suicidal is a medical and emotional emergency, not a personal failure. You deserve support, and help is available.*`:r?`‚ö†Ô∏è **CONCERN FOR SOMEONE ELSE**

**It sounds like you're concerned about someone else who may be thinking about suicide or self-harm.**

**If someone you know is in immediate danger, please contact emergency services (911) or a crisis line right away.**

**Resources to help:**
‚Ä¢ **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
‚Ä¢ **Crisis Text Line** - Text HOME to 741741
‚Ä¢ **Emergency Services** - 911 (U.S.) or your local emergency number
‚Ä¢ **Your Therapist**: ${i}

**You can also encourage the person to reach out to a trusted friend, family member, or mental health professional.**

*This app is not a crisis or emergency service. For urgent situations, contact local emergency services or crisis lines.*`:`‚ö†Ô∏è **SUPPORT AVAILABLE**

**It sounds like you're going through a very difficult time right now.**

**Who in your life (family, friends, professionals) could you contact today to talk about how you're feeling?**

**Please reach out for help:**

1. **Contact your therapist as soon as possible**: ${i}
2. **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
3. **Crisis Text Line** - Text HOME to 741741
4. **Reach out to a trusted person**‚Äîa close friend, family member, or someone you trust‚Äîand let them know you need support right now

**This app is not a crisis or emergency service and cannot keep you safe in an emergency. For urgent help, contact 988, 911, or your local crisis line.**

**If you are thinking about suicide or self-harm, this app cannot keep you safe. Please call a crisis hotline or emergency services immediately.**

*You are not alone in feeling this way. Reaching out for help can make a difference. Would you consider creating or updating a safety plan with a mental health professional or crisis counselor?*`}return`**SUPPORT AVAILABLE**

**It sounds like you're going through a difficult time. Thank you for sharing this.**

**Please know that support is available:**

1. **Discuss this with your therapist** in your next session: ${i}
2. **988 Suicide & Crisis Lifeline** - Dial 988 if you need to talk to someone (24/7, free, confidential)
3. **Crisis Text Line** - Text HOME to 741741
4. **Consider reaching out to a trusted person**‚Äîa friend, family member, or someone you trust‚Äîand sharing what you're experiencing

**If you are thinking about suicide or self-harm, or feel you might act on harmful thoughts, please stop using the app and reach out to a trusted person or crisis service now.**

**This app cannot help in emergencies. If you are in crisis or considering self-harm, call your local emergency number or a crisis hotline now.**

*This app is not a substitute for professional therapy or crisis support. I can offer general information, but only trained people and local services can provide the immediate help you deserve when you feel suicidal.*`}d(uo,"getCrisisResponse");function pe(e,o){const n={},i={};e.forEach(s=>{const c=o.find(u=>u.id===s.valueId)?.name||"Unknown";n[c]=(n[c]||0)+1,s.mood&&(i[s.mood]=(i[s.mood]||0)+1)});const a=Object.entries(n).sort((s,c)=>c[1]-s[1])[0]?.[0]||"N/A",r=Object.entries(i).sort((s,c)=>c[1]-s[1])[0]?.[0]||"N/A";let t="";return e.slice(0,10).forEach(s=>{const c=o.find(u=>u.id===s.valueId);t+=`

**${new Date(s.date).toLocaleDateString()} - ${c?.name||"General"}**
`,s.deepReflection&&(t+=`
Deep Reflection:
${s.deepReflection}
`),s.goalText&&(t+=`
Committed Action/Goal:
${s.goalText}
`),s.reflectionAnalysis&&(t+=`
Suggested Next Steps:
${s.reflectionAnalysis}
`),s.emotionalState&&(t+=`
Emotional State: ${s.emotionalState}`,s.selectedFeeling&&(t+=` (${s.selectedFeeling})`),t+=`
`)}),`# Clinical Summary

## SOAP Format

**Subjective**: Client has logged ${e.length} reflection entries, with primary focus on ${a}. Most common mood indicator: ${r}.${t}

**Objective**: Patterns show engagement with value-based reflection practice. Entries span ${new Date(e[e.length-1]?.date||Date.now()).toLocaleDateString()} to ${new Date(e[0]?.date||Date.now()).toLocaleDateString()}.

**Assessment**: Client is actively engaging in self-reflection and value alignment work.

**Plan**: Continue value-based reflection. Review patterns with LCSW in next session.

---

## DAP Format

**Data**: ${e.length} entries, ${Object.keys(n).length} values engaged, mood tracking active.${t}

**Assessment**: Consistent engagement with reflection practice. Primary value focus: ${a}.

**Plan**: Maintain current practice. Discuss themes and patterns with LCSW.

---

## BIRP Format

**Behavior**: Client consistently logs reflections and tracks mood states.${t}

**Intervention**: Value-based reflection practice, self-monitoring.

**Response**: Active engagement, ${e.length} entries completed.

**Plan**: Continue practice, review with LCSW.

---

*This is a basic summary. For detailed analysis, please review entries manually or discuss with your LCSW.*`}d(pe,"generateFallbackReport");async function fo(e,o,n){try{if(e.length===0)return"No logs available for synthesis.";const i=e.map(l=>l.note).filter(Boolean).join(" "),a=ve(i,n);if(a.isCrisis&&a.severity==="critical"){const l=n?.emergencyContact;return`# üö® SAFETY CONCERN DETECTED IN LOGS

**Your safety is the priority.** These logs contain language that suggests you may be thinking about ending your life or hurting yourself.

**If you are in immediate danger or feel you might act on thoughts of suicide, please contact emergency services (911 in the U.S.) or the 988 Suicide & Crisis Lifeline right now.**

**This app cannot help in an emergency. If you are about to harm yourself, please call 911 or 988, or your local emergency number, immediately.**

**Please also reach out to someone you trust right now**‚Äîa close friend, family member, or someone who can be with you. You don't have to go through this alone.

**Resources available right now:**
‚Ä¢ **988 Suicide & Crisis Lifeline** - Dial 988 (24/7, free, confidential)
‚Ä¢ **Crisis Text Line** - Text HOME to 741741
‚Ä¢ **Emergency Services** - 911 (U.S.) or your local emergency number
‚Ä¢ **Your Therapist**: ${l?`${l.name||"Your therapist"}: ${l.phone}`:"Your therapist or healthcare provider"}

---

# Clinical Summary

Due to safety concerns detected in these logs, a full clinical summary should be reviewed with your LCSW or mental health professional in person.

*Feeling suicidal is a medical and emotional emergency, not a personal failure. You deserve support, and help is available.*`}if(!b()&&!await J())return`${pe(e,o)}

---

*This report was generated using rule-based analysis. All processing happens on your device for privacy.*`;const s=`You are a therapy integration assistant helping synthesize a client's reflection logs for review with their LCSW.

Generate a comprehensive report in SOAP, DAP, and BIRP formats.
      
Logs:
      ${e.map(l=>{const h=o.find(E=>E.id===l.valueId)?.name||"General";let w=`[${l.date.split("T")[0]}] Value: ${h}, Mood: ${l.mood||"N/A"}`;return l.deepReflection&&(w+=`
  Deep Reflection: ${l.deepReflection}`),l.goalText&&(w+=`
  Committed Action/Goal: ${l.goalText}`),l.reflectionAnalysis&&(w+=`
  Suggested Next Steps: ${l.reflectionAnalysis}`),l.emotionalState&&(w+=`
  Emotional State: ${l.emotionalState}`),l.selectedFeeling&&(w+=`
  Selected Feeling: ${l.selectedFeeling}`),l.note&&!l.deepReflection&&(w+=`
  Note: ${l.note}`),w}).join(`

`)}
      
IMPORTANT: For each log entry, include:
1. Deep Reflection: The user's written reflection content
2. Committed Action: Any goals or actions the user committed to
3. Suggested Next Steps: AI-generated recommendations or analysis

Format your response with clear sections for each format. Keep the tone supportive, clinical yet human, and focused on patterns and themes that would be useful for therapy integration.`;let c=pe(e,o),u=b();if(!u)if(oe()){const w=Date.now();for(;!u&&Date.now()-w<3e4;)await new Promise(E=>setTimeout(E,500)),u=b()}else await J(),u=b();if(u)try{console.log("ü§ñ Using on-device AI model for report generation...");const l=performance.now(),h=await u(s,{max_new_tokens:1e3,temperature:.7,do_sample:!0}),w=performance.now(),_=(h[0]?.generated_text||"").replace(s,"").trim();_&&_.length>50?(c=_,console.log(`‚úÖ On-device AI generated report (${Math.round(w-l)}ms)`)):console.warn("‚ö†Ô∏è AI model returned empty or too short report, using fallback")}catch(l){if(console.error("‚ùå On-device AI report generation failed:",l),l instanceof Error&&(l.message.includes("not a function")||l.message.includes("Cannot read"))){await J(!0);const h=b();if(h)try{const _=((await h(s,{max_new_tokens:1e3,temperature:.7,do_sample:!0}))[0]?.generated_text||"").replace(s,"").trim();_&&(c=_)}catch(w){console.warn("Retry report generation failed:",w)}}}return c+`

---

*This report is generated on-device for your personal review and discussion with your LCSW. It is not a substitute for professional clinical assessment.*`}catch(i){return console.error("Report generation error:",i),`${pe(e,o)}

---

*This report was generated using rule-based analysis. All processing happens on your device for privacy.*`}}d(fo,"generateHumanReports");function ge(e,o,n,i,a=[]){const r=`${e}|${o}|${n}|${i}|${JSON.stringify(a)}`;let t=0;for(let s=0;s<r.length;s++){const c=r.charCodeAt(s);t=(t<<5)-t+c,t=t&t}return`ai_cache_${Math.abs(t).toString(36)}`}d(ge,"generateCacheKey");async function me(e){try{const o=`ai_cache_${e}`,n=localStorage.getItem(o);if(!n)return null;const i=JSON.parse(n);return Date.now()>i.expiresAt?(localStorage.removeItem(o),null):i}catch(o){return console.warn("Cache read error:",o),null}}d(me,"getCachedResponse");async function j(e,o){try{const n=Date.now(),i=1440*60*1e3,a={key:e,...o,timestamp:n,expiresAt:n+i},r=`ai_cache_${e}`;localStorage.setItem(r,JSON.stringify(a))}catch(n){console.warn("Cache write error:",n)}}d(j,"setCachedResponse");const Ce={drained:{exhausted:{message:"Feeling exhausted is completely valid. Your body and mind are telling you something important. Rest isn't weakness‚Äîit's necessary for recovery. Consider what small act of self-care you can do right now, even if it's just five minutes of quiet.",acknowledgeFeeling:"I hear that you're feeling exhausted.",actionableStep:"Take five minutes to sit quietly or do something gentle that brings you comfort."},depleted:{message:"When you feel depleted, it's a sign you've been giving a lot. Your energy is a finite resource, and it's okay to need time to recharge. What's one small thing you can do to restore yourself, even slightly?",acknowledgeFeeling:"I understand you're feeling depleted.",actionableStep:"Identify one small act of restoration you can do today."},default:{message:"Feeling drained is your body's way of saying you need rest. It's okay to slow down and take care of yourself. What's one small thing that would help you feel a bit more restored?",acknowledgeFeeling:"I hear that you're feeling drained.",actionableStep:"Choose one small act of self-care you can do right now."}},heavy:{burdened:{message:"Carrying a heavy burden is exhausting, and you don't have to carry it alone. Your feelings are valid, and it's okay to ask for support. What's one thing that feels lighter when you share it with someone you trust?",acknowledgeFeeling:"I understand you're feeling burdened.",actionableStep:"Consider sharing your burden with someone supportive."},weighed_down:{message:"When you feel weighed down, it can be hard to see a way forward. Remember that feelings are temporary, even when they don't feel that way. What's one small step you can take to lighten the load, even just a little?",acknowledgeFeeling:"I hear that you're feeling weighed down.",actionableStep:"Identify one small action that might help lighten your load."},default:{message:"Heavy feelings are difficult to carry, and you don't have to carry them alone. It's okay to feel this way, and it's also okay to seek support. What would help you feel even slightly lighter?",acknowledgeFeeling:"I understand you're feeling heavy.",actionableStep:"Consider what support or action might help lighten your load."}},overwhelmed:{flooded:{message:"When you feel flooded, everything can seem too much at once. It's okay to step back and take things one moment at a time. What's one thing you can focus on right now, just for this moment?",acknowledgeFeeling:"I hear that you're feeling flooded.",actionableStep:"Focus on just one thing in this moment."},swamped:{message:"Feeling swamped means you're dealing with a lot. It's okay to feel this way, and it's also okay to prioritize. What's the most important thing you need to address right now?",acknowledgeFeeling:"I understand you're feeling swamped.",actionableStep:"Identify the most important priority right now."},default:{message:"Overwhelm is your body's way of saying there's too much happening at once. It's okay to slow down and focus on one thing at a time. What's one small step you can take right now?",acknowledgeFeeling:"I hear that you're feeling overwhelmed.",actionableStep:"Choose one small action to focus on."}},calm:{peaceful:{message:"Feeling peaceful is a gift. This is a moment to appreciate and savor. How can you extend this sense of calm into the rest of your day?",acknowledgeFeeling:"I'm glad you're feeling peaceful.",actionableStep:"Consider how to carry this peace forward."},centered:{message:"When you feel centered, you're in a good place to make decisions and take action. This is a powerful state. What would you like to focus on while you're feeling this way?",acknowledgeFeeling:"I hear that you're feeling centered.",actionableStep:"Use this centered feeling to focus on what matters."},default:{message:"Calm is a valuable state. It's a good time to reflect, plan, or simply be present. What feels most important to you right now?",acknowledgeFeeling:"I'm glad you're feeling calm.",actionableStep:"Use this calm to focus on what matters to you."}},hopeful:{optimistic:{message:"Feeling optimistic is wonderful. This positive energy can fuel your actions and decisions. What would you like to channel this optimism toward?",acknowledgeFeeling:"I'm glad you're feeling optimistic.",actionableStep:"Channel this optimism into action."},encouraged:{message:"When you feel encouraged, you're in a great position to move forward. This feeling can help you take steps toward your goals. What feels possible right now?",acknowledgeFeeling:"I hear that you're feeling encouraged.",actionableStep:"Use this encouragement to take a step forward."},default:{message:"Hope is a powerful feeling. It can help you see possibilities and take action. What feels possible or important to you right now?",acknowledgeFeeling:"I'm glad you're feeling hopeful.",actionableStep:"Use this hope to identify what feels possible."}},positive:{uplifted:{message:"Feeling uplifted is wonderful. This positive energy can help you accomplish things and connect with others. How can you use this feeling to move forward?",acknowledgeFeeling:"I'm glad you're feeling uplifted.",actionableStep:"Use this positive energy to take action."},energized:{message:"When you feel energized, you have the momentum to make things happen. This is a great time to take action on things that matter to you. What would you like to focus on?",acknowledgeFeeling:"I hear that you're feeling energized.",actionableStep:"Channel this energy into something meaningful."},default:{message:"Positive feelings are valuable. They can help you connect, create, and move forward. What feels important or possible to you right now?",acknowledgeFeeling:"I'm glad you're feeling positive.",actionableStep:"Use this positive feeling to take action."}},energized:{motivated:{message:"Feeling motivated is powerful. This drive can help you accomplish things that matter to you. What would you like to channel this motivation toward?",acknowledgeFeeling:"I hear that you're feeling motivated.",actionableStep:"Use this motivation to take action on what matters."},invigorated:{message:"When you feel invigorated, you have energy to spare. This is a great time to tackle challenges or pursue goals. What feels most important to focus on?",acknowledgeFeeling:"I'm glad you're feeling invigorated.",actionableStep:"Channel this energy into something meaningful."},default:{message:"Energy is a valuable resource. When you feel energized, you can accomplish a lot. What would you like to focus this energy on?",acknowledgeFeeling:"I hear that you're feeling energized.",actionableStep:"Use this energy to take action on what matters."}},mixed:{default:{message:"Mixed feelings are completely normal. It's okay to feel multiple things at once. What's one thing that feels clear or important to you right now?",acknowledgeFeeling:"I understand you're feeling mixed emotions.",actionableStep:"Identify one thing that feels clear or important."}},default:{message:"Your feelings are valid, and it's okay to feel whatever you're feeling. What's one small thing you can do to take care of yourself right now?",acknowledgeFeeling:"I hear you.",actionableStep:"Choose one small act of self-care."}},be={drained:{"Personal Growth":"When you're drained, focus on restoration. Small acts of self-care can help you recharge. What's one thing that helps you feel restored?",Relationships:"Feeling drained can make relationships feel harder. It's okay to communicate your needs and set boundaries. How can you care for yourself while staying connected?",Career:"When you're drained, work can feel overwhelming. Consider what boundaries or adjustments might help you maintain your energy. What's one small change you could make?",default:"When you're drained, focus on restoration and self-care. What's one small thing that helps you recharge?"},heavy:{"Personal Growth":"Heavy feelings can be part of growth. It's okay to feel this way, and it's also okay to seek support. What would help you feel lighter?",Relationships:"Heavy feelings can affect how you connect with others. It's okay to communicate your needs and ask for support. Who can you reach out to?",Career:"When you feel heavy, work can feel harder. Consider what support or adjustments might help. What's one thing that could lighten your load?",default:"Heavy feelings are difficult. It's okay to feel this way, and it's also okay to seek support. What would help you feel lighter?"},overwhelmed:{"Personal Growth":"Overwhelm can be part of growth. It's okay to slow down and focus on one thing at a time. What's the most important thing to focus on right now?",Relationships:"When you're overwhelmed, relationships can feel like too much. It's okay to communicate your needs and take space. What boundaries would help?",Career:"Overwhelm at work is common. Consider what priorities matter most and what can wait. What's one thing you can focus on right now?",default:"When you're overwhelmed, focus on one thing at a time. What's the most important thing to address right now?"},calm:{"Personal Growth":"Calm is a great state for reflection and planning. What would you like to focus on or work toward?",Relationships:"When you feel calm, you can connect more easily with others. How can you use this feeling to strengthen your relationships?",Career:"Calm can help you make clear decisions and take effective action. What would you like to focus on at work?",default:"Calm is valuable. Use this feeling to focus on what matters to you."},hopeful:{"Personal Growth":"Hope can fuel growth. What possibilities feel open to you right now?",Relationships:"When you feel hopeful, you can connect more positively with others. How can you use this feeling in your relationships?",Career:"Hope can help you see possibilities at work. What feels possible or important to focus on?",default:"Hope is powerful. Use this feeling to see possibilities and take action."},positive:{"Personal Growth":"Positive feelings can support growth. What would you like to focus on or work toward?",Relationships:"When you feel positive, you can connect more easily with others. How can you use this feeling in your relationships?",Career:"Positive feelings can help you accomplish things at work. What would you like to focus on?",default:"Positive feelings are valuable. Use them to take action on what matters."},energized:{"Personal Growth":"Energy can fuel growth. What would you like to channel this energy toward?",Relationships:"When you feel energized, you can connect more actively with others. How can you use this energy in your relationships?",Career:"Energy can help you accomplish things at work. What would you like to focus on?",default:"Energy is valuable. Use it to take action on what matters."},mixed:{default:"Mixed feelings are normal. Focus on what feels clear or important to you right now."},default:"Focus on what matters to you right now. What's one thing you can do to take care of yourself or move forward?"},ke={drained:{coreThemes:["Exhaustion","Need for rest","Self-care"],lcswLens:"Feeling drained often relates to giving too much without enough restoration. Consider what boundaries or self-care practices might help you maintain your energy.",reflectiveInquiry:["What activities or situations tend to drain your energy?","What helps you feel restored or recharged?"],sessionPrep:"Focus on identifying sources of exhaustion and strategies for restoration and self-care."},heavy:{coreThemes:["Emotional weight","Burden","Need for support"],lcswLens:"Heavy feelings often relate to carrying too much alone. Consider what support or sharing might help lighten your load.",reflectiveInquiry:["What feels heaviest for you right now?","Who or what helps you feel supported or lighter?"],sessionPrep:"Focus on identifying sources of heaviness and strategies for support and lightening the load."},overwhelmed:{coreThemes:["Too much at once","Prioritization","Boundaries"],lcswLens:"Overwhelm often relates to taking on too much or not having clear priorities. Consider what boundaries or prioritization might help.",reflectiveInquiry:["What feels most overwhelming right now?","What priorities matter most, and what can wait?"],sessionPrep:"Focus on identifying sources of overwhelm and strategies for prioritization and boundaries."},calm:{coreThemes:["Peace","Clarity","Presence"],lcswLens:"Calm is a valuable state for reflection and planning. Consider how to use this feeling to move forward.",reflectiveInquiry:["What feels clear or important to you right now?","How can you use this calm to support your growth?"],sessionPrep:"Focus on using this calm state for reflection, planning, or taking meaningful action."},hopeful:{coreThemes:["Optimism","Possibility","Forward movement"],lcswLens:"Hope can fuel action and growth. Consider what possibilities feel open and what steps you might take.",reflectiveInquiry:["What feels possible or important to you right now?","What steps can you take to move toward what matters?"],sessionPrep:"Focus on identifying possibilities and taking steps toward what matters to you."},positive:{coreThemes:["Positive energy","Connection","Action"],lcswLens:"Positive feelings can support connection and action. Consider how to use this energy to move forward.",reflectiveInquiry:["What feels important or possible to you right now?","How can you use this positive energy to take action?"],sessionPrep:"Focus on using this positive energy to connect, create, or take action on what matters."},energized:{coreThemes:["Energy","Motivation","Action"],lcswLens:"Energy is a valuable resource. Consider how to channel this feeling toward what matters to you.",reflectiveInquiry:["What would you like to focus this energy on?","What steps can you take to move toward what matters?"],sessionPrep:"Focus on channeling this energy into meaningful action or connection."},mixed:{coreThemes:["Complex feelings","Multiple emotions","Clarity"],lcswLens:"Mixed feelings are normal and valid. Consider what feels clear or important to you right now.",reflectiveInquiry:["What feels most clear or important to you right now?","What would help you feel more clarity or direction?"],sessionPrep:"Focus on identifying what feels clear or important and what steps might help."},default:{coreThemes:["Self-awareness","Growth","Support"],lcswLens:"Your feelings are valid. Consider what support or action might help you move forward.",reflectiveInquiry:["What feels most important to you right now?","What would help you feel supported or move forward?"],sessionPrep:"Focus on identifying what matters and what steps might help."}},Ae={"Personal Growth":{daily:{description:"Spend 10 minutes each day reflecting on your values and how you're living them.",whatThisHelpsWith:"This helps you stay connected to what matters and track your growth over time.",howToMeasureProgress:["Set a daily reminder to reflect","Write down one way you lived your values each day","Review your reflections weekly to see patterns"],inferenceAnalysis:"Daily reflection helps you stay connected to your values and notice patterns in how you're growing.",lcsmInferences:{encouragement:"You're taking an important step toward growth by committing to daily reflection.",guidance:"Start small with just 10 minutes. You can always increase the time as it becomes a habit."}},weekly:{description:"Set aside time each week to review your progress and adjust your goals.",whatThisHelpsWith:"This helps you stay on track and make adjustments as needed.",howToMeasureProgress:["Schedule a weekly review time","Reflect on what went well and what you'd like to change","Adjust your goals based on your progress"],inferenceAnalysis:"Weekly reviews help you stay connected to your goals and make adjustments as you grow.",lcsmInferences:{encouragement:"You're showing commitment to your growth by setting aside time for weekly review.",guidance:"Choose a consistent day and time for your review. This helps make it a habit."}},monthly:{description:"Take time each month to reflect on your overall progress and set new intentions.",whatThisHelpsWith:"This helps you see the bigger picture and make meaningful adjustments.",howToMeasureProgress:["Schedule a monthly reflection time","Review your progress over the past month","Set intentions for the month ahead"],inferenceAnalysis:"Monthly reflection helps you see patterns and make meaningful adjustments to support your growth.",lcsmInferences:{encouragement:"You're investing in your growth by committing to monthly reflection.",guidance:"Use this time to celebrate your progress and identify areas where you'd like to grow."}}},Relationships:{daily:{description:"Reach out to one person each day to connect or check in.",whatThisHelpsWith:"This helps you maintain and strengthen your relationships.",howToMeasureProgress:["Set a daily reminder to reach out","Send a message, make a call, or spend time together","Notice how these connections make you feel"],inferenceAnalysis:"Daily connection helps you maintain and strengthen your relationships over time.",lcsmInferences:{encouragement:"You're investing in your relationships by committing to daily connection.",guidance:"Start small. Even a brief message or call can strengthen your connections."}},weekly:{description:"Set aside time each week to connect meaningfully with someone important to you.",whatThisHelpsWith:"This helps you deepen your relationships and feel more connected.",howToMeasureProgress:["Schedule a weekly connection time","Choose someone you'd like to connect with","Focus on being present and listening"],inferenceAnalysis:"Weekly meaningful connection helps you deepen your relationships and feel more supported.",lcsmInferences:{encouragement:"You're prioritizing your relationships by setting aside time for meaningful connection.",guidance:"Choose activities that allow for real conversation and connection, not just surface-level interaction."}},monthly:{description:"Plan a monthly activity or gathering with people who matter to you.",whatThisHelpsWith:"This helps you maintain your social connections and create positive memories.",howToMeasureProgress:["Plan one monthly social activity","Invite people who matter to you","Reflect on how these connections make you feel"],inferenceAnalysis:"Monthly social activities help you maintain your relationships and create positive experiences.",lcsmInferences:{encouragement:"You're investing in your relationships by planning regular social activities.",guidance:"Choose activities that everyone can enjoy and that allow for real connection."}}},Career:{daily:{description:"Spend 15 minutes each day on professional development or skill-building.",whatThisHelpsWith:"This helps you grow in your career and feel more confident.",howToMeasureProgress:["Set a daily reminder for professional development","Choose what to focus on (learning, skill-building, networking)","Track your progress over time"],inferenceAnalysis:"Daily professional development helps you grow in your career and build confidence.",lcsmInferences:{encouragement:"You're investing in your career by committing to daily professional development.",guidance:"Start small with just 15 minutes. You can increase the time as it becomes a habit."}},weekly:{description:"Set aside time each week to review your career goals and progress.",whatThisHelpsWith:"This helps you stay on track and make adjustments as needed.",howToMeasureProgress:["Schedule a weekly career review time","Reflect on your progress and challenges","Adjust your goals based on your review"],inferenceAnalysis:"Weekly career reviews help you stay connected to your goals and make meaningful adjustments.",lcsmInferences:{encouragement:"You're showing commitment to your career by setting aside time for weekly review.",guidance:"Use this time to celebrate your progress and identify areas where you'd like to grow."}},monthly:{description:"Take time each month to reflect on your career direction and set new goals.",whatThisHelpsWith:"This helps you see the bigger picture and make strategic decisions.",howToMeasureProgress:["Schedule a monthly career reflection time","Review your progress and direction","Set goals for the month ahead"],inferenceAnalysis:"Monthly career reflection helps you see patterns and make strategic decisions about your direction.",lcsmInferences:{encouragement:"You're investing in your career by committing to monthly reflection.",guidance:"Use this time to assess your direction and make adjustments that align with your values."}}},default:{description:"Set aside time regularly to reflect on your values and how you're living them.",whatThisHelpsWith:"This helps you stay connected to what matters and track your progress.",howToMeasureProgress:["Set a regular time for reflection","Write down your thoughts and observations","Review your reflections periodically to see patterns"],inferenceAnalysis:"Regular reflection helps you stay connected to your values and notice patterns in your growth.",lcsmInferences:{encouragement:"You're taking an important step by committing to regular reflection.",guidance:"Start with a frequency that feels manageable. You can always adjust as needed."}}};function ye(e,o,n){if(o.emotionalState&&o.subEmotion&&o.valueCategory){const i=e[o.emotionalState];if(i&&i[o.subEmotion]&&i[o.subEmotion][o.valueCategory])return i[o.subEmotion][o.valueCategory]}if(o.emotionalState&&o.subEmotion){const i=e[o.emotionalState];if(i&&i[o.subEmotion]&&i[o.subEmotion].default)return i[o.subEmotion].default}if(o.emotionalState){const i=e[o.emotionalState];if(i&&i.default)return i.default}return n}d(ye,"getFallbackResponse");async function po(e,o,n,i){const a=n?.protocols||[],r=ge(`${e}|${o.id}|${i?.recentReflections?.substring(0,50)||""}`,e,void 0,void 0,a),t=await me(r);if(t?.focusLens)return console.log("‚úÖ Using cached Focus Lens"),t.focusLens;let s=b();if(!s)if(oe()){const E=Date.now();for(;!s&&Date.now()-E<2e3;)await new Promise(_=>setTimeout(_,200)),s=b()}else try{await J(),s=b()}catch{console.warn("Model initialization failed for Focus Lens")}const c=a.length>0?`The user is working with an LCSW using ${a.join(", ")} protocols.`:"The user is working with a licensed clinical social worker.",u=i?.recentReflections?` Recent reflections: "${i.recentReflections.substring(0,200)}".`:"",y=`Generate a concise, empathetic "Focus Lens" message (2-3 sentences) for a user.

Context: User is currently feeling ${e}. They are reflecting on the value: "${o.name}" (${o.description}).${u}
${c}

Your Focus Lens should:
- Acknowledge their emotional state.
- Connect to their chosen value.
- Offer a gentle perspective or question to guide their reflection.
- Avoid giving direct advice or therapeutic interventions.

Return ONLY the Focus Lens text.`;if(s)try{console.log("ü§ñ Calling AI model for Focus Lens...");const E=((await s(y,{max_new_tokens:100,temperature:.7,do_sample:!0,top_p:.9}))[0]?.generated_text||"").replace(y,"").trim();if(E&&E.length>20)return await j(r,{focusLens:E}),E}catch(h){console.warn("AI Focus Lens generation failed:",h)}const l=ye(be,{emotionalState:e,valueCategory:o.category},be.default);console.log("‚ÑπÔ∏è Using rule-based Focus Lens fallback.");try{const{dbService:h}=await de(async()=>{const{dbService:E}=await import("./index-WGdxYKHL.js").then(_=>_.f);return{dbService:E}},__vite__mapDeps([3,2,1,0,4])),w=sessionStorage.getItem("userId")||"anonymous";await h.saveRuleBasedUsage({id:`rule-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),operationType:"focusLens",emotionalState:e,valueCategory:o.category,fallbackKey:`${e}-${o.category}`,fallbackResponse:JSON.stringify({focusLens:l}),context:{timeOfDay:i?.timeOfDay,recentJournalText:i?.recentReflections?.substring(0,200)},aiUnavailableReason:s?"error":"notLoaded",userId:w})}catch(h){console.warn("Failed to log rule-based usage:",h)}return await j(r,{focusLens:l}),l}d(po,"generateFocusLens");function ee(e){let o=`### Structured Aim
- **Description**: ${e.description}
- **What this helps with**: ${e.whatThisHelpsWith}
- **How do I measure progress**:
${e.howToMeasureProgress.map((n,i)=>`  ${i+1}. ${n}`).join(`
`)}`;return e.inferenceAnalysis&&(o+=`

### Inference Analysis
${e.inferenceAnalysis}`),e.lcsmInferences&&(o+=`

### Encouragement & Guidance

**Encouragement:**
${e.lcsmInferences.encouragement}

**Guidance:**
${e.lcsmInferences.guidance}`),o}d(ee,"formatGoalSuggestionJSON");function Ie(e,o,n,i,a,r){const t=ye(ke,{emotionalState:o},ke.default);return r?{...t,lcswLens:`${t.lcswLens} Consider this alternative perspective: ${t.reflectiveInquiry[0]||"What else might be important here?"}`,reflectiveInquiry:[t.reflectiveInquiry[1]||t.reflectiveInquiry[0]||"What other aspects feel important?","What would a different perspective reveal about this situation?"],sessionPrep:`Explore alternative perspectives and what they reveal about your experience. ${t.sessionPrep}`}:t}d(Ie,"generateFallbackReflectionAnalysis");async function Io(e,o,n,i,a,r){try{const t=ve(e,n);if(t.isCrisis)return{coreThemes:["Crisis Intervention"],lcswLens:uo(t,n),reflectiveInquiry:["What immediate support can you access?","Who can you reach out to right now?"],sessionPrep:"Focus on safety planning and immediate support with your therapist.",isCrisis:!0};if(!e.trim())return await Ie(e,i,a,o,n,r);const s=n?.protocols||[],c=ge(e,i||null,a||null,o,s),u=await me(c);if(u?.reflectionAnalysis)return console.log("‚úÖ Using cached reflection analysis"),JSON.parse(u.reflectionAnalysis);const y=s.length>0?`The user is working with an LCSW using ${s.join(", ")} protocols.`:"The user is working with a licensed clinical social worker.",l=o==="quarterly"?"monthly":o,h=!!r,w=h?`

IMPORTANT: This is a refresh request. The user wants a different perspective on the same reflection. Previous analysis:
${JSON.stringify(r,null,2)}

Provide a NEW perspective that offers different insights while staying true to what the user actually wrote.`:"",E=`Analyze this ${l} reflection and return ONLY valid JSON (no markdown, no extra text) conforming to the ReflectionAnalysisResponse type:

interface ReflectionAnalysisResponse {
  coreThemes: string[];
  lcswLens: string;
  reflectiveInquiry: string[];
  sessionPrep: string;
}

CRITICAL GUIDELINES:
- Use the user's ACTUAL WORDS from their reflection. Don't assume context they didn't provide.
- If the user doesn't mention "work", "job", "career", or "office", DO NOT assume work-related themes.
- Focus on the PERSON - their feelings, their journey, their human experience.
- Be relatable and use language that connects to what they actually wrote.
- This is about the human making efforts, not external circumstances unless explicitly mentioned.
${h?"- This is a refresh - provide a DIFFERENT perspective while staying true to their words.":""}

Context: ${y}
${i?`Current Emotional State: ${i}`:""}
${a?`Specific Feeling: ${a}`:""}
${w}

Reflection:
${e}

Return valid JSON only.`;let _=b();if(!_)if(oe()){const x=Date.now();for(;!_&&Date.now()-x<1e4;)await new Promise(k=>setTimeout(k,500)),_=b()}else try{await J(),_=b()}catch{console.warn("Model initialization failed for reflection analysis")}if(_)try{console.log("ü§ñ Calling AI model for reflection analysis (JSON)...");const k=((await _(E,{max_new_tokens:300,temperature:.7,do_sample:!0}))[0]?.generated_text||"").replace(E,"").trim().match(/{\s*[\s\S]*?}/);if(k)try{const R=JSON.parse(k[0]);return console.log("‚úÖ AI-generated JSON reflection analysis received"),await j(c,{reflectionAnalysis:JSON.stringify(R)}),R}catch(R){console.warn("Failed to parse JSON response, using fallback",R)}}catch(W){console.warn("AI reflection analysis failed:",W)}return Ie(e,i,a,o,n,r)}catch(t){return console.error("Reflection analysis error:",t),await Ie(e,i,a,o,n,r)}}d(Io,"analyzeReflection");async function wo(e,o,n,i,a){const{getEmotionalState:r}=await de(async()=>{const{getEmotionalState:T}=await import("./emotionalStates-CHdd7_6Z.js");return{getEmotionalState:T}},[]),t=r(e);if(!t)return"You're doing important work. Keep going, one step at a time.";const s=i?.protocols||[],c=ge(`${e}|${o}|${n}|${a?.timeOfDay||""}|${a?.recentJournalText?.substring(0,50)||""}`,e,o,"daily",s),u=await me(c);if(u?.encouragement)return console.log("‚úÖ Using cached encouragement"),u.encouragement;const y=s.length>0?`The user is working with an LCSW using ${s.join(", ")} protocols.`:"The user is working with a licensed clinical social worker.",l=o?` The user has specifically selected the feeling: "${o}". This is the primary feeling they want support with.`:"",h=a?.timeOfDay?a.timeOfDay==="morning"?" It is morning‚Äîa time for fresh starts and forward momentum.":a.timeOfDay==="evening"||a.timeOfDay==="night"?" It is evening/night‚Äîa time for reflection and rest.":" It is afternoon‚Äîa time for continued engagement.":"",w=a?.recentJournalText?` Recent reflection: "${a.recentJournalText.substring(0,200)}"`:"",E=a?.userPatterns&&a.userPatterns.frequentStates.length>0?` The user has been feeling ${a.userPatterns.frequentStates.join(", ")} frequently.`:"",_=e==="drained"||e==="heavy"||e==="overwhelmed",W=_&&n>=3;let I="";if(W&&a?.userPatterns){const{frequentStates:T,progress:f}=a.userPatterns;T.length>0&&(I=` Based on recent patterns, the user has been feeling ${T.join(", ")} frequently (${n} consecutive times).`),f!==void 0&&f<30&&(I+=` Recent progress shows ${f}% positive states, indicating ongoing challenges.`)}const x=W?` Strongly encourage them to reach out to a trusted person, their therapist, or a support line (988). Emphasize that they don't have to go through this alone.${I}`:_?" Gently suggest that connecting with someone they trust might be helpful.":"",k=t.encouragementPrompt.instruction,R=`Provide encouragement and return ONLY valid JSON (no markdown, no extra text):

{
  "message": "30-60 words, 2-3 sentences of support",
  "acknowledgeFeeling": "specific feeling acknowledgment",
  "actionableStep": "optional small step"
}

Context: User is feeling ${t.label.toLowerCase()}.${l}${h}${w}${E}
${y}

Role: ${k}${x}

Requirements:
- Acknowledge: "${o||t.shortLabel}"
- Honest, realistic support (30-60 words)
- See possibilities without toxic positivity
- Genuine, warm, supportive${W?`
- Strongly encourage reaching out for support`:""}

Return valid JSON only.`;let H=ye(Ce,{emotionalState:e,subEmotion:o},Ce.default).message;W&&(e==="drained"||e==="heavy"||e==="overwhelmed")&&(H+=" Please consider reaching out to your therapist, a trusted friend, or the 988 Crisis & Suicide Lifeline. You deserve support.");let L=b();const{getMoodTrackerModel:N,areModelsLoaded:q}=await de(async()=>{const{getMoodTrackerModel:T,areModelsLoaded:f}=await Promise.resolve().then(()=>eo);return{getMoodTrackerModel:T,areModelsLoaded:f}},void 0),z=N();if(!L&&z&&(console.log("‚úÖ Using mood tracker model for Focus Lens (first available model)"),L=z),!L&&oe()){const g=Date.now();for(;!L&&Date.now()-g<2e3;){if(await new Promise(p=>setTimeout(p,200)),L=b(),!L){const p=N();if(p){L=p;break}}if(!oe()&&!L)break}}if(L)try{const g=((await L(R,{max_new_tokens:200,temperature:.8,do_sample:!0,top_p:.9}))[0]?.generated_text||"").replace(R,"").trim(),p=g.match(/\{[\s\S]*\}/);if(p)try{const m=JSON.parse(p[0]);console.log("‚úÖ AI-generated JSON encouragement received");const v=m.message||H;return await j(c,{encouragement:v}),v}catch{console.warn("Failed to parse JSON encouragement, using raw response")}if(g&&g.length>20)return await j(c,{encouragement:g}),g}catch(T){if(console.warn("Emotional encouragement inference failed:",T),T instanceof Error&&(T.message.includes("not a function")||T.message.includes("Cannot read")||T.message.includes("is not a function"))){console.warn("Model type mismatch detected, attempting to reload..."),await J(!0);const f=b();if(f)try{const m=((await f(R,{max_new_tokens:200,temperature:.8,do_sample:!0,top_p:.9}))[0]?.generated_text||"").replace(R,"").trim(),v=m.match(/\{[\s\S]*\}/);if(v)try{const B=JSON.parse(v[0]);console.log("‚úÖ AI-generated JSON encouragement received after reload");const X=B.message||H;return await j(c,{encouragement:X}),X}catch{console.warn("Failed to parse retry JSON encouragement")}if(m&&m.length>20)return m}catch(g){console.warn("Retry inference also failed:",g)}}}return console.log("‚ÑπÔ∏è Using rule-based Focus Lens (AI model not available)"),await j(c,{encouragement:H}).catch(()=>{}),H}d(wo,"generateEmotionalEncouragement");async function So(e){return{Integrity:"Truth guides me",Family:"Love connects us",Creativity:"Ideas flow freely",Health:"Body and mind unite",Freedom:"I choose my path",Justice:"Fairness for all",Kindness:"Compassion in action",Learning:"Growth through curiosity",Nature:"Earth sustains me",Peace:"Calm within",Respect:"Dignity for all",Service:"Help others rise",Spirituality:"Connection beyond self",Success:"Progress over perfection",Wealth:"Abundance flows",Wisdom:"Insight guides",Authenticity:"Be true to self",Compassion:"Kindness in action",Humor:"Joy lightens the load",Leadership:"Guide with heart",Resilience:"Bounce back stronger",Responsibility:"Own my choices",Courage:"Face fears bravely",Humility:"Learn from all",Loyalty:"Stand by others",Community:"Together we thrive",Artistry:"Create with soul",Curiosity:"Wonder opens doors",Balance:"Harmony in motion",Sustainability:"Care for tomorrow","Open-Mindedness":"Embrace new views",Impact:"Make a difference",Adventure:"Explore boldly"}[e.name]||`Honor ${e.name} today`}d(So,"generateValueMantra");async function Eo(e,o,n="",i="",a,r,t,s){try{if(ve(n,a).isCrisis)return`### Safety First
- **Description**: Contact your therapist or emergency services if you're in crisis
- **What this helps with**: Immediate support and safety
- **How do I measure progress**:
  1. Reached out to a professional
  2. Followed your safety plan
  3. Engaged with your support network`;const u=a?.protocols||[],y=ge(`${e.id}|${n}`,r||null,t||null,o,u),l=await me(y);if(l?.goalSuggestion)return console.log("‚úÖ Using cached goal suggestion"),l.goalSuggestion;let h=b();if(h)console.log("‚úÖ AI model already loaded and ready");else if(console.log("üîÑ AI model not loaded, initializing..."),oe()){console.log("‚è≥ Waiting for model to finish loading...");const R=3e4,O=Date.now();for(;!h&&Date.now()-O<R;)await new Promise(H=>setTimeout(H,500)),h=b();h?console.log("‚úÖ Model loaded successfully after wait"):console.warn("‚ö†Ô∏è Model loading timeout - will use fallback response")}else{console.log("üöÄ Starting model initialization...");try{const R=await J();h=b(),h?console.log("‚úÖ Model initialized successfully"):console.warn("‚ö†Ô∏è Model initialization completed but model is not available")}catch(R){console.error("‚ùå Model initialization failed:",R),h=null}}const w=n.includes("Deep Reflection:")||n.trim().length>50,E=n.includes("## Core Themes")||n.includes("## The 'LCSW Lens'")||n.includes("Reflection Analysis:"),_=r&&t?`The user's current emotional state is: ${r}
Their specific feeling is: ${t}

`:r?`The user's current emotional state is: ${r}

`:t?`The user's specific feeling is: ${t}

`:"",W=n.includes("Deep Reflection:")&&n.split("Deep Reflection:")[1]?.split("Reflection Analysis:")[0]?.trim()||n,I=`Analyze the Deep Reflection and suggest a Self-Advocacy Aim. Return ONLY valid JSON (no markdown, no extra text):

{
  "description": "what they'll do",
  "whatThisHelpsWith": "why it matters",
  "howToMeasureProgress": ["step1", "step2", "step3"],
  "inferenceAnalysis": "analysis of how this aim addresses the reflection themes",
  "lcsmInferences": {
    "encouragement": "first LCSM inference providing encouragement based on the reflection",
    "guidance": "second LCSM inference providing guidance for their personal journey"
  }
}

Value: "${e.name}" (${e.description})
Frequency: ${o}
${_}${i?`Counseling Guidance: ${i}

`:""}${s?`Reflection Analysis:
Core Themes: ${s.coreThemes.join(", ")}
LCSW Lens: ${s.lcswLens}
Reflective Inquiry: ${s.reflectiveInquiry.join("; ")}
Session Prep: ${s.sessionPrep}

`:""}Deep Reflection:
${W}
${E?`
Reflection Analysis:
${n.split("Reflection Analysis:")[1]||""}`:""}

Requirements:
- Specific and achievable for ${o}
- Aligned with value "${e.name}"
- Directly addresses the Deep Reflection content
- inferenceAnalysis: Explain how this aim connects to themes in their reflection
- lcsmInferences.encouragement: Provide encouragement recognizing their self-awareness and progress
- lcsmInferences.guidance: Offer guidance to support their personal journey and growth
- Supports growth and success

Return valid JSON only.`,x=await we(e,o,n,i,r,t);if(!h)return console.warn("‚ö†Ô∏è AI model not available for goal suggestion - using fallback response"),console.warn("Model status:",{modelAvailable:!!h,isModelLoading:oe(),hasReflection:n.trim().length>0,hasAnalysis:n.includes("Reflection Analysis:")}),await j(y,{goalSuggestion:ee(x)}),ee(x);try{console.log("ü§ñ Calling AI model for goal suggestion (JSON)...");const O=((await h(I,{max_new_tokens:400,temperature:.8,do_sample:!0}))[0]?.generated_text||"").replace(I,"").trim(),H=O.match(/\{[\s\S]*\}/);if(H)try{const L=JSON.parse(H[0]);return console.log("‚úÖ AI-generated JSON goal suggestion received"),ee(L)}catch{console.warn("Failed to parse JSON response, using fallback")}return O&&O.length>20?(console.warn("‚ö†Ô∏è AI returned non-JSON response, using as-is"),O):(console.warn("‚ö†Ô∏è AI model returned empty or invalid response, using fallback"),x)}catch(k){if(console.error("‚ùå Goal suggestion inference failed:",k),k instanceof Error&&(k.message.includes("not a function")||k.message.includes("Cannot read"))){console.log("üîÑ Attempting to reload AI model...");try{await J(!0);const O=b();if(O){console.log("‚úÖ Model reloaded, retrying goal suggestion...");const N=((await O(I,{max_new_tokens:400,temperature:.8,do_sample:!0}))[0]?.generated_text||"").replace(I,"").trim(),q=N.match(/\{[\s\S]*\}/);if(q)try{const z=JSON.parse(q[0]);return console.log("‚úÖ AI-generated JSON goal suggestion received after reload"),ee(z)}catch{console.warn("Failed to parse retry JSON response")}if(N&&N.length>20)return console.log("‚úÖ AI-generated goal suggestion received after reload (non-JSON)"),N}}catch(O){console.error("‚ùå Retry goal suggestion failed:",O)}}console.warn("‚ö†Ô∏è Using fallback goal suggestion due to AI model errors");const R=await we(e,o,n,i,r,t);return await j(y,{goalSuggestion:ee(R)}),ee(R)}}catch(c){console.error("Goal suggestion error:",c);const u=await we(e);return await j(cacheKey,{goalSuggestion:ee(u)}).catch(console.warn),ee(u)}}d(Eo,"suggestGoal");function we(e,o,n,i,a,r){const t=ye(Ae,{valueCategory:e.category},Ae.default);return{description:t.description,whatThisHelpsWith:t.whatThisHelpsWith,howToMeasureProgress:t.howToMeasureProgress,inferenceAnalysis:t.inferenceAnalysis,lcsmInferences:t.lcsmInferences}}d(we,"generateFallbackGoalSuggestion");export{co as A,Be as B,uo as C,pe as D,de as _,Qe as a,Ze as b,Ye as c,ze as d,wo as e,po as f,fo as g,Io as h,J as i,So as j,ve as k,Eo as l,mo as m,go as n,yo as o,je as p,K as q,oe as r,Je as s,De as t,te as u,qe as v,Re as w,ae as x,ue as y,b as z};
