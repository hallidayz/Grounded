const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/transformers-CgLRIXTl.js","assets/vendor-CFU3Mex3.js","assets/react-vendor-ByHOp49b.js","assets/Dashboard-CBC0133a.js","assets/emotionalStates-CHdd7_6Z.js","assets/animations-F5nNuMjH.js","assets/animations-CgpoTaqC.js","assets/StatusIndicator-CNI75ZVz.js","assets/ai-services-4hnf0_d4.js","assets/emailService-BJmZKHwj.js","assets/ReportView-DRu6wnYs.js","assets/VirtualList-CAMr-1S6.js","assets/VaultControl-D18shDkc.js","assets/LCSWConfig-CvIiKOYr.js","assets/ntfyService-CH0GdzTc.js","assets/GoalsUpdateView-LdVzbQAE.js"])))=>i.map(i=>d[i]);
var Bt=Object.defineProperty;var l=(o,e)=>Bt(o,"name",{value:e,configurable:!0});import{r as p,j as t,b as Ft}from"./react-vendor-ByHOp49b.js";import{a as $t,b as zt,_ as ae,m as Dt,n as nt,A as yt,o as qt,p as bt,q as _e,r as Ce,t as ft,u as J,v as Wt,s as Vt,i as Gt,w as Ht}from"./ai-services-4hnf0_d4.js";import{w as We,x as se}from"./vendor-CFU3Mex3.js";import"./transformers-CgLRIXTl.js";import"@tauri-apps/api/core";l(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}l(r,"getFetchOpts");function s(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}l(s,"processPreload")},"polyfill")();const Ue=[{id:"v1",name:"Integrity",description:"Being honest and having strong moral principles.",category:"Character"},{id:"v19",name:"Authenticity",description:"Being true to one's own personality or spirit.",category:"Character"},{id:"v24",name:"Resilience",description:"The capacity to recover quickly from difficulties.",category:"Character"},{id:"v25",name:"Responsibility",description:"Having a duty to deal with something.",category:"Character"},{id:"v26",name:"Courage",description:"The ability to do something that frightens one.",category:"Character"},{id:"v27",name:"Humility",description:"A modest or low view of one's own importance.",category:"Character"},{id:"v2",name:"Family",description:"Prioritizing the well-being of loved ones.",category:"Relationships"},{id:"v7",name:"Kindness",description:"Being friendly, generous, and considerate.",category:"Relationships"},{id:"v11",name:"Respect",description:"Deep admiration for someone or something.",category:"Relationships"},{id:"v20",name:"Compassion",description:"Concern for the sufferings or misfortunes of others.",category:"Relationships"},{id:"v23",name:"Loyalty",description:"Giving or showing firm and constant support.",category:"Relationships"},{id:"v28",name:"Community",description:"A feeling of fellowship with others.",category:"Relationships"},{id:"v3",name:"Creativity",description:"Using imagination to create something new.",category:"Expression"},{id:"v21",name:"Humor",description:"The quality of being amusing or comic.",category:"Expression"},{id:"v29",name:"Artistry",description:"Creative skill or ability.",category:"Expression"},{id:"v30",name:"Curiosity",description:"A strong desire to know or learn something.",category:"Expression"},{id:"v5",name:"Health",description:"Maintaining physical and mental well-being.",category:"Well-being"},{id:"v10",name:"Peace",description:"Freedom from disturbance; tranquility.",category:"Well-being"},{id:"v9",name:"Nature",description:"Appreciation and care for the natural world.",category:"Environment"},{id:"v31",name:"Balance",description:"Stability or even distribution of effort.",category:"Well-being"},{id:"v32",name:"Sustainability",description:"Avoiding depletion of natural resources.",category:"Environment"},{id:"v8",name:"Learning",description:"The acquisition of knowledge or skills.",category:"Growth"},{id:"v14",name:"Spirituality",description:"Connection to something bigger than oneself.",category:"Growth"},{id:"v17",name:"Wisdom",description:"Experience, knowledge, and good judgment.",category:"Growth"},{id:"v33",name:"Open-Mindedness",description:"Willingness to consider new ideas.",category:"Growth"},{id:"v15",name:"Success",description:"The accomplishment of an aim or purpose.",category:"Achievement"},{id:"v16",name:"Wealth",description:"An abundance of valuable possessions.",category:"Achievement"},{id:"v22",name:"Leadership",description:"Leading a group or an organization.",category:"Influence"},{id:"v34",name:"Impact",description:"Having a strong effect on someone or something.",category:"Influence"},{id:"v4",name:"Freedom",description:"The power to act, speak, or think without restraint.",category:"Autonomy"},{id:"v6",name:"Justice",description:"Upholding what is right and fair.",category:"Society"},{id:"v13",name:"Service",description:"Helping others and contributing to society.",category:"Society"},{id:"v18",name:"Adventure",description:"Engaging in exciting experiences.",category:"Autonomy"}],wt=l(({initialSelected:o,onComplete:e,isReorderingOnly:r=!1,onAddGoal:s,goals:n=[]})=>{const[a,i]=p.useState(o),[c,d]=p.useState(null),[m,u]=p.useState(new Set),[x,h]=p.useState(o.length>0?"sort":"pick"),[g,k]=p.useState(null),[C,A]=p.useState(null),w=p.useMemo(()=>Ue.reduce((v,b)=>(v[b.category]||(v[b.category]=[]),v[b.category].push(b),v),{}),[]),T=p.useMemo(()=>a.map(v=>Ue.find(b=>b.id===v)).filter(Boolean),[a]),D=l(v=>{i(b=>b.includes(v)?b.filter(E=>E!==v):b.length>=10?(d(v),setTimeout(()=>d(null),500),b):[...b,v])},"toggleValue"),j=l((v,b)=>{const E=[...a],G=b==="up"?v-1:v+1;G<0||G>=E.length||([E[v],E[G]]=[E[G],E[v]],i(E))},"moveValue"),z=l(v=>k(v),"handleDragStart"),q=l((v,b)=>{v.preventDefault(),g!==b&&A(b)},"handleDragOver"),S=l(v=>{if(g===null||g===v){k(null),A(null);return}const b=[...a],E=b.splice(g,1)[0];b.splice(v,0,E),i(b),k(null),A(null)},"handleDrop"),W=l(v=>{u(b=>{const E=new Set(b);return E.has(v)?E.delete(v):E.add(v),E})},"toggleCategory");return t.jsxs("div",{className:"max-w-2xl mx-auto space-y-3 sm:space-y-4 animate-fade-in pb-20 sm:pb-24",children:[t.jsxs("div",{className:"text-center space-y-2 px-3 sm:px-0",children:[t.jsxs("h1",{className:"text-lg sm:text-xl font-black text-text-primary dark:text-white tracking-tight",children:[x==="pick"?"Define Your ":"Rank Your ",t.jsx("span",{className:"text-yellow-warm",children:"Compass"})]}),t.jsxs("div",{className:"flex justify-center gap-1 mt-1",children:[t.jsx("button",{onClick:l(()=>h("pick"),"onClick"),className:`px-3 py-1 rounded-lg font-bold text-xs sm:text-sm uppercase tracking-widest transition-all ${x==="pick"?"bg-yellow-warm text-text-primary shadow-sm":"bg-white dark:bg-dark-bg-primary text-text-primary/60 dark:text-white/60 border border-border-soft dark:border-dark-border/30"}`,children:"Selection"}),t.jsx("button",{onClick:l(()=>h("sort"),"onClick"),disabled:a.length===0,className:`px-3 py-1 rounded-lg font-bold text-xs sm:text-sm uppercase tracking-widest transition-all ${x==="sort"?"bg-yellow-warm text-text-primary shadow-sm":"bg-white dark:bg-dark-bg-primary text-text-primary/60 dark:text-white/60 border border-border-soft dark:border-dark-border/30"} disabled:opacity-30`,children:"Priority"})]})]}),x==="pick"?t.jsx("div",{className:"space-y-3",children:Object.entries(w).map(([v,b])=>{const E=m.has(v),G=b.filter(te=>a.includes(te.id)).length;return t.jsxs("section",{className:"bg-white dark:bg-dark-bg-primary rounded-xl border border-border-soft dark:border-dark-border/30 overflow-hidden shadow-sm",children:[t.jsxs("button",{onClick:l(()=>W(v),"onClick"),className:"w-full flex items-center justify-between p-3 bg-bg-secondary/50 dark:bg-dark-bg-primary/50 hover:bg-bg-secondary dark:hover:bg-dark-bg-primary transition-colors text-left",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"text-xs sm:text-sm font-black text-text-primary dark:text-white uppercase tracking-widest",children:v}),G>0&&t.jsx("span",{className:"bg-yellow-warm text-text-primary text-xs font-black px-1.5 py-0.5 rounded uppercase",children:G})]}),t.jsx("svg",{className:`w-3 h-3 text-text-primary/40 dark:text-white/40 transition-transform ${E?"-rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M19 9l-7 7-7-7"})})]}),t.jsx("div",{className:`transition-all duration-300 ${E?"max-h-0 opacity-0":"max-h-[1000px] opacity-100 p-2 sm:p-3"}`,children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:b.map(te=>{const P=a.includes(te.id);return t.jsxs("button",{onClick:l(()=>D(te.id),"onClick"),className:`p-2 sm:p-3 rounded-lg sm:rounded-xl border text-left transition-all ${P?"border-yellow-warm bg-yellow-warm/10 dark:bg-yellow-warm/20 shadow-sm":"border-border-soft dark:border-dark-border/30 bg-white dark:bg-dark-bg-primary/50 hover:border-yellow-warm/50"} ${c===te.id?"animate-shake":""}`,children:[t.jsx("h3",{className:"font-black text-xs sm:text-sm tracking-tight text-text-primary dark:text-white",children:te.name}),t.jsxs("p",{className:`text-xs leading-tight font-medium mt-0.5 ${P?"text-text-primary/70 dark:text-white/70":"text-text-primary/50 dark:text-white/50"}`,children:[te.description.substring(0,45),"..."]})]},te.id)})})})]},v)})}):t.jsx("div",{className:"max-w-md mx-auto space-y-2 animate-pop",children:T.map((v,b)=>{const E=g===b,G=C===b;return n.filter(P=>P.valueId===v.id).length>0,t.jsxs("div",{draggable:!0,onDragStart:l(()=>z(b),"onDragStart"),onDragOver:l(P=>q(P,b),"onDragOver"),onDragLeave:l(()=>A(null),"onDragLeave"),onDrop:l(()=>S(b),"onDrop"),className:`relative flex items-center gap-2 sm:gap-3 bg-white dark:bg-dark-bg-primary p-2 sm:p-2.5 rounded-lg sm:rounded-xl border transition-all cursor-grab active:cursor-grabbing ${E?"opacity-30 scale-95 border-dashed border-yellow-warm/50":"border-border-soft dark:border-dark-border/30 shadow-sm"} ${G?"border-yellow-warm":""}`,children:[t.jsxs("div",{className:"flex flex-col gap-0.5 items-center bg-bg-secondary dark:bg-dark-bg-primary/50 p-1 rounded-md",children:[t.jsx("button",{onClick:l(P=>{P.stopPropagation(),j(b,"up")},"onClick"),disabled:b===0,className:"text-text-primary/30 dark:text-white/30 hover:text-yellow-warm disabled:opacity-0",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 15l7-7 7 7"})})}),t.jsx("button",{onClick:l(P=>{P.stopPropagation(),j(b,"down")},"onClick"),disabled:b===a.length-1,className:"text-text-primary/30 dark:text-white/30 hover:text-yellow-warm disabled:opacity-0",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M19 9l-7 7-7-7"})})})]}),t.jsxs("div",{className:"flex-grow select-none flex items-center gap-2 min-w-0",children:[t.jsx("span",{className:`text-xs font-black w-4 h-4 rounded-full flex items-center justify-center flex-shrink-0 ${b===0?"bg-yellow-warm text-text-primary":"bg-navy-primary dark:bg-navy-primary text-white dark:text-white"}`,children:b+1}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h4",{className:"font-black text-text-primary dark:text-white text-sm sm:text-base tracking-tight truncate",children:v.name}),t.jsx("p",{className:"text-xs text-text-primary/50 dark:text-white/50 font-bold uppercase tracking-widest",children:v.category})]})]}),s&&t.jsx("button",{onClick:l(P=>{P.stopPropagation(),s(v.id)},"onClick"),className:"w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded-lg bg-yellow-warm text-text-primary hover:opacity-90 transition-all shadow-sm active:scale-95 flex-shrink-0",title:"Add goal","aria-label":"Add goal",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),t.jsx("div",{className:"text-text-primary/20 dark:text-white/20 pr-1 flex-shrink-0",children:t.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})})]},v.id)})}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-3 z-30 safe-area-inset-bottom",children:t.jsxs("div",{className:"max-w-md mx-auto bg-white/95 dark:bg-dark-bg-primary/95 backdrop-blur shadow-2xl border border-border-soft dark:border-dark-border/30 rounded-xl sm:rounded-2xl p-2 flex items-center justify-between",children:[t.jsxs("div",{className:"px-2 sm:px-3",children:[t.jsx("p",{className:"text-xs text-text-primary/50 dark:text-white/50 font-black uppercase tracking-widest",children:"Strength"}),t.jsxs("p",{className:"text-sm font-bold text-text-primary dark:text-white",children:[a.length,"/10"]})]}),t.jsxs("button",{onClick:l(()=>e(a),"onClick"),disabled:a.length===0,className:`px-6 sm:px-8 py-2 sm:py-2.5 rounded-lg sm:rounded-xl font-black text-xs sm:text-sm uppercase tracking-widest transition-all ${a.length>0?"bg-yellow-warm text-text-primary hover:opacity-90":"bg-bg-secondary dark:bg-dark-bg-primary/50 text-text-primary/30 dark:text-white/30"}`,children:[t.jsx("span",{className:"hidden sm:inline",children:"Confirm Compass"}),t.jsx("span",{className:"sm:hidden",children:"Confirm"})]})]})})]})},"ValueSelection"),Xt=100,fe=[];let kt=!1,Ve=null,Ge=null;const Kt=l(o=>{Me("error",o.message,{filename:o.filename,lineno:o.lineno,colno:o.colno,stack:o.error?.stack})},"errorHandler"),Yt=l(o=>{Me("error",`Unhandled Promise Rejection: ${o.reason}`,{reason:o.reason,stack:o.reason?.stack})},"rejectionHandler");function Jt(){kt||(Ve||(Ve=console.error.bind(console)),Ge||(Ge=console.warn.bind(console)),console.error=(...o)=>{Me("error",o.join(" "),{args:o}),Ve.apply(console,o)},console.warn=(...o)=>{Me("warning",o.join(" "),{args:o}),Ge.apply(console,o)},window.addEventListener("error",Kt),window.addEventListener("unhandledrejection",Yt),kt=!0)}l(Jt,"initializeDebugLogging");function Me(o,e,r){const s={timestamp:new Date().toISOString(),level:o,message:e,details:r,stack:r?.stack||(r?.error instanceof Error?r.error.stack:void 0)};fe.push(s),fe.length>Xt&&fe.shift()}l(Me,"logEntry");function Qt(){const o=navigator.userAgent;let e="Unknown",r="Unknown",s="Unknown";if(o.includes("Edg")){e="Edge";const n=o.match(/Edg\/(\d+)/);r=n?n[1]:"Unknown",s="Blink"}else if(o.includes("Chrome")&&!o.includes("Edg")){e="Chrome";const n=o.match(/Chrome\/(\d+)/);r=n?n[1]:"Unknown",s="Blink"}else if(o.includes("Safari")&&!o.includes("Chrome")){e="Safari";const n=o.match(/Version\/(\d+)/);r=n?n[1]:"Unknown",s="WebKit"}else if(o.includes("Firefox")){e="Firefox";const n=o.match(/Firefox\/(\d+)/);r=n?n[1]:"Unknown",s="Gecko"}return s==="Unknown"&&(o.includes("WebKit")?s="WebKit":o.includes("Gecko")&&(s="Gecko")),{name:e,version:r,engine:s}}l(Qt,"getBrowserInfo");function Zt(){return navigator.platform}l(Zt,"getPlatformInfo");async function er(){try{return"indexedDB"in window?"databases"in indexedDB?(await indexedDB.databases()).map(e=>e.name):["GroundedDB"]:[]}catch{return[]}}l(er,"getIndexedDBDatabases");async function tr(){const o="serviceWorker"in navigator;let e=!1,r;if(o)try{const s=await navigator.serviceWorker.getRegistration();e=!!s,r=s?.scope}catch{}return{available:o,registered:e,scope:r}}l(tr,"getServiceWorkerInfo");function rr(){const o=navigator.onLine;let e;if("connection"in navigator){const r=navigator.connection||navigator.mozConnection||navigator.webkitConnection;r&&(e=r.effectiveType||r.type)}return{online:o,connectionType:e}}l(rr,"getNetworkInfo");async function sr(){const e=zt()||{sharedArrayBuffer:!1,crossOriginIsolated:!1,webGPU:!1,wasm:!1,estimatedMemory:null,deviceType:"unknown",browser:"Unknown",os:"Unknown"},r=$t(),s=fe.filter(x=>x.level==="error"),n=fe.filter(x=>x.level==="warning"),a=fe.slice(-20),i=Qt(),c=await er(),d=await tr(),m=rr(),u=[];try{for(let x=0;x<localStorage.length;x++){const h=localStorage.key(x);h&&u.push(h)}}catch{}return{appVersion:"1.12.27",timestamp:new Date().toISOString(),userAgent:navigator.userAgent,platform:Zt(),language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,screenResolution:`${window.screen.width}x${window.screen.height}`,browserInfo:i,compatibility:{sharedArrayBuffer:e.sharedArrayBuffer,crossOriginIsolated:e.crossOriginIsolated,webGPU:e.webGPU,webAssembly:e.wasm,estimatedMemory:e.estimatedMemory||0,device:e.deviceType,browser:`${e.browser} on ${e.os}`},aiModelStatus:{loaded:r.loaded,loading:r.loading,moodTracker:r.moodTracker,counselingCoach:r.counselingCoach},errors:s,warnings:n,recentLogs:a,localStorage:{available:typeof Storage<"u",keys:u},indexedDB:{available:"indexedDB"in window,databases:c},serviceWorker:d,networkStatus:m}}l(sr,"generateDebugLog");function _t(o){const e=[];return e.push("=".repeat(60)),e.push("GROUNDED APP DEBUG LOG"),e.push("=".repeat(60)),e.push(""),e.push(`Generated: ${o.timestamp}`),e.push(`App Version: ${o.appVersion}`),e.push(""),e.push("SYSTEM INFORMATION"),e.push("-".repeat(60)),e.push(`Platform: ${o.platform}`),e.push(`Browser: ${o.browserInfo.name} ${o.browserInfo.version} (${o.browserInfo.engine})`),e.push(`User Agent: ${o.userAgent}`),e.push(`Language: ${o.language}`),e.push(`Timezone: ${o.timezone}`),e.push(`Screen Resolution: ${o.screenResolution}`),e.push(""),e.push("BROWSER COMPATIBILITY"),e.push("-".repeat(60)),e.push(`SharedArrayBuffer: ${o.compatibility.sharedArrayBuffer?"âœ“ Available":"âœ— Not Available"}`),e.push(`Cross-Origin Isolated: ${o.compatibility.crossOriginIsolated?"âœ“ Enabled":"âœ— Not Enabled"}`),e.push(`WebGPU: ${o.compatibility.webGPU?"âœ“ Available":"âœ— Not Available"}`),e.push(`WebAssembly: ${o.compatibility.webAssembly?"âœ“ Available":"âœ— Not Available"}`),e.push(`Estimated Memory: ${o.compatibility.estimatedMemory} MB`),e.push(`Device: ${o.compatibility.device}`),e.push(`Browser: ${o.compatibility.browser}`),e.push(""),e.push("AI MODEL STATUS"),e.push("-".repeat(60)),e.push(`Models Loaded: ${o.aiModelStatus.loaded?"âœ“ Yes":"âœ— No"}`),e.push(`Currently Loading: ${o.aiModelStatus.loading?"Yes":"No"}`),e.push(`Mood Tracker: ${o.aiModelStatus.moodTracker?"âœ“ Available":"âœ— Not Available"}`),e.push(`Counseling Coach: ${o.aiModelStatus.counselingCoach?"âœ“ Available":"âœ— Not Available"}`),e.push(""),e.push("STORAGE"),e.push("-".repeat(60)),e.push(`LocalStorage: ${o.localStorage.available?"âœ“ Available":"âœ— Not Available"}`),e.push(`LocalStorage Keys: ${o.localStorage.keys.join(", ")||"None"}`),e.push(`IndexedDB: ${o.indexedDB.available?"âœ“ Available":"âœ— Not Available"}`),e.push(`IndexedDB Databases: ${o.indexedDB.databases.join(", ")||"None"}`),e.push(""),e.push("SERVICE WORKER"),e.push("-".repeat(60)),e.push(`Available: ${o.serviceWorker.available?"âœ“ Yes":"âœ— No"}`),e.push(`Registered: ${o.serviceWorker.registered?"âœ“ Yes":"âœ— No"}`),o.serviceWorker.scope&&e.push(`Scope: ${o.serviceWorker.scope}`),e.push(""),e.push("NETWORK"),e.push("-".repeat(60)),e.push(`Online: ${o.networkStatus.online?"âœ“ Yes":"âœ— No"}`),o.networkStatus.connectionType&&e.push(`Connection Type: ${o.networkStatus.connectionType}`),e.push(""),o.errors.length>0&&(e.push("ERRORS"),e.push("-".repeat(60)),o.errors.forEach((r,s)=>{e.push(`${s+1}. [${r.timestamp}] ${r.message}`),r.stack&&e.push(`   Stack: ${r.stack.split(`
`).slice(0,3).join(`
   `)}`),r.details&&e.push(`   Details: ${JSON.stringify(r.details,null,2).split(`
`).slice(0,5).join(`
   `)}`),e.push("")})),o.warnings.length>0&&(e.push("WARNINGS"),e.push("-".repeat(60)),o.warnings.forEach((r,s)=>{e.push(`${s+1}. [${r.timestamp}] ${r.message}`),r.details&&e.push(`   Details: ${JSON.stringify(r.details,null,2).split(`
`).slice(0,3).join(`
   `)}`),e.push("")})),o.recentLogs.length>0&&(e.push("RECENT LOG ENTRIES (Last 20)"),e.push("-".repeat(60)),o.recentLogs.forEach((r,s)=>{e.push(`${s+1}. [${r.timestamp}] [${r.level.toUpperCase()}] ${r.message}`)}),e.push("")),e.push("=".repeat(60)),e.push("END OF DEBUG LOG"),e.push("=".repeat(60)),e.join(`
`)}l(_t,"formatDebugLogForEmail");function ar(o){const e=encodeURIComponent("Grounded App Debug Log - Support Request"),r=encodeURIComponent(`Hello,

I'm experiencing issues with the Grounded app. Please find the debug log attached below.

---

${_t(o)}

---

Thank you for your help!`);return`mailto:ac.minds.ai@gmail.com?subject=${e}&body=${r}`}l(ar,"createEmailWithDebugLog");const nr=l(({onClose:o})=>{const[e,r]=p.useState(null),[s,n]=p.useState(!0),[a,i]=p.useState(!1),[c,d]=p.useState(new Set(["errors","warnings"]));p.useEffect(()=>{sr().then(h=>{r(h),n(!1)}).catch(h=>{console.error("Failed to generate debug log:",h),n(!1),r(null)})},[]);const m=l(h=>{const g=new Set(c);g.has(h)?g.delete(h):g.add(h),d(g)},"toggleSection"),u=l(async()=>{if(!e)return;const h=_t(e);try{await navigator.clipboard.writeText(h),i(!0),setTimeout(()=>i(!1),2e3)}catch(g){console.error("Failed to copy:",g),alert("Failed to copy to clipboard. Please use the email button instead.")}},"handleCopy"),x=l(()=>{if(!e)return;const h=ar(e);window.location.href=h},"handleEmail");return s?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",children:t.jsx("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-2xl rounded-[40px] shadow-2xl p-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-navy-primary mx-auto mb-4"}),t.jsx("p",{className:"text-text-secondary dark:text-text-secondary",children:"Generating debug log..."})]})})}):e?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-2xl rounded-[40px] shadow-2xl overflow-hidden max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"p-6 border-b border-border-soft dark:border-dark-border flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-black text-text-primary dark:text-white",children:"Debug Log"}),t.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary mt-1",children:"Diagnostic information for troubleshooting"})]}),t.jsx("button",{onClick:o,className:"w-10 h-10 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[t.jsx(pe,{title:"System Information",expanded:c.has("system"),onToggle:l(()=>m("system"),"onToggle"),children:t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsx(Q,{label:"App Version",value:e.appVersion}),t.jsx(Q,{label:"Platform",value:e.platform}),t.jsx(Q,{label:"Browser",value:`${e.browserInfo.name} ${e.browserInfo.version}`}),t.jsx(Q,{label:"Engine",value:e.browserInfo.engine}),t.jsx(Q,{label:"Language",value:e.language}),t.jsx(Q,{label:"Timezone",value:e.timezone}),t.jsx(Q,{label:"Screen",value:e.screenResolution})]})}),t.jsx(pe,{title:"Browser Compatibility",expanded:c.has("compatibility"),onToggle:l(()=>m("compatibility"),"onToggle"),children:t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsx(oe,{label:"SharedArrayBuffer",value:e.compatibility.sharedArrayBuffer}),t.jsx(oe,{label:"Cross-Origin Isolated",value:e.compatibility.crossOriginIsolated}),t.jsx(oe,{label:"WebGPU",value:e.compatibility.webGPU}),t.jsx(oe,{label:"WebAssembly",value:e.compatibility.webAssembly}),t.jsx(Q,{label:"Estimated Memory",value:`${e.compatibility.estimatedMemory} MB`}),t.jsx(Q,{label:"Device",value:e.compatibility.device}),t.jsx(Q,{label:"Browser",value:e.compatibility.browser})]})}),t.jsx(pe,{title:"AI Model Status",expanded:c.has("ai"),onToggle:l(()=>m("ai"),"onToggle"),children:t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsx(oe,{label:"Models Loaded",value:e.aiModelStatus.loaded}),t.jsx(Q,{label:"Loading",value:e.aiModelStatus.loading?"Yes":"No"}),t.jsx(oe,{label:"Mood Tracker",value:e.aiModelStatus.moodTracker}),t.jsx(oe,{label:"Counseling Coach",value:e.aiModelStatus.counselingCoach})]})}),t.jsx(pe,{title:"Storage",expanded:c.has("storage"),onToggle:l(()=>m("storage"),"onToggle"),children:t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsx(oe,{label:"LocalStorage",value:e.localStorage.available}),t.jsx(Q,{label:"Keys",value:e.localStorage.keys.join(", ")||"None"}),t.jsx(oe,{label:"IndexedDB",value:e.indexedDB.available}),t.jsx(Q,{label:"Databases",value:e.indexedDB.databases.join(", ")||"None"})]})}),t.jsx(pe,{title:"Service Worker",expanded:c.has("sw"),onToggle:l(()=>m("sw"),"onToggle"),children:t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsx(oe,{label:"Available",value:e.serviceWorker.available}),t.jsx(oe,{label:"Registered",value:e.serviceWorker.registered}),e.serviceWorker.scope&&t.jsx(Q,{label:"Scope",value:e.serviceWorker.scope})]})}),t.jsx(pe,{title:"Network",expanded:c.has("network"),onToggle:l(()=>m("network"),"onToggle"),children:t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsx(oe,{label:"Online",value:e.networkStatus.online}),e.networkStatus.connectionType&&t.jsx(Q,{label:"Connection",value:e.networkStatus.connectionType})]})}),e.errors.length>0&&t.jsx(pe,{title:`Errors (${e.errors.length})`,expanded:c.has("errors"),onToggle:l(()=>m("errors"),"onToggle"),children:t.jsx("div",{className:"space-y-3 text-sm",children:e.errors.map((h,g)=>t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border border-red-200 dark:border-red-800",children:[t.jsx("p",{className:"font-semibold text-red-800 dark:text-red-200",children:h.message}),t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:h.timestamp}),h.stack&&t.jsx("pre",{className:"text-xs text-red-600 dark:text-red-400 mt-2 whitespace-pre-wrap break-all",children:h.stack.split(`
`).slice(0,3).join(`
`)})]},g))})}),e.warnings.length>0&&t.jsx(pe,{title:`Warnings (${e.warnings.length})`,expanded:c.has("warnings"),onToggle:l(()=>m("warnings"),"onToggle"),children:t.jsx("div",{className:"space-y-3 text-sm",children:e.warnings.map((h,g)=>t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-lg border border-yellow-200 dark:border-yellow-800",children:[t.jsx("p",{className:"font-semibold text-yellow-800 dark:text-yellow-200",children:h.message}),t.jsx("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 mt-1",children:h.timestamp})]},g))})})]}),t.jsxs("div",{className:"p-6 border-t border-border-soft dark:border-dark-border space-y-3",children:[t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:u,className:"flex-1 px-4 py-3 bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-xl text-xs font-black uppercase tracking-widest hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary",children:a?"âœ“ Copied!":"Copy Log"}),t.jsx("button",{onClick:x,className:"flex-1 px-4 py-3 bg-navy-primary text-white rounded-xl text-xs font-black uppercase tracking-widest hover:opacity-90",children:"ðŸ“§ Email Support"})]}),t.jsx("p",{className:"text-xs text-text-tertiary dark:text-text-tertiary text-center",children:'Click "Email Support" to open your email client with the debug log attached'})]})]})}):t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",children:t.jsx("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-2xl rounded-[40px] shadow-2xl p-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-text-secondary dark:text-text-secondary",children:"Failed to generate debug log."}),t.jsx("button",{onClick:o,className:"mt-4 px-6 py-3 bg-navy-primary text-white rounded-xl font-black uppercase tracking-widest",children:"Close"})]})})})},"DebugLogComponent"),pe=l(({title:o,expanded:e,onToggle:r,children:s})=>t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border overflow-hidden",children:[t.jsxs("button",{onClick:r,className:"w-full px-4 py-3 flex items-center justify-between text-left hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary transition-colors",children:[t.jsx("span",{className:"text-sm font-black text-text-primary dark:text-white uppercase tracking-widest",children:o}),t.jsx("svg",{className:`w-5 h-5 text-text-tertiary dark:text-text-tertiary transition-transform ${e?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e&&t.jsx("div",{className:"px-4 py-3 border-t border-border-soft dark:border-dark-border",children:s})]}),"Section"),Q=l(({label:o,value:e})=>t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-text-secondary dark:text-text-secondary",children:[o,":"]}),t.jsx("span",{className:"font-semibold text-text-primary dark:text-white",children:e})]}),"InfoRow"),oe=l(({label:o,value:e})=>t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{className:"text-text-secondary dark:text-text-secondary",children:[o,":"]}),t.jsx("span",{className:`font-semibold ${e?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:e?"âœ“":"âœ—"})]}),"StatusRow"),or=l(({onClose:o})=>{const[e,r]=p.useState(!1);return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-navy-dark/60 backdrop-blur-sm animate-fade-in",children:[t.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-lg rounded-[40px] shadow-2xl overflow-hidden animate-pop relative border border-border-soft dark:border-dark-border",onClick:l(s=>s.stopPropagation(),"onClick"),children:[t.jsx("button",{onClick:o,className:"absolute top-6 right-6 w-10 h-10 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white transition-colors",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})}),t.jsxs("div",{className:"p-10 space-y-8 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-3xl font-black text-text-primary dark:text-white tracking-tight",children:"How to navigate"}),t.jsx("p",{className:"text-text-secondary dark:text-text-secondary font-medium",children:"Mastering Grounded in 3 steps."})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex gap-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-2xl bg-navy-primary dark:bg-navy-primary flex items-center justify-center text-white font-black shrink-0 shadow-lg",children:"1"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-black text-text-primary dark:text-white text-lg",children:"Define & Rank"}),t.jsxs("p",{className:"text-text-secondary dark:text-text-secondary text-sm leading-relaxed",children:["Pick up to 10 values in the ",t.jsx("b",{children:"Values"}),' tab. Rank them by dragging. Your top value becomes your "North Star" for the Dashboard guidance.']})]})]}),t.jsxs("div",{className:"flex gap-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-2xl bg-yellow-warm dark:bg-yellow-warm flex items-center justify-center text-navy-primary dark:text-navy-primary font-black shrink-0 shadow-lg",children:"2"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-black text-text-primary dark:text-white text-lg",children:"Embody Daily"}),t.jsxs("p",{className:"text-text-secondary dark:text-text-secondary text-sm leading-relaxed",children:["In the ",t.jsx("b",{children:"Dashboard"}),', open a value to reflect on your progress. Log a win or set a "Next Aim" (micro-goal) to build momentum.']})]})]}),t.jsxs("div",{className:"flex gap-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-2xl bg-calm-sage dark:bg-calm-sage flex items-center justify-center text-white dark:text-navy-primary font-black shrink-0 shadow-lg",children:"3"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-black text-text-primary dark:text-white text-lg",children:"Synthesize"}),t.jsxs("p",{className:"text-text-secondary dark:text-text-secondary text-sm leading-relaxed",children:["Use ",t.jsx("b",{children:"Reports"})," to generate clinical-style summaries (SOAP/DAP) of your journey to share with a therapist or for personal growth audits."]})]})]})]}),t.jsxs("div",{className:"pt-4 border-t border-border-soft dark:border-dark-border space-y-4",children:[t.jsx("h3",{className:"text-lg font-black text-text-primary dark:text-white",children:"Tips & Best Practices"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary p-6 rounded-3xl flex items-start gap-4",children:[t.jsx("div",{className:"text-2xl mt-1",children:"ðŸ’¡"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Pro Tip"}),t.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary leading-relaxed font-medium",children:["Head to ",t.jsx("b",{children:"Settings"}),' to enable "Growth and Progress" nudgesâ€”system notifications that keep your North Star top-of-mind.']})]})]}),t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary p-6 rounded-3xl flex items-start gap-4",children:[t.jsx("div",{className:"text-2xl mt-1",children:"ðŸ“±"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Daily Practice"}),t.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary leading-relaxed font-medium",children:"Check your Dashboard daily to log wins and set micro-goals. Small consistent actions build lasting change."})]})]}),t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary p-6 rounded-3xl flex items-start gap-4",children:[t.jsx("div",{className:"text-2xl mt-1",children:"ðŸ“Š"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Therapy Integration"}),t.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary leading-relaxed font-medium",children:["Use the ",t.jsx("b",{children:"Reports"})," feature to generate summaries you can share with your therapist during sessions."]})]})]})]})]}),t.jsxs("div",{className:"pt-4 border-t border-border-soft dark:border-dark-border space-y-4",children:[t.jsx("h3",{className:"text-lg font-black text-text-primary dark:text-white",children:"AI Model Information"}),t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary p-6 rounded-3xl space-y-3",children:[t.jsx("p",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"On-Device AI Processing"}),t.jsxs("div",{className:"space-y-2 text-xs text-text-secondary dark:text-text-secondary leading-relaxed",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Privacy First:"})," All AI processing happens entirely on your device. No data is sent to external servers."]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Fast Loading:"})," AI models begin downloading immediately when the app starts, so they're ready when you need them."]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Offline Capable:"})," Once downloaded, models are cached locally for instant loading and offline use."]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Progress Tracking:"})," Watch the progress bar during first launch to see model download status."]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Fallback Mode:"})," If models fail to load, the app continues with rule-based responses. Core functionality remains available."]})]})]})]}),t.jsxs("div",{className:"pt-4 border-t border-border-soft dark:border-dark-border space-y-4",children:[t.jsx("h3",{className:"text-lg font-black text-text-primary dark:text-white",children:"Support & Troubleshooting"}),t.jsx("div",{className:"bg-yellow-warm/10 dark:bg-yellow-warm/20 p-6 rounded-3xl border-2 border-yellow-warm/30 space-y-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"text-2xl",children:"ðŸ”§"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-black text-text-primary dark:text-white mb-1",children:"Experiencing Issues?"}),t.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary leading-relaxed mb-3",children:"Generate a debug log with diagnostic information. Debug logging starts automatically when the app launches."}),t.jsxs("button",{onClick:l(()=>r(!0),"onClick"),className:"w-full px-4 py-3 bg-navy-primary text-white rounded-xl text-xs font-black uppercase tracking-widest hover:opacity-90 flex items-center justify-center gap-2 shadow-lg",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Generate Debug Log"]})]})]})}),t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary p-6 rounded-3xl space-y-2",children:[t.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary leading-relaxed",children:"Need help or have questions? We're here to assist you."}),t.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[t.jsx("svg",{className:"w-5 h-5 text-navy-primary dark:text-yellow-warm flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),t.jsx("a",{href:"mailto:ac.minds.ai@gmail.com?subject=Grounded App Support",className:"text-sm font-bold text-navy-primary dark:text-yellow-warm hover:underline",children:"ac.minds.ai@gmail.com"})]})]})]}),t.jsxs("div",{className:"pt-4 border-t border-border-soft dark:border-dark-border space-y-4",children:[t.jsx("h3",{className:"text-lg font-black text-text-primary dark:text-white",children:"License"}),t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary p-6 rounded-3xl space-y-3",children:[t.jsx("p",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest",children:"Apache License 2.0"}),t.jsxs("div",{className:"space-y-2 text-xs text-text-secondary dark:text-text-secondary leading-relaxed",children:[t.jsxs("p",{children:["Copyright ",new Date().getFullYear()," AC MiNDS"]}),t.jsx("p",{children:'Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at:'}),t.jsx("a",{href:"http://www.apache.org/licenses/LICENSE-2.0",target:"_blank",rel:"noopener noreferrer",className:"text-navy-primary dark:text-yellow-warm hover:underline break-all",children:"http://www.apache.org/licenses/LICENSE-2.0"}),t.jsx("p",{children:'Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.'})]})]})]}),t.jsx("div",{className:"pt-4",children:t.jsx("button",{onClick:o,className:"w-full py-5 bg-navy-primary dark:bg-navy-primary text-white dark:text-white rounded-[24px] font-black uppercase tracking-[0.2em] shadow-xl hover:opacity-90 transition-all active:scale-[0.98]",children:"Got it, Let's grow"})})]})]}),t.jsx("div",{className:"absolute inset-0 -z-10",onClick:o}),e&&t.jsx(nr,{onClose:l(()=>r(!1),"onClose")})]})},"HelpOverlay"),Ct=p.createContext(void 0),ir=l(({children:o})=>{const[e,r]=p.useState(()=>{const a=localStorage.getItem("theme");return a||"light"});p.useEffect(()=>{const a=document.documentElement;e==="dark"?a.classList.add("dark"):a.classList.remove("dark"),localStorage.setItem("theme",e)},[e]);const s=l(()=>{r(a=>a==="light"?"dark":"light")},"toggleTheme"),n=l(a=>{r(a)},"setTheme");return t.jsx(Ct.Provider,{value:{theme:e,toggleTheme:s,setTheme:n},children:o})},"ThemeProvider"),lr=l(()=>{const o=p.useContext(Ct);if(o===void 0)throw new Error("useTheme must be used within a ThemeProvider");return o},"useTheme"),cr=l(()=>{const{theme:o,toggleTheme:e}=lr();return t.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center rounded-full transition-colors hover:bg-opacity-20 dark:hover:bg-opacity-20","aria-label":"Toggle theme",title:o==="light"?"Switch to dark mode":"Switch to light mode",children:o==="light"?t.jsx("svg",{className:"w-5 h-5 text-yellow-warm",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}):t.jsx("svg",{className:"w-5 h-5 text-yellow-warm",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})})},"ThemeToggle"),lt=class lt{constructor(){this.dbName="groundedAuthDB",this.dbVersion=1,this.db=null,this.initPromise=null}async init(){return this.db?Promise.resolve():this.initPromise?this.initPromise:(this.initPromise=new Promise((e,r)=>{if(typeof indexedDB>"u"){r(new Error("IndexedDB is not available"));return}const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>{this.initPromise=null,r(s.error)},s.onsuccess=()=>{this.db=s.result,this.initPromise=null,e()},s.onupgradeneeded=n=>{const a=n.target.result;if(!a.objectStoreNames.contains("users")){const i=a.createObjectStore("users",{keyPath:"id"});i.createIndex("username","username",{unique:!0}),i.createIndex("email","email",{unique:!1})}if(!a.objectStoreNames.contains("reset_tokens")){const i=a.createObjectStore("reset_tokens",{keyPath:"token"});i.createIndex("userId","userId",{unique:!1}),i.createIndex("expires","expires",{unique:!1})}}}),this.initPromise)}async createUser(e){if(await this.init(),!this.db)throw new Error("Database not initialized");const r=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s={...e,id:r,createdAt:new Date().toISOString()};return new Promise((n,a)=>{const d=this.db.transaction(["users"],"readwrite").objectStore("users").add(s);d.onsuccess=()=>n(r),d.onerror=()=>a(d.error)})}async getUserByUsername(e){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,s)=>{const c=this.db.transaction(["users"],"readonly").objectStore("users").index("username").get(e);c.onsuccess=()=>{r(c.result||null)},c.onerror=()=>s(c.error)})}async getUserByEmail(e){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,s)=>{const c=this.db.transaction(["users"],"readonly").objectStore("users").index("email").get(e);c.onsuccess=()=>{r(c.result||null)},c.onerror=()=>s(c.error)})}async getUserById(e){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,s)=>{const i=this.db.transaction(["users"],"readonly").objectStore("users").get(e);i.onsuccess=()=>{r(i.result||null)},i.onerror=()=>s(i.error)})}async updateUser(e,r){if(await this.init(),!this.db)throw new Error("Database not initialized");const s=await this.getUserById(e);if(!s)throw new Error("User not found");const n={...s,...r};return new Promise((a,i)=>{const m=this.db.transaction(["users"],"readwrite").objectStore("users").put(n);m.onsuccess=()=>a(),m.onerror=()=>i(m.error)})}async createResetToken(e,r){if(await this.init(),!this.db)throw new Error("Database not initialized");const s=`reset_${Date.now()}_${Math.random().toString(36).substr(2,16)}`,n=Date.now()+1440*60*1e3,a={token:s,userId:e,email:r,expires:n,createdAt:new Date().toISOString()};return new Promise((i,c)=>{const u=this.db.transaction(["reset_tokens"],"readwrite").objectStore("reset_tokens").add(a);u.onsuccess=()=>i(s),u.onerror=()=>c(u.error)})}async getResetToken(e){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,s)=>{const i=this.db.transaction(["reset_tokens"],"readonly").objectStore("reset_tokens").get(e);i.onsuccess=()=>{const c=i.result;if(!c){r(null);return}if(c.expires<Date.now()){r(null);return}r({userId:c.userId,email:c.email})},i.onerror=()=>s(i.error)})}async deleteResetToken(e){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,s)=>{const i=this.db.transaction(["reset_tokens"],"readwrite").objectStore("reset_tokens").delete(e);i.onsuccess=()=>r(),i.onerror=()=>s(i.error)})}async cleanupExpiredTokens(){if(await this.init(),!!this.db)return new Promise((e,r)=>{const i=this.db.transaction(["reset_tokens"],"readwrite").objectStore("reset_tokens").index("expires").openCursor(),c=Date.now();i.onsuccess=d=>{const m=d.target.result;m?(m.value.expires<c&&m.delete(),m.continue()):e()},i.onerror=()=>r(i.error)})}};l(lt,"AuthStore");let Je=lt;const X=new Je,dr=Object.freeze(Object.defineProperty({__proto__:null,authStore:X},Symbol.toStringTag,{value:"Module"})),Y=class Y{constructor(e){this.db=null,this.encryptionKey=null,this.initialized=!1,this.userId=e}static async initSQL(){if(!Y.SQL)if(typeof process<"u"&&process.versions&&process.versions.node)try{const r=await ae(()=>import("./transformers-CgLRIXTl.js").then(a=>a.O),__vite__mapDeps([0,1,2])),n=(r.default||r).join(process.cwd(),"node_modules","sql.js","dist","sql-wasm.wasm");Y.SQL=await We({locateFile:l(()=>n,"locateFile")})}catch{const s=require.resolve("sql.js/dist/sql-wasm.wasm");Y.SQL=await We({locateFile:l(()=>s,"locateFile")})}else Y.SQL=await We({locateFile:l(r=>`https://sql.js.org/dist/${r}`,"locateFile")})}static async init(e,r){await Y.initSQL();const s=new Y(r);return await s.deriveKey(e),await s.loadOrCreateDB(),s.initialized||(s.initialized=!0),Y.instance=s,s}static getInstance(){return Y.instance}async deriveKey(e){const s=new TextEncoder().encode(e),n=await crypto.subtle.importKey("raw",s,"PBKDF2",!1,["deriveBits","deriveKey"]),a=await this.getOrCreateSalt();this.encryptionKey=await crypto.subtle.deriveKey({name:"PBKDF2",salt:a,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async getOrCreateSalt(){const e="grounded_encryption_salt";let r=localStorage.getItem(e);if(!r){const n=new Uint8Array(16);crypto.getRandomValues(n),r=Array.from(n).map(a=>a.toString(16).padStart(2,"0")).join(""),localStorage.setItem(e,r)}return new Uint8Array(r.match(/.{1,2}/g).map(n=>parseInt(n,16)))}async loadOrCreateDB(){try{const e=await this.loadEncryptedDBInternal();if(e){const r=await this.decrypt(e);await this.initSQLite(r),this.initialized=!0}else await this.initSQLite(null),await this.createSchema(),this.initialized=!0}catch(e){throw console.error("Error loading database:",e),new Error("Failed to load encrypted database. Wrong password?")}}async initSQLite(e){Y.SQL||await Y.initSQL();try{e&&e.length>0?this.db=new Y.SQL.Database(e):this.db=new Y.SQL.Database}catch(r){throw console.error("Error initializing SQLite database:",r),new Error("Failed to initialize database. Wrong password or corrupted data?")}}async createSchema(){await this.executeSQL(`
      CREATE TABLE IF NOT EXISTS users_encrypted (
        id TEXT PRIMARY KEY,
        username TEXT NOT NULL,
        password_hash TEXT NOT NULL,
        email TEXT,
        therapist_emails TEXT,
        terms_accepted INTEGER DEFAULT 0,
        terms_accepted_date TEXT,
        created_at TEXT NOT NULL,
        last_login TEXT
      );
      
      CREATE TABLE IF NOT EXISTS app_data_encrypted (
        user_id TEXT PRIMARY KEY,
        settings TEXT,
        logs TEXT,
        goals TEXT,
        "values" TEXT,
        lcsw_config TEXT,
        updated_at TEXT NOT NULL
      );
      
      CREATE TABLE IF NOT EXISTS feeling_logs_encrypted (
        id TEXT PRIMARY KEY,
        user_id TEXT,
        timestamp TEXT NOT NULL,
        emotional_state TEXT,
        selected_feeling TEXT,
        reflection_text TEXT,
        ai_analysis TEXT,
        created_at TEXT NOT NULL
      );
      
      CREATE TABLE IF NOT EXISTS goals_encrypted (
        id TEXT PRIMARY KEY,
        user_id TEXT NOT NULL,
        value_id TEXT NOT NULL,
        text TEXT NOT NULL,
        frequency TEXT,
        completed INTEGER DEFAULT 0,
        created_at TEXT NOT NULL,
        updated_at TEXT
      );
      
      CREATE TABLE IF NOT EXISTS goal_updates_encrypted (
        id TEXT PRIMARY KEY,
        goal_id TEXT NOT NULL,
        timestamp TEXT NOT NULL,
        note TEXT,
        mood TEXT,
        created_at TEXT NOT NULL,
        FOREIGN KEY (goal_id) REFERENCES goals_encrypted(id)
      );
      
      CREATE TABLE IF NOT EXISTS reset_tokens_encrypted (
        token TEXT PRIMARY KEY,
        user_id TEXT NOT NULL,
        email TEXT NOT NULL,
        expires INTEGER NOT NULL,
        created_at TEXT NOT NULL
      );
      
      CREATE TABLE IF NOT EXISTS user_interactions_encrypted (
        id TEXT PRIMARY KEY,
        timestamp TEXT NOT NULL,
        type TEXT NOT NULL,
        session_id TEXT NOT NULL,
        user_id TEXT,
        value_id TEXT,
        emotional_state TEXT,
        selected_feeling TEXT,
        metadata TEXT,
        created_at TEXT NOT NULL
      );
      
      CREATE TABLE IF NOT EXISTS sessions_encrypted (
        id TEXT PRIMARY KEY,
        user_id TEXT NOT NULL,
        start_timestamp TEXT NOT NULL,
        end_timestamp TEXT,
        value_id TEXT NOT NULL,
        initial_emotional_state TEXT,
        final_emotional_state TEXT,
        selected_feeling TEXT,
        reflection_length INTEGER,
        goal_created INTEGER DEFAULT 0,
        duration INTEGER,
        created_at TEXT NOT NULL
      );
      
      CREATE TABLE IF NOT EXISTS audit_log (
        id TEXT PRIMARY KEY,
        timestamp TEXT NOT NULL,
        user_id INTEGER NOT NULL,
        action TEXT NOT NULL,
        table_name TEXT,
        record_id TEXT,
        details TEXT
      );
      
      CREATE INDEX IF NOT EXISTS idx_audit_user ON audit_log(user_id);
      CREATE INDEX IF NOT EXISTS idx_audit_timestamp ON audit_log(timestamp);
      CREATE INDEX IF NOT EXISTS idx_feeling_logs_user ON feeling_logs_encrypted(user_id);
      CREATE INDEX IF NOT EXISTS idx_goals_user ON goals_encrypted(user_id);
      CREATE INDEX IF NOT EXISTS idx_reset_tokens_user ON reset_tokens_encrypted(user_id);
      CREATE INDEX IF NOT EXISTS idx_reset_tokens_expires ON reset_tokens_encrypted(expires);
      CREATE INDEX IF NOT EXISTS idx_user_interactions_session ON user_interactions_encrypted(session_id);
      CREATE INDEX IF NOT EXISTS idx_user_interactions_timestamp ON user_interactions_encrypted(timestamp);
      CREATE INDEX IF NOT EXISTS idx_sessions_user ON sessions_encrypted(user_id);
      CREATE INDEX IF NOT EXISTS idx_sessions_value ON sessions_encrypted(value_id);
      CREATE INDEX IF NOT EXISTS idx_sessions_start ON sessions_encrypted(start_timestamp);
    `);try{await this.auditLog("schema_created","system",null,"Database schema initialized")}catch(r){console.warn("Could not log schema creation:",r)}}async executeSQL(e){if(!this.db)throw new Error("Database not initialized");try{const r=e.split(";").filter(s=>s.trim().length>0);for(const s of r)this.db.run(s.trim()+";")}catch(r){throw console.error("SQL execution error:",r),r}}async query(e,r){if(!this.initialized||!this.encryptionKey||!this.db)throw new Error("Database not initialized");try{const s=this.db.prepare(e);r&&r.length>0&&s.bind(r);const n=[];for(;s.step();){const a=s.getAsObject();n.push(a)}return s.free(),n}catch(s){throw console.error("Query error:",s,"SQL:",e),s}}async execute(e,r){if(!this.initialized||!this.encryptionKey||!this.db)throw new Error("Database not initialized");try{const s=this.db.prepare(e);r&&r.length>0&&s.bind(r),s.step(),s.free()}catch(s){throw console.error("Execute error:",s,"SQL:",e),s}}async save(){if(!this.db)throw new Error("Database not initialized");try{const e=await this.exportDB(),r=await this.encrypt(e);await this.saveEncryptedDB(r),await this.auditLog("database_saved","system",null,"Encrypted database saved")}catch(e){throw console.error("Error saving database:",e),e}}async exportDB(){if(!this.db)throw new Error("Database not initialized");try{const e=this.db.export();return new Uint8Array(e)}catch(e){throw console.error("Error exporting database:",e),e}}async encrypt(e){if(!this.encryptionKey)throw new Error("Encryption key not available");const r=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},this.encryptionKey,e),n=new Uint8Array(r.length+s.byteLength);return n.set(r,0),n.set(new Uint8Array(s),r.length),n.buffer}async decrypt(e){if(!this.encryptionKey)throw new Error("Encryption key not available");const r=new Uint8Array(e),s=r.slice(0,12),n=r.slice(12);try{const a=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},this.encryptionKey,n);return new Uint8Array(a)}catch{throw new Error("Failed to decrypt database. Wrong password?")}}async loadEncryptedDB(){return this.loadEncryptedDBInternal()}async loadEncryptedDBInternal(){try{if("FileSystemHandle"in window)try{return await(await(await(await navigator.storage.getDirectory()).getFileHandle("grounded_encrypted.db",{create:!1})).getFile()).arrayBuffer()}catch{}const e="grounded_encrypted_storage",r="encrypted_db";return new Promise((s,n)=>{const a=indexedDB.open(e,1);a.onerror=()=>n(a.error),a.onsuccess=()=>{const i=a.result;if(!i.objectStoreNames.contains(r)){s(null);return}const m=i.transaction([r],"readonly").objectStore(r).get("database");m.onsuccess=()=>{const u=m.result;s(u?u.data:null)},m.onerror=()=>n(m.error)},a.onupgradeneeded=i=>{const c=i.target.result;c.objectStoreNames.contains(r)||c.createObjectStore(r)}})}catch(e){return console.error("Error loading encrypted database:",e),null}}async saveEncryptedDB(e){try{if("FileSystemHandle"in window)try{const i=await(await(await navigator.storage.getDirectory()).getFileHandle("grounded_encrypted.db",{create:!0})).createWritable();await i.write(e),await i.close();return}catch{}const r="grounded_encrypted_storage",s="encrypted_db";return new Promise((n,a)=>{const i=indexedDB.open(r,1);i.onerror=()=>a(i.error),i.onsuccess=()=>{const u=i.result.transaction([s],"readwrite").objectStore(s).put({id:"database",data:e});u.onsuccess=()=>n(),u.onerror=()=>a(u.error)},i.onupgradeneeded=c=>{const d=c.target.result;d.objectStoreNames.contains(s)||d.createObjectStore(s)}})}catch(r){throw console.error("Error saving encrypted database:",r),r}}async auditLog(e,r,s,n){const a={id:crypto.randomUUID(),timestamp:new Date().toISOString(),userId:this.userId,action:e,table:r,recordId:s||void 0,details:n};await this.execute(`INSERT INTO audit_log (id, timestamp, user_id, action, table_name, record_id, details)
       VALUES (?, ?, ?, ?, ?, ?, ?)`,[a.id,a.timestamp,a.userId,a.action,a.table||null,a.recordId||null,a.details||null])}async verifyIntegrity(){try{return(await this.query("PRAGMA integrity_check"))[0]?.integrity_check==="ok"}catch(e){return console.error("Error verifying integrity:",e),!1}}async generateReport(e="SOAP"){return await this.auditLog("report_generated","reports",null,`Format: ${e}`),new Uint8Array(0)}async changePassword(e,r){if(!this.db||!this.initialized)throw new Error("Database not initialized");try{const s=await this.getOrCreateSalt(),n=new TextEncoder,a=n.encode(e),i=await crypto.subtle.importKey("raw",a,"PBKDF2",!1,["deriveBits","deriveKey"]),c=await crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),d=await this.loadEncryptedDBInternal();if(d){const w=new Uint8Array(d),T=w.slice(0,12),D=w.slice(12);try{await crypto.subtle.decrypt({name:"AES-GCM",iv:T},c,D)}catch{throw new Error("Old password is incorrect")}}const m=await this.exportDB(),u=new Uint8Array(16);crypto.getRandomValues(u);const x="grounded_encryption_salt",h=Array.from(u).map(w=>w.toString(16).padStart(2,"0")).join("");localStorage.setItem(x,h);const g=n.encode(r),k=await crypto.subtle.importKey("raw",g,"PBKDF2",!1,["deriveBits","deriveKey"]),C=await crypto.subtle.deriveKey({name:"PBKDF2",salt:u,iterations:1e5,hash:"SHA-256"},k,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]);this.encryptionKey=C;const A=await this.encrypt(m);await this.saveEncryptedDB(A),await this.auditLog("password_changed","system",null,"Database re-encrypted with new password"),console.log("Password changed successfully - database re-encrypted")}catch(s){throw console.error("Error changing password:",s),s}}};l(Y,"EncryptedPWA"),Y.instance=null,Y.SQL=null;let we=Y;const ur=Object.freeze(Object.defineProperty({__proto__:null,EncryptedPWA:we},Symbol.toStringTag,{value:"Module"}));function ge(){return typeof window<"u"&&"__TAURI__"in window}l(ge,"isTauri");async function ot(o){const r=new TextEncoder().encode(o),s=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(s)).map(a=>a.toString(16).padStart(2,"0")).join("")}l(ot,"hashPassword");async function mr(o,e){return await ot(o)===e}l(mr,"verifyPassword");async function pr(o){try{try{await X.init()}catch(a){const i=a instanceof Error?a.message:String(a);return console.error("Auth store initialization error:",a),i.includes("IndexedDB is not available")?{success:!1,error:"Your browser does not support local storage. Please use a modern browser like Chrome, Firefox, or Safari."}:i.includes("quota")||i.includes("QuotaExceeded")?{success:!1,error:"Storage quota exceeded. Please clear some browser data and try again."}:i.includes("blocked")||i.includes("Blocked")?{success:!1,error:"Database access is blocked. Please check your browser settings and allow local storage for this site."}:{success:!1,error:"Unable to access local storage. Please refresh the page and try again."}}if(!o.username||o.username.length<3)return{success:!1,error:"Username must be at least 3 characters"};if(!o.password||o.password.length<6)return{success:!1,error:"Password must be at least 6 characters"};if(!o.email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email))return{success:!1,error:"Please enter a valid email address"};let e;try{e=await X.getUserByUsername(o.username)}catch(a){return console.error("Error checking username:",a),{success:!1,error:"Database error. Please try again."}}if(e)return{success:!1,error:"Username already exists"};let r;try{r=await X.getUserByEmail(o.email)}catch(a){return console.error("Error checking email:",a),{success:!1,error:"Database error. Please try again."}}if(r)return{success:!1,error:"Email already registered"};let s;try{s=await ot(o.password)}catch(a){return console.error("Error hashing password:",a),{success:!1,error:"Password encryption failed. Please try again."}}let n;try{n=await X.createUser({username:o.username,passwordHash:s,email:o.email,termsAccepted:!1})}catch(a){console.error("Error creating user:",a);const i=a instanceof Error?a.message:String(a);return i.includes("ConstraintError")||i.includes("already exists")?{success:!1,error:"Username or email already exists"}:{success:!1,error:"Failed to create account. Please try again."}}return{success:!0,userId:n}}catch(e){return console.error("Registration error:",e),{success:!1,error:`Registration failed: ${e instanceof Error?e.message:String(e)}. Please try again.`}}}l(pr,"registerUser");async function vt(o){try{if(!o.username||!o.password)return{success:!1,error:"Please enter username and password"};try{await X.init()}catch(s){const n=s instanceof Error?s.message:String(s);return console.error("Auth store initialization error during login:",s),n.includes("IndexedDB is not available")?{success:!1,error:"Your browser does not support local storage. Please use a modern browser."}:n.includes("blocked")||n.includes("Blocked")?{success:!1,error:"Database access is blocked. Please check your browser settings."}:{success:!1,error:"Unable to access local storage. Please refresh the page and try again."}}const e=await X.getUserByUsername(o.username);return e?await mr(o.password,e.passwordHash)?(await X.updateUser(e.id,{lastLogin:new Date().toISOString()}),sessionStorage.setItem("userId",e.id),sessionStorage.setItem("username",e.username),{success:!0,userId:e.id}):{success:!1,error:"Invalid username or password"}:{success:!1,error:"Invalid username or password"}}catch(e){return console.error("Login error:",e),{success:!1,error:"Login failed. Please try again."}}}l(vt,"loginUser");function jt(){sessionStorage.removeItem("userId"),sessionStorage.removeItem("username")}l(jt,"logoutUser");async function Nt(){const o=sessionStorage.getItem("userId");return o?await X.getUserById(o):null}l(Nt,"getCurrentUser");function gr(){return!!sessionStorage.getItem("userId")}l(gr,"isLoggedIn");async function hr(o){try{try{await X.init()}catch(c){const d=c instanceof Error?c.message:String(c);return console.error("Auth store initialization error during password reset:",c),d.includes("IndexedDB is not available")?{success:!1,error:"Your browser does not support local storage. Please use a modern browser."}:d.includes("quota")||d.includes("QuotaExceeded")?{success:!1,error:"Storage quota exceeded. Please clear some browser data and try again."}:{success:!1,error:"Unable to access local storage. Please refresh the page and try again."}}const e=await X.getUserByEmail(o);if(!e)return{success:!0};if(!e.id)throw new Error("User ID is missing");const r=await X.createResetToken(e.id,o);if(!r)throw new Error("Failed to create reset token");const n=ge()?"tauri://localhost":typeof window<"u"?window.location.origin:"http://localhost",a=typeof window<"u"&&window.location.pathname?window.location.pathname:"/",i=`${n}${a}#reset/${r}`;if(!i||!i.includes("#reset/"))throw new Error(`Invalid reset link generated: ${i}`);return{success:!0,resetLink:i}}catch(e){return console.error("Password reset error:",e),{success:!1,error:`Failed to generate reset link: ${e instanceof Error?e.message:"Unknown error"}`}}}l(hr,"requestPasswordReset");async function xr(o,e){try{if(!e||e.length<6)return{success:!1,error:"Password must be at least 6 characters"};await X.init();const r=await X.getResetToken(o);if(!r)return{success:!1,error:"Invalid or expired reset token"};const s=await ot(e);return await X.updateUser(r.userId,{passwordHash:s}),await X.deleteResetToken(o),localStorage.getItem("encryption_enabled")==="true"&&console.warn("Password reset with encryption enabled - database will need to be unlocked with new password"),{success:!0,userId:r.userId}}catch(r){return console.error("Password reset error:",r),{success:!1,error:"Failed to reset password"}}}l(xr,"resetPasswordWithToken");async function yr(o){await X.init(),await X.updateUser(o,{termsAccepted:!0,termsAcceptedDate:new Date().toISOString()})}l(yr,"acceptTerms");const br=900*1e3,He="encrypted_session_last_activity",Xe="encrypted_session_user_id";function Lt(){const[o,e]=p.useState({isAuthenticated:!1,isUnlocking:!1,error:null,userId:null}),r=l(()=>localStorage.getItem("encryption_enabled")==="true","isEncryptionEnabled"),s=p.useCallback(()=>{if(!r())return!0;const c=localStorage.getItem(He);if(!c)return!1;const d=parseInt(c,10);return Date.now()-d<br},[]),n=p.useCallback(()=>{r()&&localStorage.setItem(He,Date.now().toString())},[]);p.useEffect(()=>{if(!r()){e({isAuthenticated:!0,isUnlocking:!1,error:null,userId:null});return}if(we.getInstance()&&s()){const d=parseInt(localStorage.getItem(Xe)||"0",10);e({isAuthenticated:!0,isUnlocking:!1,error:null,userId:d}),n()}else e({isAuthenticated:!1,isUnlocking:!1,error:null,userId:null})},[s,n]);const a=p.useCallback(()=>{r()&&(localStorage.removeItem(He),localStorage.removeItem(Xe),e({isAuthenticated:!1,isUnlocking:!1,error:null,userId:null}))},[]);p.useEffect(()=>{if(!r()||!o.isAuthenticated)return;const c=["mousedown","keydown","scroll","touchstart"],d=l(()=>{n()},"handleActivity");c.forEach(u=>{window.addEventListener(u,d,{passive:!0})});const m=setInterval(()=>{s()||a()},6e4);return()=>{c.forEach(u=>{window.removeEventListener(u,d)}),clearInterval(m)}},[o.isAuthenticated,s,n,a]);const i=p.useCallback(async(c,d)=>{if(!r())return!0;e(m=>({...m,isUnlocking:!0,error:null}));try{return await we.init(c,d)?(localStorage.setItem(Xe,d.toString()),n(),e({isAuthenticated:!0,isUnlocking:!1,error:null,userId:d}),!0):!1}catch(m){const u=m instanceof Error?m.message:"Failed to unlock database";return e(x=>({...x,isUnlocking:!1,error:u})),!1}},[n]);return{...o,login:i,logout:a,updateActivity:n,isEncryptionEnabled:r()}}l(Lt,"useAuth");const fr=l(({onLogin:o})=>{const e=Lt(),[r,s]=p.useState("login"),[n,a]=p.useState(""),[i,c]=p.useState(""),[d,m]=p.useState(""),[u,x]=p.useState(""),[h,g]=p.useState(""),[k,C]=p.useState(""),[A,w]=p.useState(""),[T,D]=p.useState(!1),[j,z]=p.useState(""),[q,S]=p.useState(!1),[W,v]=p.useState(!1),[b,E]=p.useState(!1),[G,te]=p.useState(!1),[P,he]=p.useState(Dt()),ce=p.useRef(null);p.useEffect(()=>{const I=l(()=>{const V=window.location.hash.match(/^#reset\/(.+)$/);V&&(g(V[1]),s("reset"),window.history.replaceState(null,"",window.location.pathname))},"checkHash");return I(),window.addEventListener("hashchange",I),()=>{window.removeEventListener("hashchange",I)}},[]),p.useEffect(()=>{const I=nt(_=>{ce.current&&(clearTimeout(ce.current),ce.current=null),_.status==="loading"&&_.progress>0?he(_):_.status==="success"&&_.progress===100?(he({..._,label:"AI models ready"}),ce.current=setTimeout(()=>{he(V=>({...V,status:"idle",progress:0})),ce.current=null},1500)):_.status==="idle"&&he(V=>({...V,status:"idle",progress:0}))});return()=>{ce.current&&(clearTimeout(ce.current),ce.current=null),I()}},[]);const Te=l(async I=>{if(I.preventDefault(),w(""),D(!0),i!==u){w("Passwords do not match"),D(!1);return}const _=await pr({username:n,password:i,email:d});if(D(!1),_.success){const V=await vt({username:n,password:i});V.success&&V.userId&&o(V.userId)}else w(_.error||"Registration failed")},"handleRegister"),De=l(async I=>{I.preventDefault(),w(""),D(!0);try{const _=await vt({username:n,password:i});if(!_.success||!_.userId){w(_.error||"Login failed"),D(!1);return}const V=parseInt(_.userId,10);if(e.isEncryptionEnabled&&!await e.login(i,V)){w(e.error||"Failed to unlock encrypted database"),D(!1);return}D(!1),typeof sessionStorage<"u"&&(sessionStorage.removeItem("app_init_started"),sessionStorage.removeItem("app_init_complete")),o(_.userId)}catch(_){w(_ instanceof Error?_.message:"Login failed"),D(!1)}},"handleLogin"),ke=l(async I=>{I.preventDefault(),w(""),D(!0);const _=await hr(d);D(!1),_.success&&_.resetLink?(z(_.resetLink),w("")):w(_.error||"Failed to generate reset link")},"handleForgotPassword"),ze=l(async I=>{if(I.preventDefault(),w(""),D(!0),k!==u){w("Passwords do not match"),D(!1);return}const _=await xr(h,k);D(!1),_.success?(w(""),alert("Password reset successful! Please login with your new password."),s("login"),g(""),C(""),x("")):w(_.error||"Failed to reset password")},"handleResetPassword"),qe=l(()=>{navigator.clipboard.writeText(j),alert("Reset link copied to clipboard! Save this link to reset your password.")},"copyResetLink");return t.jsx("div",{className:"min-h-screen bg-bg-primary dark:bg-dark-bg-primary flex items-center justify-center p-4 sm:p-6",children:t.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-dark-bg-primary rounded-xl sm:rounded-2xl shadow-2xl border border-border-soft dark:border-dark-border/30 overflow-hidden",children:[t.jsxs("div",{className:"p-6 sm:p-8 space-y-6",children:[t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("img",{src:"/ac-minds-logo.png",alt:"AC MINDS",className:"w-12 h-12 sm:w-16 sm:h-16 object-contain mx-auto"}),t.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary dark:text-white tracking-tight",children:"Grounded"}),t.jsxs("p",{className:"text-sm sm:text-base text-text-primary/60 dark:text-white/60",children:[r==="login"&&"Sign in to continue",r==="register"&&"Create your account",r==="forgot"&&"Reset your password",r==="reset"&&"Set new password"]})]}),A&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 sm:p-4",children:t.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:A})}),j&&r==="forgot"&&t.jsxs("div",{className:"bg-yellow-warm/20 dark:bg-yellow-warm/30 border border-yellow-warm/50 rounded-lg p-4 space-y-3",children:[t.jsx("p",{className:"text-sm font-bold text-text-primary dark:text-white",children:"Reset Link Generated"}),t.jsx("p",{className:"text-xs text-text-primary/70 dark:text-white/70",children:"Copy this link to reset your password. It will expire in 24 hours."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:j,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-dark-bg-primary rounded-lg text-xs border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white"}),t.jsx("button",{onClick:qe,className:"px-4 py-2 bg-yellow-warm text-text-primary rounded-lg text-xs font-bold uppercase tracking-widest hover:opacity-90",children:"Copy"})]})]}),r==="login"&&t.jsxs("form",{onSubmit:De,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Username"}),t.jsx("input",{type:"text",value:n,onChange:l(I=>a(I.target.value),"onChange"),required:!0,className:"w-full px-4 py-3 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"Enter your username"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:q?"text":"password",value:i,onChange:l(I=>c(I.target.value),"onChange"),required:!0,className:"w-full px-4 py-3 pr-12 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"Enter your password"}),t.jsx("button",{type:"button",onClick:l(()=>S(!q),"onClick"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white transition-colors","aria-label":q?"Hide password":"Show password",children:q?t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):t.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),t.jsx("button",{type:"submit",disabled:T,className:"w-full py-3 sm:py-4 bg-yellow-warm text-text-primary rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-sm sm:text-base hover:opacity-90 transition-all disabled:opacity-50 shadow-lg",children:T?"Signing in...":"Sign In"}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-2 text-center",children:[t.jsx("button",{type:"button",onClick:l(()=>s("register"),"onClick"),className:"text-xs sm:text-sm text-yellow-warm hover:underline",children:"Create Account"}),t.jsx("button",{type:"button",onClick:l(()=>s("forgot"),"onClick"),className:"text-xs sm:text-sm text-text-primary/60 dark:text-white/60 hover:underline",children:"Forgot Password?"})]})]}),r==="register"&&t.jsxs("form",{onSubmit:Te,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Username"}),t.jsx("input",{type:"text",value:n,onChange:l(I=>a(I.target.value),"onChange"),required:!0,minLength:3,className:"w-full px-4 py-3 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"Choose a username (min 3 characters)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Email"}),t.jsx("input",{type:"email",value:d,onChange:l(I=>m(I.target.value),"onChange"),required:!0,className:"w-full px-4 py-3 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"your.email@example.com"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:q?"text":"password",value:i,onChange:l(I=>c(I.target.value),"onChange"),required:!0,minLength:6,className:"w-full px-4 py-3 pr-12 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"Choose a password (min 6 characters)"}),t.jsx("button",{type:"button",onClick:l(()=>S(!q),"onClick"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white transition-colors","aria-label":q?"Hide password":"Show password",children:q?t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):t.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Confirm Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:W?"text":"password",value:u,onChange:l(I=>x(I.target.value),"onChange"),required:!0,minLength:6,className:"w-full px-4 py-3 pr-12 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"Confirm your password"}),t.jsx("button",{type:"button",onClick:l(()=>v(!W),"onClick"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white transition-colors","aria-label":W?"Hide password":"Show password",children:W?t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):t.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),t.jsx("button",{type:"submit",disabled:T,className:"w-full py-3 sm:py-4 bg-yellow-warm text-text-primary rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-sm sm:text-base hover:opacity-90 transition-all disabled:opacity-50 shadow-lg",children:T?"Creating Account...":"Create Account"}),t.jsx("div",{className:"text-center",children:t.jsx("button",{type:"button",onClick:l(()=>s("login"),"onClick"),className:"text-xs sm:text-sm text-yellow-warm hover:underline",children:"Already have an account? Sign In"})})]}),r==="forgot"&&t.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Email Address"}),t.jsx("input",{type:"email",value:d,onChange:l(I=>m(I.target.value),"onChange"),required:!0,className:"w-full px-4 py-3 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"Enter your email address"})]}),t.jsx("p",{className:"text-xs text-text-primary/60 dark:text-white/60",children:"A reset link will be generated. Copy and save it to reset your password."}),t.jsx("button",{type:"submit",disabled:T,className:"w-full py-3 sm:py-4 bg-yellow-warm text-text-primary rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-sm sm:text-base hover:opacity-90 transition-all disabled:opacity-50 shadow-lg",children:T?"Generating Link...":"Generate Reset Link"}),t.jsx("div",{className:"text-center",children:t.jsx("button",{type:"button",onClick:l(()=>{s("login"),m(""),z("")},"onClick"),className:"text-xs sm:text-sm text-yellow-warm hover:underline",children:"Back to Sign In"})})]}),r==="reset"&&t.jsxs("form",{onSubmit:ze,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"New Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:b?"text":"password",value:k,onChange:l(I=>C(I.target.value),"onChange"),required:!0,minLength:6,className:"w-full px-4 py-3 pr-12 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"Enter new password (min 6 characters)"}),t.jsx("button",{type:"button",onClick:l(()=>E(!b),"onClick"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white transition-colors","aria-label":b?"Hide password":"Show password",children:b?t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):t.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-2",children:"Confirm New Password"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:G?"text":"password",value:u,onChange:l(I=>x(I.target.value),"onChange"),required:!0,minLength:6,className:"w-full px-4 py-3 pr-12 rounded-lg bg-bg-primary dark:bg-dark-bg-primary/50 border border-border-soft dark:border-dark-border/30 text-text-primary dark:text-white focus:ring-2 focus:ring-yellow-warm/50 outline-none",placeholder:"Confirm new password"}),t.jsx("button",{type:"button",onClick:l(()=>te(!G),"onClick"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white transition-colors","aria-label":G?"Hide password":"Show password",children:G?t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):t.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),t.jsx("button",{type:"submit",disabled:T,className:"w-full py-3 sm:py-4 bg-yellow-warm text-text-primary rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-sm sm:text-base hover:opacity-90 transition-all disabled:opacity-50 shadow-lg",children:T?"Resetting Password...":"Reset Password"})]})]}),(P.status==="loading"||P.status==="success"&&P.progress===100)&&P.progress>0&&t.jsxs("div",{className:"border-t border-border-soft dark:border-dark-border/30 pt-3 mt-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:P.label||"Initializing..."}),t.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[Math.round(P.progress),"%"]})]}),t.jsx("div",{className:"w-full h-0.5 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-navy-primary/50 dark:bg-navy-primary/40 rounded-full transition-all duration-300 ease-out",style:{width:`${Math.max(0,Math.min(100,P.progress))}%`}})}),P.details&&P.status==="loading"&&t.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:P.details})]})]})})},"Login"),wr=l(({onAccept:o,onDecline:e})=>{const[r,s]=p.useState(!1),[n,a]=p.useState(!1),i=r&&n;return t.jsxs("div",{className:"min-h-screen bg-bg-primary dark:bg-dark-bg-primary flex items-center justify-center p-4 sm:p-6",children:[t.jsx("div",{className:"max-w-2xl w-full bg-white dark:bg-dark-bg-primary rounded-xl sm:rounded-2xl shadow-2xl border border-border-soft dark:border-dark-border/30 overflow-hidden",children:t.jsxs("div",{className:"p-6 sm:p-8 lg:p-10 space-y-6 sm:space-y-8 max-h-[90vh] overflow-y-auto custom-scrollbar",children:[t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary dark:text-white tracking-tight",children:"Acceptance of Terms and Conditions"}),t.jsx("p",{className:"text-sm sm:text-base text-text-primary/60 dark:text-white/60",children:"Please read the following information carefully before using this app."})]}),t.jsxs("div",{className:"space-y-4 text-text-primary dark:text-white",children:[t.jsx("p",{className:"text-sm sm:text-base leading-relaxed",children:'By selecting "I Accept," you confirm that you have read, understood, and agree to the Terms and Conditions governing the use of this application ("the App").'}),t.jsxs("div",{className:"space-y-4 pt-4 border-t border-border-soft dark:border-dark-border/30",children:[t.jsx("h2",{className:"text-lg sm:text-xl font-black text-text-primary dark:text-white",children:"DISCLAIMER"}),t.jsxs("div",{className:"space-y-3 text-sm sm:text-base leading-relaxed",children:[t.jsxs("p",{children:["This App is designed for general wellness and informational purposes only. It is ",t.jsx("strong",{children:"not"})," a substitute for professional therapy, medical advice, diagnosis, or treatment."]}),t.jsx("p",{children:"You should always seek help from a licensed therapist, counselor, psychiatrist, or other qualified healthcare provider for mental health concerns."}),t.jsx("p",{children:"If you are in crisis or believe you may be in danger, do not use this App as a source of emergency support. Please contact local emergency services or crisis resources immediately."})]}),t.jsxs("div",{className:"bg-bg-primary dark:bg-dark-bg-primary/50 rounded-lg p-4 sm:p-5 space-y-2",children:[t.jsx("p",{className:"font-bold text-sm sm:text-base",children:"In the United States:"}),t.jsxs("ul",{className:"space-y-2 text-sm sm:text-base list-disc list-inside ml-2",children:[t.jsxs("li",{children:["Call ",t.jsx("strong",{children:"911"})," for emergencies"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"988 Suicide and Crisis Lifeline"})," â€“ Dial 988 (24/7, free, confidential)"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Crisis Text Line"})," â€“ Text HOME to 741741"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"National Domestic Violence Hotline"})," â€“ 1-800-799-SAFE (7233)"]})]})]}),t.jsx("p",{className:"text-sm sm:text-base leading-relaxed pt-2",children:"By proceeding, you acknowledge that you understand and agree to these terms and that you accept full responsibility for your use of the App."})]}),t.jsxs("div",{className:"space-y-4 pt-4 border-t border-border-soft dark:border-dark-border/30",children:[t.jsx("h2",{className:"text-lg sm:text-xl font-black text-text-primary dark:text-white",children:"CRISIS DETECTION & SAFETY"}),t.jsxs("div",{className:"space-y-3 text-sm sm:text-base leading-relaxed",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"This app includes automatic crisis detection"})," to help protect your safety and wellbeing. The app monitors your journal entries and reflections for language that may indicate you are in crisis or at risk of self-harm."]}),t.jsx("p",{children:t.jsx("strong",{children:"If the app detects crisis language, it will:"})}),t.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[t.jsx("li",{children:"Immediately stop normal AI responses"}),t.jsx("li",{children:"Display crisis resources and emergency contact information"}),t.jsx("li",{children:"Encourage you to contact professional help or emergency services"}),t.jsx("li",{children:"Provide direct links to crisis hotlines and support resources"})]}),t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 p-4 rounded",children:[t.jsx("p",{className:"font-bold text-red-800 dark:text-red-300 mb-2",children:"âš ï¸ Important Safety Information"}),t.jsxs("p",{className:"text-red-700 dark:text-red-200 text-sm",children:["The app treats ",t.jsx("strong",{children:"any direct or indirect self-harm language as a crisis trigger"}),", even if used hypothetically or in a joking manner. This is to ensure your safety. All suicide and self-harm mentions are taken seriously and will trigger immediate crisis guidance."]})]}),t.jsxs("details",{className:"mt-4",children:[t.jsx("summary",{className:"cursor-pointer font-bold text-text-primary dark:text-white hover:text-yellow-warm",children:"View Crisis Detection Categories (Click to expand)"}),t.jsx("div",{className:"mt-3 space-y-4 pl-4 border-l-2 border-border-soft dark:border-dark-border/30",children:Array.from(new Set(yt.map(c=>c.category))).map(c=>{const d=yt.filter(u=>u.category===c),m=d[0]?.severity||"moderate";return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("h3",{className:"font-bold text-sm",children:[qt(c),t.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs ${m==="critical"?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300":m==="high"?"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300":"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300"}`,children:m.toUpperCase()})]}),t.jsxs("p",{className:"text-xs text-text-primary/70 dark:text-white/70",children:['The app monitors for phrases like: "',d.slice(0,3).map(u=>u.phrase).join('", "'),'" and ',d.length-3>0?`${d.length-3} more similar phrases`:"similar phrases","."]})]},c)})})]}),t.jsx("p",{className:"text-xs text-text-primary/60 dark:text-white/60 italic pt-2",children:"These crisis detection phrases are hardcoded into the app and cannot be modified or disabled. This ensures consistent safety monitoring regardless of settings."})]})]})]}),t.jsxs("div",{className:"space-y-4 pt-4 border-t border-border-soft dark:border-dark-border/30",children:[t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:r,onChange:l(c=>s(c.target.checked),"onChange"),className:"mt-1 w-5 h-5 rounded border-2 border-text-primary/30 dark:border-white/30 text-yellow-warm focus:ring-2 focus:ring-yellow-warm/50 cursor-pointer"}),t.jsx("span",{className:"text-sm sm:text-base text-text-primary dark:text-white leading-relaxed flex-1",children:"I have read and understand the Terms and Conditions."})]}),t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:n,onChange:l(c=>a(c.target.checked),"onChange"),className:"mt-1 w-5 h-5 rounded border-2 border-text-primary/30 dark:border-white/30 text-yellow-warm focus:ring-2 focus:ring-yellow-warm/50 cursor-pointer"}),t.jsx("span",{className:"text-sm sm:text-base text-text-primary dark:text-white leading-relaxed flex-1",children:"I acknowledge this App does not replace professional therapy or emergency resources."})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 pt-4",children:[t.jsx("button",{onClick:e,className:"flex-1 px-6 py-3 sm:py-4 bg-bg-primary dark:bg-dark-bg-primary/50 text-text-primary dark:text-white rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-sm sm:text-base hover:opacity-80 transition-all border border-border-soft dark:border-dark-border/30",children:"Decline"}),t.jsx("button",{onClick:o,disabled:!i,className:`flex-1 px-6 py-3 sm:py-4 rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-sm sm:text-base transition-all ${i?"bg-yellow-warm text-text-primary hover:opacity-90 shadow-lg active:scale-[0.98]":"bg-border-soft dark:bg-dark-bg-primary/30 text-text-tertiary dark:text-white/30 cursor-not-allowed"}`,children:"Accept"})]})]})}),t.jsx("style",{children:`
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
          background: #cbd5e1; 
          border-radius: 10px; 
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { 
          background: #4a5568; 
        }
      `})]})},"TermsAcceptance"),kr=l(({currentView:o,onViewChange:e})=>{const r=[{id:"home",label:"Home",icon:"ðŸ "},{id:"values",label:"Values",icon:"ðŸ’›"},{id:"goals",label:"Goals",icon:"ðŸŽ¯"},{id:"report",label:"Reports",icon:"ðŸ“Š"},{id:"vault",label:"Vault",icon:"ðŸ”’"}];return t.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-bg-primary border-t border-border-soft dark:border-dark-border shadow-lg z-50 safe-area-inset-bottom",children:t.jsx("div",{className:"max-w-4xl mx-auto px-2",children:t.jsx("div",{className:"flex items-center justify-around",children:r.map(s=>{const n=o===s.id;return t.jsxs("button",{onClick:l(()=>{e(s.id),s.id==="home"&&window.__dashboardReset&&window.__dashboardReset(),s.id==="home"&&window.scrollTo({top:0,behavior:"smooth"})},"onClick"),className:`
                  flex flex-col items-center justify-center py-3 px-4 min-w-[60px] min-h-[60px]
                  transition-all duration-200
                  ${n?"text-navy-primary dark:text-yellow-warm":"text-text-secondary dark:text-white/60"}
                  active:scale-95
                `,"aria-label":s.label,children:[t.jsx("span",{className:"text-2xl mb-1",children:s.icon}),t.jsx("span",{className:`
                  text-xs font-medium
                  ${n?"font-semibold":""}
                `,children:s.label})]},s.id)})})})})},"BottomNavigation"),vr=l(({error:o,errorInfo:e,onReset:r})=>t.jsx("div",{className:"min-h-screen bg-bg-primary dark:bg-dark-bg-primary flex items-center justify-center p-4",children:t.jsx("div",{className:"bg-white dark:bg-dark-bg-secondary rounded-2xl sm:rounded-3xl border border-border-soft dark:border-dark-border shadow-2xl p-6 sm:p-8 max-w-2xl w-full",children:t.jsxs("div",{className:"text-center space-y-4 sm:space-y-6",children:[t.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto",children:t.jsx("span",{className:"text-3xl sm:text-4xl",children:"âš ï¸"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-black text-text-primary dark:text-white mb-2",children:"Something went wrong"}),t.jsx("p",{className:"text-text-secondary dark:text-text-secondary text-sm sm:text-base",children:"We encountered an unexpected error. Don't worry, your data is safe."})]}),o&&t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-primary rounded-xl p-4 text-left",children:[t.jsx("p",{className:"text-xs font-black text-text-primary/60 dark:text-white/60 uppercase tracking-widest mb-2",children:"Error Details"}),t.jsx("p",{className:"text-xs sm:text-sm text-text-primary dark:text-white font-mono break-all",children:o.message})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center",children:[t.jsx("button",{onClick:r,className:"px-6 py-3 sm:py-4 bg-navy-primary dark:bg-navy-primary text-white dark:text-white rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-sm sm:text-base hover:opacity-90 active:scale-[0.98] transition-all shadow-lg",children:"Try Again"}),t.jsx("button",{onClick:l(()=>window.location.reload(),"onClick"),className:"px-6 py-3 sm:py-4 bg-bg-primary dark:bg-dark-bg-primary/50 text-text-primary dark:text-white rounded-lg sm:rounded-xl font-black uppercase tracking-widest text-sm sm:text-base hover:opacity-80 transition-all border border-border-soft dark:border-dark-border/30",children:"Reload Page"})]}),t.jsx("p",{className:"text-xs text-text-tertiary dark:text-text-tertiary",children:"If this problem persists, please contact support."})]})})}),"ErrorFallback"),ct=class ct extends p.Component{constructor(e){super(e),this.handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,r){console.error("ErrorBoundary caught an error:",e,r),this.setState({error:e,errorInfo:r})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:t.jsx(vr,{error:this.state.error,errorInfo:this.state.errorInfo,onReset:this.handleReset}):this.props.children}};l(ct,"ErrorBoundary");let Qe=ct;const Le=l(({className:o="",width:e="100%",height:r="1rem"})=>t.jsx("div",{className:`animate-pulse bg-bg-tertiary dark:bg-dark-bg-tertiary rounded ${o}`,style:{width:e,height:r}}),"SkeletonLoader"),ve=l(({lines:o=3,showHeader:e=!0,showFooter:r=!1})=>t.jsxs("div",{className:"bg-white dark:bg-dark-bg-secondary rounded-xl sm:rounded-2xl border border-border-soft dark:border-dark-border shadow-sm p-4 sm:p-5 space-y-3",children:[e&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(Le,{width:"60%",height:"1.25rem"}),t.jsx(Le,{width:"40%",height:"0.875rem"})]}),t.jsx("div",{className:"space-y-2",children:Array.from({length:o}).map((s,n)=>t.jsx(Le,{width:n===o-1?"80%":"100%",height:"0.875rem"},n))}),r&&t.jsx("div",{className:"pt-2",children:t.jsx(Le,{width:"30%",height:"0.75rem"})})]}),"SkeletonCard"),dt=class dt{constructor(){this.dbName="groundedDB",this.dbVersion=6,this.db=null,this.oldDbName="com.acminds.grounded.therapy.db",this.APP_ID="com.acminds.grounded",this.APP_NAME="Grounded",this.metadataValidated=!1,this.oldDatabaseCheckCache=null,this.metadataCache=null}async checkForOldDatabase(){if(this.oldDatabaseCheckCache!==null)return this.oldDatabaseCheckCache;if(typeof indexedDB>"u")return this.oldDatabaseCheckCache=!1,!1;try{const e=await new Promise(r=>{const s=indexedDB.open(this.oldDbName),n=setTimeout(()=>{r(!1)},100);s.onsuccess=()=>{clearTimeout(n),s.result.close(),r(!0)},s.onerror=()=>{clearTimeout(n),r(!1)}});return this.oldDatabaseCheckCache=e,e}catch(e){return console.warn("Error checking for old database:",e),this.oldDatabaseCheckCache=!1,!1}}async deleteOldDatabase(){try{"databases"in indexedDB&&(await indexedDB.databases()).find(s=>s.name===this.oldDbName)&&(await new Promise((s,n)=>{const a=indexedDB.deleteDatabase(this.oldDbName);a.onsuccess=()=>s(),a.onerror=()=>n(a.error),a.onblocked=()=>{console.warn("Old database deletion blocked - another tab may have it open"),setTimeout(()=>s(),1e3)}}),console.log("âœ… Old database deleted successfully"))}catch(e){console.warn("Error deleting old database:",e)}}async validateDatabase(){if(this.metadataValidated)return!0;if(!this.db)return!1;try{let e=this.metadataCache;return e||(e=await this.getMetadata(),this.metadataCache=e),e?e.appId===this.APP_ID&&e.appName===this.APP_NAME?(this.metadataValidated=!0,this.updateMetadataValidation().catch(s=>{console.warn("Failed to update metadata validation timestamp (non-critical):",s)}),!0):(console.error("Database validation failed - metadata mismatch"),!1):(this.setMetadata().catch(s=>{console.warn("Failed to set metadata (non-critical):",s)}),this.metadataValidated=!0,!0)}catch(e){return console.error("Error validating database:",e),!1}}async getMetadata(){return this.metadataCache!==null?this.metadataCache:this.db?new Promise((e,r)=>{try{const a=this.db.transaction(["metadata"],"readonly").objectStore("metadata").get("app_metadata");a.onsuccess=()=>{const i=a.result||null;this.metadataCache=i,e(i)},a.onerror=()=>{e(null)}}catch{e(null)}}):null}async setMetadata(){if(!this.db)return;if(!this.db.objectStoreNames.contains("metadata")){console.warn("Metadata object store does not exist - database may need upgrade");return}const e=this.detectPlatform(),r={appName:this.APP_NAME,appId:this.APP_ID,platform:e,version:"1.0.0",createdAt:new Date().toISOString(),lastValidated:new Date().toISOString()};return new Promise((s,n)=>{try{const c=this.db.transaction(["metadata"],"readwrite").objectStore("metadata").put({id:"app_metadata",...r});c.onsuccess=()=>s(),c.onerror=()=>{console.warn("Failed to set metadata (non-critical):",c.error),s()}}catch(a){console.warn("Failed to set metadata (non-critical):",a),s()}})}async updateMetadataValidation(){if(!this.db||!this.db.objectStoreNames.contains("metadata"))return;const e=await this.getMetadata();if(e)try{e.lastValidated=new Date().toISOString(),this.db.transaction(["metadata"],"readwrite").objectStore("metadata").put({id:"app_metadata",...e})}catch(r){console.warn("Failed to update metadata validation (non-critical):",r)}}detectPlatform(){if(typeof window>"u")return"unknown";if(typeof window<"u"&&"__TAURI__"in window)return"desktop";if(typeof window<"u"&&window.Capacitor)return window.Capacitor.getPlatform()||"mobile";const e=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(e)?"android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"ios":"pwa"}async init(){if(this.db)return Promise.resolve();const e=2;let r=null;for(let s=0;s<e;s++)try{await new Promise((n,a)=>{this.initDatabase(n,a)});return}catch(n){r=n instanceof Error?n:new Error(String(n));const a=r.message;if((a.includes("backing store")||a.includes("Internal error"))&&s<e-1){console.warn(`Database initialization attempt ${s+1} failed, retrying...`),await new Promise(i=>setTimeout(i,500*(s+1)));continue}throw r}throw r||new Error("Database initialization failed after retries")}initDatabase(e,r){if(typeof indexedDB>"u"){r(new Error("IndexedDB is not available in this browser"));return}const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>{const n=s.error||new Error("Unknown database error"),a=n instanceof Error?n.message:String(n);console.error("Database open error:",n),a.includes("backing store")||a.includes("Internal error")?r(new Error("Database storage error. Please try refreshing the page or clearing browser data.")):a.includes("QuotaExceeded")||a.includes("quota")?r(new Error("Storage quota exceeded. Please clear some browser data and try again.")):a.includes("blocked")||a.includes("Blocked")?r(new Error("Database access is blocked. Please check your browser settings and allow local storage.")):r(n)},s.onsuccess=async()=>{try{if(this.db=s.result,!this.db){r(new Error("Database connection is null"));return}if(this.db.onerror=n=>{console.error("Database error:",n)},this.db.onclose=()=>{console.warn("Database connection closed"),this.db=null,this.metadataValidated=!1,this.metadataCache=null},!this.metadataValidated&&!await this.validateDatabase()){r(new Error("Database validation failed - database may be corrupted or from another app"));return}e()}catch(n){console.error("Error setting up database:",n),r(n)}},s.onupgradeneeded=n=>{const a=n.target.result;if(!a){r(new Error("Database upgrade failed - database is null"));return}if(!a.objectStoreNames.contains("users")){const i=a.createObjectStore("users",{keyPath:"id"});i.createIndex("username","username",{unique:!0}),i.createIndex("email","email",{unique:!0})}if(a.objectStoreNames.contains("appData")||a.createObjectStore("appData",{keyPath:"userId"}).createIndex("userId","userId",{unique:!0}),!a.objectStoreNames.contains("resetTokens")){const i=a.createObjectStore("resetTokens",{keyPath:"token"});i.createIndex("userId","userId",{unique:!1}),i.createIndex("expires","expires",{unique:!1})}if(!a.objectStoreNames.contains("feelingLogs")){const i=a.createObjectStore("feelingLogs",{keyPath:"id"});i.createIndex("timestamp","timestamp",{unique:!1}),i.createIndex("emotionalState","emotionalState",{unique:!1})}if(!a.objectStoreNames.contains("userInteractions")){const i=a.createObjectStore("userInteractions",{keyPath:"id"});i.createIndex("timestamp","timestamp",{unique:!1}),i.createIndex("sessionId","sessionId",{unique:!1}),i.createIndex("type","type",{unique:!1})}if(!a.objectStoreNames.contains("sessions")){const i=a.createObjectStore("sessions",{keyPath:"id"});i.createIndex("startTimestamp","startTimestamp",{unique:!1}),i.createIndex("valueId","valueId",{unique:!1}),i.createIndex("userId","userId",{unique:!1})}if(!a.objectStoreNames.contains("metadata")){const i=a.createObjectStore("metadata",{keyPath:"id"});i.createIndex("appId","appId",{unique:!1}),i.createIndex("platform","platform",{unique:!1})}if(!a.objectStoreNames.contains("ruleBasedUsageLogs")){const i=a.createObjectStore("ruleBasedUsageLogs",{keyPath:"id"});i.createIndex("timestamp","timestamp",{unique:!1}),i.createIndex("type","type",{unique:!1})}s.onblocked=()=>{console.warn("Database upgrade blocked - another tab may have the database open")}}}async ensureDB(){if(this.db||await this.init(),!this.db)throw new Error("Database initialization failed");return this.db}generateUUID(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const r=Math.random()*16|0;return(e==="x"?r:r&3|8).toString(16)})}async createUser(e){const r=await this.ensureDB(),s={...e,id:this.generateUUID(),createdAt:new Date().toISOString()};return new Promise((n,a)=>{const d=r.transaction(["users"],"readwrite").objectStore("users").add(s);d.onsuccess=()=>n(s.id),d.onerror=()=>a(d.error)})}async getUserByUsername(e){const r=await this.ensureDB();return new Promise((s,n)=>{const d=r.transaction(["users"],"readonly").objectStore("users").index("username").get(e);d.onsuccess=()=>s(d.result||null),d.onerror=()=>n(d.error)})}async getUserByEmail(e){const r=await this.ensureDB();return new Promise((s,n)=>{const d=r.transaction(["users"],"readonly").objectStore("users").index("email").get(e);d.onsuccess=()=>s(d.result||null),d.onerror=()=>n(d.error)})}async getUserById(e){const r=await this.ensureDB();return new Promise((s,n)=>{const c=r.transaction(["users"],"readonly").objectStore("users").get(e);c.onsuccess=()=>s(c.result||null),c.onerror=()=>n(c.error)})}async updateUser(e,r){const s=await this.ensureDB();return new Promise(async(n,a)=>{const i=await this.getUserById(e);if(!i){a(new Error("User not found"));return}const d=s.transaction(["users"],"readwrite").objectStore("users"),m={...i,...r},u=d.put(m);u.onsuccess=()=>n(),u.onerror=()=>a(u.error)})}async getAppData(e){const r=await this.ensureDB();return r.objectStoreNames.contains("appData")?new Promise((s,n)=>{try{const c=r.transaction(["appData"],"readonly").objectStore("appData").get(e);c.onsuccess=()=>{const d=c.result;s(d?d.data:null)},c.onerror=()=>{console.warn("Failed to get app data (non-critical):",c.error),s(null)}}catch(a){console.warn("Failed to get app data (non-critical):",a),s(null)}}):null}async saveAppData(e,r){const s=await this.ensureDB();if(!s.objectStoreNames.contains("appData")){console.warn("App data store not available - data will not be saved");return}return new Promise((n,a)=>{try{const d=s.transaction(["appData"],"readwrite").objectStore("appData").put({userId:e,data:r});d.onsuccess=()=>n(),d.onerror=()=>{console.warn("Failed to save app data (non-critical):",d.error),n()}}catch(i){console.warn("Failed to save app data (non-critical):",i),n()}})}async createResetToken(e,r){const s=await this.ensureDB();if(!s.objectStoreNames.contains("resetTokens"))throw new Error("Reset tokens store not available - database may need upgrade");const n=this.generateUUID(),a=Date.now()+1440*60*1e3;return new Promise((i,c)=>{try{const u=s.transaction(["resetTokens"],"readwrite").objectStore("resetTokens").add({token:n,userId:e,email:r,expires:a,createdAt:new Date().toISOString()});u.onsuccess=()=>i(n),u.onerror=x=>{const h=x.target.error;console.error("Failed to create reset token:",h),c(h||new Error("Failed to create reset token in database"))}}catch(d){console.error("Failed to create reset token:",d),c(d)}})}async getResetToken(e){const r=await this.ensureDB();return r.objectStoreNames.contains("resetTokens")?new Promise((s,n)=>{try{const c=r.transaction(["resetTokens"],"readonly").objectStore("resetTokens").get(e);c.onsuccess=()=>{const d=c.result;if(!d){s(null);return}if(d.expires<Date.now()){s(null);return}s({userId:d.userId,email:d.email})},c.onerror=()=>{console.warn("Failed to get reset token (non-critical):",c.error),s(null)}}catch(a){console.warn("Failed to get reset token (non-critical):",a),s(null)}}):null}async deleteResetToken(e){const r=await this.ensureDB();if(r.objectStoreNames.contains("resetTokens"))return new Promise((s,n)=>{try{const c=r.transaction(["resetTokens"],"readwrite").objectStore("resetTokens").delete(e);c.onsuccess=()=>s(),c.onerror=()=>{console.warn("Failed to delete reset token (non-critical):",c.error),s()}}catch(a){console.warn("Failed to delete reset token (non-critical):",a),s()}})}async cleanupExpiredTokens(){const e=await this.ensureDB();if(e.objectStoreNames.contains("resetTokens"))return new Promise((r,s)=>{try{const a=e.transaction(["resetTokens"],"readwrite").objectStore("resetTokens");if(!a.indexNames.contains("expires")){r();return}const c=a.index("expires").openCursor();c.onsuccess=d=>{const m=d.target.result;m?(m.value.expires<Date.now()&&m.delete(),m.continue()):r()},c.onerror=()=>{console.warn("Failed to cleanup expired tokens (non-critical):",c.error),r()}}catch(n){console.warn("Failed to cleanup expired tokens (non-critical):",n),r()}})}async saveFeelingLog(e){const r=await this.ensureDB();return r.objectStoreNames.contains("feelingLogs")?new Promise((s,n)=>{try{const i=r.transaction(["feelingLogs"],"readwrite").objectStore("feelingLogs"),c={id:e.id,timestamp:e.timestamp,emotion:e.emotion||e.emotionalState||"",subEmotion:e.subEmotion!==void 0?e.subEmotion:e.selectedFeeling||null,jsonIn:e.jsonIn||"",jsonOut:e.jsonOut||"",focusLens:e.focusLens||"",reflection:e.reflection||"",selfAdvocacy:e.selfAdvocacy||"",frequency:e.frequency||"daily",jsonAssessment:e.jsonAssessment||"",emotionalState:e.emotionalState||e.emotion||"",selectedFeeling:e.selectedFeeling!==void 0?e.selectedFeeling:e.subEmotion||null,aiResponse:e.aiResponse||e.jsonOut||"",isAIResponse:e.isAIResponse!==void 0?e.isAIResponse:!0,lowStateCount:e.lowStateCount||0},d=i.put(c);d.onsuccess=()=>s(),d.onerror=()=>n(d.error)}catch(a){console.error("Error saving feeling log:",a),s()}}):(console.warn("feelingLogs object store does not exist"),Promise.resolve())}async saveRuleBasedUsage(e){const r=await this.ensureDB();return r.objectStoreNames.contains("ruleBasedUsageLogs")?new Promise((s,n)=>{try{const c=r.transaction(["ruleBasedUsageLogs"],"readwrite").objectStore("ruleBasedUsageLogs").add(e);c.onsuccess=()=>s(),c.onerror=()=>{console.error("Failed to save rule-based usage log:",c.error),s()}}catch(a){console.error("Error saving rule-based usage log:",a),s()}}):(console.warn("ruleBasedUsageLogs object store does not exist - skipping save (non-critical)"),Promise.resolve())}async getRuleBasedUsageLogs(e,r){const s=await this.ensureDB();return s.objectStoreNames.contains("ruleBasedUsageLogs")?new Promise((n,a)=>{try{const d=s.transaction(["ruleBasedUsageLogs"],"readonly").objectStore("ruleBasedUsageLogs").index("timestamp");let m=null;if(r){const x=new Date;x.setDate(x.getDate()-r),m=IDBKeyRange.lowerBound(x.toISOString())}const u=m?d.getAll(m):d.getAll();u.onsuccess=()=>{let x=u.result||[];e&&(x=x.slice(0,e)),n(x)},u.onerror=()=>a(u.error)}catch(i){console.error("Error getting rule-based usage logs:",i),n([])}}):Promise.resolve([])}async getFeelingLogs(e){const r=await this.ensureDB();return new Promise((s,n)=>{const d=r.transaction(["feelingLogs"],"readonly").objectStore("feelingLogs").index("timestamp").openCursor(null,"prev"),m=[];d.onsuccess=u=>{const x=u.target.result;x&&(!e||m.length<e)?(m.push(x.value),x.continue()):s(m)},d.onerror=()=>n(d.error)})}async getFeelingLogsByState(e,r){const s=await this.ensureDB();return new Promise((n,a)=>{const m=s.transaction(["feelingLogs"],"readonly").objectStore("feelingLogs").index("emotionalState").openCursor(IDBKeyRange.only(e)),u=[];m.onsuccess=x=>{const h=x.target.result;h&&(!r||u.length<r)?(u.push(h.value),h.continue()):n(u)},m.onerror=()=>a(m.error)})}async saveUserInteraction(e){const r=await this.ensureDB();return new Promise((s,n)=>{const c=r.transaction(["userInteractions"],"readwrite").objectStore("userInteractions").add(e);c.onsuccess=()=>s(),c.onerror=()=>n(c.error)})}async getUserInteractions(e,r){const s=await this.ensureDB();return new Promise((n,a)=>{const c=s.transaction(["userInteractions"],"readonly").objectStore("userInteractions"),d=e?c.index("sessionId"):c.index("timestamp"),m=e?d.openCursor(IDBKeyRange.only(e)):d.openCursor(null,"prev"),u=[];m.onsuccess=x=>{const h=x.target.result;h&&(!r||u.length<r)?(u.push(h.value),h.continue()):n(u)},m.onerror=()=>a(m.error)})}async saveSession(e){const r=await this.ensureDB();return new Promise((s,n)=>{const c=r.transaction(["sessions"],"readwrite").objectStore("sessions").add(e);c.onsuccess=()=>s(),c.onerror=()=>n(c.error)})}async updateSession(e,r){const s=await this.ensureDB();return new Promise((n,a)=>{const c=s.transaction(["sessions"],"readwrite").objectStore("sessions"),d=c.get(e);d.onsuccess=()=>{const m=d.result;if(m){Object.assign(m,r);const u=c.put(m);u.onsuccess=()=>n(),u.onerror=()=>a(u.error)}else a(new Error("Session not found"))},d.onerror=()=>a(d.error)})}async getSessions(e,r){const s=await this.ensureDB();return new Promise((n,a)=>{const m=s.transaction(["sessions"],"readonly").objectStore("sessions").index("userId").openCursor(IDBKeyRange.only(e),"prev"),u=[];m.onsuccess=x=>{const h=x.target.result;h&&(!r||u.length<r)?(u.push(h.value),h.continue()):n(u)},m.onerror=()=>a(m.error)})}async getSessionsByValue(e,r){const s=await this.ensureDB();return new Promise((n,a)=>{const m=s.transaction(["sessions"],"readonly").objectStore("sessions").index("valueId").openCursor(IDBKeyRange.only(e),"prev"),u=[];m.onsuccess=x=>{const h=x.target.result;h&&(!r||u.length<r)?(u.push(h.value),h.continue()):n(u)},m.onerror=()=>a(m.error)})}async getFeelingPatterns(e,r){const s=await this.ensureDB();return new Promise((n,a)=>{const m=s.transaction(["feelingLogs"],"readonly").objectStore("feelingLogs").index("timestamp").openCursor(IDBKeyRange.bound(e,r)),u={};m.onsuccess=x=>{const h=x.target.result;if(h){const g=h.value.emotionalState;u[g]=(u[g]||0)+1,h.continue()}else n(Object.entries(u).map(([g,k])=>({state:g,count:k})))},m.onerror=()=>a(m.error)})}async getProgressMetrics(e,r){const s=await this.ensureDB();return new Promise((n,a)=>{const m=s.transaction(["sessions"],"readonly").objectStore("sessions").index("startTimestamp").openCursor(IDBKeyRange.bound(e,r)),u=[];m.onsuccess=x=>{const h=x.target.result;if(h)u.push(h.value),h.continue();else{const g=u.length,k=u.filter(w=>w.duration!==void 0),C=k.length>0?k.reduce((w,T)=>w+(T.duration||0),0)/k.length:0,A=[...new Set(u.map(w=>w.valueId))];n({totalSessions:g,averageDuration:C,valuesEngaged:A})}},m.onerror=()=>a(m.error)})}async getFeelingFrequency(e){const r=await this.ensureDB();return new Promise((s,n)=>{const c=r.transaction(["feelingLogs"],"readonly").objectStore("feelingLogs").openCursor(null,"prev"),d={};let m=0;c.onsuccess=u=>{const x=u.target.result;if(x&&(!e||m<e)){const h=x.value.selectedFeeling;h&&(d[h]=(d[h]||0)+1),m++,x.continue()}else s(Object.entries(d).map(([h,g])=>({feeling:h,count:g})).sort((h,g)=>g.count-h.count))},c.onerror=()=>n(c.error)})}};l(dt,"DatabaseService");let Ze=dt;const me=new Ze,At=Object.freeze(Object.defineProperty({__proto__:null,dbService:me},Symbol.toStringTag,{value:"Module"})),ye="app_version",Ae="install_date",je="last_update",ie="1.13.5",ut=class ut{async initialize(){const e=localStorage.getItem(ye),r=localStorage.getItem(Ae);localStorage.getItem(je);const s=!e&&!r,n=e!==null&&e!==ie;if(s)localStorage.setItem(ye,ie),localStorage.setItem(Ae,new Date().toISOString()),localStorage.setItem(je,new Date().toISOString()),console.log(`âœ… New installation detected: v${ie}`);else if(n){const a=e;localStorage.setItem(ye,ie),localStorage.setItem(je,new Date().toISOString()),console.log(`ðŸ”„ Update detected: v${a} â†’ v${ie}`),await this.runMigrations(a,ie)}else console.log(`âœ… App version unchanged: v${ie}`);return{isNewInstall:s,isUpdate:n,previousVersion:e,currentVersion:ie,installDate:r,lastUpdateDate:localStorage.getItem(je)}}async runMigrations(e,r){console.log(`ðŸ”„ Running migrations from v${e} to v${r}`);try{const s=l((a,i)=>{const c=a.split(".").map(Number),d=i.split(".").map(Number);for(let m=0;m<Math.max(c.length,d.length);m++){const u=c[m]||0,x=d[m]||0;if(u<x)return-1;if(u>x)return 1}return 0},"versionCompare"),n=[{version:"1.12.26",migrate:l(async()=>{console.log("  â†’ Migration 1.12.26: Ensuring feelingLogs store exists")},"migrate")},{version:"1.12.27",migrate:l(async()=>{console.log("  â†’ Migration 1.12.27: Adding userInteractions and sessions stores");try{await me.init()}catch(a){console.warn("Database re-initialization warning:",a)}},"migrate")}];for(const a of n)s(e,a.version)<0&&s(r,a.version)>=0&&await a.migrate();console.log("âœ… Migrations completed successfully")}catch(s){console.error("âŒ Migration error:",s)}}getUpdateInfo(){const e=localStorage.getItem(ye),r=localStorage.getItem(Ae),s=localStorage.getItem(je);return{isNewInstall:!e&&!r,isUpdate:e!==null&&e!==ie,previousVersion:e,currentVersion:ie,installDate:r,lastUpdateDate:s}}getCurrentVersion(){return ie}isNewInstall(){const e=localStorage.getItem(ye),r=localStorage.getItem(Ae);return!e&&!r}isUpdate(){const e=localStorage.getItem(ye);return e!==null&&e!==ie}};l(ut,"UpdateManager");let et=ut;const Pt=new et,jr=Object.freeze(Object.defineProperty({__proto__:null,updateManager:Pt},Symbol.toStringTag,{value:"Module"}));function Ke(){if(typeof window>"u")return!1;const o=window.navigator.userAgent,e=/^((?!chrome|android).)*safari/i.test(o),r=/Macintosh|MacIntel|MacPPC|Mac68K/i.test(o),s=/iPad|iPhone|iPod/.test(o);return e&&(r||s)}l(Ke,"isSafari");function Nr(){return typeof window>"u"?!1:/Macintosh|MacIntel|MacPPC|Mac68K/i.test(window.navigator.userAgent)}l(Nr,"isMacOS");const Sr=l(()=>{const[o,e]=p.useState(null),[r,s]=p.useState(!1),[n,a]=p.useState(!1),[i,c]=p.useState(!1),[d,m]=p.useState(!1),[u,x]=p.useState(null);p.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone){a(!0);return}const k=Pt.getUpdateInfo();x({isNewInstall:k.isNewInstall,isUpdate:k.isUpdate,currentVersion:k.currentVersion}),c(Ke()),m(Nr());const C=l(w=>{w.preventDefault(),e(w);const T=localStorage.getItem("pwa-install-dismissed");if(T){const D=parseInt(T,10);if((Date.now()-D)/(1e3*60*60*24)<7)return}setTimeout(()=>s(!0),3e3)},"handleBeforeInstallPrompt");if(window.addEventListener("beforeinstallprompt",C),Ke()){const w=localStorage.getItem("pwa-install-dismissed");if(w){const T=parseInt(w,10);if((Date.now()-T)/(1e3*60*60*24)<7)return}setTimeout(()=>s(!0),3e3)}const A=localStorage.getItem("pwa-install-dismissed");if(A&&!Ke()){const w=parseInt(A,10);(Date.now()-w)/(1e3*60*60*24)<7&&s(!1)}return()=>{window.removeEventListener("beforeinstallprompt",C)}},[]);const h=l(async()=>{if(!o)return;o.prompt();const{outcome:k}=await o.userChoice;k==="accepted"?(a(!0),s(!1)):(localStorage.setItem("pwa-install-dismissed",Date.now().toString()),s(!1)),e(null)},"handleInstallClick"),g=l(()=>{localStorage.setItem("pwa-install-dismissed",Date.now().toString()),s(!1)},"handleDismiss");return n||!r?null:i?t.jsx("div",{className:"fixed bottom-20 left-0 right-0 z-50 px-4 sm:px-6 lg:bottom-4 lg:left-auto lg:right-4 lg:max-w-md",children:t.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary border border-border-soft dark:border-dark-border rounded-xl shadow-2xl p-4 sm:p-6 space-y-4",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-navy-primary dark:bg-yellow-warm rounded-lg flex items-center justify-center",children:t.jsx("img",{src:"/ac-minds-logo.png",alt:"AC MINDS",className:"w-8 h-8 object-contain"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-sm font-black text-text-primary dark:text-white mb-1",children:"Install Grounded on Safari"}),t.jsxs("p",{className:"text-xs text-text-secondary dark:text-text-secondary mb-2",children:["Safari doesn't show an install button in the address bar. Follow these steps to add Grounded to your ",d?"Dock":"Home Screen"," for future use:"]}),u&&u.isUpdate&&t.jsxs("div",{className:"mb-3 p-2 bg-yellow-warm/10 dark:bg-yellow-warm/20 border border-yellow-warm/30 rounded-lg",children:[t.jsxs("p",{className:"text-xs font-semibold text-yellow-warm dark:text-yellow-warm",children:["ðŸ”„ Update Available: v",u.currentVersion]}),t.jsx("p",{className:"text-xs text-text-primary/80 dark:text-white/80 mt-1",children:"Installing updates preserves all your existing data. Your reflections, goals, and settings will remain intact."})]}),u&&u.isNewInstall&&t.jsxs("div",{className:"mb-3 p-2 bg-calm-sage/10 dark:bg-calm-sage/20 border border-calm-sage/30 rounded-lg",children:[t.jsx("p",{className:"text-xs font-semibold text-calm-sage dark:text-calm-sage",children:"âœ¨ Fresh Install"}),t.jsx("p",{className:"text-xs text-text-primary/80 dark:text-white/80 mt-1",children:"This is a new installation. The app will check for updates automatically and preserve your data when updates are available."})]}),t.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"text-white text-xs font-bold",children:"1"})}),t.jsx("p",{className:"text-xs font-semibold text-blue-900 dark:text-blue-200",children:d?"macOS Safari Instructions:":"iOS Safari Instructions:"})]}),t.jsx("ol",{className:"text-xs text-blue-800 dark:text-blue-300 space-y-2.5 ml-8",children:d?t.jsxs(t.Fragment,{children:[t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"1."}),t.jsxs("span",{children:["Click the ",t.jsx("strong",{className:"text-blue-900 dark:text-blue-100",children:"Share button"})," (square with arrow) in the Safari toolbar at the top"]})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"2."}),t.jsxs("span",{children:["In the menu, select ",t.jsx("strong",{className:"text-blue-900 dark:text-blue-100",children:'"Add to Dock"'})," (recommended) or ",t.jsx("strong",{className:"text-blue-900 dark:text-blue-100",children:'"Add to Home Screen"'})]})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"3."}),t.jsxs("span",{children:["Click ",t.jsx("strong",{className:"text-blue-900 dark:text-blue-100",children:'"Add"'})," in the confirmation dialog"]})]}),t.jsxs("li",{className:"flex items-start gap-2 pt-1 border-t border-blue-200 dark:border-blue-700",children:[t.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"âœ“"}),t.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:"The app icon will appear in your Dock and can be launched like any other app!"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"1."}),t.jsxs("span",{children:["Tap the ",t.jsx("strong",{className:"text-blue-900 dark:text-blue-100",children:"Share button"})," (square with arrow pointing up) at the bottom of Safari"]})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"2."}),t.jsxs("span",{children:["Scroll down in the Share menu and tap ",t.jsx("strong",{className:"text-blue-900 dark:text-blue-100",children:'"Add to Home Screen"'})]})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"3."}),t.jsxs("span",{children:["Tap ",t.jsx("strong",{className:"text-blue-900 dark:text-blue-100",children:'"Add"'})," in the top right corner to confirm"]})]}),t.jsxs("li",{className:"flex items-start gap-2 pt-1 border-t border-blue-200 dark:border-blue-700",children:[t.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"âœ“"}),t.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:"The app icon will appear on your home screen and can be launched like any other app!"})]})]})})]})]}),t.jsx("button",{onClick:g,className:"flex-shrink-0 w-6 h-6 flex items-center justify-center text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white","aria-label":"Dismiss",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"flex gap-2 pt-2 border-t border-border-soft dark:border-dark-border",children:[t.jsx("button",{onClick:g,className:"flex-1 px-4 py-2.5 text-xs font-bold text-text-secondary dark:text-text-secondary hover:text-text-primary dark:hover:text-white border border-border-soft dark:border-dark-border rounded-lg transition-colors",children:"Not Now"}),t.jsx("button",{onClick:g,className:"flex-1 px-4 py-2.5 bg-navy-primary text-white text-xs font-black uppercase tracking-widest rounded-lg hover:opacity-90 transition-opacity",children:"Got It"})]})]})}):o?t.jsx("div",{className:"fixed bottom-20 left-0 right-0 z-50 px-4 sm:px-6 lg:bottom-4 lg:left-auto lg:right-4 lg:max-w-sm",children:t.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary border border-border-soft dark:border-dark-border rounded-xl shadow-2xl p-4 sm:p-6 space-y-3",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-navy-primary dark:bg-yellow-warm rounded-lg flex items-center justify-center",children:t.jsx("img",{src:"/ac-minds-logo.png",alt:"AC MINDS",className:"w-8 h-8 object-contain"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-sm font-black text-text-primary dark:text-white mb-1",children:"Install Grounded"}),t.jsx("p",{className:"text-xs text-text-secondary dark:text-text-secondary mb-2",children:"Install this app on your device for a better experience. Works offline and loads faster."}),t.jsx("p",{className:"text-xs text-text-tertiary dark:text-text-tertiary italic mb-2",children:"ðŸ’¡ Tip: You can also install via the install icon (âž•) in your browser's address bar."}),u&&u.isUpdate&&t.jsxs("div",{className:"mt-2 p-2 bg-yellow-warm/10 dark:bg-yellow-warm/20 border border-yellow-warm/30 rounded-lg",children:[t.jsxs("p",{className:"text-xs font-semibold text-yellow-warm dark:text-yellow-warm",children:["ðŸ”„ Update Available: v",u.currentVersion]}),t.jsx("p",{className:"text-xs text-text-primary/80 dark:text-white/80 mt-1",children:"Installing updates preserves all your existing data automatically."})]}),u&&u.isNewInstall&&t.jsxs("div",{className:"mt-2 p-2 bg-calm-sage/10 dark:bg-calm-sage/20 border border-calm-sage/30 rounded-lg",children:[t.jsx("p",{className:"text-xs font-semibold text-calm-sage dark:text-calm-sage",children:"âœ¨ New Installation"}),t.jsx("p",{className:"text-xs text-text-primary/80 dark:text-white/80 mt-1",children:"The app will automatically check for updates and preserve your data when updates are available."})]})]}),t.jsx("button",{onClick:g,className:"flex-shrink-0 w-6 h-6 flex items-center justify-center text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white","aria-label":"Dismiss",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:g,className:"flex-1 px-4 py-2 text-xs font-bold text-text-secondary dark:text-text-secondary hover:text-text-primary dark:hover:text-white border border-border-soft dark:border-dark-border rounded-lg",children:"Not Now"}),t.jsx("button",{onClick:h,className:"flex-1 px-4 py-2 bg-navy-primary text-white text-xs font-black uppercase tracking-widest rounded-lg hover:opacity-90",children:"Install"})]})]})}):null},"PWAInstallPrompt"),Ir=l(({className:o=""})=>{const[e,r]=p.useState(!1),[s,n]=p.useState(null),[a,i]=p.useState(""),[c,d]=p.useState(!1),[m,u]=p.useState(!1),x=[{emoji:"ðŸ˜",label:"Love it"},{emoji:"ðŸ˜Š",label:"Happy"},{emoji:"ðŸ˜",label:"Neutral"},{emoji:"ðŸ˜•",label:"Unhappy"},{emoji:"ðŸ˜¢",label:"Very unhappy"}],h=l(async()=>{if(!s&&!a.trim())return;const g=x.find(T=>T.emoji===s)?.label||"None";let k=`Feedback for Grounded App

Rating: ${s||"None"} (${g})

Feedback:
${a.trim()||"(No additional feedback provided)"}

`;if(m)try{const{dbService:T}=await ae(async()=>{const{dbService:j}=await Promise.resolve().then(()=>At);return{dbService:j}},void 0),D=await T.getRuleBasedUsageLogs(10,7);if(D.length>0){const j={},z=[],q={};D.forEach(S=>{j[S.operationType]=(j[S.operationType]||0)+1;const W=`${S.operationType}-${S.emotionalState||"unknown"}`;q[W]=(q[W]||0)+1}),Object.entries(q).forEach(([S,W])=>{const[v,b]=S.split("-");z.push({operationType:v,emotionalState:b,count:W})}),z.sort((S,W)=>W.count-S.count),k+=`---
Rule-Based Usage Data (with consent):
Total Uses: ${D.length}
By Operation Type:
${Object.entries(j).map(([S,W])=>`  - ${S}: ${W}`).join(`
`)}
Most Common Scenarios:
${z.slice(0,5).map(S=>`  - ${S.operationType} (${S.emotionalState}): ${S.count}`).join(`
`)}

Sample Entries (anonymized, last ${Math.min(D.length,3)}):
`,D.slice(0,3).forEach((S,W)=>{const v={operationType:S.operationType,emotionalState:S.emotionalState,subEmotion:S.subEmotion,valueCategory:S.valueCategory,frequency:S.frequency,fallbackKey:S.fallbackKey,aiUnavailableReason:S.aiUnavailableReason,timestamp:S.timestamp};k+=`
Sample ${W+1}:
${JSON.stringify(v,null,2)}
`}),k+=`
---
`}}catch(T){console.warn("Failed to include rule-based usage data:",T),k+=`
(Note: Could not include rule-based usage data)

`}k+=`---
App Version: 1.12.27
Timestamp: ${new Date().toISOString()}`;const C=encodeURIComponent("Grounded App Feedback"),A=encodeURIComponent(k),w=`mailto:ac.minds.ai@gmail.com?subject=${C}&body=${A}`;window.location.href=w,d(!0),setTimeout(()=>{r(!1),d(!1),n(null),i(""),u(!1)},2e3)},"handleSubmit");return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:l(()=>r(!0),"onClick"),className:`
          fixed bottom-20 right-4 sm:bottom-6 sm:right-6
          w-14 h-14 sm:w-16 sm:h-16
          bg-navy-primary dark:bg-navy-primary
          text-white
          rounded-full
          shadow-2xl
          flex items-center justify-center
          hover:scale-110 active:scale-95
          transition-all duration-200
          z-40
          ${o}
        `,"aria-label":"Send Feedback",title:"Send Feedback",children:t.jsx("svg",{className:"w-6 h-6 sm:w-7 sm:h-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})}),e&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm animate-fade-in",onClick:l(()=>!c&&r(!1),"onClick"),children:t.jsx("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-md rounded-[40px] shadow-2xl overflow-hidden animate-pop relative border border-border-soft dark:border-dark-border",onClick:l(g=>g.stopPropagation(),"onClick"),children:c?t.jsxs("div",{className:"p-12 text-center",children:[t.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx("span",{className:"text-4xl",children:"âœ…"})}),t.jsx("h3",{className:"text-xl font-black text-text-primary dark:text-white mb-2",children:"Thank You!"}),t.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary",children:"Your feedback has been prepared. Check your email client to send it."})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-6 border-b border-border-soft dark:border-dark-border flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-black text-text-primary dark:text-white",children:"Send Feedback"}),t.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary mt-1",children:"Help us improve Grounded"})]}),t.jsx("button",{onClick:l(()=>r(!1),"onClick"),className:"w-10 h-10 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 block",children:"How do you feel about Grounded?"}),t.jsx("div",{className:"flex items-center justify-around gap-2",children:x.map(g=>t.jsxs("button",{onClick:l(()=>n(g.emoji),"onClick"),className:`
                            flex flex-col items-center justify-center
                            w-16 h-16 sm:w-20 sm:h-20
                            rounded-2xl
                            transition-all duration-200
                            ${s===g.emoji?"bg-yellow-warm dark:bg-yellow-warm scale-110 shadow-lg":"bg-bg-secondary dark:bg-dark-bg-secondary hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary"}
                            active:scale-95
                          `,"aria-label":g.label,children:[t.jsx("span",{className:"text-3xl sm:text-4xl mb-1",children:g.emoji}),t.jsx("span",{className:`text-xs sm:text-sm font-semibold ${s===g.emoji?"text-text-primary dark:text-text-primary":"text-text-secondary dark:text-text-secondary"}`,children:g.label})]},g.emoji))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-black text-text-primary dark:text-white uppercase tracking-widest mb-3 block",children:"Additional Feedback (Optional)"}),t.jsx("textarea",{value:a,onChange:l(g=>i(g.target.value),"onChange"),placeholder:"Tell us what you think, what you'd like to see, or any issues you've encountered...",className:"w-full p-4 rounded-2xl bg-bg-secondary dark:bg-dark-bg-secondary border border-border-soft dark:border-dark-border focus:ring-2 focus:ring-navy-primary/30 dark:focus:ring-navy-primary/50 outline-none text-text-primary dark:text-white min-h-[120px] resize-none text-sm",maxLength:1e3}),t.jsxs("p",{className:"text-xs text-text-tertiary dark:text-text-tertiary mt-2 text-right",children:[a.length,"/1000"]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-4 bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl border border-border-soft dark:border-dark-border",children:[t.jsx("input",{type:"checkbox",id:"includeUsageData",checked:m,onChange:l(g=>u(g.target.checked),"onChange"),className:"mt-1 w-5 h-5 rounded border-2 border-text-primary/30 dark:border-white/30 text-navy-primary focus:ring-2 focus:ring-navy-primary/50 cursor-pointer"}),t.jsxs("label",{htmlFor:"includeUsageData",className:"flex-1 text-xs sm:text-sm text-text-primary dark:text-white leading-relaxed cursor-pointer",children:[t.jsx("span",{className:"font-bold",children:"Include rule-based usage data"})," to help improve responses. This includes anonymized information about when rule-based fallbacks were used (no personal reflection content)."]})]})]}),t.jsxs("div",{className:"p-6 border-t border-border-soft dark:border-dark-border",children:[t.jsx("button",{onClick:h,disabled:!s&&!a.trim(),className:`
                      w-full px-6 py-4 rounded-2xl text-xs font-black uppercase tracking-widest
                      transition-all
                      ${s||a.trim()?"bg-navy-primary text-white hover:opacity-90 shadow-lg":"bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary cursor-not-allowed"}
                    `,children:"Send Feedback"}),t.jsx("p",{className:"text-xs text-text-tertiary dark:text-text-tertiary text-center mt-3",children:"Opens your email client to send feedback"})]})]})})})]})},"FeedbackButton"),Er=l(({onConfirm:o,onCancel:e})=>t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm animate-fade-in",onClick:e,children:t.jsx("div",{className:"bg-white dark:bg-dark-bg-primary w-full max-w-md rounded-[40px] shadow-2xl overflow-hidden animate-pop relative border border-border-soft dark:border-dark-border",onClick:l(r=>r.stopPropagation(),"onClick"),children:t.jsx("div",{className:"p-6 sm:p-8 space-y-6",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("div",{className:"w-16 h-16 bg-yellow-warm/20 dark:bg-yellow-warm/30 rounded-full flex items-center justify-center mx-auto",children:t.jsx("span",{className:"text-3xl",children:"âš ï¸"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-black text-text-primary dark:text-white mb-2",children:"Existing Database Found"}),t.jsxs("p",{className:"text-sm sm:text-base text-text-secondary dark:text-text-secondary",children:["An existing on-device database for ",t.jsx("strong",{children:"Grounded"})," already exists."]})]}),t.jsxs("div",{className:"bg-bg-secondary dark:bg-dark-bg-secondary rounded-xl p-4 text-left space-y-2",children:[t.jsx("p",{className:"text-sm font-bold text-text-primary dark:text-white",children:"âš ï¸ Important Notice"}),t.jsx("p",{className:"text-xs sm:text-sm text-text-secondary dark:text-text-secondary",children:"Proceeding with this app will remove the old database and replace it with a new database just for this application."}),t.jsx("p",{className:"text-xs sm:text-sm text-text-secondary dark:text-text-secondary mt-2",children:t.jsx("strong",{children:"All existing data in the old database will be lost."})})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[t.jsx("button",{onClick:e,className:"flex-1 px-6 py-3 rounded-xl text-sm font-black uppercase tracking-widest bg-yellow-warm text-text-primary hover:opacity-90 transition-all shadow-lg",children:"Skip (Use Existing)"}),t.jsx("button",{onClick:o,className:"flex-1 px-6 py-3 rounded-xl text-sm font-bold uppercase tracking-widest bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white hover:opacity-90 transition-all",children:"Reset Database"})]})]})})})}),"DatabaseMigrationModal"),mt=class mt{constructor(e){this.dbService=e}async init(){return this.dbService.init()}async createUser(e){return this.dbService.createUser(e)}async getUserByUsername(e){return this.dbService.getUserByUsername(e)}async getUserByEmail(e){return this.dbService.getUserByEmail(e)}async getUserById(e){return this.dbService.getUserById(e)}async updateUser(e,r){return this.dbService.updateUser(e,r)}async getAppData(e){return this.dbService.getAppData(e)}async saveAppData(e,r){return this.dbService.saveAppData(e,r)}async createResetToken(e,r){return this.dbService.createResetToken(e,r)}async getResetToken(e){return this.dbService.getResetToken(e)}async deleteResetToken(e){return this.dbService.deleteResetToken(e)}async cleanupExpiredTokens(){return this.dbService.cleanupExpiredTokens()}async saveFeelingLog(e){return this.dbService.saveFeelingLog(e)}async getFeelingLogs(e){return this.dbService.getFeelingLogs(e)}async getFeelingLogsByState(e,r){return this.dbService.getFeelingLogsByState(e,r)}async saveUserInteraction(e){return this.dbService.saveUserInteraction(e)}async getUserInteractions(e,r){return this.dbService.getUserInteractions(e,r)}async saveSession(e){return this.dbService.saveSession(e)}async updateSession(e,r){return this.dbService.updateSession(e,r)}async getSessions(e,r){return this.dbService.getSessions(e,r)}async getSessionsByValue(e,r){return this.dbService.getSessionsByValue(e,r)}async getFeelingPatterns(e,r){return this.dbService.getFeelingPatterns(e,r)}async getProgressMetrics(e,r){return this.dbService.getProgressMetrics(e,r)}async getFeelingFrequency(e){return this.dbService.getFeelingFrequency(e)}};l(mt,"LegacyAdapter");let Be=mt;const pt=class pt{constructor(e){this.encryptedDb=e}async init(){return Promise.resolve()}generateUUID(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const r=Math.random()*16|0;return(e==="x"?r:r&3|8).toString(16)})}async createUser(e){const r=this.generateUUID(),s=new Date().toISOString();return await this.encryptedDb.execute(`INSERT INTO users_encrypted (id, username, password_hash, email, therapist_emails, terms_accepted, terms_accepted_date, created_at, last_login)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,[r,e.username,e.passwordHash,e.email||null,JSON.stringify(e.therapistEmails||[]),e.termsAccepted?1:0,e.termsAcceptedDate||null,s,null]),await this.encryptedDb.auditLog("user_created","users_encrypted",r,`User ${e.username} created`),await this.encryptedDb.save(),r}async getUserByUsername(e){const r=await this.encryptedDb.query("SELECT * FROM users_encrypted WHERE username = ?",[e]);if(r.length===0)return null;const s=r[0];return{id:s.id,username:s.username,passwordHash:s.password_hash,email:s.email,therapistEmails:s.therapist_emails?JSON.parse(s.therapist_emails):[],termsAccepted:s.terms_accepted===1,termsAcceptedDate:s.terms_accepted_date||void 0,createdAt:s.created_at,lastLogin:s.last_login||void 0}}async getUserByEmail(e){const r=await this.encryptedDb.query("SELECT * FROM users_encrypted WHERE email = ?",[e]);if(r.length===0)return null;const s=r[0];return{id:s.id,username:s.username,passwordHash:s.password_hash,email:s.email,therapistEmails:s.therapist_emails?JSON.parse(s.therapist_emails):[],termsAccepted:s.terms_accepted===1,termsAcceptedDate:s.terms_accepted_date||void 0,createdAt:s.created_at,lastLogin:s.last_login||void 0}}async getUserById(e){const r=await this.encryptedDb.query("SELECT * FROM users_encrypted WHERE id = ?",[e]);if(r.length===0)return null;const s=r[0];return{id:s.id,username:s.username,passwordHash:s.password_hash,email:s.email,therapistEmails:s.therapist_emails?JSON.parse(s.therapist_emails):[],termsAccepted:s.terms_accepted===1,termsAcceptedDate:s.terms_accepted_date||void 0,createdAt:s.created_at,lastLogin:s.last_login||void 0}}async updateUser(e,r){const s=await this.getUserById(e);if(!s)throw new Error("User not found");const n={...s,...r};await this.encryptedDb.execute(`UPDATE users_encrypted 
       SET username = ?, password_hash = ?, email = ?, therapist_emails = ?, 
           terms_accepted = ?, terms_accepted_date = ?, last_login = ?
       WHERE id = ?`,[n.username,n.passwordHash,n.email||null,JSON.stringify(n.therapistEmails||[]),n.termsAccepted?1:0,n.termsAcceptedDate||null,n.lastLogin||null,e]),await this.encryptedDb.auditLog("user_updated","users_encrypted",e,"User updated"),await this.encryptedDb.save()}async getAppData(e){const r=await this.encryptedDb.query("SELECT * FROM app_data_encrypted WHERE user_id = ?",[e]);if(r.length===0)return null;const s=r[0];return{settings:s.settings?JSON.parse(s.settings):{},logs:s.logs?JSON.parse(s.logs):[],goals:s.goals?JSON.parse(s.goals):[],values:s.values?JSON.parse(s.values):[],lcswConfig:s.lcsw_config?JSON.parse(s.lcsw_config):void 0}}async saveAppData(e,r){await this.encryptedDb.execute(`INSERT OR REPLACE INTO app_data_encrypted (user_id, settings, logs, goals, "values", lcsw_config, updated_at)
       VALUES (?, ?, ?, ?, ?, ?, ?)`,[e,JSON.stringify(r.settings),JSON.stringify(r.logs),JSON.stringify(r.goals),JSON.stringify(r.values),JSON.stringify(r.lcswConfig||{}),new Date().toISOString()]),await this.encryptedDb.auditLog("app_data_saved","app_data_encrypted",e,"App data saved"),await this.encryptedDb.save()}async createResetToken(e,r){const s=this.generateUUID(),n=Date.now()+1440*60*1e3;return await this.encryptedDb.execute(`INSERT INTO reset_tokens_encrypted (token, user_id, email, expires, created_at)
       VALUES (?, ?, ?, ?, ?)`,[s,e,r,n,new Date().toISOString()]),await this.encryptedDb.auditLog("reset_token_created","reset_tokens_encrypted",s,`Token created for user ${e}`),await this.encryptedDb.save(),s}async getResetToken(e){const r=await this.encryptedDb.query("SELECT * FROM reset_tokens_encrypted WHERE token = ?",[e]);if(r.length===0)return null;const s=r[0];return s.expires<Date.now()?null:{userId:s.user_id,email:s.email}}async deleteResetToken(e){await this.encryptedDb.execute("DELETE FROM reset_tokens_encrypted WHERE token = ?",[e]),await this.encryptedDb.auditLog("reset_token_deleted","reset_tokens_encrypted",e,"Token deleted"),await this.encryptedDb.save()}async cleanupExpiredTokens(){await this.encryptedDb.execute("DELETE FROM reset_tokens_encrypted WHERE expires < ?",[Date.now()]),await this.encryptedDb.save()}async saveFeelingLog(e){await this.encryptedDb.execute(`INSERT INTO feeling_logs_encrypted (id, user_id, timestamp, emotional_state, selected_feeling, reflection_text, ai_analysis, created_at)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[e.id,null,e.timestamp,e.emotionalState,e.selectedFeeling,null,JSON.stringify({aiResponse:e.aiResponse,isAIResponse:e.isAIResponse,lowStateCount:e.lowStateCount}),new Date().toISOString()]),await this.encryptedDb.auditLog("feeling_log_saved","feeling_logs_encrypted",e.id,"Feeling log saved"),await this.encryptedDb.save()}async getFeelingLogs(e){let r="SELECT * FROM feeling_logs_encrypted ORDER BY timestamp DESC";return e&&(r+=` LIMIT ${e}`),(await this.encryptedDb.query(r)).map(n=>{const a=n.ai_analysis?JSON.parse(n.ai_analysis):{};return{id:n.id,userId:n.user_id,timestamp:n.timestamp,emotionalState:n.emotional_state,selectedFeeling:n.selected_feeling,reflectionText:n.reflection_text,aiAnalysis:a,aiResponse:a.aiResponse||"",isAIResponse:a.isAIResponse||!1,lowStateCount:a.lowStateCount||0,createdAt:n.created_at}})}async getFeelingLogsByState(e,r){let s="SELECT * FROM feeling_logs_encrypted WHERE emotional_state = ? ORDER BY timestamp DESC";return r&&(s+=` LIMIT ${r}`),(await this.encryptedDb.query(s,[e])).map(a=>{const i=a.ai_analysis?JSON.parse(a.ai_analysis):{};return{id:a.id,userId:a.user_id,timestamp:a.timestamp,emotionalState:a.emotional_state,selectedFeeling:a.selected_feeling,reflectionText:a.reflection_text,aiAnalysis:i,aiResponse:i.aiResponse||"",isAIResponse:i.isAIResponse||!1,lowStateCount:i.lowStateCount||0,createdAt:a.created_at}})}async saveUserInteraction(e){await this.encryptedDb.execute(`INSERT INTO user_interactions_encrypted (id, timestamp, type, session_id, user_id, value_id, emotional_state, selected_feeling, metadata, created_at)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[e.id,e.timestamp,e.type,e.sessionId,null,e.valueId||null,e.emotionalState||null,e.selectedFeeling||null,JSON.stringify(e.metadata||{}),new Date().toISOString()]),await this.encryptedDb.auditLog("user_interaction_saved","user_interactions_encrypted",e.id,`Interaction ${e.type} saved`),await this.encryptedDb.save()}async getUserInteractions(e,r){let s,n=[];return e?(s="SELECT * FROM user_interactions_encrypted WHERE session_id = ? ORDER BY timestamp DESC",n=[e]):s="SELECT * FROM user_interactions_encrypted ORDER BY timestamp DESC",r&&(s+=` LIMIT ${r}`),(await this.encryptedDb.query(s,n)).map(i=>({id:i.id,timestamp:i.timestamp,type:i.type,sessionId:i.session_id,valueId:i.value_id,emotionalState:i.emotional_state,selectedFeeling:i.selected_feeling,metadata:i.metadata?JSON.parse(i.metadata):{},createdAt:i.created_at}))}async saveSession(e){await this.encryptedDb.execute(`INSERT INTO sessions_encrypted (id, user_id, start_timestamp, end_timestamp, value_id, initial_emotional_state, final_emotional_state, selected_feeling, reflection_length, goal_created, duration, created_at)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[e.id,e.userId,e.startTimestamp,e.endTimestamp||null,e.valueId,e.initialEmotionalState||null,e.finalEmotionalState||null,e.selectedFeeling||null,e.reflectionLength||null,e.goalCreated?1:0,e.duration||null,new Date().toISOString()]),await this.encryptedDb.auditLog("session_saved","sessions_encrypted",e.id,"Session saved"),await this.encryptedDb.save()}async updateSession(e,r){const s=[],n=[];r.endTimestamp!==void 0&&(s.push("end_timestamp = ?"),n.push(r.endTimestamp)),r.finalEmotionalState!==void 0&&(s.push("final_emotional_state = ?"),n.push(r.finalEmotionalState)),r.reflectionLength!==void 0&&(s.push("reflection_length = ?"),n.push(r.reflectionLength)),r.goalCreated!==void 0&&(s.push("goal_created = ?"),n.push(r.goalCreated?1:0)),r.duration!==void 0&&(s.push("duration = ?"),n.push(r.duration)),s.length!==0&&(n.push(e),await this.encryptedDb.execute(`UPDATE sessions_encrypted SET ${s.join(", ")} WHERE id = ?`,n),await this.encryptedDb.auditLog("session_updated","sessions_encrypted",e,"Session updated"),await this.encryptedDb.save())}async getSessions(e,r){let s="SELECT * FROM sessions_encrypted WHERE user_id = ? ORDER BY start_timestamp DESC";return r&&(s+=` LIMIT ${r}`),(await this.encryptedDb.query(s,[e])).map(a=>({id:a.id,userId:a.user_id,startTimestamp:a.start_timestamp,endTimestamp:a.end_timestamp,valueId:a.value_id,initialEmotionalState:a.initial_emotional_state,finalEmotionalState:a.final_emotional_state,selectedFeeling:a.selected_feeling,reflectionLength:a.reflection_length,goalCreated:a.goal_created===1,duration:a.duration}))}async getSessionsByValue(e,r){let s="SELECT * FROM sessions_encrypted WHERE value_id = ? ORDER BY start_timestamp DESC";return r&&(s+=` LIMIT ${r}`),(await this.encryptedDb.query(s,[e])).map(a=>({id:a.id,userId:a.user_id,startTimestamp:a.start_timestamp,endTimestamp:a.end_timestamp,valueId:a.value_id,initialEmotionalState:a.initial_emotional_state,finalEmotionalState:a.final_emotional_state,selectedFeeling:a.selected_feeling,reflectionLength:a.reflection_length,goalCreated:a.goal_created===1,duration:a.duration}))}async getFeelingPatterns(e,r){return(await this.encryptedDb.query(`SELECT emotional_state as state, COUNT(*) as count 
       FROM feeling_logs_encrypted 
       WHERE timestamp >= ? AND timestamp <= ? 
       GROUP BY emotional_state`,[e,r])).map(n=>({state:n.state||"unknown",count:n.count}))}async getProgressMetrics(e,r){const s=await this.encryptedDb.query(`SELECT * FROM sessions_encrypted 
       WHERE start_timestamp >= ? AND start_timestamp <= ?`,[e,r]),n=s.length,a=s.filter(d=>d.duration!==null&&d.duration!==void 0),i=a.length>0?a.reduce((d,m)=>d+(m.duration||0),0)/a.length:0,c=[...new Set(s.map(d=>d.value_id))];return{totalSessions:n,averageDuration:i,valuesEngaged:c}}async getFeelingFrequency(e){let r=`SELECT selected_feeling as feeling, COUNT(*) as count 
               FROM feeling_logs_encrypted 
               WHERE selected_feeling IS NOT NULL 
               GROUP BY selected_feeling 
               ORDER BY count DESC`;return e&&(r+=` LIMIT ${e}`),(await this.encryptedDb.query(r)).map(n=>({feeling:n.feeling,count:n.count}))}};l(pt,"EncryptedAdapter");let tt=pt;function Ne(){if(localStorage.getItem("encryption_enabled")==="true"){const e=we.getInstance();return e?new tt(e):(console.warn("Encrypted database not initialized, falling back to legacy"),new Be(me))}return new Be(me)}l(Ne,"getDatabaseAdapter");const rt="grounded_legacy_backup",Tr=7;async function Rt(){try{let o;try{o=await se("groundedDB",5)}catch(n){if(n?.name==="VersionError"||n?.message?.includes("version")){const{dbService:a}=await ae(async()=>{const{dbService:i}=await Promise.resolve().then(()=>At);return{dbService:i}},void 0);return await a.init(),{hasLegacyData:!1,recordCount:0,tables:[]}}try{o=await se("groundedDB",4)}catch{return{hasLegacyData:!1,recordCount:0,tables:[]}}}const e=[];let r=0;for(const n of o.objectStoreNames){if(n==="metadata")continue;const i=await o.transaction(n,"readonly").objectStore(n).count();i>0&&(e.push(n),r+=i)}await o.close();const s=it();return{hasLegacyData:r>0,recordCount:r,tables:e,lastBackup:s?.timestamp}}catch{return{hasLegacyData:!1,recordCount:0,tables:[]}}}l(Rt,"detectLegacyData");async function Dr(){try{let o;try{o=await se("groundedDB",5)}catch(s){if(s?.name==="VersionError"||s?.message?.includes("version"))throw new Error("Database version mismatch - cannot create backup");o=await se("groundedDB",4)}const e={};for(const s of o.objectStoreNames){const a=await o.transaction(s,"readonly").objectStore(s).getAll();e[s]=a}await o.close();const r={timestamp:new Date().toISOString(),expiry:Date.now()+Tr*24*60*60*1e3,data:e};try{localStorage.setItem(rt,JSON.stringify(r))}catch(s){throw console.warn("Failed to save backup to localStorage:",s),new Error("Failed to create backup: localStorage may be full")}}catch(o){throw console.error("Error creating legacy backup:",o),o}}l(Dr,"createLegacyBackup");function it(){try{const o=localStorage.getItem(rt);if(!o)return null;const e=JSON.parse(o);return e.expiry&&Date.now()>e.expiry?(localStorage.removeItem(rt),null):{timestamp:e.timestamp,data:e.data}}catch(o){return console.error("Error reading legacy backup:",o),null}}l(it,"getLegacyBackup");async function _r(){const o=it();if(!o)throw new Error("No backup found or backup has expired");try{let e;try{e=await se("groundedDB",5)}catch(r){if(r?.name==="VersionError"||r?.message?.includes("version"))throw new Error("Database version mismatch - cannot restore backup");e=await se("groundedDB",4)}for(const r of e.objectStoreNames){if(r==="metadata")continue;await e.transaction(r,"readwrite").objectStore(r).clear()}for(const[r,s]of Object.entries(o.data)){if(!e.objectStoreNames.contains(r)){console.warn(`Store ${r} not found, skipping restore`);continue}const n=e.transaction(r,"readwrite").objectStore(r);for(const a of s)await n.put(a)}await e.close()}catch(e){throw console.error("Error restoring legacy backup:",e),e}}l(_r,"restoreLegacyBackup");function St(){return it()!==null}l(St,"hasValidBackup");const gt=class gt{static async validateLegacyDatabase(){const e=[],r=[],s={};try{const n=await se("groundedDB",4);for(const a of n.objectStoreNames){const i=n.transaction(a,"readonly").objectStore(a),c=await i.count();if(s[a]=c,c>0){const m=(await i.getAll())[0];a==="users"&&(!m.id||!m.username||!m.passwordHash)&&e.push(`Invalid user record structure in ${a}`),a==="appData"&&(!m.userId||!m.data)&&e.push(`Invalid appData record structure in ${a}`),a==="feelingLogs"&&(!m.id||!m.timestamp)&&e.push(`Invalid feelingLog record structure in ${a}`)}}return await n.close(),{isValid:e.length===0,errors:e,warnings:r,recordCounts:{legacy:s,encrypted:{}}}}catch(n){return{isValid:!1,errors:[`Failed to validate legacy database: ${n instanceof Error?n.message:String(n)}`],warnings:[],recordCounts:{legacy:{},encrypted:{}}}}}static async validateEncryptedDatabase(e){const r=[],s=[],n={};try{const a=["users_encrypted","app_data_encrypted","feeling_logs_encrypted","goals_encrypted","goal_updates_encrypted"];for(const i of a)try{const c=await e.query(`SELECT COUNT(*) as count FROM ${i}`);n[i]=c[0]?.count||0}catch{s.push(`Table ${i} not found or empty`),n[i]=0}try{const i=await e.query("PRAGMA integrity_check"),c=i[0]?.values?.[0]?.[0]||i[0]?.count;c!=="ok"&&c!==1&&r.push("Database integrity check failed")}catch{s.push("Could not run integrity check (database may be new)")}return{isValid:r.length===0,errors:r,warnings:s,recordCounts:{legacy:{},encrypted:n}}}catch(a){return{isValid:!1,errors:[`Failed to validate encrypted database: ${a instanceof Error?a.message:String(a)}`],warnings:[],recordCounts:{legacy:{},encrypted:{}}}}}static compareRecordCounts(e,r){const s=[],n=[],a={users:"users_encrypted",appData:"app_data_encrypted",feelingLogs:"feeling_logs_encrypted",goals:"goals_encrypted"};for(const[i,c]of Object.entries(a)){const d=e[i]||0,m=r[c]||0;d!==m&&s.push(`Record count mismatch: ${i} (${d}) != ${c} (${m})`)}return{isValid:s.length===0,errors:s,warnings:n,recordCounts:{legacy:e,encrypted:r}}}static async verifyDataIntegrity(e,r){const s=[],n=[];try{if(e.objectStoreNames.contains("users")){const a=await e.getAll("users");for(const i of a.slice(0,5))try{const c=await r.query("SELECT * FROM users_encrypted WHERE id = ?",[i.id]);if(!c||c.length===0)s.push(`User ${i.id} not found in encrypted database`);else{const d=c[0];d.username!==i.username&&s.push(`Username mismatch for user ${i.id}`),d.email!==i.email&&s.push(`Email mismatch for user ${i.id}`)}}catch(c){n.push(`Could not verify user ${i.id}: ${c instanceof Error?c.message:String(c)}`)}}if(e.objectStoreNames.contains("appData")){const a=await e.getAll("appData");for(const i of a.slice(0,3))try{const c=await r.query("SELECT * FROM app_data_encrypted WHERE user_id = ?",[i.userId]);if(!c||c.length===0)s.push(`App data for user ${i.userId} not found in encrypted database`);else{const d=JSON.stringify(i.data.logs||[]),m=c[0].logs;d!==m&&n.push(`Logs structure may differ for user ${i.userId}`)}}catch(c){n.push(`Could not verify app data for user ${i.userId}: ${c instanceof Error?c.message:String(c)}`)}}if(e.objectStoreNames.contains("feelingLogs")){const a=await e.getAll("feelingLogs"),i=Math.min(5,a.length);for(const c of a.slice(0,i))try{const d=await r.query("SELECT * FROM feeling_logs_encrypted WHERE id = ?",[c.id]);(!d||d.length===0)&&n.push(`Feeling log ${c.id} not found in encrypted database`)}catch(d){n.push(`Could not verify feeling log ${c.id}: ${d instanceof Error?d.message:String(d)}`)}}return{isValid:s.length===0,errors:s,warnings:n,recordCounts:{legacy:{},encrypted:{}}}}catch(a){return{isValid:!1,errors:[`Data integrity verification failed: ${a instanceof Error?a.message:String(a)}`],warnings:[],recordCounts:{legacy:{},encrypted:{}}}}}};l(gt,"MigrationValidator");let be=gt;const ht=class ht{constructor(e){this.onProgress=e}async migrateToEncrypted(e,r){const s=[];try{this.updateProgress("Validating legacy database...",5,"running");const n=await be.validateLegacyDatabase();if(!n.isValid)return s.push(...n.errors),{success:!1,errors:s,validation:n};this.updateProgress("Creating backup...",10,"running"),await Dr(),this.updateProgress("Initializing encrypted database...",15,"running");const{EncryptedPWA:a}=await ae(async()=>{const{EncryptedPWA:w}=await Promise.resolve().then(()=>ur);return{EncryptedPWA:w}},void 0),i=await a.init(e,parseInt(r));this.updateProgress("Migrating users to authentication store...",20,"running");const c=await this.migrateUsersToAuthStore();c.success||s.push(...c.errors),this.updateProgress("Migrating users to encrypted database...",25,"running");const d=await this.migrateUsers(i);d.success||s.push(...d.errors),this.updateProgress("Migrating app data...",40,"running");const m=await this.migrateAppData(i);m.success||s.push(...m.errors),this.updateProgress("Migrating feeling logs...",60,"running");const u=await this.migrateFeelingLogs(i);u.success||s.push(...u.errors),this.updateProgress("Migrating goals...",80,"running");const x=await this.migrateGoals(i);x.success||s.push(...x.errors),this.updateProgress("Saving encrypted database...",90,"running"),await i.save(),this.updateProgress("Validating migration...",95,"running");const h=await be.validateEncryptedDatabase(i),g=be.compareRecordCounts(n.recordCounts.legacy,h.recordCounts.encrypted);g.isValid||s.push(...g.errors);const k=await se("groundedDB",4),C=await be.verifyDataIntegrity(k,i);await k.close(),C.isValid||s.push(...C.errors),this.updateProgress("Finalizing migration...",100,"completed");const A={isValid:s.length===0,errors:s,warnings:[...n.warnings,...h.warnings,...g.warnings,...C.warnings],recordCounts:{legacy:n.recordCounts.legacy,encrypted:h.recordCounts.encrypted}};return{success:s.length===0,errors:s,validation:A}}catch(n){return this.updateProgress("Migration failed",0,"error"),{success:!1,errors:[n instanceof Error?n.message:"Unknown error"],validation:{isValid:!1,errors:[n instanceof Error?n.message:"Unknown error"],warnings:[],recordCounts:{legacy:{},encrypted:{}}}}}}async migrateUsersToAuthStore(){const e=[];try{const{authStore:r}=await ae(async()=>{const{authStore:n}=await Promise.resolve().then(()=>dr);return{authStore:n}},void 0);await r.init();const s=await se("groundedDB",4);if(s.objectStoreNames.contains("users")){const n=await s.getAll("users");for(const a of n)try{if(await r.getUserByUsername(a.username)){console.log(`User ${a.username} already exists in auth store, skipping...`);continue}await r.createUser({username:a.username,passwordHash:a.passwordHash,email:a.email||"",therapistEmails:a.therapistEmails||[],termsAccepted:a.termsAccepted||!1,termsAcceptedDate:a.termsAcceptedDate||void 0})}catch(i){const c=i instanceof Error?i.message:String(i);if(c.includes("ConstraintError")||c.includes("already exists")){console.log(`User ${a.username} already exists in auth store, skipping...`);continue}e.push(`Failed to migrate user ${a.username} to auth store: ${c}`)}await s.close()}return{success:e.length===0,errors:e}}catch(r){return{success:!1,errors:[r instanceof Error?r.message:"Unknown error"]}}}async migrateUsers(e){const r=[];try{const s=await se("groundedDB",4);if(s.objectStoreNames.contains("users")){const n=await s.getAll("users");for(const a of n)try{await e.query(`INSERT INTO users_encrypted (id, username, password_hash, email, therapist_emails, terms_accepted, terms_accepted_date, created_at, last_login)
               VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,[a.id,a.username,a.passwordHash,a.email||null,JSON.stringify(a.therapistEmails||[]),a.termsAccepted?1:0,a.termsAcceptedDate||null,a.createdAt,a.lastLogin||null])}catch(i){r.push(`Failed to migrate user ${a.id}: ${i instanceof Error?i.message:String(i)}`)}await s.close()}return{success:r.length===0,errors:r}}catch(s){return{success:!1,errors:[s instanceof Error?s.message:"Unknown error"]}}}async migrateAppData(e){const r=[];try{const s=await se("groundedDB",4);if(s.objectStoreNames.contains("appData")){const n=await s.getAll("appData");for(const a of n)try{await e.query(`INSERT INTO app_data_encrypted (user_id, settings, logs, goals, "values", lcsw_config, updated_at)
               VALUES (?, ?, ?, ?, ?, ?, ?)`,[a.userId,JSON.stringify(a.data.settings||{}),JSON.stringify(a.data.logs||[]),JSON.stringify(a.data.goals||[]),JSON.stringify(a.data.values||[]),JSON.stringify(a.data.lcswConfig||{}),new Date().toISOString()])}catch(i){r.push(`Failed to migrate app data for user ${a.userId}: ${i instanceof Error?i.message:String(i)}`)}await s.close()}return{success:r.length===0,errors:r}}catch(s){return{success:!1,errors:[s instanceof Error?s.message:"Unknown error"]}}}async migrateFeelingLogs(e){const r=[];try{const s=await se("groundedDB",4);if(s.objectStoreNames.contains("feelingLogs")){const n=await s.getAll("feelingLogs");for(const a of n)try{await e.query(`INSERT INTO feeling_logs_encrypted (id, user_id, timestamp, emotional_state, selected_feeling, reflection_text, ai_analysis, created_at)
               VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[a.id,a.userId||null,a.timestamp,a.emotionalState||null,a.selectedFeeling||null,a.reflectionText||null,JSON.stringify(a.aiAnalysis||{}),a.createdAt||new Date().toISOString()])}catch(i){r.push(`Failed to migrate feeling log ${a.id}: ${i instanceof Error?i.message:String(i)}`)}await s.close()}return{success:r.length===0,errors:r}}catch(s){return{success:!1,errors:[s instanceof Error?s.message:"Unknown error"]}}}async migrateGoals(e){const r=[];try{const s=await se("groundedDB",4);if(s.objectStoreNames.contains("appData")){const n=await s.getAll("appData");for(const a of n){const i=a.data?.goals||[],c=a.userId;for(const d of i)try{const m=d.updates||[];await e.query(`INSERT INTO goals_encrypted (id, user_id, value_id, text, frequency, completed, created_at, updated_at)
                 VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[d.id,c,d.valueId,d.text,d.frequency||null,d.completed?1:0,d.createdAt,d.updatedAt||null]);for(const u of m)try{await e.query(`INSERT INTO goal_updates_encrypted (id, goal_id, timestamp, note, mood, created_at)
                     VALUES (?, ?, ?, ?, ?, ?)`,[u.id,d.id,u.timestamp,u.note||null,u.mood||null,u.createdAt||new Date().toISOString()])}catch(x){r.push(`Failed to migrate goal update ${u.id}: ${x instanceof Error?x.message:String(x)}`)}}catch(m){r.push(`Failed to migrate goal ${d.id}: ${m instanceof Error?m.message:String(m)}`)}}await s.close()}return{success:r.length===0,errors:r}}catch(s){return{success:!1,errors:[s instanceof Error?s.message:"Unknown error"]}}}updateProgress(e,r,s){this.onProgress&&this.onProgress({step:e,progress:r,status:s,message:e})}};l(ht,"MigrationService");let st=ht;const Cr=l(({onClose:o,onComplete:e})=>{const[r,s]=p.useState(""),[n,a]=p.useState(""),[i,c]=p.useState(!1),[d,m]=p.useState(null),[u,x]=p.useState(null),[h,g]=p.useState(null),[k,C]=p.useState(null),[A,w]=p.useState(!1);p.useEffect(()=>{Rt().then(j=>{C(j)})},[]);const T=l(async()=>{if(r!==n){g("Passwords do not match");return}if(r.length<8){g("Password must be at least 8 characters");return}c(!0),g(null),x(null);try{const j=sessionStorage.getItem("userId")||localStorage.getItem("userId")||"1",q=await new st(S=>{m(S)}).migrateToEncrypted(r,j);if(x(q.validation),!q.success){g(`Migration completed with errors:
${q.errors.join(`
`)}`),c(!1);return}localStorage.setItem("encryption_enabled","true"),setTimeout(()=>{e(),window.location.reload()},2e3)}catch(j){g(j instanceof Error?j.message:"Migration failed"),c(!1)}},"handleMigrate"),D=l(async()=>{if(!St()){g("No backup found to restore");return}try{await _r(),localStorage.setItem("encryption_enabled","false"),g(null),alert("Backup restored successfully. Please refresh the page."),window.location.reload()}catch(j){g(j instanceof Error?j.message:"Restore failed")}},"handleRestore");return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-dark/60 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-white dark:bg-dark-bg-primary rounded-xl shadow-xl p-8 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-2xl font-black text-text-primary dark:text-white",children:"ðŸ” Migrate to HIPAA Encryption"}),t.jsx("button",{onClick:o,className:"w-8 h-8 flex items-center justify-center rounded-full bg-bg-secondary dark:bg-dark-bg-secondary text-text-tertiary dark:text-text-tertiary hover:text-text-primary dark:hover:text-white",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),!i&&k&&k.hasLegacyData&&t.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[t.jsx("p",{className:"text-sm font-medium mb-2",children:"Pre-Migration Check"}),t.jsxs("p",{className:"text-xs text-text-secondary",children:["Found ",t.jsxs("strong",{children:[k.recordCount," records"]})," across ",k.tables.length," tables"]}),t.jsx("ul",{className:"text-xs text-text-tertiary mt-2 list-disc list-inside",children:k.tables.map(j=>t.jsx("li",{children:j},j))})]}),!i&&!u&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-text-primary dark:text-white mb-2",children:"Encryption Password"}),t.jsx("input",{type:"password",value:r,onChange:l(j=>s(j.target.value),"onChange"),className:"w-full px-4 py-3 bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-lg border border-border-soft dark:border-dark-border focus:outline-none focus:ring-2 focus:ring-yellow-warm",placeholder:"Enter password (min 8 characters)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-text-primary dark:text-white mb-2",children:"Confirm Password"}),t.jsx("input",{type:"password",value:n,onChange:l(j=>a(j.target.value),"onChange"),className:"w-full px-4 py-3 bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-lg border border-border-soft dark:border-dark-border focus:outline-none focus:ring-2 focus:ring-yellow-warm",placeholder:"Confirm password"})]}),h&&t.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:t.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:h})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:T,className:"flex-1 px-4 py-3 bg-yellow-warm text-white rounded-lg text-sm font-black uppercase tracking-widest hover:opacity-90",children:"Start Migration"}),St()&&t.jsx("button",{onClick:l(()=>w(!A),"onClick"),className:"px-4 py-3 bg-bg-secondary dark:bg-dark-bg-secondary text-text-primary dark:text-white rounded-lg text-sm font-medium hover:bg-bg-tertiary dark:hover:bg-dark-bg-tertiary",children:"Restore"})]}),A&&t.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[t.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 mb-3",children:"Restore will revert to the legacy database. This will disable encryption."}),t.jsx("button",{onClick:D,className:"w-full px-4 py-2 bg-yellow-warm text-white rounded-lg text-sm font-medium hover:opacity-90",children:"Confirm Restore"})]})]}),i&&d&&t.jsxs("div",{className:"mb-6 space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"font-medium text-text-primary dark:text-white",children:d.step}),t.jsxs("span",{className:"text-text-secondary dark:text-text-secondary",children:[d.progress,"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"bg-yellow-warm h-2 rounded-full transition-all",style:{width:`${d.progress}%`}})})]}),u&&!i&&t.jsxs("div",{className:`mb-6 p-4 rounded-lg ${u.isValid?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[t.jsx("p",{className:"text-sm font-medium mb-2 text-text-primary dark:text-white",children:u.isValid?"âœ… Migration Validated":"âš ï¸ Validation Issues"}),Object.keys(u.recordCounts.legacy).length>0&&t.jsxs("div",{className:"text-xs mt-2",children:[t.jsx("p",{className:"font-medium text-text-primary dark:text-white",children:"Record Counts:"}),Object.entries(u.recordCounts.legacy).map(([j,z])=>t.jsxs("p",{className:"text-text-secondary dark:text-text-secondary",children:[j,": ",z," â†’ ",u.recordCounts.encrypted[`${j}_encrypted`]||0]},j))]}),u.errors.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-xs font-medium text-red-600 dark:text-red-400",children:"Errors:"}),t.jsx("ul",{className:"text-xs text-red-600 dark:text-red-400 list-disc list-inside",children:u.errors.map((j,z)=>t.jsx("li",{children:j},z))})]}),u.warnings.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-xs font-medium text-yellow-600 dark:text-yellow-400",children:"Warnings:"}),t.jsx("ul",{className:"text-xs text-yellow-600 dark:text-yellow-400 list-disc list-inside",children:u.warnings.map((j,z)=>t.jsx("li",{children:j},z))})]})]})]})})},"MigrationScreen");let ue=null;async function $e(){if(ge())try{const e=await import(l(()=>"@tauri-apps/plugin-store","getTauriStoreImport")()),{Store:r}=e;ue=new r(".settings.dat")}catch(o){console.warn("Tauri store not available, falling back to localStorage:",o),ue=null}}l($e,"initStorage");let Ie=!1;typeof window<"u"&&$e().then(()=>{Ie=!0}).catch(()=>{Ie=!0});async function es(o){Ie||await $e();try{if(ge()&&ue)return await ue.get(o);{const e=localStorage.getItem(o);if(e===null)return null;try{return JSON.parse(e)}catch{return e}}}catch(e){console.error(`Error getting item ${o}:`,e);try{const r=localStorage.getItem(o);if(r===null)return null;try{return JSON.parse(r)}catch{return r}}catch{return null}}}l(es,"getItem");async function ts(o,e){Ie||await $e();try{if(ge()&&ue)await ue.set(o,e),await ue.save();else{const r=typeof e=="string"?e:JSON.stringify(e);localStorage.setItem(o,r)}}catch(r){console.error(`Error setting item ${o}:`,r);try{const s=typeof e=="string"?e:JSON.stringify(e);localStorage.setItem(o,s)}catch(s){console.error("Fallback storage also failed:",s)}}}l(ts,"setItem");async function rs(o){Ie||await $e();try{ge()&&ue?(await ue.delete(o),await ue.save()):localStorage.removeItem(o)}catch(e){console.error(`Error removing item ${o}:`,e);try{localStorage.removeItem(o)}catch(r){console.error("Fallback storage removal also failed:",r)}}}l(rs,"removeItem");async function Lr(){if(typeof window>"u"||!("Notification"in window))return"denied";if(ge())try{return Notification.permission==="default"?await Notification.requestPermission():Notification.permission}catch(o){return console.error("Error requesting notification permission:",o),"denied"}else return Notification.permission==="default"?await Notification.requestPermission():Notification.permission}l(Lr,"requestPermission");function Ot(){return typeof window>"u"||!("Notification"in window)?!1:Notification.permission==="granted"}l(Ot,"hasPermission");async function Ar(o,e){if(!Ot()&&await Lr()!=="granted"){console.warn("Notification permission not granted");return}try{if(ge())try{const s=await import(l(()=>"@tauri-apps/plugin-notification","getTauriNotifyImport")()),{sendNotification:n}=s;await n({title:o,body:e?.body||"",icon:e?.icon})}catch(r){console.warn("Tauri notification plugin not available, using browser notifications:",r),new Notification(o,e)}else new Notification(o,e)}catch(r){console.error("Error sending notification:",r)}}l(Ar,"sendNotification");const Pr=l(({progress:o,status:e="loading",label:r,showPercentage:s=!0,className:n="",height:a="md"})=>{const i=Math.max(0,Math.min(100,o)),c={sm:"h-1",md:"h-2",lg:"h-3"},d=l(()=>{switch(e){case"success":return"bg-green-500 dark:bg-green-400";case"error":return"bg-red-500 dark:bg-red-400";case"loading":return"bg-navy-primary dark:bg-navy-primary";default:return"bg-gray-400 dark:bg-gray-500"}},"getStatusColor"),m=l(()=>{switch(e){case"success":return"bg-green-50 dark:bg-green-900/20";case"error":return"bg-red-50 dark:bg-red-900/20";case"loading":return"bg-bg-secondary dark:bg-dark-bg-secondary";default:return"bg-bg-secondary dark:bg-dark-bg-secondary"}},"getStatusBg"),u=l(()=>{switch(e){case"success":return t.jsx("svg",{className:"w-5 h-5 text-green-500 dark:text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})});case"error":return t.jsx("svg",{className:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})});case"loading":return t.jsxs("svg",{className:"w-5 h-5 text-navy-primary dark:text-navy-primary animate-spin",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});default:return null}},"getStatusIcon");return t.jsxs("div",{className:`w-full ${n}`,children:[(r||s)&&t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r&&t.jsx("span",{className:"text-xs font-semibold text-text-primary dark:text-white",children:r}),s&&t.jsx("span",{className:`text-xs font-bold ${e==="success"?"text-green-600 dark:text-green-400":e==="error"?"text-red-600 dark:text-red-400":"text-text-primary dark:text-white"}`,children:e==="success"?"Complete":e==="error"?"Failed":`${Math.round(i)}%`})]}),t.jsxs("div",{className:`relative w-full ${c[a]} ${m()} rounded-full overflow-hidden`,children:[t.jsx("div",{className:`absolute top-0 left-0 ${c[a]} ${d()} rounded-full transition-all duration-300 ease-out ${e==="loading"?"animate-pulse":""}`,style:{width:`${i}%`}}),e==="loading"&&i>0&&i<100&&t.jsx("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden rounded-full",children:t.jsx("div",{className:"h-full w-1/3 bg-white/30 dark:bg-white/20 animate-shimmer"})})]}),e!=="idle"&&t.jsx("div",{className:"flex items-center justify-center mt-2",children:u()})]})},"ProgressBar");async function Rr(){if(typeof window>"u")return;const o=navigator.userAgent.toLowerCase();if(/android/.test(o))try{"serviceWorker"in navigator&&"share"in navigator&&console.log("âœ… Android launcher icon created via AndroidManifest.xml")}catch(r){console.warn("Could not create Android shortcut:",r)}}l(Rr,"createAndroidShortcut");async function Or(){if(!(typeof window>"u")&&ge())try{console.log("âœ… Desktop shortcut created by Tauri installer")}catch(o){console.warn("Could not verify desktop shortcut:",o)}}l(Or,"createDesktopShortcut");async function Ur(){if(!(typeof window>"u")&&window.matchMedia("(display-mode: standalone)").matches){console.log("âœ… PWA installed - home screen icon created automatically");return}}l(Ur,"createPWAShortcut");async function Mr(){try{await Promise.all([Rr(),Or(),Ur()]),console.log("âœ… Shortcut initialization complete")}catch(o){console.warn("Error initializing shortcuts:",o)}}l(Mr,"initializeShortcuts");let Pe=!1;async function Br(){return typeof window>"u"||!("serviceWorker"in navigator)?(console.warn("âš ï¸ Service Worker not available in this environment"),!1):Pe?!1:(Pe=!0,Promise.race([(async()=>{try{await new Promise(n=>setTimeout(n,500));const e=await navigator.serviceWorker.getRegistration();if(e){if(console.log("âœ… Service Worker registered:",e.scope),e.active)return console.log("âœ… Service Worker is ACTIVE"),!0;if(e.installing)return console.log("â³ Service Worker is installing..."),Promise.race([new Promise(a=>{const i=l(()=>{e.installing.state==="activated"?(console.log("âœ… Service Worker installation complete and ACTIVE"),a(!0)):e.installing.state==="redundant"&&(console.warn("âš ï¸ Service Worker installation failed (redundant)"),a(!1))},"stateChangeHandler");e.installing.addEventListener("statechange",i),e.installing.state==="activated"&&a(!0)}),new Promise(a=>{setTimeout(()=>{console.warn("âš ï¸ Service Worker installation timeout after 5 seconds"),a(!1)},5e3)})]);if(e.waiting)return console.log("â³ Service Worker is waiting to activate..."),e.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload(),!0;if(console.log("â³ Service Worker registered but not yet active, waiting..."),await new Promise(a=>setTimeout(a,1e3)),(await navigator.serviceWorker.getRegistration())?.active)return console.log("âœ… Service Worker is now ACTIVE"),!0}else{console.log("â³ Service Worker not yet registered, waiting for auto-registration..."),await new Promise(a=>setTimeout(a,2e3));const n=await navigator.serviceWorker.getRegistration();if(n?.active)return console.log("âœ… Service Worker auto-registered and ACTIVE"),!0;if(n)return console.log("â³ Service Worker registered but not yet active"),!0}return!1||(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?console.info("â„¹ï¸ Service Worker not active (expected in development/localhost). App will work normally."):console.warn("âš ï¸ Service Worker not active - PWA features may be limited. App will work normally."),!1}catch(e){return console.error("âŒ Error checking service worker:",e),!1}})(),new Promise(e=>{setTimeout(()=>{e(!1)},1e4)})]).then(e=>(Pe=!1,e)).catch(e=>(Pe=!1,!1)))}l(Br,"ensureServiceWorkerActive");function Fr(o){typeof window>"u"||!("serviceWorker"in navigator)||(navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("âœ… Service Worker controller changed - new version activated"),window.location.reload()}),setInterval(async()=>{try{const e=await navigator.serviceWorker.getRegistration();e&&(await e.update(),e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"}))}catch{}},300*1e3))}l(Fr,"listenForServiceWorkerUpdates");function $r(){const[o,e]=p.useState("idle"),[r,s]=p.useState(0),[n,a]=p.useState("");p.useEffect(()=>{const d=bt(),m=_e(),u=Ce();m?(e("complete"),s(100),a("Complete")):u||d.status==="downloading"||d.status==="idle"?(e("in-progress"),s(d.progress),a(d.label||"In Progress")):d.status==="error"&&!u&&!m?(e("error"),s(d.progress),a(d.label||"Error")):d.status==="complete"&&!m?(e("in-progress"),s(100),a("Verifying models...")):(e("idle"),s(0),a(""));const x=nt(g=>{const k=_e(),C=Ce();k||g.status==="success"?(e("complete"),s(100),a("Complete")):C||g.status==="loading"?(e("in-progress"),s(g.progress),a(g.label||"In Progress")):g.status==="error"&&!C&&!k&&(e("error"),s(g.progress),a(g.label||"Error"))}),h=setInterval(()=>{const g=bt(),k=_e(),C=Ce(),A=Dt();if(k){e("complete"),s(100),a("Complete");return}if(C||g.status==="downloading"){e("in-progress");const w=Math.max(g.progress||0,A.progress||0),T=k?w:Math.min(95,w);s(T),a(g.label||A.label||"Loading...");return}if(g.status==="error"&&!C&&!k)e("error"),s(g.progress),a(g.label||"Error");else if(g.status==="idle"&&C)e("in-progress"),s(A.progress||0),a(A.label||"Starting download...");else if(g.status==="complete"){e("in-progress");const w=k?Math.min(95,g.progress||90):Math.min(90,g.progress||0);s(w),a("Verifying models...")}},2e3);return()=>{x(),clearInterval(h)}},[o]);let i="";const c=_e();if(o==="complete")i="AI Ready";else if(o==="in-progress"){const d=r>=100&&!c?95:r;i=d>0?`AI Loading ${d}%`:"AI Loading..."}else if(o==="error")i="Rules Only";else{const d=Ce();if(c)i="AI Ready";else if(d){const m=r>=100&&!c?95:r;i=m>0?`AI Loading ${m}%`:"AI Loading..."}else i="Rules Only"}return{status:o,progress:r,label:n,displayText:i}}l($r,"useModelInstallationStatus");const zr=p.lazy(()=>ae(()=>import("./Dashboard-CBC0133a.js"),__vite__mapDeps([3,2,1,0,4,5,6,7,8,9]))),qr=p.lazy(()=>ae(()=>import("./ReportView-DRu6wnYs.js"),__vite__mapDeps([10,8,2,1,0,9,11]))),Wr=p.lazy(()=>ae(()=>import("./VaultControl-D18shDkc.js"),__vite__mapDeps([12,2,1,0,9,8,4,11]))),Vr=p.lazy(()=>ae(()=>import("./LCSWConfig-CvIiKOYr.js"),__vite__mapDeps([13,8,2,1,0,9,6,14]))),Gr=p.lazy(()=>ae(()=>import("./GoalsUpdateView-LdVzbQAE.js"),__vite__mapDeps([15,2,1,0,9,8,7]))),Se="app_init_started",Fe="app_init_started_time",at="app_init_complete";function It(){if(typeof sessionStorage<"u"&&sessionStorage.getItem(Se)==="true"){const e=sessionStorage.getItem(Fe);if(e){const r=Date.now()-parseInt(e,10);return r>3e4?(console.warn("[INIT] Initialization stuck for",r,"ms - resetting"),sessionStorage.removeItem(Se),sessionStorage.removeItem(Fe),!1):!0}else return console.warn("[INIT] Initialization started flag exists but no timestamp - resetting (likely from old run)"),sessionStorage.removeItem(Se),!1}return!1}l(It,"isInitializationStarted");function Ye(o){typeof sessionStorage<"u"&&(o?(sessionStorage.setItem(Se,"true"),sessionStorage.setItem(Fe,Date.now().toString())):(sessionStorage.removeItem(Se),sessionStorage.removeItem(Fe)))}l(Ye,"setInitializationStarted");function Re(){return typeof sessionStorage<"u"?sessionStorage.getItem(at)==="true":!1}l(Re,"isInitializationComplete");function Oe(o){typeof sessionStorage<"u"&&(o?sessionStorage.setItem(at,"true"):sessionStorage.removeItem(at))}l(Oe,"setInitializationComplete");const Hr=l(()=>{const[o,e]=p.useState("checking"),[r,s]=p.useState(null),[n,a]=p.useState([]),[i,c]=p.useState([]),[d,m]=p.useState([]),[u,x]=p.useState({reminders:{enabled:!1,frequency:"daily",time:"09:00"}}),[h,g]=p.useState("onboarding"),[k,C]=p.useState(!1),[A,w]=p.useState(!1),[T,D]=p.useState(!1),[j,z]=p.useState(!1),[q,S]=p.useState(!1),[W,v]=p.useState(null);let b;try{b=localStorage.getItem("encryption_enabled")==="true"}catch{b=!1}const E=Lt(),{displayText:G}=$r();p.useEffect(()=>{if(console.log("[INIT] useEffect triggered - checking guards...",{started:It(),complete:Re(),authState:o,encryptionEnabled:b,isAuthenticated:E.isAuthenticated}),E.isAuthenticated&&Re()&&(console.log("[INIT] User authenticated after login - clearing flags to allow re-initialization"),Ye(!1),Oe(!1)),Re()&&E.isAuthenticated){console.log("[INIT] âš ï¸ Initialization already completed and user authenticated, skipping...");return}if(Re()&&!E.isAuthenticated&&b){console.log("[INIT] Initialization complete - user needs to login (encryption enabled)"),o==="checking"&&(console.log("[INIT] Setting authState to login (was checking)"),e("login"));return}if(It()){console.log("[INIT] âš ï¸ Initialization already in progress, skipping...");return}Ye(!0),console.log("[INIT] âœ… Marking initialization as started");let y=!0,R=null,N=null;N=setTimeout(()=>{y&&o==="checking"&&(console.error("âš ï¸ Initialization timeout after 15 seconds - proceeding to login screen"),console.error("[INIT] This suggests a blocking operation is taking too long"),b&&!E.isAuthenticated&&S(!0),e("login"))},15e3);const O=setTimeout(()=>{y&&o==="checking"&&b&&!E.isAuthenticated&&S(!0)},5e3),B=l(async()=>{try{console.log("[INIT] Starting initialization..."),J(5,"Starting...","Initializing app"),console.log("[INIT] ðŸš€ Starting AI model loading in background (non-blocking)..."),Wt().catch(f=>{f instanceof Error&&(f.message.includes("network")||f.message.includes("fetch")||f.message.includes("Failed to fetch")||f.message.includes("No internet"))&&console.warn("[INIT] AI model loading stopped: No internet connection")}),await new Promise(f=>setTimeout(f,50)),J(10,"Initializing app...","Setting up core services"),console.log("[INIT] Progress updated to 10%"),o==="checking"&&(console.log("[INIT] Setting authState to login (non-blocking initialization)"),e("login"));try{Jt(),console.log("[INIT] Debug logging initialized")}catch(f){console.warn("[INIT] Debug logging failed (non-critical):",f)}J(20,"Checking for updates...",""),console.log("[INIT] Progress updated to 20%");let U=null;try{const{updateManager:f}=await ae(async()=>{const{updateManager:le}=await Promise.resolve().then(()=>jr);return{updateManager:le}},void 0),$=f.initialize(),H=new Promise((le,re)=>{setTimeout(()=>re(new Error("Update manager initialization timeout")),5e3)});U=await Promise.race([$,H]),console.log("[INIT] Update manager initialized:",{isNewInstall:U?.isNewInstall,isUpdate:U?.isUpdate})}catch(f){console.warn("[INIT] Update manager failed (non-critical):",f),U={isNewInstall:!1,isUpdate:!1,previousVersion:null}}U?.isNewInstall?console.log("ðŸŽ‰ New installation detected - setting up fresh app"):U?.isUpdate&&(console.log(`ðŸ”„ App updated from v${U.previousVersion} to v${U.currentVersion||"unknown"}`),console.log("âœ… User data preserved - database migrations applied")),J(30,"Setting up service worker...",""),console.log("[INIT] Progress updated to 30%");const F=await Br().catch(()=>!1);console.log(F?"âœ… Service Worker is active - starting background model loading":"âš ï¸ Service Worker not active - starting model loading anyway");try{Fr()}catch(f){console.warn("[INIT] Service worker listener failed (non-critical):",f)}if(typeof window<"u"&&"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(f=>{f&&f.update().catch($=>{console.warn("Service worker update check failed:",$)})}).catch(f=>{console.warn("Service worker registration check failed:",f)}),Mr().catch(f=>{console.warn("Failed to initialize shortcuts:",f)}),J(40,"Checking encryption...",""),console.log("[INIT] Progress updated to 40%, checking encryption..."),b?(await new Promise(f=>setTimeout(f,100)),console.log("[INIT] Encryption enabled, auth state:",{isAuthenticated:E.isAuthenticated})):console.log("[INIT] Encryption not enabled"),b){if(!E.isAuthenticated){console.log("[INIT] Encryption enabled but not authenticated - user needs to login"),J(100,"Ready!","Please login to continue"),await new Promise(f=>setTimeout(f,50));return}console.log("[INIT] User authenticated, proceeding with database initialization")}else localStorage.getItem("migration_prompt_dismissed")==="true"||Rt().then($=>{$.hasLegacyData&&y&&z(!0)}).catch(()=>{});J(50,"Initializing database...","Loading user data"),console.log("[INIT] Progress updated to 50%, initializing database...");let L;try{L=Ne(),console.log("[INIT] Database adapter obtained:",L.constructor.name)}catch(f){throw console.error("[INIT] Failed to get database adapter:",f),f}console.log("[INIT] Starting database initialization with 10s timeout...");const Z=L.init(),M=new Promise((f,$)=>{setTimeout(()=>$(new Error("Database initialization timeout after 10 seconds")),1e4)});try{await Promise.race([Z,M]),console.log("[INIT] Database initialization completed successfully")}catch(f){console.error("[INIT] Database initialization failed:",f),console.log("[INIT] Retrying database initialization...");try{await Promise.race([L.init(),new Promise(($,H)=>setTimeout(()=>H(new Error("Database retry timeout")),5e3))]),console.log("[INIT] Database initialization retry succeeded")}catch($){console.error("[INIT] Database retry failed:",$),console.warn("[INIT] Continuing without database initialization - some features may be limited")}}if(!b)try{await Promise.race([me.checkForOldDatabase(),new Promise($=>setTimeout(()=>$(!1),2e3))]).catch(()=>!1)&&D(!0)}catch(f){console.warn("[INIT] Old database check failed (non-critical):",f)}if(J(60,"Checking authentication...",""),J(40,"Preparing AI models...",""),me.cleanupExpiredTokens().catch(console.error),R=setInterval(()=>{me.cleanupExpiredTokens().catch(console.error)},3600*1e3),!y)return;if(window.location.hash.match(/^#reset\/(.+)$/)){e("login");return}if(gr()){J(70,"Loading user data...","AI models loading in background"),console.log("[INIT] Progress updated to 70%, loading user data...");const $=await(async()=>{try{console.log("[INIT] Getting current user...");const H=await Promise.race([Nt(),new Promise((le,re)=>setTimeout(()=>re(new Error("getCurrentUser timeout")),5e3))]);if(!y||!H)return console.warn("[INIT] No user found or component unmounted"),null;console.log("[INIT] User loaded:",H.id),s(H.id),J(80,"Loading app data...","AI models loading in background"),console.log("[INIT] Progress updated to 80%, loading app data...");try{const le=Ne();console.log("[INIT] Getting app data for user:",H.id);const re=await Promise.race([le.getAppData(H.id),new Promise((ee,xe)=>setTimeout(()=>xe(new Error("getAppData timeout")),5e3))]);if(!y)return console.warn("[INIT] Component unmounted during app data load"),null;if(re){a(re.values||[]),c(re.logs||[]),m(re.goals||[]);const ee=re.settings||{reminders:{enabled:!1,frequency:"daily",time:"09:00"}};ee.reminders&&!ee.reminders.frequency&&(ee.reminders.frequency="daily"),ee.aiModel||(ee.aiModel="tinyllama"),x(ee),ee.aiModel&&(Vt(ee.aiModel),Gt(!1,ee.aiModel).catch(()=>{}))}}catch(le){console.error("[INIT] Failed to load app data:",le)}return H}catch(H){return console.error("[INIT] Error loading user data:",H),null}})();J(100,"Ready!","AI models continue loading in background"),$?$.termsAccepted?e("app"):e("terms"):e("login")}else J(100,"Ready!","AI models loading in background"),e("login")}catch(U){console.error("Initialization error:",U);const F=U instanceof Error?U.message:String(U),L=F.includes("Database initialization")&&F.includes("timeout");L?(console.warn("âš ï¸ Non-critical initialization issue - proceeding to login"),J(100,"Ready!","Some features may be limited")):Ht("Initialization issue","Some features may be limited"),y&&(b&&!E.isAuthenticated&&S(!0),setTimeout(()=>{y&&e("login")},L?500:2e3))}finally{N&&clearTimeout(N)}},"initialize");return l(async()=>{const U=Date.now();try{console.log("[INIT] Starting initialize() function..."),await B();const F=Date.now()-U;console.log(`[INIT] initialize() completed successfully in ${F}ms`),Oe(!0),y&&b&&!E.isAuthenticated&&(console.log("[INIT] Encryption enabled but not authenticated - setting authState to login"),e("login")),N&&(clearTimeout(N),N=null)}catch(F){const L=Date.now()-U;console.error(`[INIT] initialize() failed after ${L}ms:`,F),Oe(!0),y&&(b&&!E.isAuthenticated&&S(!0),e("login"))}finally{}},"initializeWithTimeout")(),typeof window<"u"&&"__TAURI__"in window&&ae(async()=>{const{onOpenUrl:U,getCurrent:F}=await import("./vendor-CFU3Mex3.js").then(L=>L.y);return{onOpenUrl:U,getCurrent:F}},__vite__mapDeps([1,2,0])).then(({onOpenUrl:U,getCurrent:F})=>{y&&(U(L=>{for(const Z of L)try{const M=new URL(Z);if(M.protocol==="tauri:"&&M.hostname==="localhost"){const K=M.hash||"";K.startsWith("#reset/")&&(window.location.hash!==K&&(window.location.hash=K),window.dispatchEvent(new Event("hashchange")))}}catch(M){console.error("Error parsing deep link URL:",M)}}).catch(console.error),F().then(L=>{if(!(!y||!L||L.length===0))for(const Z of L)try{const M=new URL(Z);if(M.protocol==="tauri:"&&M.hostname==="localhost"){const K=M.hash||"";K.startsWith("#reset/")&&(window.location.hash!==K&&(window.location.hash=K),window.dispatchEvent(new Event("hashchange")))}}catch(M){console.error("Error parsing deep link URL:",M)}}).catch(()=>{}))}).catch(()=>{console.warn("Deep-link plugin not available")}),()=>{y=!1,clearTimeout(O),R&&clearInterval(R),N&&clearTimeout(N)}},[]),p.useEffect(()=>{if(r&&o==="app"){const R=setTimeout(l(async()=>{try{await me.saveAppData(r,{settings:u,logs:i,goals:d,values:n,lcswConfig:u.lcswConfig})}catch(N){console.error("Error saving app data:",N)}},"saveData"),500);return()=>clearTimeout(R)}},[r,u,i,d,n,o]),p.useEffect(()=>{if(o==="app"){const y=setTimeout(()=>{ft().catch(()=>{})},1e3);return()=>clearTimeout(y)}},[o]),p.useEffect(()=>{if(!u.reminders.enabled)return;const y=l(()=>{const N=new Date,O=N.getHours(),B=N.getMinutes();`${O.toString().padStart(2,"0")}${B.toString().padStart(2,"0")}`;const ne=N.toISOString().split("T")[0],U=N.getDay(),F=N.getDate();if(!Ot())return;const L=n.length>0&&Ue.find(de=>de.id===n[0])?.name||"your values";let Z=!1,M="";const K=u.reminders.frequency||"daily";switch(K){case"hourly":O>=8&&O<20&&B===0&&u.reminders.lastNotifiedHour!==O&&(Z=!0,M=`ðŸ’› Hourly Pulse: Are your actions right now aligned with your North Star (${L})?`);break;case"daily":const[de,f]=u.reminders.time.split(":").map(Number);O===de&&B===f&&u.reminders.lastNotifiedDay!==ne&&(Z=!0,M=`ðŸ’› Time for your daily Grounded check-in. Your North Star is ${L}.`);break;case"weekly":const $=u.reminders.dayOfWeek??0,[H,le]=u.reminders.time.split(":").map(Number);U===$&&O===H&&B===le&&u.reminders.lastNotifiedWeek!==ne&&(Z=!0,M=`ðŸ’› Weekly Reflection: Time to check in with your North Star (${L}).`);break;case"monthly":const re=u.reminders.dayOfMonth??1,[ee,xe]=u.reminders.time.split(":").map(Number);F===re&&O===ee&&B===xe&&u.reminders.lastNotifiedMonth!==ne&&(Z=!0,M=`ðŸ’› Monthly Reflection: Time to reflect on your North Star (${L}).`);break;default:const[Ut,Mt]=u.reminders.time.split(":").map(Number);O===Ut&&B===Mt&&u.reminders.lastNotifiedDay!==ne&&(Z=!0,M=`ðŸ’› Time for your daily Grounded check-in. Your North Star is ${L}.`);break}if(Z){if(Ar("Grounded",{body:M,icon:"/favicon.ico"}).catch(f=>{console.error("Failed to send notification:",f)}),u.reminders.useNtfyPush&&u.reminders.ntfyTopic&&ae(async()=>{const{sendNtfyNotification:f}=await import("./ntfyService-CH0GdzTc.js");return{sendNtfyNotification:f}},[]).then(({sendNtfyNotification:f})=>{f(M,"Grounded Reminder",{topic:u.reminders.ntfyTopic,server:u.reminders.ntfyServer}).catch($=>{console.error("Failed to send ntfy notification:",$)})}),u.reminders.useDeviceCalendar&&K!=="hourly"){const[f,$]=u.reminders.time.split(":").map(Number),H=new Date;H.setHours(f,$,0,0);const le=encodeURIComponent(`Grounded ${K.charAt(0).toUpperCase()+K.slice(1)} Check-in`),re=encodeURIComponent(M),ee=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${le}&details=${re}&dates=${H.toISOString().replace(/[-:]|\.\d{3}/g,"")}/${new Date(H.getTime()+1800*1e3).toISOString().replace(/[-:]|\.\d{3}/g,"")}`;u.reminders.calendarEventId||(window.open(ee,"_blank"),x(xe=>({...xe,reminders:{...xe.reminders,calendarEventId:Date.now().toString()}})))}const de={};K==="hourly"?de.lastNotifiedHour=O:K==="daily"?de.lastNotifiedDay=ne:K==="weekly"?de.lastNotifiedWeek=ne:K==="monthly"&&(de.lastNotifiedMonth=ne),x(f=>({...f,reminders:{...f.reminders,...de}}))}},"checkReminders"),R=setInterval(y,6e4);return y(),()=>clearInterval(R)},[u.reminders,n]),p.useEffect(()=>{o==="app"&&n.length>0&&h==="onboarding"&&g("home")},[n,h,o]);const te=l(async y=>{try{console.log("[LOGIN] handleLogin called with userId:",y),s(y),Oe(!1),Ye(!1);const R=Nt(),N=new Promise((B,ne)=>{setTimeout(()=>ne(new Error("getCurrentUser timeout")),5e3)}),O=await Promise.race([R,N]);if(console.log("[LOGIN] User data loaded:",O?"found":"not found"),O)if(O.termsAccepted){try{console.log("[LOGIN] Loading app data...");const B=Ne();console.log("[LOGIN] Database adapter:",B.constructor.name),await B.init();const ne=B.getAppData(y),U=new Promise((L,Z)=>{setTimeout(()=>Z(new Error("getAppData timeout")),5e3)}),F=await Promise.race([ne,U]);if(console.log("[LOGIN] App data loaded:",F?"found":"not found"),F){a(F.values||[]),c(F.logs||[]),m(F.goals||[]);const L=F.settings||{reminders:{enabled:!1,frequency:"daily",time:"09:00"}};L.reminders&&!L.reminders.frequency&&(L.reminders.frequency="daily"),x(L)}else console.log("[LOGIN] No app data found - using defaults")}catch(B){console.error("[LOGIN] Failed to load app data after login:",B)}console.log("[LOGIN] Setting authState to app"),e("app")}else console.log("[LOGIN] User has not accepted terms - showing terms screen"),e("terms");else console.error("[LOGIN] No user found after login"),e("login")}catch(R){console.error("[LOGIN] Error in handleLogin:",R),e("login")}},"handleLogin"),P=l(async()=>{r&&(await yr(r),e("app"),g("vault"),ft().catch(y=>{console.warn("AI model preload retry failed:",y)}))},"handleAcceptTerms"),he=l(()=>{jt(),e("login"),s(null)},"handleDeclineTerms"),ce=l(()=>{jt(),e("login"),s(null),a([]),c([]),m([]),x({reminders:{enabled:!1,frequency:"daily",time:"09:00"}}),g("onboarding")},"handleLogout"),Te=l(y=>{a(y),g("home")},"handleSelectionComplete"),De=l(y=>{c(R=>[y,...R])},"handleLogEntry"),ke=l(y=>{m(y)},"handleUpdateGoals"),ze=l((y,R)=>{m(N=>N.map(O=>O.id===y?{...O,updates:[...O.updates,R]}:O))},"handleUpdateGoalProgress"),qe=l(()=>{c([]),a([]),m([]),x({reminders:{enabled:!1,frequency:"daily",time:"09:00"}}),g("onboarding")},"handleClearData"),I=n.map(y=>Ue.find(R=>R.id===y)).filter(Boolean),_=n.length>0&&h!=="onboarding",[V,xt]=p.useState({progress:0,status:"idle",label:"Initializing...",details:""});return p.useEffect(()=>{let y=!0;const R=nt(N=>{if(y&&N.status==="idle"&&!N.label&&N.progress===0){y=!1;return}y=!1;const O=N.status==="idle"?"loading":N.status;xt(B=>B.progress===N.progress&&B.label===(N.label||"Loading...")&&B.status===O&&B.details===(N.details||"")?B:(console.log("[PROGRESS] Updating progress state:",{progress:N.progress,label:N.label,status:O}),{progress:N.progress,status:O,label:N.label||"Loading...",details:N.details||""}))});return J(0,"Initializing...","Starting app"),R},[]),p.useEffect(()=>{if(o==="checking"){const y=setTimeout(()=>{console.warn("[SAFETY] App stuck in checking state for 10 seconds - forcing login screen"),e("login")},2e4);return()=>clearTimeout(y)}},[o]),o==="checking"?t.jsx("div",{className:"min-h-screen bg-bg-primary dark:bg-dark-bg-primary flex items-center justify-center p-4",children:t.jsxs("div",{className:"text-center space-y-6 w-full max-w-md",children:[t.jsx("img",{src:"/ac-minds-logo.png",alt:"AC MINDS",className:"w-20 h-20 object-contain mx-auto",onError:l(y=>{y.target.style.display="none"},"onError")}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h2",{className:"text-xl font-black text-text-primary dark:text-white",children:V.label||"Initializing..."}),V.details&&t.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary",children:V.details}),t.jsx(Pr,{progress:V.progress,status:V.status,showPercentage:!0,height:"lg",className:"mt-4"}),V.status==="error"&&t.jsx("button",{onClick:l(()=>e("login"),"onClick"),className:"mt-4 px-4 py-2 bg-yellow-warm text-text-primary rounded-lg font-black uppercase tracking-widest text-xs hover:opacity-90 transition-all",children:"Continue to Login"})]})]})}):o==="login"?t.jsx(t.Fragment,{children:t.jsx(fr,{onLogin:te})}):o==="terms"?t.jsx(wr,{onAccept:P,onDecline:he}):["checking","login","terms","app"].includes(o)?t.jsx(Qe,{children:t.jsxs("div",{className:"min-h-screen bg-bg-primary dark:bg-dark-bg-primary text-text-primary dark:text-white flex flex-col transition-colors duration-300",children:[t.jsx("header",{className:"bg-white dark:bg-dark-bg-primary border-b border-border-soft dark:border-dark-border sticky top-0 z-40 shadow-sm dark:shadow-lg",children:t.jsxs("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 h-14 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("img",{src:"/ac-minds-logo.png",alt:"AC MINDS",className:"w-7 h-7 object-contain"}),t.jsx("span",{className:"font-bold text-base sm:text-lg tracking-tight text-text-primary dark:text-white hidden sm:inline",children:"Grounded"}),o==="app"&&G&&t.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full border ${G==="AI Ready"?"bg-green-500/20 dark:bg-green-500/30 text-green-600 dark:text-green-400 border-green-500/30":"bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm dark:text-yellow-warm border-yellow-warm/30"}`,children:G})]}),t.jsxs("div",{className:"flex items-center space-x-1.5 sm:space-x-2",children:[_&&t.jsxs("nav",{className:"hidden lg:flex items-center space-x-0.5 sm:space-x-1",children:[t.jsxs("button",{onClick:l(()=>{g("home"),window.__dashboardReset&&window.__dashboardReset(),window.scrollTo({top:0,behavior:"smooth"})},"onClick"),className:`px-2 sm:px-3 py-1.5 rounded-lg text-xs sm:text-sm font-bold transition-colors ${h==="home"?"bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm dark:text-yellow-warm":"text-text-secondary dark:text-text-secondary hover:text-text-primary dark:hover:text-white hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary"}`,children:[t.jsx("span",{className:"hidden sm:inline",children:"Home"}),t.jsx("span",{className:"sm:hidden",children:"H"})]}),t.jsxs("button",{onClick:l(()=>g("values"),"onClick"),className:`px-2 sm:px-3 py-1.5 rounded-lg text-xs sm:text-sm font-bold transition-colors ${h==="values"?"bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm dark:text-yellow-warm":"text-text-secondary dark:text-text-secondary hover:text-text-primary dark:hover:text-white hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary"}`,children:[t.jsx("span",{className:"hidden sm:inline",children:"Values"}),t.jsx("span",{className:"sm:hidden",children:"V"})]}),t.jsxs("button",{onClick:l(()=>g("goals"),"onClick"),className:`px-2 sm:px-3 py-1.5 rounded-lg text-xs sm:text-sm font-bold transition-colors ${h==="goals"?"bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm dark:text-yellow-warm":"text-text-secondary dark:text-text-secondary hover:text-text-primary dark:hover:text-white hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary"}`,children:[t.jsx("span",{className:"hidden sm:inline",children:"Goals"}),t.jsx("span",{className:"sm:hidden",children:"G"})]}),t.jsxs("button",{onClick:l(()=>g("report"),"onClick"),className:`px-2 sm:px-3 py-1.5 rounded-lg text-xs sm:text-sm font-bold transition-colors ${h==="report"?"bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm dark:text-yellow-warm":"text-text-secondary dark:text-text-secondary hover:text-text-primary dark:hover:text-white hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary"}`,children:[t.jsx("span",{className:"hidden sm:inline",children:"Reports"}),t.jsx("span",{className:"sm:hidden",children:"R"})]}),t.jsxs("button",{onClick:l(()=>g("vault"),"onClick"),className:`px-2 sm:px-3 py-1.5 rounded-lg text-xs sm:text-sm font-bold transition-colors ${h==="vault"?"bg-yellow-warm/20 dark:bg-yellow-warm/30 text-yellow-warm dark:text-yellow-warm":"text-text-secondary dark:text-text-secondary hover:text-text-primary dark:hover:text-white hover:bg-bg-secondary dark:hover:bg-dark-bg-secondary"}`,children:[t.jsx("span",{className:"hidden sm:inline",children:"Vault"}),t.jsx("span",{className:"sm:hidden",children:"V"})]})]}),_&&t.jsx("button",{onClick:l(()=>w(!0),"onClick"),className:"w-8 h-8 flex items-center justify-center rounded-full text-text-secondary dark:text-text-secondary hover:text-yellow-warm dark:hover:text-yellow-warm hover:bg-yellow-warm/10 dark:hover:bg-yellow-warm/20 transition-all","aria-label":"Configuration",title:"Configuration",children:t.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),t.jsx(cr,{}),t.jsx("button",{onClick:l(()=>C(!0),"onClick"),className:"w-8 h-8 flex items-center justify-center rounded-full text-text-secondary dark:text-text-secondary hover:text-yellow-warm dark:hover:text-yellow-warm hover:bg-yellow-warm/10 dark:hover:bg-yellow-warm/20 transition-all","aria-label":"Help",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("button",{onClick:ce,className:"w-8 h-8 flex items-center justify-center rounded-full text-text-secondary dark:text-text-secondary hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all","aria-label":"Logout",title:"Logout",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})]})}),t.jsxs("main",{className:"flex-grow max-w-4xl w-full mx-auto px-3 sm:px-4 py-4 sm:py-6 pb-24 lg:pb-6",children:[h==="onboarding"&&t.jsx(wt,{initialSelected:n,onComplete:Te}),h==="values"&&t.jsx(wt,{initialSelected:n,onComplete:Te,onAddGoal:l(y=>{v(y),g("home")},"onAddGoal"),goals:d}),h==="home"&&t.jsx(p.Suspense,{fallback:t.jsx(ve,{lines:5,showHeader:!0}),children:t.jsx(zr,{values:I,onLog:De,goals:d,onUpdateGoals:ke,logs:i,lcswConfig:u.lcswConfig,onNavigate:l(y=>{g(y),y!=="home"&&v(null)},"onNavigate"),initialValueId:W})}),h==="report"&&t.jsx(p.Suspense,{fallback:t.jsx(ve,{lines:5,showHeader:!0}),children:t.jsx(qr,{logs:i,values:I,lcswConfig:u.lcswConfig})}),h==="vault"&&t.jsx(p.Suspense,{fallback:t.jsx(ve,{lines:5,showHeader:!0}),children:t.jsx(Wr,{logs:i,goals:d,settings:u,onUpdateSettings:x,onClearData:qe,selectedValueIds:n})}),h==="goals"&&t.jsx(p.Suspense,{fallback:t.jsx(ve,{lines:5,showHeader:!0}),children:t.jsx(Gr,{goals:d,values:I,lcswConfig:u.lcswConfig,onUpdateGoal:ze,onCompleteGoal:l(y=>{const R={...y,completed:!0};De({id:Date.now().toString()+"-done",date:new Date().toISOString(),valueId:y.valueId,livedIt:!0,note:`Achieved Commitment: ${y.text.substring(0,40)}...`,type:"goal-completion",goalText:y.text}),ke(d.map(N=>N.id===y.id?R:N))},"onCompleteGoal"),onDeleteGoal:l(y=>ke(d.filter(R=>R.id!==y)),"onDeleteGoal")})})]}),_&&t.jsx(kr,{currentView:h,onViewChange:l(y=>g(y),"onViewChange")}),k&&t.jsx(or,{onClose:l(()=>C(!1),"onClose")}),T&&t.jsx(Er,{onConfirm:l(async()=>{D(!1);try{await me.deleteOldDatabase(),await Ne().init(),console.log("âœ… Database migration completed successfully")}catch(y){console.error("Error during database migration:",y)}},"onConfirm"),onCancel:l(()=>{D(!1),console.warn("User cancelled database migration - old database may still exist"),Ne().init().catch(R=>{console.warn("Database initialization after cancel:",R)})},"onCancel")}),j&&t.jsx(Cr,{onClose:l(()=>{z(!1),localStorage.setItem("migration_prompt_dismissed","true")},"onClose"),onComplete:l(()=>{z(!1),window.location.reload()},"onComplete")}),t.jsx(Sr,{}),o==="app"&&t.jsx(Ir,{}),A&&t.jsx(p.Suspense,{fallback:t.jsx(ve,{lines:5,showHeader:!0}),children:t.jsx(Vr,{config:u.lcswConfig,onUpdate:l(y=>x({...u,lcswConfig:y}),"onUpdate"),onClose:l(()=>w(!1),"onClose"),settings:u,onUpdateSettings:x})}),t.jsx("footer",{className:"py-4 text-center text-text-tertiary dark:text-text-tertiary text-xs sm:text-sm font-medium tracking-wide",children:t.jsx("p",{children:"Private & Secure. All AI processing happens on your device."})})]})}):t.jsx("div",{className:"min-h-screen bg-bg-primary dark:bg-dark-bg-primary flex items-center justify-center p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Invalid State"}),t.jsxs("p",{className:"mb-4",children:["AuthState: ",String(o)]}),t.jsx("button",{onClick:l(()=>e("login"),"onClick"),className:"px-4 py-2 bg-blue-500 text-white rounded",children:"Go to Login"})]})})},"App");window.addEventListener("error",o=>{console.error("Global error:",o.error,o.error?.stack),o.error&&console.error("Error details:",{message:o.error.message,stack:o.error.stack,filename:o.filename,lineno:o.lineno,colno:o.colno})});window.addEventListener("unhandledrejection",o=>{console.error("Unhandled promise rejection:",o.reason),o.reason instanceof Error&&console.error("Rejection details:",{message:o.reason.message,stack:o.reason.stack})});const Ee=document.getElementById("root");if(!Ee)throw document.body.innerHTML=`
    <div style="padding: 20px; font-family: sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; background-color: #f6f7f9;">
      <h1 style="font-size: 24px; margin-bottom: 16px; color: #000;">Critical Error</h1>
      <p style="margin-bottom: 16px; color: #666;">Root element not found. Please check the HTML structure.</p>
      <button onclick="window.location.reload()" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 16px;">
        Reload
      </button>
    </div>
  `,new Error("Could not find root element to mount to");Ee.innerHTML=`
  <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background-color: #f6f7f9; font-family: 'Inter', sans-serif;">
    <div style="text-align: center;">
      <img src="/ac-minds-logo.png" alt="AC MINDS" style="width: 80px; height: 80px; margin: 0 auto 24px; object-fit: contain;" onerror="this.style.display='none'" />
      <h2 style="font-size: 20px; font-weight: 900; color: #000; margin-bottom: 16px;">Loading...</h2>
      <div style="width: 200px; height: 4px; background-color: #e5e7eb; border-radius: 2px; margin: 0 auto; overflow: hidden;">
        <div style="width: 30%; height: 100%; background-color: #02295b; animation: pulse 1.5s ease-in-out infinite;"></div>
      </div>
      <style>
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
      </style>
    </div>
  </div>
`;const Et=setTimeout(()=>{Ee.innerHTML.includes("Initializing...")&&(console.error("React failed to render within 5 seconds - showing error screen"),Ee.innerHTML=`
      <div style="padding: 20px; font-family: sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; background-color: #f6f7f9;">
        <h1 style="font-size: 24px; margin-bottom: 16px; color: #000;">Loading Timeout</h1>
        <p style="margin-bottom: 16px; color: #666; text-align: center; max-width: 500px;">The app is taking longer than expected to load. This may be due to a network issue or a problem with the deployment.</p>
        <p style="margin-bottom: 16px; color: #999; font-size: 14px;">Check the browser console (F12) for error details.</p>
        <button onclick="window.location.reload()" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 16px;">
          Reload
        </button>
      </div>
    `)},5e3),Tt=Ft.createRoot(Ee);try{Tt.render(t.jsx(ir,{children:t.jsx(Hr,{})})),clearTimeout(Et)}catch(o){clearTimeout(Et),console.error("Error mounting App:",o),Tt.render(t.jsxs("div",{style:{padding:"20px",fontFamily:"sans-serif",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",backgroundColor:"#fff"},children:[t.jsx("h1",{style:{fontSize:"24px",marginBottom:"16px",color:"#000"},children:"Error Loading App"}),t.jsx("p",{style:{marginBottom:"16px",color:"#666"},children:String(o)}),o instanceof Error&&o.stack&&t.jsx("pre",{style:{fontSize:"12px",color:"#999",maxWidth:"600px",overflow:"auto",textAlign:"left",padding:"16px",backgroundColor:"#f5f5f5",borderRadius:"4px"},children:o.stack}),t.jsx("button",{onClick:l(()=>window.location.reload(),"onClick"),style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginTop:"16px"},children:"Reload"})]}))}export{Ue as A,ve as S,Le as a,es as b,ts as c,me as d,rs as e,At as f,Nt as g,Ot as h,Lr as r,Ar as s};
